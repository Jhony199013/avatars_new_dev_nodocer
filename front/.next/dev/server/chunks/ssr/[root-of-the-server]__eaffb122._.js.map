{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/lib/supabaseClient.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || \"\";\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || \"\";\n\n// Создаем клиент только если переменные окружения установлены\n// Во время сборки может не быть переменных окружения\nexport const supabase = supabaseUrl && supabaseAnonKey\n  ? createClient(supabaseUrl, supabaseAnonKey)\n  : createClient(\"https://placeholder.supabase.co\", \"placeholder-key\");\n\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,gEAAwC;AAC5D,MAAM,kBAAkB,iNAA6C;AAI9D,MAAM,WAAW,uCACpB,IAAA,uMAAY,EAAC,aAAa,mBAC1B"}},
    {"offset": {"line": 41, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/material/editor/servers/getSlideAudioUrl.ts"],"sourcesContent":["\"use server\";\r\n\r\ntype GetSlideAudioUrlParams = {\r\n  userUuid: string;\r\n  slideNumber: number;\r\n  voiceId: string;\r\n};\r\n\r\nconst BASE_S3_URL = \"https://s3.twcstorage.ru/da2ac12a-41cc63a3-3ad9-4eee-a33a-7776f7973de7\";\r\n\r\nexport async function getSlideAudioUrl({\r\n  userUuid,\r\n  slideNumber,\r\n  voiceId,\r\n}: GetSlideAudioUrlParams): Promise<string> {\r\n  if (!userUuid) {\r\n    throw new Error(\"Не удалось определить пользователя\");\r\n  }\r\n  if (!voiceId) {\r\n    throw new Error(\"Не указан voice_id для слайда\");\r\n  }\r\n  if (!Number.isFinite(slideNumber) || slideNumber <= 0) {\r\n    throw new Error(\"Неверный номер слайда\");\r\n  }\r\n\r\n  const safeUuid = encodeURIComponent(userUuid.trim());\r\n  const safeVoiceId = encodeURIComponent(voiceId.trim());\r\n\r\n  return `${BASE_S3_URL}/temp/${safeUuid}/TTS/${slideNumber}_${safeVoiceId}`;\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;IAUsB,mBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 53, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/material/editor/components/EditorSidebar.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef, useState } from \"react\";\nimport Image from \"next/image\";\nimport { supabase } from \"@/lib/supabaseClient\";\nimport { getSlideAudioUrl } from \"../servers/getSlideAudioUrl\";\nimport type {\n  AspectRatio,\n  AvatarOption,\n  Scene,\n  VoiceOption,\n} from \"./types\";\n\ntype EditorSidebarProps = {\n  aspectRatio: AspectRatio;\n  onAspectRatioChange: (ratio: AspectRatio) => void;\n  videoTitle: string;\n  onVideoTitleChange: (value: string) => void;\n  avatars: AvatarOption[];\n  isLoadingAvatars: boolean;\n  voices: VoiceOption[];\n  isLoadingVoices: boolean;\n  scenes: Scene[];\n  activeSceneId: string;\n  onSelectScene: (sceneId: string) => void;\n  onAddScene: (afterSceneId?: string) => void;\n  onDeleteScene: (sceneId: string) => void;\n  onSceneVoiceChange: (sceneId: string, voiceId: string | null) => void;\n  onSceneScriptChange: (sceneId: string, script: string) => void;\n  onSceneAvatarChange: (sceneId: string, avatarId: string | null) => void;\n};\n\ntype ManagedAudio = HTMLAudioElement & {\n  __handlers?: {\n    onPlay: ((this: GlobalEventHandlers, ev: Event) => any) | null;\n    onPause: ((this: GlobalEventHandlers, ev: Event) => any) | null;\n    onEnded: ((this: GlobalEventHandlers, ev: Event) => any) | null;\n    onError: ((this: GlobalEventHandlers, ev: Event) => any) | null;\n  };\n};\n\nconst ratioOptions: { label: string; value: AspectRatio }[] = [\n  { label: \"16:9\", value: \"16:9\" },\n  { label: \"9:16\", value: \"9:16\" },\n];\n\nexport function EditorSidebar({\n  aspectRatio,\n  onAspectRatioChange,\n  videoTitle,\n  onVideoTitleChange,\n  avatars,\n  isLoadingAvatars,\n  voices,\n  isLoadingVoices,\n  scenes,\n  activeSceneId,\n  onSelectScene,\n  onAddScene,\n  onDeleteScene,\n  onSceneVoiceChange,\n  onSceneScriptChange,\n  onSceneAvatarChange,\n}: EditorSidebarProps) {\n  const [openAvatarModalForSceneId, setOpenAvatarModalForSceneId] = useState<string | null>(null);\n  const [openVoiceModalForSceneId, setOpenVoiceModalForSceneId] = useState<string | null>(null);\n  const [playingSceneId, setPlayingSceneId] = useState<string | null>(null);\n  const [loadingSceneId, setLoadingSceneId] = useState<string | null>(null);\n  const audioRefs = useRef<Record<string, HTMLAudioElement>>({});\n  // Сохраняем последний отправленный текст для каждого слайда\n  const lastSentTexts = useRef<Record<string, string>>({});\n\n  // Очистка аудио при размонтировании компонента\n  useEffect(() => {\n    return () => {\n      Object.values(audioRefs.current).forEach((audio) => {\n        const managed = audio as ManagedAudio;\n        audio.pause();\n        audio.onplay = null;\n        audio.onpause = null;\n        audio.onended = null;\n        audio.onerror = null;\n        managed.__handlers = undefined;\n        audio.removeAttribute(\"src\");\n        audio.src = \"\";\n      });\n      audioRefs.current = {};\n    };\n  }, []);\n\n  // Останавливает воспроизведение на всех слайдах, кроме указанного\n  const stopOtherScenesAudio = (currentSceneId: string) => {\n    Object.entries(audioRefs.current).forEach(([id, audio]) => {\n      if (id !== currentSceneId && audio.src) {\n        audio.pause();\n        audio.currentTime = 0;\n      }\n    });\n  };\n\n  const handlePlayClick = async (sceneId: string, sceneIndex: number) => {\n    const scene = scenes.find((s) => s.id === sceneId);\n    if (!scene || !scene.avatarId || !scene.script || scene.script.trim() === \"\") {\n      return;\n    }\n\n    // Находим выбранный голос и получаем его voice_id из таблицы\n    const selectedVoice = voices.find((voice) => voice.id === scene.voiceId);\n    if (!selectedVoice || !selectedVoice.voice_id) {\n      alert(\"У выбранного голоса отсутствует voice_id\");\n      return;\n    }\n\n    // Извлекаем номер слайда из title (например, \"Слайд 1\" -> 1)\n    const slideNumberMatch = scene.title.match(/\\d+/);\n    const slideNumber = slideNumberMatch ? parseInt(slideNumberMatch[0], 10) : sceneIndex + 1;\n\n    try {\n      const {\n        data: { user },\n      } = await supabase.auth.getUser();\n      const userUuid = user?.id;\n      if (!userUuid) {\n        throw new Error(\"Не удалось определить пользователя\");\n      }\n\n      const baseAudioUrl = await getSlideAudioUrl({\n        userUuid,\n        slideNumber,\n        voiceId: selectedVoice.voice_id,\n      });\n\n      const currentText = scene.script.trim();\n      const lastSentText = lastSentTexts.current[sceneId];\n      const textChanged = lastSentText !== currentText;\n\n      const existingAudio = audioRefs.current[sceneId];\n      if (!textChanged && existingAudio && existingAudio.src.startsWith(baseAudioUrl)) {\n        if (!existingAudio.paused) {\n          existingAudio.pause();\n          setPlayingSceneId((current) => (current === sceneId ? null : current));\n        } else {\n          stopOtherScenesAudio(sceneId);\n          await existingAudio.play();\n          setPlayingSceneId(sceneId);\n        }\n        return;\n      }\n\n      setLoadingSceneId(sceneId);\n\n      const response = await fetch(\"https://rueleven.ru/webhook/d08c47c0-82c3-4b50-a7e0-e1b525c5498b\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          voice_id: selectedVoice.voice_id, // voice_id из таблицы voices\n          slide_number: slideNumber, // Номер слайда\n          text: currentText,\n          uuid: userUuid,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      // Ожидаем подтверждение от n8n, что файл готов: [{ \"success\": true }] или { \"success\": true }\n      let json: unknown;\n      try {\n        json = await response.json();\n      } catch {\n        throw new Error(\"Некорректный JSON ответ от вебхука\");\n      }\n\n      let success = false;\n      if (Array.isArray(json) && json.length > 0 && typeof json[0] === \"object\" && json[0] !== null) {\n        success = Boolean((json[0] as { success?: unknown }).success);\n      } else if (json && typeof json === \"object\") {\n        success = Boolean((json as { success?: unknown }).success);\n      }\n\n      if (!success) {\n        console.error(\"Неожиданный ответ вебхука, ожидали success=true:\", json);\n        throw new Error(\"Вебхук не вернул success=true, аудио может быть не готово\");\n      }\n\n      console.log(\"Вебхук успешно завершил генерацию для слайда:\", slideNumber);\n\n      // Сохраняем отправленный текст (используется для определения, изменился ли текст)\n      lastSentTexts.current[sceneId] = currentText;\n\n      // Если текст изменился, добавляем cache-buster к URL, чтобы браузер не брал старое аудио из кеша\n      const audioUrl = textChanged ? `${baseAudioUrl}?t=${Date.now()}` : baseAudioUrl;\n\n      console.log(\"Воспроизведение аудио по URL:\", audioUrl);\n\n      // Останавливаем воспроизведение на других слайдах\n      stopOtherScenesAudio(sceneId);\n\n      // Создаем или используем существующий audio элемент\n      let audio = audioRefs.current[sceneId] as ManagedAudio | undefined;\n      if (!audio) {\n        audio = new Audio() as ManagedAudio;\n\n        const handlePlay = () => {\n          setPlayingSceneId(sceneId);\n          setLoadingSceneId(null);\n        };\n\n        const handlePause = () => {\n          setPlayingSceneId((current) => (current === sceneId ? null : current));\n        };\n\n        const handleEnded = () => {\n          setPlayingSceneId((current) => (current === sceneId ? null : current));\n        };\n\n        const handleError = (event: Event | string) => {\n          if (typeof event === \"string\") {\n            console.error(\"Ошибка загрузки аудио:\", event);\n            setLoadingSceneId(null);\n            setPlayingSceneId((current) => (current === sceneId ? null : current));\n            return;\n          }\n\n          const audioElement = event.currentTarget as HTMLAudioElement;\n          const hasSrcAttr = audioElement.getAttribute(\"src\");\n          if (!hasSrcAttr || hasSrcAttr === \"\") {\n            return;\n          }\n          console.error(\"Ошибка загрузки аудио:\", event);\n          setLoadingSceneId(null);\n          setPlayingSceneId((current) => (current === sceneId ? null : current));\n          if (audioElement.error) {\n            console.error(\"Код ошибки:\", audioElement.error.code);\n            console.error(\"Сообщение:\", audioElement.error.message);\n          }\n        };\n\n        audio.onplay = handlePlay;\n        audio.onpause = handlePause;\n        audio.onended = handleEnded;\n        audio.onerror = handleError;\n        audio.__handlers = {\n          onPlay: handlePlay,\n          onPause: handlePause,\n          onEnded: handleEnded,\n          onError: handleError,\n        };\n\n        audioRefs.current[sceneId] = audio;\n      }\n\n      // Устанавливаем источник и воспроизводим\n      audio.setAttribute(\"src\", audioUrl);\n      audio.src = audioUrl;\n      await audio.play();\n      setPlayingSceneId(sceneId);\n      setLoadingSceneId(null);\n      console.log(\"Воспроизведение начато\");\n    } catch (error) {\n      setLoadingSceneId(null);\n      console.error(\"Ошибка при отправке вебхука или воспроизведении:\", error);\n      alert(error instanceof Error ? error.message : \"Не удалось отправить вебхук или воспроизвести аудио\");\n    }\n  };\n\n  return (\n    <>\n      <aside className=\"flex h-full min-h-0 flex-col overflow-hidden rounded-3xl border border-gray-100 bg-white shadow-sm ring-1 ring-black/5\">\n        <div className=\"flex-shrink-0 space-y-6 border-b border-gray-100 p-6\">\n          <div className=\"space-y-3\">\n            <p className=\"text-sm uppercase tracking-[0.2em] text-gray-500\">\n              Настройка слайдов\n            </p>\n            <div className=\"flex items-center gap-3\">\n              {ratioOptions.map(({ label, value }) => {\n                const isActive = aspectRatio === value;\n                return (\n                  <button\n                    key={value}\n                    type=\"button\"\n                    onClick={() => onAspectRatioChange(value)}\n                    className={`flex h-12 flex-1 items-center justify-center rounded-2xl border text-sm font-semibold transition ${\n                      isActive\n                        ? \"border-gray-900 bg-gray-900 text-white\"\n                        : \"border-gray-200 text-gray-600 hover:border-gray-300 hover:text-gray-900\"\n                    }`}\n                  >\n                    {label}\n                  </button>\n                );\n              })}\n            </div>\n          </div>\n\n          <label className=\"block space-y-2\">\n            <span className=\"text-sm text-gray-600\">Название видео</span>\n            <input\n              type=\"text\"\n              value={videoTitle}\n              onChange={(event) => onVideoTitleChange(event.target.value)}\n              placeholder=\"Untitled Video\"\n              className=\"w-full rounded-2xl border border-gray-200 bg-white px-4 py-3 text-sm text-gray-900 outline-none placeholder:text-gray-400 focus:border-gray-900 focus:ring-1 focus:ring-gray-900\"\n            />\n          </label>\n        </div>\n\n        <div className=\"flex-1 min-h-0 space-y-2 overflow-y-auto p-4 [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-track]:bg-gray-100 [&::-webkit-scrollbar-thumb]:bg-gray-300 [&::-webkit-scrollbar-thumb]:rounded-full\">\n          {scenes.map((scene, index) => {\n            const isActive = scene.id === activeSceneId;\n            const selectedAvatar = avatars.find((avatar) => avatar.id === scene.avatarId);\n            const selectedVoice = voices.find((voice) => voice.id === scene.voiceId);\n\n            return (\n              <div key={scene.id} className=\"space-y-2\">\n                <div\n                  className={`rounded-2xl p-4 transition ${\n                    isActive\n                      ? \"bg-gray-50\"\n                      : \"bg-white hover:bg-gray-50/50\"\n                  }`}\n                  onClick={() => onSelectScene(scene.id)}\n                >\n                  <div className=\"space-y-3\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full bg-gray-200 text-sm font-semibold text-gray-700\">\n                        {index + 1}\n                      </div>\n                      <button\n                        type=\"button\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          setOpenAvatarModalForSceneId(scene.id);\n                        }}\n                        className=\"flex items-center gap-1 rounded-xl bg-gray-100 px-3 py-2 transition hover:bg-gray-200\"\n                      >\n                        {selectedAvatar ? (\n                          <>\n                            <div className=\"relative h-8 w-8 flex-shrink-0 overflow-hidden rounded-full\">\n                              <Image\n                                src={selectedAvatar.photo}\n                                alt={selectedAvatar.name}\n                                fill\n                                className=\"object-cover\"\n                                unoptimized\n                              />\n                            </div>\n                            <span className=\"text-left text-xs font-medium text-gray-900 whitespace-nowrap\">\n                              Аватар\n                            </span>\n                          </>\n                        ) : (\n                          <>\n                            <div className=\"flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full border-2 border-dashed border-gray-300 bg-white\">\n                              <span className=\"text-sm text-gray-400\">＋</span>\n                            </div>\n                            <span className=\"text-left text-xs text-gray-500 whitespace-nowrap\">\n                              Аватар\n                            </span>\n                          </>\n                        )}\n                      </button>\n                      <button\n                        type=\"button\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          setOpenVoiceModalForSceneId(scene.id);\n                        }}\n                        className=\"flex items-center gap-1 rounded-xl bg-gray-100 px-3 py-2 transition hover:bg-gray-200\"\n                      >\n                        {selectedVoice ? (\n                          <>\n                            <div className=\"flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full border-2 border-dashed border-gray-300 bg-white\">\n                              <svg\n                                xmlns=\"http://www.w3.org/2000/svg\"\n                                viewBox=\"0 0 24 24\"\n                                fill=\"none\"\n                                stroke=\"currentColor\"\n                                strokeWidth={2}\n                                className=\"h-4 w-4 text-gray-400\"\n                              >\n                                <path d=\"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z\" />\n                                <path d=\"M19 10v2a7 7 0 0 1-14 0v-2\" />\n                                <line x1=\"12\" y1=\"19\" x2=\"12\" y2=\"23\" />\n                                <line x1=\"8\" y1=\"23\" x2=\"16\" y2=\"23\" />\n                              </svg>\n                            </div>\n                            <span className=\"text-left text-xs font-medium text-gray-900 whitespace-nowrap\">\n                              {selectedVoice.name}\n                            </span>\n                          </>\n                        ) : (\n                          <>\n                            <div className=\"flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full border-2 border-dashed border-gray-300 bg-white\">\n                              <span className=\"text-sm text-gray-400\">＋</span>\n                            </div>\n                            <span className=\"text-left text-xs text-gray-500 whitespace-nowrap\">\n                              Голос\n                            </span>\n                          </>\n                        )}\n                      </button>\n                      <button\n                        type=\"button\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          handlePlayClick(scene.id, index);\n                        }}\n                        disabled={\n                          !scene.avatarId ||\n                          !scene.voiceId ||\n                          !scene.script ||\n                          scene.script.trim() === \"\" ||\n                          loadingSceneId === scene.id\n                        }\n                        className=\"ml-auto flex h-9 w-9 flex-shrink-0 items-center justify-center rounded-xl bg-gray-100 text-gray-900 transition hover:bg-gray-200 disabled:bg-gray-50 disabled:text-gray-300\"\n                        aria-label={playingSceneId === scene.id ? \"Поставить на паузу\" : \"Воспроизвести голос\"}\n                      >\n                        {loadingSceneId === scene.id ? (\n                          <svg\n                            className=\"h-4 w-4 animate-spin text-gray-600\"\n                            xmlns=\"http://www.w3.org/2000/svg\"\n                            fill=\"none\"\n                            viewBox=\"0 0 24 24\"\n                          >\n                            <circle\n                              className=\"opacity-25\"\n                              cx=\"12\"\n                              cy=\"12\"\n                              r=\"10\"\n                              stroke=\"currentColor\"\n                              strokeWidth=\"4\"\n                            />\n                            <path\n                              className=\"opacity-75\"\n                              fill=\"currentColor\"\n                              d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n                            />\n                          </svg>\n                        ) : playingSceneId === scene.id ? (\n                          <svg\n                            xmlns=\"http://www.w3.org/2000/svg\"\n                            viewBox=\"0 0 24 24\"\n                            fill=\"currentColor\"\n                            className=\"h-4 w-4\"\n                          >\n                            <path d=\"M6 4h4v16H6V4zm8 0h4v16h-4V4z\" />\n                          </svg>\n                        ) : (\n                          <svg\n                            xmlns=\"http://www.w3.org/2000/svg\"\n                            viewBox=\"0 0 24 24\"\n                            fill=\"currentColor\"\n                            className=\"h-4 w-4\"\n                          >\n                            <path d=\"M8 5v14l11-7z\" />\n                          </svg>\n                        )}\n                      </button>\n                      {scenes.length > 1 && (\n                        <button\n                          type=\"button\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            onDeleteScene(scene.id);\n                          }}\n                          className=\"flex h-9 w-9 flex-shrink-0 items-center justify-center rounded-xl bg-red-50 text-red-600 transition hover:bg-red-100\"\n                          aria-label=\"Удалить слайд\"\n                        >\n                          <svg\n                            xmlns=\"http://www.w3.org/2000/svg\"\n                            viewBox=\"0 0 24 24\"\n                            fill=\"none\"\n                            stroke=\"currentColor\"\n                            strokeWidth={2}\n                            className=\"h-4 w-4\"\n                          >\n                            <path d=\"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2\" />\n                          </svg>\n                        </button>\n                      )}\n                    </div>\n\n                    <textarea\n                      value={scene.script}\n                      onChange={(event) =>\n                        onSceneScriptChange(scene.id, event.target.value)\n                      }\n                      onClick={(e) => e.stopPropagation()}\n                      rows={3}\n                      placeholder=\"Напишите текст\"\n                      className=\"w-full resize-none rounded-xl border border-gray-200 bg-white px-3 py-2 text-xs text-gray-900 outline-none placeholder:text-gray-400 focus:border-gray-900 focus:ring-1 focus:ring-gray-900\"\n                    />\n                  </div>\n                </div>\n\n                <button\n                  type=\"button\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    onAddScene(scene.id);\n                  }}\n                  className=\"flex w-full items-center justify-center gap-2 rounded-xl bg-gray-100 px-3 py-2 text-xs font-medium text-gray-700 transition hover:bg-gray-200\"\n                >\n                  <span className=\"text-sm\">＋</span>\n                  Слайд\n                </button>\n              </div>\n            );\n          })}\n        </div>\n      </aside>\n\n      {openAvatarModalForSceneId && (\n        <div\n          className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4\"\n          onClick={() => setOpenAvatarModalForSceneId(null)}\n        >\n          <div\n            className=\"w-full max-w-2xl rounded-3xl border border-gray-100 bg-white p-6 shadow-xl\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            <div className=\"mb-4 flex items-center justify-between\">\n              <h2 className=\"text-xl font-semibold text-gray-900\">\n                Выберите аватар\n              </h2>\n              <button\n                type=\"button\"\n                onClick={() => setOpenAvatarModalForSceneId(null)}\n                className=\"rounded-lg p-2 text-gray-400 transition hover:bg-gray-100 hover:text-gray-900\"\n                aria-label=\"Закрыть\"\n              >\n                <svg\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                  viewBox=\"0 0 24 24\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  strokeWidth={2}\n                  className=\"h-5 w-5\"\n                >\n                  <path d=\"M18 6L6 18M6 6l12 12\" />\n                </svg>\n              </button>\n            </div>\n            {isLoadingAvatars ? (\n              <div className=\"flex items-center justify-center py-12\">\n                <p className=\"text-gray-500\">Загрузка аватаров...</p>\n              </div>\n            ) : avatars.length === 0 ? (\n              <div className=\"flex items-center justify-center py-12\">\n                <p className=\"text-gray-500\">Нет доступных аватаров</p>\n              </div>\n            ) : (\n              <div className=\"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4\">\n                {avatars.map((avatar) => {\n                  const scene = scenes.find((s) => s.id === openAvatarModalForSceneId);\n                  const isSelected = scene?.avatarId === avatar.id;\n                  return (\n                    <button\n                      key={avatar.id}\n                      type=\"button\"\n                      onClick={() => {\n                        if (openAvatarModalForSceneId) {\n                          onSceneAvatarChange(\n                            openAvatarModalForSceneId,\n                            isSelected ? null : avatar.id,\n                          );\n                        }\n                        setOpenAvatarModalForSceneId(null);\n                      }}\n                      className={`group relative aspect-[3/4] overflow-hidden rounded-2xl border-2 transition ${\n                        isSelected\n                          ? \"border-gray-900 ring-2 ring-gray-900\"\n                          : \"border-gray-200 hover:border-gray-300\"\n                      }`}\n                    >\n                      <Image\n                        src={avatar.photo}\n                        alt={avatar.name}\n                        fill\n                        className=\"object-cover\"\n                        unoptimized\n                      />\n                      <div className=\"absolute inset-0 bg-black/0 transition group-hover:bg-black/20\" />\n                      <div className=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-3\">\n                        <p className=\"text-sm font-semibold text-white\">\n                          {avatar.name}\n                        </p>\n                      </div>\n                    </button>\n                  );\n                })}\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {openVoiceModalForSceneId && (\n        <div\n          className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4\"\n          onClick={() => setOpenVoiceModalForSceneId(null)}\n        >\n          <div\n            className=\"w-full max-w-2xl rounded-3xl border border-gray-100 bg-white p-6 shadow-xl\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            <div className=\"mb-4 flex items-center justify-between\">\n              <h2 className=\"text-xl font-semibold text-gray-900\">\n                Выберите голос\n              </h2>\n              <button\n                type=\"button\"\n                onClick={() => setOpenVoiceModalForSceneId(null)}\n                className=\"rounded-lg p-2 text-gray-400 transition hover:bg-gray-100 hover:text-gray-900\"\n                aria-label=\"Закрыть\"\n              >\n                <svg\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                  viewBox=\"0 0 24 24\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  strokeWidth={2}\n                  className=\"h-5 w-5\"\n                >\n                  <path d=\"M18 6L6 18M6 6l12 12\" />\n                </svg>\n              </button>\n            </div>\n            {isLoadingVoices ? (\n              <div className=\"flex items-center justify-center py-12\">\n                <p className=\"text-gray-500\">Загрузка голосов...</p>\n              </div>\n            ) : voices.length === 0 ? (\n              <div className=\"flex items-center justify-center py-12\">\n                <p className=\"text-gray-500\">Нет доступных голосов</p>\n              </div>\n            ) : (\n              <div className=\"space-y-2\">\n                {voices.map((voice) => {\n                  const scene = scenes.find((s) => s.id === openVoiceModalForSceneId);\n                  const isSelected = scene?.voiceId === voice.id;\n                  return (\n                    <button\n                      key={voice.id}\n                      type=\"button\"\n                      onClick={() => {\n                        if (openVoiceModalForSceneId) {\n                          onSceneVoiceChange(\n                            openVoiceModalForSceneId,\n                            isSelected ? null : voice.id,\n                          );\n                        }\n                        setOpenVoiceModalForSceneId(null);\n                      }}\n                      className={`w-full rounded-xl border-2 p-4 text-left transition ${\n                        isSelected\n                          ? \"border-gray-900 bg-gray-50 ring-2 ring-gray-900\"\n                          : \"border-gray-200 hover:border-gray-300\"\n                      }`}\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-gray-100\">\n                          <svg\n                            xmlns=\"http://www.w3.org/2000/svg\"\n                            viewBox=\"0 0 24 24\"\n                            fill=\"none\"\n                            stroke=\"currentColor\"\n                            strokeWidth={2}\n                            className=\"h-5 w-5 text-gray-600\"\n                          >\n                            <path d=\"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z\" />\n                            <path d=\"M19 10v2a7 7 0 0 1-14 0v-2\" />\n                            <line x1=\"12\" y1=\"19\" x2=\"12\" y2=\"23\" />\n                            <line x1=\"8\" y1=\"23\" x2=\"16\" y2=\"23\" />\n                          </svg>\n                        </div>\n                        <div className=\"flex-1\">\n                          <p className=\"text-sm font-semibold text-gray-900\">\n                            {voice.name}\n                          </p>\n                          {voice.description && (\n                            <p className=\"text-xs text-gray-500\">\n                              {voice.description}\n                            </p>\n                          )}\n                        </div>\n                      </div>\n                    </button>\n                  );\n                })}\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n    </>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1076, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/material/editor/components/Timeline.tsx"],"sourcesContent":["\"use client\";\n\nimport Image from \"next/image\";\nimport type { Scene, AvatarOption, AspectRatio, CanvasElement } from \"./types\";\n\nconst CANVAS_SIZES: Record<AspectRatio, { width: number; height: number }> = {\n  \"16:9\": { width: 1920, height: 1080 },\n  \"9:16\": { width: 1080, height: 1920 },\n};\n\ntype CanvasThumbnailProps = {\n  scene: Scene;\n  avatars: AvatarOption[];\n  aspectRatio: AspectRatio;\n};\n\nfunction CanvasThumbnail({ scene, avatars, aspectRatio }: CanvasThumbnailProps) {\n  const canvasSize = CANVAS_SIZES[aspectRatio];\n\n  const avatar = scene.avatarId\n    ? avatars.find((a) => a.id === scene.avatarId)\n    : null;\n\n  return (\n    <div className=\"absolute inset-0 bg-gray-50 overflow-hidden\">\n      {/* Аватар */}\n      {avatar && scene.avatarPosition && scene.avatarSize && (\n        <div\n          className=\"absolute\"\n          style={{\n            left: `${(scene.avatarPosition.x / canvasSize.width) * 100}%`,\n            top: `${(scene.avatarPosition.y / canvasSize.height) * 100}%`,\n            width: `${(scene.avatarSize.width / canvasSize.width) * 100}%`,\n            height: `${(scene.avatarSize.height / canvasSize.height) * 100}%`,\n            transform: \"translate(-50%, -50%)\",\n          }}\n        >\n          <img\n            src={avatar.photo}\n            alt={avatar.name}\n            className=\"w-full h-full object-cover rounded\"\n          />\n        </div>\n      )}\n\n      {/* Элементы */}\n      {scene.elements.map((element) => {\n        const leftPercent = (element.x / canvasSize.width) * 100;\n        const topPercent = (element.y / canvasSize.height) * 100;\n        const widthPercent = (element.width / canvasSize.width) * 100;\n        const heightPercent = (element.height / canvasSize.height) * 100;\n\n        return (\n          <div\n            key={element.id}\n            className=\"absolute rounded border border-gray-300 overflow-hidden\"\n            style={{\n              left: `${leftPercent}%`,\n              top: `${topPercent}%`,\n              width: `${widthPercent}%`,\n              height: `${heightPercent}%`,\n              transform: \"translate(-50%, -50%)\",\n              backgroundColor: element.imageUrl ? \"transparent\" : \"#e5e7eb\",\n            }}\n          >\n            {element.imageUrl ? (\n              <img\n                src={element.imageUrl}\n                alt={element.label}\n                className=\"w-full h-full object-cover\"\n              />\n            ) : (\n              <div className=\"w-full h-full bg-gray-200\" />\n            )}\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n\ntype TimelineProps = {\n  scenes: Scene[];\n  activeSceneId: string;\n  onSelectScene: (sceneId: string) => void;\n  onAddScene: (afterSceneId?: string) => void;\n  avatars: AvatarOption[];\n  aspectRatio: AspectRatio;\n};\n\nexport function Timeline({\n  scenes,\n  activeSceneId,\n  onSelectScene,\n  onAddScene,\n  avatars,\n  aspectRatio,\n}: TimelineProps) {\n  return (\n    <div className=\"flex h-full flex-col rounded-3xl border border-gray-100 bg-white p-4 shadow-sm ring-1 ring-black/5\">\n      <div className=\"mb-3 flex flex-shrink-0 items-center justify-between\">\n        <p className=\"text-sm font-semibold text-gray-900\">Таймлайн</p>\n        <p className=\"text-xs text-gray-500\">\n          Слайды: {scenes.length.toString().padStart(2, \"0\")}\n        </p>\n      </div>\n      <div className=\"flex w-full flex-1 flex-nowrap items-center gap-4 overflow-x-auto pb-2 [&::-webkit-scrollbar]:h-2 [&::-webkit-scrollbar-track]:bg-gray-100 [&::-webkit-scrollbar-thumb]:bg-gray-300 [&::-webkit-scrollbar-thumb]:rounded-full min-h-0\">\n        {scenes.map((scene, index) => {\n          const isActive = scene.id === activeSceneId;\n          const isLast = index === scenes.length - 1;\n          return (\n            <div key={scene.id} className=\"flex items-center gap-2 flex-shrink-0\">\n              <button\n                type=\"button\"\n                onClick={() => onSelectScene(scene.id)}\n                className={`relative min-w-[180px] min-h-[120px] w-[180px] h-[120px] rounded-2xl border overflow-hidden transition ${\n                  isActive\n                    ? \"border-gray-900\"\n                    : \"border-gray-200 hover:border-gray-300\"\n                }`}\n              >\n                <CanvasThumbnail\n                  scene={scene}\n                  avatars={avatars}\n                  aspectRatio={aspectRatio}\n                />\n                {/* Номер слайда */}\n                <div className=\"absolute top-2 left-2 flex h-6 w-6 items-center justify-center rounded-full bg-black/70 text-xs font-semibold text-white\">\n                  {index + 1}\n                </div>\n              </button>\n              {isLast && (\n                <button\n                  type=\"button\"\n                  onClick={() => onAddScene(scene.id)}\n                  className=\"flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full border-2 border-dashed border-gray-300 bg-white text-gray-400 transition hover:border-gray-400 hover:text-gray-600\"\n                  aria-label=\"Добавить слайд\"\n                >\n                  <svg\n                    xmlns=\"http://www.w3.org/2000/svg\"\n                    viewBox=\"0 0 24 24\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    strokeWidth={2}\n                    className=\"h-4 w-4\"\n                  >\n                    <path d=\"M12 5v14M5 12h14\" />\n                  </svg>\n                </button>\n              )}\n              {!isLast && (\n                <svg\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                  viewBox=\"0 0 24 24\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  strokeWidth={2}\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  className=\"h-3 w-3 flex-shrink-0 text-gray-400\"\n                >\n                  <path d=\"M9 18l6-6-6-6\" />\n                </svg>\n              )}\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1306, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/material/editor/components/useImageAspectRatio.ts"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\n\r\n/**\r\n * Хук для определения соотношения сторон изображения в рантайме\r\n * @param imageSrc - URL изображения\r\n * @returns Соотношение сторон (width / height) или null, если еще не загружено\r\n */\r\nexport function useImageAspectRatio(imageSrc: string | null): number | null {\r\n  const [aspectRatio, setAspectRatio] = useState<number | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!imageSrc) {\r\n      setAspectRatio(null);\r\n      return;\r\n    }\r\n\r\n    const img = new Image();\r\n    \r\n    img.onload = () => {\r\n      const ratio = img.naturalWidth / img.naturalHeight;\r\n      setAspectRatio(ratio);\r\n    };\r\n\r\n    img.onerror = () => {\r\n      setAspectRatio(null);\r\n    };\r\n\r\n    img.src = imageSrc;\r\n\r\n    return () => {\r\n      img.onload = null;\r\n      img.onerror = null;\r\n    };\r\n  }, [imageSrc]);\r\n\r\n  return aspectRatio;\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAOO,SAAS,oBAAoB,QAAuB;IACzD,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAgB;IAE9D,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,UAAU;YACb,eAAe;YACf;QACF;QAEA,MAAM,MAAM,IAAI;QAEhB,IAAI,MAAM,GAAG;YACX,MAAM,QAAQ,IAAI,YAAY,GAAG,IAAI,aAAa;YAClD,eAAe;QACjB;QAEA,IAAI,OAAO,GAAG;YACZ,eAAe;QACjB;QAEA,IAAI,GAAG,GAAG;QAEV,OAAO;YACL,IAAI,MAAM,GAAG;YACb,IAAI,OAAO,GAAG;QAChB;IACF,GAAG;QAAC;KAAS;IAEb,OAAO;AACT"}},
    {"offset": {"line": 1341, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/material/editor/components/AvatarCanvas.tsx"],"sourcesContent":["\"use client\";\n\nimport Image from \"next/image\";\nimport type { AvatarOption } from \"./types\";\nimport { useImageAspectRatio } from \"./useImageAspectRatio\";\n\ntype AvatarCanvasProps = {\n  avatar: AvatarOption | null;\n  position: { x: number; y: number }; // позиция центра в пикселях канвы\n  size: { width: number; height: number }; // размер в пикселях канвы\n  canvasSize: { width: number; height: number }; // размеры канвы в пикселях\n  onRemove: () => void;\n  onPointerDown: (event: React.PointerEvent<HTMLDivElement>) => void;\n  onResizeStart: (\n    event: React.PointerEvent<HTMLDivElement>,\n    corner: \"top-left\" | \"top-right\" | \"bottom-left\" | \"bottom-right\",\n  ) => void;\n};\n\nexport function AvatarCanvas({\n  avatar,\n  position,\n  size,\n  canvasSize,\n  onRemove,\n  onPointerDown,\n  onResizeStart,\n}: AvatarCanvasProps) {\n  if (!avatar) return null;\n\n  // Определяем соотношение сторон изображения\n  const imageAspectRatio = useImageAspectRatio(avatar.photo);\n\n  // Конвертируем пиксели канвы в проценты для отображения\n  const leftPercent = (position.x / canvasSize.width) * 100;\n  const topPercent = (position.y / canvasSize.height) * 100;\n  const widthPercent = (size.width / canvasSize.width) * 100;\n\n  const resizeHandles: Array<{\n    corner: \"top-left\" | \"top-right\" | \"bottom-left\" | \"bottom-right\";\n    cursor: string;\n    position: string;\n  }> = [\n    { corner: \"top-left\", cursor: \"cursor-nwse-resize\", position: \"top-0 left-0\" },\n    { corner: \"top-right\", cursor: \"cursor-nesw-resize\", position: \"top-0 right-0\" },\n    { corner: \"bottom-left\", cursor: \"cursor-nesw-resize\", position: \"bottom-0 left-0\" },\n    { corner: \"bottom-right\", cursor: \"cursor-nwse-resize\", position: \"bottom-0 right-0\" },\n  ];\n\n  return (\n    <div\n      className=\"group absolute cursor-grab active:cursor-grabbing\"\n      style={{\n        left: `${leftPercent}%`,\n        top: `${topPercent}%`,\n        width: `${widthPercent}%`,\n        aspectRatio: imageAspectRatio ? `${imageAspectRatio} / 1` : undefined,\n        transform: \"translate(-50%, -50%)\",\n      }}\n      onPointerDown={onPointerDown}\n      role=\"button\"\n      tabIndex={0}\n    >\n      {/* Фото аватара */}\n      <img\n        src={avatar.photo}\n        alt={avatar.name}\n        className=\"w-full h-full object-cover rounded-2xl\"\n      />\n      \n      {/* Маркеры масштабирования по углам */}\n      {resizeHandles.map(({ corner, cursor, position }) => (\n        <div\n          key={corner}\n          className={`absolute h-5 w-5 rounded-full bg-white border-2 border-gray-600 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity hover:border-gray-900 hover:scale-125 ${cursor} ${position}`}\n          style={{\n            transform: corner === \"top-left\" \n              ? \"translate(-50%, -50%)\" \n              : corner === \"top-right\"\n              ? \"translate(50%, -50%)\"\n              : corner === \"bottom-left\"\n              ? \"translate(-50%, 50%)\"\n              : \"translate(50%, 50%)\",\n          }}\n          onPointerDown={(e) => {\n            e.stopPropagation();\n            onResizeStart(e, corner);\n          }}\n          role=\"button\"\n          tabIndex={0}\n        />\n      ))}\n\n      {/* Кнопка удаления - красная и масштабируемая */}\n      <button\n        type=\"button\"\n        onClick={(e) => {\n          e.stopPropagation();\n          onRemove();\n        }}\n        className=\"absolute right-0 top-0 flex items-center justify-center rounded-full bg-red-500 text-white opacity-0 transition-opacity hover:bg-red-600 group-hover:opacity-100 z-10\"\n        style={{\n          width: `${Math.min(40, Math.max(24, Math.min(size.width, size.height) * 0.08))}px`,\n          height: `${Math.min(40, Math.max(24, Math.min(size.width, size.height) * 0.08))}px`,\n          transform: 'translate(50%, -50%)',\n        }}\n        aria-label=\"Удалить аватар\"\n      >\n        <svg\n          xmlns=\"http://www.w3.org/2000/svg\"\n          viewBox=\"0 0 24 24\"\n          fill=\"none\"\n          stroke=\"currentColor\"\n          strokeWidth={2.5}\n          className=\"w-full h-full p-1\"\n        >\n          <path d=\"M18 6L6 18M6 6l12 12\" />\n        </svg>\n      </button>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":";;;;;AAIA;AAJA;;;AAmBO,SAAS,aAAa,EAC3B,MAAM,EACN,QAAQ,EACR,IAAI,EACJ,UAAU,EACV,QAAQ,EACR,aAAa,EACb,aAAa,EACK;IAClB,IAAI,CAAC,QAAQ,OAAO;IAEpB,4CAA4C;IAC5C,MAAM,mBAAmB,IAAA,qLAAmB,EAAC,OAAO,KAAK;IAEzD,wDAAwD;IACxD,MAAM,cAAc,AAAC,SAAS,CAAC,GAAG,WAAW,KAAK,GAAI;IACtD,MAAM,aAAa,AAAC,SAAS,CAAC,GAAG,WAAW,MAAM,GAAI;IACtD,MAAM,eAAe,AAAC,KAAK,KAAK,GAAG,WAAW,KAAK,GAAI;IAEvD,MAAM,gBAID;QACH;YAAE,QAAQ;YAAY,QAAQ;YAAsB,UAAU;QAAe;QAC7E;YAAE,QAAQ;YAAa,QAAQ;YAAsB,UAAU;QAAgB;QAC/E;YAAE,QAAQ;YAAe,QAAQ;YAAsB,UAAU;QAAkB;QACnF;YAAE,QAAQ;YAAgB,QAAQ;YAAsB,UAAU;QAAmB;KACtF;IAED,qBACE,8OAAC;QACC,WAAU;QACV,OAAO;YACL,MAAM,GAAG,YAAY,CAAC,CAAC;YACvB,KAAK,GAAG,WAAW,CAAC,CAAC;YACrB,OAAO,GAAG,aAAa,CAAC,CAAC;YACzB,aAAa,mBAAmB,GAAG,iBAAiB,IAAI,CAAC,GAAG;YAC5D,WAAW;QACb;QACA,eAAe;QACf,MAAK;QACL,UAAU;;0BAGV,8OAAC;gBACC,KAAK,OAAO,KAAK;gBACjB,KAAK,OAAO,IAAI;gBAChB,WAAU;;;;;;YAIX,cAAc,GAAG,CAAC,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,iBAC9C,8OAAC;oBAEC,WAAW,CAAC,qKAAqK,EAAE,OAAO,CAAC,EAAE,UAAU;oBACvM,OAAO;wBACL,WAAW,WAAW,aAClB,0BACA,WAAW,cACX,yBACA,WAAW,gBACX,yBACA;oBACN;oBACA,eAAe,CAAC;wBACd,EAAE,eAAe;wBACjB,cAAc,GAAG;oBACnB;oBACA,MAAK;oBACL,UAAU;mBAhBL;;;;;0BAqBT,8OAAC;gBACC,MAAK;gBACL,SAAS,CAAC;oBACR,EAAE,eAAe;oBACjB;gBACF;gBACA,WAAU;gBACV,OAAO;oBACL,OAAO,GAAG,KAAK,GAAG,CAAC,IAAI,KAAK,GAAG,CAAC,IAAI,KAAK,GAAG,CAAC,KAAK,KAAK,EAAE,KAAK,MAAM,IAAI,OAAO,EAAE,CAAC;oBAClF,QAAQ,GAAG,KAAK,GAAG,CAAC,IAAI,KAAK,GAAG,CAAC,IAAI,KAAK,GAAG,CAAC,KAAK,KAAK,EAAE,KAAK,MAAM,IAAI,OAAO,EAAE,CAAC;oBACnF,WAAW;gBACb;gBACA,cAAW;0BAEX,cAAA,8OAAC;oBACC,OAAM;oBACN,SAAQ;oBACR,MAAK;oBACL,QAAO;oBACP,aAAa;oBACb,WAAU;8BAEV,cAAA,8OAAC;wBAAK,GAAE;;;;;;;;;;;;;;;;;;;;;;AAKlB"}},
    {"offset": {"line": 1466, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/material/editor/components/MediaCanvas.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport type { CanvasElement } from \"./types\";\r\nimport { useImageAspectRatio } from \"./useImageAspectRatio\";\r\n\r\ntype MediaCanvasProps = {\r\n  element: CanvasElement;\r\n  canvasSize: { width: number; height: number };\r\n  onRemove: () => void;\r\n  onPointerDown: (event: React.PointerEvent<HTMLDivElement>) => void;\r\n  onResizeStart: (\r\n    event: React.PointerEvent<HTMLDivElement>,\r\n    corner: \"top-left\" | \"top-right\" | \"bottom-left\" | \"bottom-right\",\r\n  ) => void;\r\n};\r\n\r\nexport function MediaCanvas({\r\n  element,\r\n  canvasSize,\r\n  onRemove,\r\n  onPointerDown,\r\n  onResizeStart,\r\n}: MediaCanvasProps) {\r\n  if (!element.imageUrl) return null;\r\n\r\n  // Определяем соотношение сторон изображения\r\n  const imageAspectRatio = useImageAspectRatio(element.imageUrl);\r\n\r\n  // Конвертируем пиксели канвы в проценты для отображения\r\n  const leftPercent = (element.x / canvasSize.width) * 100;\r\n  const topPercent = (element.y / canvasSize.height) * 100;\r\n  const widthPercent = (element.width / canvasSize.width) * 100;\r\n\r\n  const resizeHandles: Array<{\r\n    corner: \"top-left\" | \"top-right\" | \"bottom-left\" | \"bottom-right\";\r\n    cursor: string;\r\n    position: string;\r\n  }> = [\r\n    { corner: \"top-left\", cursor: \"cursor-nwse-resize\", position: \"top-0 left-0\" },\r\n    { corner: \"top-right\", cursor: \"cursor-nesw-resize\", position: \"top-0 right-0\" },\r\n    { corner: \"bottom-left\", cursor: \"cursor-nesw-resize\", position: \"bottom-0 left-0\" },\r\n    { corner: \"bottom-right\", cursor: \"cursor-nwse-resize\", position: \"bottom-0 right-0\" },\r\n  ];\r\n\r\n  return (\r\n    <div\r\n      className=\"group absolute cursor-grab active:cursor-grabbing\"\r\n      style={{\r\n        left: `${leftPercent}%`,\r\n        top: `${topPercent}%`,\r\n        width: `${widthPercent}%`,\r\n        aspectRatio: imageAspectRatio ? `${imageAspectRatio} / 1` : undefined,\r\n        transform: \"translate(-50%, -50%)\",\r\n      }}\r\n      onPointerDown={onPointerDown}\r\n      role=\"button\"\r\n      tabIndex={0}\r\n    >\r\n      {/* Изображение медиа */}\r\n      <img\r\n        src={element.imageUrl}\r\n        alt={element.label}\r\n        className=\"w-full h-full object-cover rounded-2xl\"\r\n      />\r\n      \r\n      {/* Маркеры масштабирования по углам */}\r\n      {resizeHandles.map(({ corner, cursor, position }) => (\r\n        <div\r\n          key={corner}\r\n          className={`absolute h-5 w-5 rounded-full bg-white border-2 border-gray-600 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity hover:border-gray-900 hover:scale-125 ${cursor} ${position}`}\r\n          style={{\r\n            transform: corner === \"top-left\" \r\n              ? \"translate(-50%, -50%)\" \r\n              : corner === \"top-right\"\r\n              ? \"translate(50%, -50%)\"\r\n              : corner === \"bottom-left\"\r\n              ? \"translate(-50%, 50%)\"\r\n              : \"translate(50%, 50%)\",\r\n          }}\r\n          onPointerDown={(e) => {\r\n            e.stopPropagation();\r\n            onResizeStart(e, corner);\r\n          }}\r\n          role=\"button\"\r\n          tabIndex={0}\r\n        />\r\n      ))}\r\n\r\n      {/* Кнопка удаления */}\r\n      <button\r\n        type=\"button\"\r\n        onClick={(e) => {\r\n          e.stopPropagation();\r\n          onRemove();\r\n        }}\r\n        className=\"absolute right-0 top-0 flex items-center justify-center rounded-full bg-red-500 text-white opacity-0 transition-opacity hover:bg-red-600 group-hover:opacity-100 z-10\"\r\n        style={{\r\n          width: `${Math.min(40, Math.max(24, Math.min(element.width, element.height) * 0.08))}px`,\r\n          height: `${Math.min(40, Math.max(24, Math.min(element.width, element.height) * 0.08))}px`,\r\n          transform: 'translate(50%, -50%)',\r\n        }}\r\n        aria-label=\"Удалить медиа\"\r\n      >\r\n        <svg\r\n          xmlns=\"http://www.w3.org/2000/svg\"\r\n          viewBox=\"0 0 24 24\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          strokeWidth={2.5}\r\n          className=\"w-full h-full p-1\"\r\n        >\r\n          <path d=\"M18 6L6 18M6 6l12 12\" />\r\n        </svg>\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;AAGA;AAHA;;;AAgBO,SAAS,YAAY,EAC1B,OAAO,EACP,UAAU,EACV,QAAQ,EACR,aAAa,EACb,aAAa,EACI;IACjB,IAAI,CAAC,QAAQ,QAAQ,EAAE,OAAO;IAE9B,4CAA4C;IAC5C,MAAM,mBAAmB,IAAA,qLAAmB,EAAC,QAAQ,QAAQ;IAE7D,wDAAwD;IACxD,MAAM,cAAc,AAAC,QAAQ,CAAC,GAAG,WAAW,KAAK,GAAI;IACrD,MAAM,aAAa,AAAC,QAAQ,CAAC,GAAG,WAAW,MAAM,GAAI;IACrD,MAAM,eAAe,AAAC,QAAQ,KAAK,GAAG,WAAW,KAAK,GAAI;IAE1D,MAAM,gBAID;QACH;YAAE,QAAQ;YAAY,QAAQ;YAAsB,UAAU;QAAe;QAC7E;YAAE,QAAQ;YAAa,QAAQ;YAAsB,UAAU;QAAgB;QAC/E;YAAE,QAAQ;YAAe,QAAQ;YAAsB,UAAU;QAAkB;QACnF;YAAE,QAAQ;YAAgB,QAAQ;YAAsB,UAAU;QAAmB;KACtF;IAED,qBACE,8OAAC;QACC,WAAU;QACV,OAAO;YACL,MAAM,GAAG,YAAY,CAAC,CAAC;YACvB,KAAK,GAAG,WAAW,CAAC,CAAC;YACrB,OAAO,GAAG,aAAa,CAAC,CAAC;YACzB,aAAa,mBAAmB,GAAG,iBAAiB,IAAI,CAAC,GAAG;YAC5D,WAAW;QACb;QACA,eAAe;QACf,MAAK;QACL,UAAU;;0BAGV,8OAAC;gBACC,KAAK,QAAQ,QAAQ;gBACrB,KAAK,QAAQ,KAAK;gBAClB,WAAU;;;;;;YAIX,cAAc,GAAG,CAAC,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,iBAC9C,8OAAC;oBAEC,WAAW,CAAC,qKAAqK,EAAE,OAAO,CAAC,EAAE,UAAU;oBACvM,OAAO;wBACL,WAAW,WAAW,aAClB,0BACA,WAAW,cACX,yBACA,WAAW,gBACX,yBACA;oBACN;oBACA,eAAe,CAAC;wBACd,EAAE,eAAe;wBACjB,cAAc,GAAG;oBACnB;oBACA,MAAK;oBACL,UAAU;mBAhBL;;;;;0BAqBT,8OAAC;gBACC,MAAK;gBACL,SAAS,CAAC;oBACR,EAAE,eAAe;oBACjB;gBACF;gBACA,WAAU;gBACV,OAAO;oBACL,OAAO,GAAG,KAAK,GAAG,CAAC,IAAI,KAAK,GAAG,CAAC,IAAI,KAAK,GAAG,CAAC,QAAQ,KAAK,EAAE,QAAQ,MAAM,IAAI,OAAO,EAAE,CAAC;oBACxF,QAAQ,GAAG,KAAK,GAAG,CAAC,IAAI,KAAK,GAAG,CAAC,IAAI,KAAK,GAAG,CAAC,QAAQ,KAAK,EAAE,QAAQ,MAAM,IAAI,OAAO,EAAE,CAAC;oBACzF,WAAW;gBACb;gBACA,cAAW;0BAEX,cAAA,8OAAC;oBACC,OAAM;oBACN,SAAQ;oBACR,MAAK;oBACL,QAAO;oBACP,aAAa;oBACb,WAAU;8BAEV,cAAA,8OAAC;wBAAK,GAAE;;;;;;;;;;;;;;;;;;;;;;AAKlB"}},
    {"offset": {"line": 1591, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/material/editor/components/MediaCanvasWrapper.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useCallback } from \"react\";\r\nimport type { CanvasElement } from \"./types\";\r\nimport { MediaCanvas } from \"./MediaCanvas\";\r\nimport { useImageAspectRatio } from \"./useImageAspectRatio\";\r\n\r\ntype MediaCanvasWrapperProps = {\r\n  element: CanvasElement;\r\n  canvasSize: { width: number; height: number };\r\n  onRemove: () => void;\r\n  onPointerDown: (event: React.PointerEvent<HTMLDivElement>) => void;\r\n  onResizeStart: (\r\n    event: React.PointerEvent<HTMLDivElement>,\r\n    corner: \"top-left\" | \"top-right\" | \"bottom-left\" | \"bottom-right\",\r\n    imageAspectRatio: number,\r\n  ) => void;\r\n  screenToCanvas: (screenPx: number, dimension: \"width\" | \"height\") => number;\r\n  onElementSizeChange: (elementId: string, size: { width: number; height: number }) => void;\r\n};\r\n\r\nexport function MediaCanvasWrapper({\r\n  element,\r\n  canvasSize,\r\n  onRemove,\r\n  onPointerDown,\r\n  onResizeStart,\r\n  screenToCanvas,\r\n  onElementSizeChange,\r\n}: MediaCanvasWrapperProps) {\r\n  const imageAspectRatio = useImageAspectRatio(element.imageUrl ?? null);\r\n\r\n  const handleResizeStart = useCallback(\r\n    (\r\n      event: React.PointerEvent<HTMLDivElement>,\r\n      corner: \"top-left\" | \"top-right\" | \"bottom-left\" | \"bottom-right\",\r\n    ) => {\r\n      if (!imageAspectRatio) return;\r\n      \r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n\r\n      const startX = event.clientX;\r\n      const startY = event.clientY;\r\n      const initialWidth = element.width;\r\n      const initialHeight = initialWidth / imageAspectRatio;\r\n      const initialX = element.x;\r\n      const initialY = element.y;\r\n\r\n      const centerX = initialX;\r\n      const centerY = initialY;\r\n      const halfWidth = initialWidth / 2;\r\n      const halfHeight = initialHeight / 2;\r\n      \r\n      let initialCornerX: number, initialCornerY: number;\r\n      if (corner === \"top-left\") {\r\n        initialCornerX = centerX - halfWidth;\r\n        initialCornerY = centerY - halfHeight;\r\n      } else if (corner === \"top-right\") {\r\n        initialCornerX = centerX + halfWidth;\r\n        initialCornerY = centerY - halfHeight;\r\n      } else if (corner === \"bottom-left\") {\r\n        initialCornerX = centerX - halfWidth;\r\n        initialCornerY = centerY + halfHeight;\r\n      } else {\r\n        initialCornerX = centerX + halfWidth;\r\n        initialCornerY = centerY + halfHeight;\r\n      }\r\n\r\n      const initialDistance = Math.sqrt(\r\n        Math.pow(initialCornerX - centerX, 2) + Math.pow(initialCornerY - centerY, 2),\r\n      );\r\n\r\n      let rafId: number | null = null;\r\n\r\n      const handlePointerMove = (moveEvent: PointerEvent) => {\r\n        if (rafId !== null) {\r\n          cancelAnimationFrame(rafId);\r\n        }\r\n\r\n        rafId = requestAnimationFrame(() => {\r\n          const deltaXScreen = moveEvent.clientX - startX;\r\n          const deltaYScreen = moveEvent.clientY - startY;\r\n\r\n          const deltaX = screenToCanvas(deltaXScreen, \"width\");\r\n          const deltaY = screenToCanvas(deltaYScreen, \"height\");\r\n\r\n          const newCornerX = initialCornerX + deltaX;\r\n          const newCornerY = initialCornerY + deltaY;\r\n\r\n          const newDistance = Math.sqrt(\r\n            Math.pow(newCornerX - centerX, 2) + Math.pow(newCornerY - centerY, 2),\r\n          );\r\n\r\n          const scale = newDistance / initialDistance;\r\n          \r\n          let newWidth = initialWidth * scale;\r\n          let newHeight = newWidth / imageAspectRatio;\r\n\r\n          const minSizePx = Math.min(canvasSize.width, canvasSize.height) * 0.05;\r\n          const maxWidthPx = canvasSize.width; // Максимальная ширина = 100% ширины канвы\r\n          const maxHeightPx = canvasSize.height; // Максимальная высота = 100% высоты канвы\r\n          \r\n          if (newWidth > maxWidthPx) {\r\n            newWidth = maxWidthPx;\r\n            newHeight = newWidth / imageAspectRatio;\r\n          }\r\n          if (newWidth < minSizePx) {\r\n            newWidth = minSizePx;\r\n            newHeight = newWidth / imageAspectRatio;\r\n          }\r\n          \r\n          if (newHeight > maxHeightPx) {\r\n            newHeight = maxHeightPx;\r\n            newWidth = newHeight * imageAspectRatio;\r\n          }\r\n          if (newHeight < minSizePx) {\r\n            newHeight = minSizePx;\r\n            newWidth = newHeight * imageAspectRatio;\r\n          }\r\n\r\n          onElementSizeChange(element.id, { width: newWidth, height: newHeight });\r\n          rafId = null;\r\n        });\r\n      };\r\n\r\n      const handlePointerUp = () => {\r\n        if (rafId !== null) {\r\n          cancelAnimationFrame(rafId);\r\n          rafId = null;\r\n        }\r\n        window.removeEventListener(\"pointermove\", handlePointerMove);\r\n        window.removeEventListener(\"pointerup\", handlePointerUp);\r\n      };\r\n\r\n      window.addEventListener(\"pointermove\", handlePointerMove);\r\n      window.addEventListener(\"pointerup\", handlePointerUp);\r\n    },\r\n    [element, imageAspectRatio, screenToCanvas, canvasSize, onElementSizeChange],\r\n  );\r\n\r\n  if (!imageAspectRatio) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <MediaCanvas\r\n      element={element}\r\n      canvasSize={canvasSize}\r\n      onRemove={onRemove}\r\n      onPointerDown={onPointerDown}\r\n      onResizeStart={handleResizeStart}\r\n    />\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1713, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/material/editor/components/LayersPanel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useMemo } from \"react\";\nimport type { CanvasElement, AvatarOption } from \"./types\";\n\ntype LayerItem = {\n  id: string;\n  type: \"avatar\" | \"media\";\n  label: string;\n  thumbnail?: string;\n  zIndex: number;\n};\n\ntype LayersPanelProps = {\n  isOpen: boolean;\n  onClose: () => void;\n  elements: CanvasElement[];\n  avatar: AvatarOption | null;\n  avatarZIndex?: number;\n  avatarLocked?: boolean;\n  onReorderLayers: (newOrder: string[]) => void;\n  onToggleAvatarLock: () => void;\n  panelRef?: React.RefObject<HTMLDivElement | null>;\n};\n\nexport function LayersPanel({\n  isOpen,\n  onClose,\n  elements,\n  avatar,\n  avatarZIndex,\n  avatarLocked,\n  onReorderLayers,\n  onToggleAvatarLock,\n  panelRef,\n}: LayersPanelProps) {\n  const [draggedId, setDraggedId] = useState<string | null>(null);\n  const [dragOverId, setDragOverId] = useState<string | null>(null);\n\n  // Создаем список слоев: элементы и аватар отсортированные по zIndex (больший zIndex = выше = первый в списке)\n  const layers: LayerItem[] = useMemo(() => {\n    const allLayers: LayerItem[] = [\n      ...elements.map((el) => ({\n        id: el.id,\n        type: \"media\" as const,\n        label: el.label,\n        thumbnail: el.imageUrl,\n        zIndex: el.zIndex ?? 0,\n      })),\n      ...(avatar\n        ? [\n            {\n              id: \"avatar\",\n              type: \"avatar\" as const,\n              label: avatar.name,\n              thumbnail: avatar.photo,\n              zIndex: avatarZIndex ?? 9999,\n            },\n          ]\n        : []),\n    ];\n    return allLayers.sort((a, b) => b.zIndex - a.zIndex); // Больший zIndex = первый в списке\n  }, [elements, avatar, avatarZIndex]);\n\n  const handleDragStart = (e: React.DragEvent, id: string) => {\n    // Аватар не перетаскивается, если заблокирован\n    if (id === \"avatar\" && avatarLocked) {\n      e.preventDefault();\n      return;\n    }\n    setDraggedId(id);\n    e.dataTransfer.effectAllowed = \"move\";\n    e.dataTransfer.setData(\"text/plain\", id);\n  };\n\n  const handleDragOver = (e: React.DragEvent, id: string) => {\n    // Нельзя перетаскивать на заблокированный аватар или перетаскивать заблокированный аватар\n    if ((id === \"avatar\" && avatarLocked) || (draggedId === \"avatar\" && avatarLocked)) {\n      return;\n    }\n    e.preventDefault();\n    e.stopPropagation();\n    if (draggedId && draggedId !== id) {\n      setDragOverId(id);\n    }\n  };\n\n  const handleDragLeave = () => {\n    setDragOverId(null);\n  };\n\n  const handleDrop = (e: React.DragEvent, targetId: string) => {\n    e.preventDefault();\n    e.stopPropagation();\n    \n    // Нельзя перетаскивать на заблокированный аватар или перетаскивать заблокированный аватар\n    if ((targetId === \"avatar\" && avatarLocked) || !draggedId || draggedId === targetId || (draggedId === \"avatar\" && avatarLocked)) {\n      setDraggedId(null);\n      setDragOverId(null);\n      return;\n    }\n\n    // Используем актуальный список layers\n    const currentLayers = [\n      ...elements.map((el) => ({\n        id: el.id,\n        type: \"media\" as const,\n        label: el.label,\n        thumbnail: el.imageUrl,\n        zIndex: el.zIndex ?? 0,\n      })),\n      ...(avatar\n        ? [\n            {\n              id: \"avatar\",\n              type: \"avatar\" as const,\n              label: avatar.name,\n              thumbnail: avatar.photo,\n              zIndex: avatarZIndex ?? 9999,\n            },\n          ]\n        : []),\n    ].sort((a, b) => b.zIndex - a.zIndex);\n\n    const draggedIndex = currentLayers.findIndex((l) => l.id === draggedId);\n    const targetIndex = currentLayers.findIndex((l) => l.id === targetId);\n\n    if (draggedIndex === -1 || targetIndex === -1) {\n      setDraggedId(null);\n      setDragOverId(null);\n      return;\n    }\n\n    // Создаем новый порядок слоев\n    const newLayers = [...currentLayers];\n    const [draggedLayer] = newLayers.splice(draggedIndex, 1);\n    newLayers.splice(targetIndex, 0, draggedLayer);\n\n    // Обновляем zIndex: первый в списке (index 0) = больший zIndex = выше на канве\n    const newOrder = newLayers.map((l) => l.id);\n    onReorderLayers(newOrder);\n\n    setDraggedId(null);\n    setDragOverId(null);\n  };\n\n  const handleDragEnd = () => {\n    setDraggedId(null);\n    setDragOverId(null);\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div\n      ref={panelRef}\n      className=\"absolute right-0 top-full z-50 mt-2 w-[416px] rounded-xl border border-gray-200 bg-white shadow-lg\"\n    >\n      <div className=\"p-4\">\n        <div className=\"mb-4\">\n          <h2 className=\"text-lg font-semibold text-gray-900\">Слои</h2>\n        </div>\n\n        <div className=\"space-y-2\">\n          {layers.length === 0 ? (\n            <p className=\"py-8 text-center text-sm text-gray-500\">\n              Нет элементов на канве\n            </p>\n          ) : (\n            layers.map((layer, index) => {\n              const isAvatar = layer.type === \"avatar\";\n              const isLocked = isAvatar && avatarLocked;\n              return (\n              <div\n                key={layer.id}\n                draggable={!isLocked}\n                onDragStart={(e) => handleDragStart(e, layer.id)}\n                onDragOver={(e) => handleDragOver(e, layer.id)}\n                onDragLeave={handleDragLeave}\n                onDrop={(e) => handleDrop(e, layer.id)}\n                onDragEnd={handleDragEnd}\n                className={`flex items-center gap-3 rounded-xl border-2 p-3 transition ${\n                  draggedId === layer.id\n                    ? \"cursor-move opacity-50\"\n                    : dragOverId === layer.id && !isLocked\n                    ? \"cursor-move border-blue-500 bg-blue-50\"\n                    : isLocked\n                    ? \"cursor-default border-gray-200 bg-gray-50\"\n                    : \"cursor-move border-gray-200 hover:border-gray-300\"\n                }`}\n              >\n                <div className=\"flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg bg-gray-100 text-xs font-semibold text-gray-600\">\n                  {index + 1}\n                </div>\n                {layer.thumbnail ? (\n                  <div className=\"relative h-10 w-10 flex-shrink-0 overflow-hidden rounded-lg\">\n                    <img\n                      src={layer.thumbnail}\n                      alt={layer.label}\n                      className=\"h-full w-full object-cover\"\n                    />\n                  </div>\n                ) : (\n                  <div className=\"flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg bg-gray-200\">\n                    <span className=\"text-xs text-gray-500\">\n                      {layer.type === \"avatar\" ? \"👤\" : \"📄\"}\n                    </span>\n                  </div>\n                )}\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"text-sm font-medium text-gray-900 truncate\">{layer.label}</p>\n                  <p className=\"text-xs text-gray-500 truncate\">\n                    {layer.type === \"avatar\" ? \"Аватар\" : \"Медиа\"}\n                  </p>\n                </div>\n                 {isAvatar ? (\n                   <button\n                     type=\"button\"\n                     onClick={(e) => {\n                       e.stopPropagation();\n                       onToggleAvatarLock();\n                     }}\n                     className={`flex-shrink-0 rounded-lg px-3 py-1.5 text-xs font-medium transition ${\n                       avatarLocked\n                         ? \"bg-red-100 text-red-600 hover:bg-red-200\"\n                         : \"bg-green-100 text-green-600 hover:bg-green-200\"\n                     }`}\n                     aria-label={avatarLocked ? \"Разблокировать аватар\" : \"Заблокировать аватар\"}\n                   >\n                     {avatarLocked ? \"Заблокирован\" : \"Разблокирован\"}\n                   </button>\n                 ) : (\n                  <svg\n                    xmlns=\"http://www.w3.org/2000/svg\"\n                    viewBox=\"0 0 24 24\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    strokeWidth={2}\n                    className=\"h-5 w-5 flex-shrink-0 text-gray-400\"\n                  >\n                    <path d=\"M8 9h8M8 15h8\" />\n                  </svg>\n                )}\n              </div>\n            );\n            })\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1992, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/material/editor/components/CanvasArea.tsx"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useRef, useState, useMemo, useEffect } from \"react\";\nimport type { AspectRatio, CanvasElement, AvatarOption } from \"./types\";\nimport { AvatarCanvas } from \"./AvatarCanvas\";\nimport { MediaCanvasWrapper } from \"./MediaCanvasWrapper\";\nimport { LayersPanel } from \"./LayersPanel\";\nimport { useImageAspectRatio } from \"./useImageAspectRatio\";\n\n// Размеры канвы в пикселях\nconst CANVAS_SIZES: Record<AspectRatio, { width: number; height: number }> = {\n  \"16:9\": { width: 1920, height: 1080 },\n  \"9:16\": { width: 1080, height: 1920 },\n};\n\ntype CanvasAreaProps = {\n  aspectRatio: AspectRatio;\n  elements: CanvasElement[];\n  avatar: AvatarOption | null;\n  avatarPosition: { x: number; y: number };\n  avatarSize: { width: number; height: number };\n  avatarZIndex?: number;\n  avatarLocked?: boolean;\n  onElementPositionChange: (\n    elementId: string,\n    coords: { x: number; y: number },\n  ) => void;\n  onElementSizeChange: (\n    elementId: string,\n    size: { width: number; height: number },\n  ) => void;\n  onRemoveElement: (elementId: string) => void;\n  onReorderLayers: (newOrder: string[]) => void;\n  onAvatarPositionChange: (coords: { x: number; y: number }) => void;\n  onAvatarSizeChange: (size: { width: number; height: number }) => void;\n  onAddMediaAsset: (imageUrl?: string, fileName?: string) => void;\n  onRemoveAvatar: () => void;\n  onToggleAvatarLock: () => void;\n};\n\nexport function CanvasArea({\n  aspectRatio,\n  elements,\n  avatar,\n  avatarPosition,\n  avatarSize,\n  avatarZIndex,\n  avatarLocked,\n  onElementPositionChange,\n  onElementSizeChange,\n  onRemoveElement,\n  onReorderLayers,\n  onAvatarPositionChange,\n  onAvatarSizeChange,\n  onAddMediaAsset,\n  onRemoveAvatar,\n  onToggleAvatarLock,\n}: CanvasAreaProps) {\n  const canvasRef = useRef<HTMLDivElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const layersButtonRef = useRef<HTMLButtonElement>(null);\n  const layersPanelRef = useRef<HTMLDivElement>(null);\n  const mediaButtonRef = useRef<HTMLButtonElement>(null);\n  const mediaPanelRef = useRef<HTMLDivElement>(null);\n  const layersCloseTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const mediaCloseTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const [isLayersPanelOpen, setIsLayersPanelOpen] = useState(false);\n  const [isMediaPanelOpen, setIsMediaPanelOpen] = useState(false);\n\n  // Закрытие меню слоев при клике вне его\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (\n        isLayersPanelOpen &&\n        layersButtonRef.current &&\n        layersPanelRef.current &&\n        !layersButtonRef.current.contains(event.target as Node) &&\n        !layersPanelRef.current.contains(event.target as Node)\n      ) {\n        setIsLayersPanelOpen(false);\n      }\n    };\n\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClickOutside);\n    };\n  }, [isLayersPanelOpen]);\n\n  // Закрытие меню медиа при клике вне его\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (\n        isMediaPanelOpen &&\n        mediaButtonRef.current &&\n        mediaPanelRef.current &&\n        !mediaButtonRef.current.contains(event.target as Node) &&\n        !mediaPanelRef.current.contains(event.target as Node)\n      ) {\n        setIsMediaPanelOpen(false);\n      }\n    };\n\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClickOutside);\n    };\n  }, [isMediaPanelOpen]);\n\n  // Обработчики для автоматического закрытия меню слоев\n  const handleLayersMouseEnter = () => {\n    if (layersCloseTimeoutRef.current) {\n      clearTimeout(layersCloseTimeoutRef.current);\n      layersCloseTimeoutRef.current = null;\n    }\n  };\n\n  const handleLayersMouseLeave = () => {\n    layersCloseTimeoutRef.current = setTimeout(() => {\n      setIsLayersPanelOpen(false);\n    }, 500);\n  };\n\n  // Обработчики для автоматического закрытия меню медиа\n  const handleMediaMouseEnter = () => {\n    if (mediaCloseTimeoutRef.current) {\n      clearTimeout(mediaCloseTimeoutRef.current);\n      mediaCloseTimeoutRef.current = null;\n    }\n  };\n\n  const handleMediaMouseLeave = () => {\n    mediaCloseTimeoutRef.current = setTimeout(() => {\n      setIsMediaPanelOpen(false);\n    }, 500);\n  };\n\n  // Очистка таймеров при размонтировании\n  useEffect(() => {\n    return () => {\n      if (layersCloseTimeoutRef.current) {\n        clearTimeout(layersCloseTimeoutRef.current);\n      }\n      if (mediaCloseTimeoutRef.current) {\n        clearTimeout(mediaCloseTimeoutRef.current);\n      }\n    };\n  }, []);\n  const [draggingElementId, setDraggingElementId] = useState<string | null>(null);\n  const [dragCoords, setDragCoords] = useState<{ x: number; y: number } | null>(null);\n  const [draggingAvatar, setDraggingAvatar] = useState(false);\n  const [avatarDragCoords, setAvatarDragCoords] = useState<{ x: number; y: number } | null>(null);\n  const [snapPoint, setSnapPoint] = useState<{ x: number | null; y: number | null; type: string } | null>(null);\n\n  const canvasSize = CANVAS_SIZES[aspectRatio];\n  \n  // Получаем пропорции изображения аватара для правильного масштабирования\n  const avatarImageAspectRatio = useImageAspectRatio(avatar?.photo ?? null);\n  \n  // Получаем пропорции изображений медиа элементов\n  const mediaImageAspectRatios = useMemo(() => {\n    const ratios: Record<string, number | null> = {};\n    elements.forEach((element) => {\n      if (element.imageUrl) {\n        ratios[element.id] = null; // Будет установлено через хук\n      }\n    });\n    return ratios;\n  }, [elements]);\n\n  // Определяем линии привязки\n  const snapLines = useMemo(() => {\n    const snapDistance = 160; // Расстояние от углов\n    return {\n      vertical: [snapDistance, canvasSize.width - snapDistance, canvasSize.width / 2],\n      horizontal: [snapDistance, canvasSize.height - snapDistance, canvasSize.height / 2],\n    };\n  }, [canvasSize]);\n\n  // Определяем точки привязки (пересечения линий)\n  const snapPoints = useMemo(() => {\n    const snapDistance = 160;\n    return [\n      { x: snapDistance, y: snapDistance, type: 'top-left' },\n      { x: canvasSize.width - snapDistance, y: snapDistance, type: 'top-right' },\n      { x: snapDistance, y: canvasSize.height - snapDistance, type: 'bottom-left' },\n      { x: canvasSize.width - snapDistance, y: canvasSize.height - snapDistance, type: 'bottom-right' },\n      { x: canvasSize.width / 2, y: canvasSize.height / 2, type: 'center' },\n    ];\n  }, [canvasSize]);\n\n  // Проверка привязки к линиям и точкам\n  const checkSnap = useCallback((x: number, y: number, threshold: number = 20) => {\n    let snapX: number | null = null;\n    let snapY: number | null = null;\n    let snapType = '';\n\n    // Проверяем привязку к вертикальным линиям\n    for (const lineX of snapLines.vertical) {\n      if (Math.abs(x - lineX) <= threshold) {\n        snapX = lineX;\n        break;\n      }\n    }\n\n    // Проверяем привязку к горизонтальным линиям\n    for (const lineY of snapLines.horizontal) {\n      if (Math.abs(y - lineY) <= threshold) {\n        snapY = lineY;\n        break;\n      }\n    }\n\n    // Проверяем привязку к точкам (пересечениям линий)\n    for (const point of snapPoints) {\n      const distance = Math.sqrt(Math.pow(x - point.x, 2) + Math.pow(y - point.y, 2));\n      if (distance <= threshold) {\n        // Если попали в точку, используем координаты точки\n        snapX = point.x;\n        snapY = point.y;\n        snapType = point.type;\n        break;\n      }\n    }\n\n    // Если есть привязка хотя бы по одной оси\n    if (snapX !== null || snapY !== null) {\n      return {\n        x: snapX,\n        y: snapY,\n        type: snapType || (snapX !== null && snapY !== null ? 'intersection' : snapX !== null ? 'vertical' : 'horizontal'),\n      };\n    }\n\n    return null;\n  }, [snapLines, snapPoints]);\n\n  // Конвертирует пиксели канвы в пиксели экрана\n  const canvasToScreen = useCallback((canvasPx: number, dimension: \"width\" | \"height\") => {\n    const canvas = canvasRef.current;\n    if (!canvas) return 0;\n    const rect = canvas.getBoundingClientRect();\n    const screenSize = dimension === \"width\" ? rect.width : rect.height;\n    const canvasSizePx = dimension === \"width\" ? canvasSize.width : canvasSize.height;\n    return (canvasPx / canvasSizePx) * screenSize;\n  }, [canvasSize]);\n\n  // Конвертирует пиксели экрана в пиксели канвы\n  const screenToCanvas = useCallback((screenPx: number, dimension: \"width\" | \"height\") => {\n    const canvas = canvasRef.current;\n    if (!canvas) return 0;\n    const rect = canvas.getBoundingClientRect();\n    const screenSize = dimension === \"width\" ? rect.width : rect.height;\n    const canvasSizePx = dimension === \"width\" ? canvasSize.width : canvasSize.height;\n    return (screenPx / screenSize) * canvasSizePx;\n  }, [canvasSize]);\n\n  const handlePointerDown = useCallback(\n    (event: React.PointerEvent<HTMLDivElement>, element: CanvasElement) => {\n      event.preventDefault();\n      const canvas = canvasRef.current;\n      if (!canvas) return;\n\n      setDraggingElementId(element.id);\n      const canvasRect = canvas.getBoundingClientRect();\n      \n      // Вычисляем позицию мыши относительно канвы\n      const mouseXRelative = event.clientX - canvasRect.left;\n      const mouseYRelative = event.clientY - canvasRect.top;\n      \n      // Конвертируем в пиксели канвы\n      const mouseXCanvas = screenToCanvas(mouseXRelative, \"width\");\n      const mouseYCanvas = screenToCanvas(mouseYRelative, \"height\");\n      \n      // Вычисляем смещение мыши относительно центра элемента\n      const offsetX = mouseXCanvas - element.x;\n      const offsetY = mouseYCanvas - element.y;\n      \n      const startX = event.clientX;\n      const startY = event.clientY;\n      const initialX = element.x;\n      const initialY = element.y;\n\n      const handlePointerMove = (moveEvent: PointerEvent) => {\n        const deltaXScreen = moveEvent.clientX - startX;\n        const deltaYScreen = moveEvent.clientY - startY;\n\n        // Конвертируем смещение экрана в пиксели канвы\n        const deltaX = screenToCanvas(deltaXScreen, \"width\");\n        const deltaY = screenToCanvas(deltaYScreen, \"height\");\n\n        // Вычисляем новую позицию центра элемента с учетом смещения мыши\n        let nextX = initialX + deltaX;\n        let nextY = initialY + deltaY;\n\n        // Ограничиваем позицию так, чтобы элемент не выходил за границы канвы\n        const halfWidth = element.width / 2;\n        const halfHeight = element.height / 2;\n\n        nextX = Math.min(\n          canvasSize.width - halfWidth,\n          Math.max(halfWidth, nextX),\n        );\n        nextY = Math.min(\n          canvasSize.height - halfHeight,\n          Math.max(halfHeight, nextY),\n        );\n\n        setDragCoords({ x: Math.round(nextX), y: Math.round(nextY) });\n        onElementPositionChange(element.id, { x: nextX, y: nextY });\n      };\n\n      const handlePointerUp = () => {\n        setDraggingElementId(null);\n        setDragCoords(null);\n        window.removeEventListener(\"pointermove\", handlePointerMove);\n        window.removeEventListener(\"pointerup\", handlePointerUp);\n      };\n\n      window.addEventListener(\"pointermove\", handlePointerMove);\n      window.addEventListener(\"pointerup\", handlePointerUp);\n    },\n    [onElementPositionChange, screenToCanvas, canvasSize],\n  );\n\n  const handleAvatarPointerDown = useCallback(\n    (event: React.PointerEvent<HTMLDivElement>) => {\n      event.preventDefault();\n      const canvas = canvasRef.current;\n      if (!canvas) return;\n\n      setDraggingAvatar(true);\n      const startX = event.clientX;\n      const startY = event.clientY;\n      \n      // Начальная позиция центра аватара в пикселях канвы\n      const initialX = Math.max(0, Math.min(canvasSize.width, avatarPosition.x));\n      const initialY = Math.max(0, Math.min(canvasSize.height, avatarPosition.y));\n\n      let rafId: number | null = null;\n\n      const handlePointerMove = (moveEvent: PointerEvent) => {\n        if (rafId !== null) {\n          cancelAnimationFrame(rafId);\n        }\n\n        rafId = requestAnimationFrame(() => {\n          const deltaXScreen = moveEvent.clientX - startX;\n          const deltaYScreen = moveEvent.clientY - startY;\n\n          // Конвертируем смещение экрана в пиксели канвы\n          const deltaX = screenToCanvas(deltaXScreen, \"width\");\n          const deltaY = screenToCanvas(deltaYScreen, \"height\");\n\n          // Вычисляем новую позицию центра аватара\n          let nextX = initialX + deltaX;\n          let nextY = initialY + deltaY;\n\n          // Проверяем привязку к линиям и точкам\n          const snap = checkSnap(nextX, nextY);\n          if (snap) {\n            // Фиксируем координаты только если есть привязка по соответствующей оси\n            if (snap.x !== null) {\n              nextX = snap.x;\n            }\n            if (snap.y !== null) {\n              nextY = snap.y;\n            }\n            setSnapPoint(snap);\n          } else {\n            setSnapPoint(null);\n          }\n\n          // Ограничиваем позицию так, чтобы центр аватара не выходил за границы канвы\n          nextX = Math.max(0, Math.min(canvasSize.width, nextX));\n          nextY = Math.max(0, Math.min(canvasSize.height, nextY));\n\n          setAvatarDragCoords({ x: Math.round(nextX), y: Math.round(nextY) });\n          onAvatarPositionChange({ x: nextX, y: nextY });\n          rafId = null;\n        });\n      };\n\n      const handlePointerUp = () => {\n        setDraggingAvatar(false);\n        setAvatarDragCoords(null);\n        setSnapPoint(null);\n        if (rafId !== null) {\n          cancelAnimationFrame(rafId);\n          rafId = null;\n        }\n        window.removeEventListener(\"pointermove\", handlePointerMove);\n        window.removeEventListener(\"pointerup\", handlePointerUp);\n      };\n\n      window.addEventListener(\"pointermove\", handlePointerMove);\n      window.addEventListener(\"pointerup\", handlePointerUp);\n    },\n    [avatarPosition, onAvatarPositionChange, screenToCanvas, canvasSize, checkSnap],\n  );\n\n  const handleAvatarResizeStart = useCallback(\n    (\n      event: React.PointerEvent<HTMLDivElement>,\n      corner: \"top-left\" | \"top-right\" | \"bottom-left\" | \"bottom-right\",\n    ) => {\n      event.preventDefault();\n      event.stopPropagation();\n      const canvas = canvasRef.current;\n      if (!canvas) return;\n\n      const startX = event.clientX;\n      const startY = event.clientY;\n      const initialWidth = avatarSize.width;\n      // Высота вычисляется автоматически на основе ширины и пропорций изображения\n      const initialHeight = avatarImageAspectRatio \n        ? initialWidth / avatarImageAspectRatio \n        : avatarSize.height;\n      const initialX = avatarPosition.x;\n      const initialY = avatarPosition.y;\n\n      // Вычисляем начальную позицию угла в пикселях канвы\n      const centerX = initialX;\n      const centerY = initialY;\n      const halfWidth = initialWidth / 2;\n      const halfHeight = initialHeight / 2;\n      \n      let initialCornerX: number, initialCornerY: number;\n      if (corner === \"top-left\") {\n        initialCornerX = centerX - halfWidth;\n        initialCornerY = centerY - halfHeight;\n      } else if (corner === \"top-right\") {\n        initialCornerX = centerX + halfWidth;\n        initialCornerY = centerY - halfHeight;\n      } else if (corner === \"bottom-left\") {\n        initialCornerX = centerX - halfWidth;\n        initialCornerY = centerY + halfHeight;\n      } else {\n        // bottom-right\n        initialCornerX = centerX + halfWidth;\n        initialCornerY = centerY + halfHeight;\n      }\n\n      // Начальное расстояние от центра до угла (для расчета масштаба)\n      const initialDistance = Math.sqrt(\n        Math.pow(initialCornerX - centerX, 2) + Math.pow(initialCornerY - centerY, 2),\n      );\n\n      let rafId: number | null = null;\n\n      const handlePointerMove = (moveEvent: PointerEvent) => {\n        if (rafId !== null) {\n          cancelAnimationFrame(rafId);\n        }\n\n        rafId = requestAnimationFrame(() => {\n          const deltaXScreen = moveEvent.clientX - startX;\n          const deltaYScreen = moveEvent.clientY - startY;\n\n          // Конвертируем смещение экрана в пиксели канвы\n          const deltaX = screenToCanvas(deltaXScreen, \"width\");\n          const deltaY = screenToCanvas(deltaYScreen, \"height\");\n\n          // Вычисляем новую позицию угла в пикселях канвы\n          const newCornerX = initialCornerX + deltaX;\n          const newCornerY = initialCornerY + deltaY;\n\n          // Вычисляем новое расстояние от центра до угла\n          const newDistance = Math.sqrt(\n            Math.pow(newCornerX - centerX, 2) + Math.pow(newCornerY - centerY, 2),\n          );\n\n          // Масштабируем на основе изменения расстояния\n          const scale = newDistance / initialDistance;\n          \n          // Вычисляем новую ширину\n          let newWidth = initialWidth * scale;\n          \n          // Вычисляем высоту автоматически на основе ширины и пропорций изображения\n          let newHeight = avatarImageAspectRatio \n            ? newWidth / avatarImageAspectRatio \n            : initialHeight * scale;\n\n          // Ограничиваем минимальный и максимальный размер в пикселях\n          const minSizePx = Math.min(canvasSize.width, canvasSize.height) * 0.05; // минимум 5% от меньшей стороны\n          const maxSizePx = Math.min(canvasSize.width, canvasSize.height) * 0.95; // максимум 95% от меньшей стороны\n          \n          // Ограничиваем ширину\n          if (newWidth > maxSizePx) {\n            newWidth = maxSizePx;\n            newHeight = avatarImageAspectRatio ? newWidth / avatarImageAspectRatio : newHeight;\n          }\n          if (newWidth < minSizePx) {\n            newWidth = minSizePx;\n            newHeight = avatarImageAspectRatio ? newWidth / avatarImageAspectRatio : newHeight;\n          }\n          \n          // Ограничиваем высоту (если она слишком большая)\n          if (newHeight > maxSizePx) {\n            newHeight = maxSizePx;\n            newWidth = avatarImageAspectRatio ? newHeight * avatarImageAspectRatio : newWidth;\n          }\n          if (newHeight < minSizePx) {\n            newHeight = minSizePx;\n            newWidth = avatarImageAspectRatio ? newHeight * avatarImageAspectRatio : newWidth;\n          }\n\n          onAvatarSizeChange({ width: newWidth, height: newHeight });\n          rafId = null;\n        });\n      };\n\n      const handlePointerUp = () => {\n        if (rafId !== null) {\n          cancelAnimationFrame(rafId);\n          rafId = null;\n        }\n        window.removeEventListener(\"pointermove\", handlePointerMove);\n        window.removeEventListener(\"pointerup\", handlePointerUp);\n      };\n\n      window.addEventListener(\"pointermove\", handlePointerMove);\n      window.addEventListener(\"pointerup\", handlePointerUp);\n    },\n    [avatarPosition, avatarSize, onAvatarSizeChange, screenToCanvas, canvasSize, avatarImageAspectRatio],\n  );\n\n  return (\n    <div className=\"flex h-full flex-col rounded-3xl border border-gray-100 bg-white p-4 shadow-sm ring-1 ring-black/5\">\n      <div className=\"mb-3 flex flex-shrink-0 items-center justify-between\">\n        <div>\n          <p className=\"text-sm font-semibold text-gray-900\">Редактор</p>\n          <p className=\"text-xs text-gray-500\">\n            Соотношение сторон {aspectRatio}\n          </p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <>\n            <input\n              ref={fileInputRef}\n              type=\"file\"\n              accept=\"image/*\"\n              multiple\n              className=\"hidden\"\n              onChange={(e) => {\n                const files = e.target.files;\n                if (files && files.length > 0) {\n                  Array.from(files).forEach((file) => {\n                    const imageUrl = URL.createObjectURL(file);\n                    const fileName = file.name;\n                    onAddMediaAsset(imageUrl, fileName);\n                  });\n                }\n                // Сброс input для возможности повторной загрузки того же файла\n                if (e.target) {\n                  e.target.value = \"\";\n                }\n              }}\n            />\n            <div className=\"relative\">\n              <button\n                ref={mediaButtonRef}\n                type=\"button\"\n                onClick={() => {\n                  if (mediaCloseTimeoutRef.current) {\n                    clearTimeout(mediaCloseTimeoutRef.current);\n                    mediaCloseTimeoutRef.current = null;\n                  }\n                  setIsMediaPanelOpen(!isMediaPanelOpen);\n                }}\n                onMouseEnter={handleMediaMouseEnter}\n                onMouseLeave={handleMediaMouseLeave}\n                className=\"flex h-9 min-w-[100px] items-center justify-center gap-2 rounded-2xl border border-gray-200 px-4 text-xs font-semibold text-gray-900 transition hover:bg-gray-50\"\n              >\n                <span className=\"text-base leading-none\">＋</span> Медиа\n              </button>\n              {isMediaPanelOpen && (\n                <div\n                  ref={mediaPanelRef}\n                  onMouseEnter={handleMediaMouseEnter}\n                  onMouseLeave={handleMediaMouseLeave}\n                  className=\"absolute right-0 top-full z-50 mt-2 w-[416px] rounded-xl border border-gray-200 bg-white shadow-lg\"\n                >\n                  <div className=\"p-4\">\n                    <div className=\"mb-4\">\n                      <h2 className=\"text-lg font-semibold text-gray-900\">Медиа</h2>\n                    </div>\n                    <div className=\"space-y-2\">\n                      <button\n                        type=\"button\"\n                        onClick={() => {\n                          fileInputRef.current?.click();\n                          setIsMediaPanelOpen(false);\n                        }}\n                        className=\"flex w-full items-center gap-3 rounded-xl border-2 border-dashed border-gray-300 p-3 transition hover:border-gray-400 hover:bg-gray-50\"\n                      >\n                        <div className=\"flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg bg-gray-100\">\n                          <span className=\"text-xl\">＋</span>\n                        </div>\n                        <div className=\"flex-1 text-left\">\n                          <p className=\"text-sm font-medium text-gray-900\">Добавить медиа</p>\n                          <p className=\"text-xs text-gray-500\">Загрузить изображение</p>\n                        </div>\n                      </button>\n                      {elements.filter((el) => el.type === \"media\").length === 0 ? (\n                        <p className=\"py-8 text-center text-sm text-gray-500\">\n                          Нет добавленных медиа\n                        </p>\n                      ) : (\n                        elements\n                          .filter((el) => el.type === \"media\")\n                          .map((element) => (\n                            <div\n                              key={element.id}\n                              className=\"flex items-center gap-3 rounded-xl border-2 border-gray-200 p-3 transition hover:border-gray-300\"\n                            >\n                              <div className=\"flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg bg-gray-100 text-xs font-semibold text-gray-600\">\n                                {elements.filter((el) => el.type === \"media\").indexOf(element) + 1}\n                              </div>\n                              {element.imageUrl ? (\n                                <div className=\"relative h-10 w-10 flex-shrink-0 overflow-hidden rounded-lg\">\n                                  <img\n                                    src={element.imageUrl}\n                                    alt={element.label}\n                                    className=\"h-full w-full object-cover\"\n                                  />\n                                </div>\n                              ) : (\n                                <div className=\"flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg bg-gray-200\">\n                                  <span className=\"text-xs text-gray-500\">📄</span>\n                                </div>\n                              )}\n                              <div className=\"flex-1 min-w-0\">\n                                <p className=\"text-sm font-medium text-gray-900 truncate\">{element.label}</p>\n                                <p className=\"text-xs text-gray-500 truncate\">Медиа</p>\n                              </div>\n                              <button\n                                type=\"button\"\n                                onClick={() => {\n                                  onRemoveElement(element.id);\n                                }}\n                                className=\"flex-shrink-0 rounded-lg px-3 py-1.5 text-xs font-medium text-red-600 transition hover:bg-red-50\"\n                                aria-label=\"Удалить медиа\"\n                              >\n                                Удалить\n                              </button>\n                            </div>\n                          ))\n                      )}\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          </>\n          <div className=\"relative\">\n            <button\n              ref={layersButtonRef}\n              type=\"button\"\n              onClick={() => {\n                if (layersCloseTimeoutRef.current) {\n                  clearTimeout(layersCloseTimeoutRef.current);\n                  layersCloseTimeoutRef.current = null;\n                }\n                setIsLayersPanelOpen(!isLayersPanelOpen);\n              }}\n              onMouseEnter={handleLayersMouseEnter}\n              onMouseLeave={handleLayersMouseLeave}\n              className=\"flex h-9 min-w-[100px] items-center justify-center gap-2 rounded-2xl border border-gray-200 px-4 text-xs font-semibold text-gray-900 transition hover:bg-gray-50\"\n            >\n            <svg\n              xmlns=\"http://www.w3.org/2000/svg\"\n              viewBox=\"0 0 24 24\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              strokeWidth={2}\n              className=\"h-4 w-4 flex-shrink-0\"\n            >\n              <path d=\"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5\" />\n            </svg>\n            Слои\n          </button>\n          {isLayersPanelOpen && (\n            <div\n              onMouseEnter={handleLayersMouseEnter}\n              onMouseLeave={handleLayersMouseLeave}\n            >\n              <LayersPanel\n                isOpen={isLayersPanelOpen}\n                onClose={() => setIsLayersPanelOpen(false)}\n                elements={elements}\n                avatar={avatar}\n                avatarZIndex={avatarZIndex}\n                avatarLocked={avatarLocked}\n                onReorderLayers={onReorderLayers}\n                onToggleAvatarLock={onToggleAvatarLock}\n                panelRef={layersPanelRef}\n              />\n            </div>\n          )}\n        </div>\n        </div>\n      </div>\n\n      <div className=\"relative flex-1 min-h-0 overflow-hidden\">\n        <div className=\"flex h-full w-full items-center justify-center p-2\">\n          <div\n            ref={canvasRef}\n            className=\"relative overflow-visible rounded-2xl bg-gray-50 border-2 border-dashed border-gray-300\"\n            style={{ \n              aspectRatio: aspectRatio === \"16:9\" ? \"16 / 9\" : \"9 / 16\",\n              width: aspectRatio === \"16:9\" ? \"100%\" : \"auto\",\n              height: aspectRatio === \"9:16\" ? \"100%\" : \"auto\",\n              maxWidth: \"100%\",\n              maxHeight: \"100%\",\n            }}\n          >\n            {/* Направляющие линии при привязке */}\n            {snapPoint && (\n              <>\n                {/* Вертикальная линия - показываем только если есть привязка по X */}\n                {snapPoint.x !== null && (\n                  <div\n                    className=\"absolute z-40 pointer-events-none\"\n                    style={{\n                      left: `${(snapPoint.x / canvasSize.width) * 100}%`,\n                      top: 0,\n                      width: '1px',\n                      height: '100%',\n                      backgroundColor: '#3b82f6',\n                      opacity: 0.5,\n                    }}\n                  />\n                )}\n                {/* Горизонтальная линия - показываем только если есть привязка по Y */}\n                {snapPoint.y !== null && (\n                  <div\n                    className=\"absolute z-40 pointer-events-none\"\n                    style={{\n                      left: 0,\n                      top: `${(snapPoint.y / canvasSize.height) * 100}%`,\n                      width: '100%',\n                      height: '1px',\n                      backgroundColor: '#3b82f6',\n                      opacity: 0.5,\n                    }}\n                  />\n                )}\n              </>\n            )}\n\n            {/* Отображение координат при перетаскивании элемента */}\n            {draggingElementId && dragCoords && (\n              <div\n                className=\"absolute z-50 rounded-lg bg-black/80 px-3 py-1.5 text-xs font-mono text-white pointer-events-none whitespace-nowrap\"\n                style={{\n                  left: `${(dragCoords.x / canvasSize.width) * 100}%`,\n                  top: `${(dragCoords.y / canvasSize.height) * 100}%`,\n                  transform: \"translate(-50%, calc(50% + 30px))\",\n                }}\n              >\n                X: {dragCoords.x} Y: {dragCoords.y}\n              </div>\n            )}\n            \n            {/* Отображение координат при перетаскивании аватара */}\n            {draggingAvatar && avatarDragCoords && (\n              <div\n                className=\"absolute z-50 rounded-lg bg-black/80 px-3 py-1.5 text-xs font-mono text-white pointer-events-none whitespace-nowrap\"\n                style={{\n                  left: `${(avatarDragCoords.x / canvasSize.width) * 100}%`,\n                  top: `${(avatarDragCoords.y / canvasSize.height) * 100}%`,\n                  transform: \"translate(-50%, calc(50% + 30px))\",\n                }}\n              >\n                X: {avatarDragCoords.x} Y: {avatarDragCoords.y}\n              </div>\n            )}\n            {/* Отображаем все элементы отсортированные по zIndex (меньший zIndex = ниже, больший = выше) */}\n            {[\n              ...elements.map((el) => ({ type: \"element\" as const, data: el, zIndex: el.zIndex ?? 0 })),\n              ...(avatar ? [{ type: \"avatar\" as const, data: avatar, zIndex: avatarZIndex ?? 9999 }] : []),\n            ]\n              .sort((a, b) => a.zIndex - b.zIndex)\n              .map((item) => {\n                if (item.type === \"avatar\") {\n                  return (\n                    <AvatarCanvas\n                      key=\"avatar\"\n                      avatar={item.data}\n                      position={avatarPosition}\n                      size={avatarSize}\n                      canvasSize={canvasSize}\n                      onRemove={onRemoveAvatar}\n                      onPointerDown={handleAvatarPointerDown}\n                      onResizeStart={handleAvatarResizeStart}\n                    />\n                  );\n                }\n\n                const element = item.data;\n                if (element.imageUrl) {\n                  return (\n                    <MediaCanvasWrapper\n                      key={element.id}\n                      element={element}\n                      canvasSize={canvasSize}\n                      onRemove={() => onRemoveElement(element.id)}\n                      onPointerDown={(event) => handlePointerDown(event, element)}\n                      onResizeStart={() => {}}\n                      screenToCanvas={screenToCanvas}\n                      onElementSizeChange={onElementSizeChange}\n                    />\n                  );\n                }\n\n                // Плейсхолдер для элементов без изображения\n                const leftPercent = (element.x / canvasSize.width) * 100;\n                const topPercent = (element.y / canvasSize.height) * 100;\n                const widthPercent = (element.width / canvasSize.width) * 100;\n                const heightPercent = (element.height / canvasSize.height) * 100;\n\n                return (\n                  <div\n                    key={element.id}\n                    role=\"button\"\n                    tabIndex={0}\n                    onPointerDown={(event) => handlePointerDown(event, element)}\n                    className=\"absolute cursor-grab rounded-2xl border-2 border-gray-300 bg-white text-center text-xs font-semibold text-gray-900 shadow-md transition hover:border-gray-900 active:cursor-grabbing overflow-hidden\"\n                    style={{\n                      left: `${leftPercent}%`,\n                      top: `${topPercent}%`,\n                      width: `${widthPercent}%`,\n                      height: `${heightPercent}%`,\n                      transform: \"translate(-50%, -50%)\",\n                      background: \"#f3f4f6\",\n                    }}\n                  >\n                    <div className=\"flex h-full w-full flex-col items-center justify-center px-2\">\n                      <span className=\"text-sm text-gray-900\">{element.label}</span>\n                      <span className=\"text-[10px] text-gray-500\">Медиа</span>\n                    </div>\n                  </div>\n                );\n              })}\n\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3041, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/material/editor/components/MaterialEditor.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { supabase } from \"@/lib/supabaseClient\";\nimport Image from \"next/image\";\n\nimport { EditorSidebar } from \"./EditorSidebar\";\nimport { Timeline } from \"./Timeline\";\nimport { CanvasArea } from \"./CanvasArea\";\nimport type {\n  AspectRatio,\n  AvatarOption,\n  Scene,\n  VoiceOption,\n  CanvasElement,\n} from \"./types\";\n\nconst createScene = (index: number): Scene => ({\n  id: crypto.randomUUID(),\n  title: `Слайд ${index}`,\n  script: \"\",\n  avatarId: null,\n  voiceId: null,\n  elements: [],\n});\n\nexport function MaterialEditor() {\n  const router = useRouter();\n  const initialScenes = useMemo(() => [createScene(1)], []);\n  const [aspectRatio, setAspectRatio] = useState<AspectRatio>(\"16:9\");\n  const [videoTitle, setVideoTitle] = useState(\"Новое видео\");\n  const [scenes, setScenes] = useState<Scene[]>(initialScenes);\n  const [activeSceneId, setActiveSceneId] = useState<string>(\n    initialScenes[0].id,\n  );\n  const [avatars, setAvatars] = useState<AvatarOption[]>([]);\n  const [voices, setVoices] = useState<VoiceOption[]>([]);\n  const [isLoadingAvatars, setIsLoadingAvatars] = useState(true);\n  const [isLoadingVoices, setIsLoadingVoices] = useState(true);\n  const [isGenerating, setIsGenerating] = useState(false);\n\n  const activeScene = scenes.find((scene) => scene.id === activeSceneId);\n\n  useEffect(() => {\n    const fetchAvatars = async () => {\n      const {\n        data: { user },\n      } = await supabase.auth.getUser();\n\n      if (!user) return;\n\n      const { data, error } = await supabase\n        .from(\"photo_avatars\")\n        .select(\"*\")\n        .eq(\"uid\", user.id)\n        .eq(\"status\", \"done\")\n        .order(\"created_at\", { ascending: false });\n\n      if (error) {\n        console.error(\"[MaterialEditor] Ошибка загрузки аватаров:\", error);\n      } else {\n        setAvatars(\n          (data ?? []).map((avatar) => ({\n            id: avatar.id ?? \"\",\n            name: avatar.name,\n            photo: avatar.photo,\n            image_key: avatar.image_key,\n            hey_gen_id: avatar.hey_gen_id,\n            group_id: avatar.group_id,\n          })),\n        );\n      }\n      setIsLoadingAvatars(false);\n    };\n\n    fetchAvatars();\n  }, []);\n\n  useEffect(() => {\n    const fetchVoices = async () => {\n      const {\n        data: { user },\n      } = await supabase.auth.getUser();\n\n      if (!user) return;\n\n      const { data, error } = await supabase\n        .from(\"voices\")\n        .select(\"*\")\n        .eq(\"uid\", user.id)\n        .order(\"created_at\", { ascending: false });\n\n      if (error) {\n        console.error(\"[MaterialEditor] Ошибка загрузки голосов:\", error);\n      } else {\n        setVoices(\n          (data ?? [])\n            .filter((voice) => voice.url && voice.name)\n            .map((voice) => ({\n              id: voice.id ?? \"\",\n              name: voice.name,\n              url: voice.url,\n              description: voice.description,\n              voice_id: voice.voice_id ?? null,\n            })),\n        );\n      }\n      setIsLoadingVoices(false);\n    };\n\n    fetchVoices();\n  }, []);\n\n  const handleSceneUpdate = (sceneId: string, updater: (scene: Scene) => Scene) =>\n    setScenes((prev) =>\n      prev.map((scene) => (scene.id === sceneId ? updater(scene) : scene)),\n    );\n\n  // Константы размеров канвы в пикселях\n  const CANVAS_SIZES: Record<AspectRatio, { width: number; height: number }> = {\n    \"16:9\": { width: 1920, height: 1080 },\n    \"9:16\": { width: 1080, height: 1920 },\n  };\n\n  // Рассчитывает начальный размер аватара в пикселях (35% от высоты канвы)\n  const getInitialAvatarSize = (ratio: AspectRatio): { width: number; height: number } => {\n    const canvasSize = CANVAS_SIZES[ratio];\n    \n    // Высота аватара = 35% от высоты канвы в пикселях\n    const avatarHeightPercent = 0.35;\n    const height = canvasSize.height * avatarHeightPercent;\n    \n    // Типичное соотношение сторон аватара (ширина к высоте)\n    const avatarAspectRatio = 3 / 4;\n    \n    // Ширина рассчитывается на основе соотношения сторон аватара\n    const width = height * avatarAspectRatio;\n    \n    return { width, height };\n  };\n\n  // Конвертирует координаты из одного соотношения сторон в другое\n  const convertCoordinates = (\n    coords: { x: number; y: number },\n    fromRatio: AspectRatio,\n    toRatio: AspectRatio,\n  ): { x: number; y: number } => {\n    if (fromRatio === toRatio) return coords;\n\n    const fromSize = CANVAS_SIZES[fromRatio];\n    const toSize = CANVAS_SIZES[toRatio];\n\n    // Конвертируем в проценты относительно исходной канвы\n    const xPercent = coords.x / fromSize.width;\n    const yPercent = coords.y / fromSize.height;\n\n    // Применяем проценты к новой канве\n    return {\n      x: xPercent * toSize.width,\n      y: yPercent * toSize.height,\n    };\n  };\n\n  // Конвертирует размеры из одного соотношения сторон в другое\n  const convertSize = (\n    size: { width: number; height: number },\n    fromRatio: AspectRatio,\n    toRatio: AspectRatio,\n  ): { width: number; height: number } => {\n    if (fromRatio === toRatio) return size;\n\n    const fromSize = CANVAS_SIZES[fromRatio];\n    const toSize = CANVAS_SIZES[toRatio];\n\n    // Конвертируем в проценты относительно исходной канвы\n    const widthPercent = size.width / fromSize.width;\n    const heightPercent = size.height / fromSize.height;\n\n    // Применяем проценты к новой канве\n    return {\n      width: widthPercent * toSize.width,\n      height: heightPercent * toSize.height,\n    };\n  };\n\n  const handleAddScene = (afterSceneId?: string) => {\n    setScenes((prev) => {\n      const newIndex = afterSceneId\n        ? prev.findIndex((s) => s.id === afterSceneId) + 1\n        : prev.length;\n      // Берем данные из активного слайда для копирования настроек (кроме текста)\n      const activeScene = prev.find((s) => s.id === activeSceneId);\n      const previousScene = afterSceneId\n        ? prev.find((s) => s.id === afterSceneId)\n        : prev[prev.length - 1];\n      \n      const newScene: Scene = {\n        id: crypto.randomUUID(),\n        title: `Слайд ${newIndex + 1}`,\n        script: \"\", // Текст не переносится в новый слайд\n        avatarId: activeScene?.avatarId ?? previousScene?.avatarId ?? null,\n        voiceId: activeScene?.voiceId ?? previousScene?.voiceId ?? null,\n        elements: activeScene?.elements ? [...activeScene.elements] : previousScene?.elements ? [...previousScene.elements] : [],\n        avatarPosition: activeScene?.avatarPosition ?? previousScene?.avatarPosition,\n        avatarSize: activeScene?.avatarSize ?? previousScene?.avatarSize,\n        avatarZIndex: activeScene?.avatarZIndex ?? previousScene?.avatarZIndex,\n      };\n      \n      setActiveSceneId(newScene.id);\n      \n      if (afterSceneId) {\n        const index = prev.findIndex((s) => s.id === afterSceneId);\n        const updated = [...prev];\n        updated.splice(index + 1, 0, newScene);\n        return updated.map((scene, idx) => ({\n          ...scene,\n          title: `Слайд ${idx + 1}`,\n        }));\n      }\n      \n      return [...prev, newScene].map((scene, idx) => ({\n        ...scene,\n        title: `Слайд ${idx + 1}`,\n      }));\n    });\n  };\n\n  const handleDeleteScene = (sceneId: string) => {\n    setScenes((prev) => {\n      const filtered = prev.filter((scene) => scene.id !== sceneId);\n      if (filtered.length === 0) {\n        const newScene = createScene(1);\n        setActiveSceneId(newScene.id);\n        return [newScene];\n      }\n      if (activeSceneId === sceneId) {\n        const currentIndex = prev.findIndex((scene) => scene.id === sceneId);\n        const newActiveIndex = Math.max(0, currentIndex - 1);\n        setActiveSceneId(filtered[newActiveIndex]?.id ?? filtered[0].id);\n      }\n      return filtered.map((scene, index) => ({\n        ...scene,\n        title: `Слайд ${index + 1}`,\n      }));\n    });\n  };\n\n  const handleScriptChange = (value: string) => {\n    if (!activeScene) return;\n    handleSceneUpdate(activeScene.id, (scene) => ({ ...scene, script: value }));\n  };\n\n  const handleVoiceChange = (voiceId: string | null) => {\n    if (!activeScene) return;\n    handleSceneUpdate(activeScene.id, (scene) => ({ ...scene, voiceId }));\n  };\n\n  const handleAvatarChange = (avatarId: string | null) => {\n    if (!activeScene) return;\n    handleSceneUpdate(activeScene.id, (scene) => {\n      if (avatarId && !scene.avatarPosition) {\n        // При первом добавлении аватара устанавливаем начальную позицию и размер\n        const initialSize = getInitialAvatarSize(aspectRatio);\n        const canvasSize = CANVAS_SIZES[aspectRatio];\n        // Аватар по умолчанию имеет большой zIndex (выше всех элементов)\n        const maxZIndex = Math.max(...scene.elements.map((el) => el.zIndex ?? 0), 0);\n        return {\n          ...scene,\n          avatarId,\n          avatarPosition: { x: canvasSize.width / 2, y: canvasSize.height / 2 }, // центр канвы\n          avatarSize: initialSize,\n          avatarZIndex: maxZIndex + 1,\n        };\n      }\n      return { ...scene, avatarId };\n    });\n  };\n\n  const handleRemoveAvatar = () => {\n    if (!activeScene) return;\n    handleSceneUpdate(activeScene.id, (scene) => ({\n      ...scene,\n      avatarId: null,\n      avatarPosition: undefined,\n      avatarSize: undefined,\n    }));\n  };\n\n  const handleAvatarPositionChange = (coords: { x: number; y: number }) => {\n    if (!activeScene) return;\n    handleSceneUpdate(activeScene.id, (scene) => ({\n      ...scene,\n      avatarPosition: coords,\n    }));\n  };\n\n  const handleAvatarSizeChange = (size: { width: number; height: number }) => {\n    if (!activeScene) return;\n    handleSceneUpdate(activeScene.id, (scene) => ({\n      ...scene,\n      avatarSize: size,\n    }));\n  };\n\n\n  const handleAddMediaAsset = (imageUrl?: string, fileName?: string) => {\n    if (!activeScene) return;\n    handleSceneUpdate(activeScene.id, (scene) => {\n      const mediaIndex =\n        scene.elements.filter((element) => element.type === \"media\").length + 1;\n\n      const canvasSize = CANVAS_SIZES[aspectRatio];\n      \n      // Начальные размеры элемента в пикселях (примерно 28% ширины канвы)\n      const elementWidth = canvasSize.width * 0.28;\n      // Высота будет установлена автоматически на основе соотношения сторон изображения\n      // Пока используем примерную высоту, она будет скорректирована компонентом MediaCanvas\n      const elementHeight = canvasSize.height * 0.34;\n\n      // Определяем zIndex для нового элемента (добавляем в конец, самый верхний)\n      const maxElementZIndex = scene.elements.reduce((max, el) => Math.max(max, el.zIndex ?? 0), 0);\n      const maxZIndex = Math.max(maxElementZIndex, scene.avatarZIndex ?? 0);\n      \n      // Используем имя файла, если оно есть, иначе используем \"Медиа X\"\n      const label = fileName || `Медиа ${mediaIndex}`;\n      \n      const newElement: CanvasElement = {\n        id: `media-${scene.id}-${mediaIndex}-${Date.now()}`,\n        type: \"media\",\n        label: label,\n        color: \"#1fb6ff\",\n        width: elementWidth,\n        height: elementHeight,\n        x: canvasSize.width / 2, // центр по X\n        y: canvasSize.height / 2, // центр по Y\n        imageUrl: imageUrl,\n        zIndex: maxZIndex + 1,\n      };\n\n      return {\n        ...scene,\n        elements: [...scene.elements, newElement],\n      };\n    });\n  };\n\n  const handleElementPositionChange = (elementId: string, coords: { x: number; y: number }) => {\n    if (!activeScene) return;\n    handleSceneUpdate(activeScene.id, (scene) => ({\n      ...scene,\n      elements: scene.elements.map((element) =>\n        element.id === elementId ? { ...element, ...coords } : element,\n      ),\n    }));\n  };\n\n  const handleElementSizeChange = (elementId: string, size: { width: number; height: number }) => {\n    if (!activeScene) return;\n    handleSceneUpdate(activeScene.id, (scene) => ({\n      ...scene,\n      elements: scene.elements.map((element) =>\n        element.id === elementId ? { ...element, ...size } : element,\n      ),\n    }));\n  };\n\n  const handleRemoveElement = (elementId: string) => {\n    if (!activeScene) return;\n    handleSceneUpdate(activeScene.id, (scene) => ({\n      ...scene,\n      elements: scene.elements.filter((element) => element.id !== elementId),\n    }));\n  };\n\n  const handleReorderLayers = (newOrder: string[]) => {\n    if (!activeScene) return;\n    handleSceneUpdate(activeScene.id, (scene) => {\n      // Первый в списке (index 0) = больший zIndex = выше на канве\n      // Обновляем zIndex для всех элементов и аватара\n      const updatedElements = scene.elements.map((element) => {\n        const index = newOrder.indexOf(element.id);\n        // Первый элемент (index 0) получает zIndex = newOrder.length, последний получает 1\n        const zIndex = index !== -1 ? newOrder.length - index : element.zIndex ?? 0;\n        return {\n          ...element,\n          zIndex,\n        };\n      });\n      \n      // Обновляем zIndex для аватара\n      const avatarIndex = newOrder.indexOf(\"avatar\");\n      const avatarZIndex = avatarIndex !== -1 ? newOrder.length - avatarIndex : scene.avatarZIndex ?? 9999;\n      \n      return {\n        ...scene,\n        elements: updatedElements,\n        avatarZIndex,\n      };\n    });\n  };\n\n  const handleToggleAvatarLock = () => {\n    if (!activeScene) return;\n    handleSceneUpdate(activeScene.id, (scene) => ({\n      ...scene,\n      avatarLocked: !scene.avatarLocked,\n    }));\n  };\n\n  // Функция для получения оригинальных размеров изображения\n  const getImageDimensions = (imageUrl: string): Promise<{ width: number; height: number }> => {\n    return new Promise((resolve, reject) => {\n      // Используем window.Image чтобы избежать конфликта с импортом Image из Next.js\n      const img = document.createElement(\"img\");\n      \n      // Устанавливаем таймаут для загрузки\n      const timeout = setTimeout(() => {\n        img.onload = null;\n        img.onerror = null;\n        reject(new Error(`Таймаут загрузки изображения: ${imageUrl}`));\n      }, 15000); // 15 секунд таймаут\n      \n      img.onload = () => {\n        clearTimeout(timeout);\n        const width = img.naturalWidth || img.width;\n        const height = img.naturalHeight || img.height;\n        \n        if (width > 0 && height > 0) {\n          console.log(`Размеры изображения получены: ${imageUrl} - ${width}x${height}`);\n          resolve({ width, height });\n        } else {\n          reject(new Error(`Неверные размеры изображения: ${imageUrl}`));\n        }\n      };\n      \n      img.onerror = (error) => {\n        clearTimeout(timeout);\n        console.error(`Ошибка загрузки изображения: ${imageUrl}`, error);\n        reject(new Error(`Не удалось загрузить изображение: ${imageUrl}`));\n      };\n      \n      // Устанавливаем src после настройки обработчиков\n      img.src = imageUrl;\n    });\n  };\n\n  // Функция для подготовки данных слайда для вебхука\n  const prepareSlideData = async (scene: Scene, slideNumber: number) => {\n    const canvasSize = CANVAS_SIZES[aspectRatio];\n    const slideData: any = {\n      slide_number: slideNumber,\n      canvas_size: {\n        width: canvasSize.width,\n        height: canvasSize.height,\n      },\n      aspect_ratio: aspectRatio,\n      script: scene.script,\n      voice_id: scene.voiceId ? voices.find((v) => v.id === scene.voiceId)?.voice_id ?? null : null,\n      elements: [],\n    };\n\n    // Обрабатываем аватар\n    if (scene.avatarId && scene.avatarPosition && scene.avatarSize) {\n      const avatar = avatars.find((a) => a.id === scene.avatarId);\n      if (avatar && avatar.photo) {\n        console.log(`Загрузка размеров аватара для слайда ${slideNumber}: ${avatar.photo}`);\n        try {\n          const originalDimensions = await getImageDimensions(avatar.photo);\n          console.log(`Размеры аватара получены для слайда ${slideNumber}:`, originalDimensions);\n          slideData.elements.push({\n            type: \"avatar\",\n            id: scene.avatarId,\n            position: {\n              x: scene.avatarPosition.x,\n              y: scene.avatarPosition.y,\n            },\n            original_resolution: {\n              width: originalDimensions.width,\n              height: originalDimensions.height,\n            },\n            canvas_resolution: {\n              width: scene.avatarSize.width,\n              height: scene.avatarSize.height,\n            },\n            z_index: scene.avatarZIndex ?? 0,\n            image_url: avatar.photo,\n          });\n        } catch (error) {\n          console.error(`Ошибка при получении размеров аватара для слайда ${slideNumber}:`, error);\n          console.error(`URL аватара: ${avatar.photo}`);\n          // Добавляем аватар без оригинальных размеров\n          slideData.elements.push({\n            type: \"avatar\",\n            id: scene.avatarId,\n            position: {\n              x: scene.avatarPosition.x,\n              y: scene.avatarPosition.y,\n            },\n            original_resolution: null,\n            canvas_resolution: {\n              width: scene.avatarSize.width,\n              height: scene.avatarSize.height,\n            },\n            z_index: scene.avatarZIndex ?? 0,\n            image_url: avatar.photo,\n          });\n        }\n      }\n    }\n\n    // Обрабатываем медиа элементы\n    for (const element of scene.elements) {\n      if (element.type === \"media\" && element.imageUrl) {\n        console.log(`Загрузка размеров медиа для слайда ${slideNumber}: ${element.imageUrl}`);\n        try {\n          const originalDimensions = await getImageDimensions(element.imageUrl);\n          console.log(`Размеры медиа получены для слайда ${slideNumber}:`, originalDimensions);\n          slideData.elements.push({\n            type: \"media\",\n            id: element.id,\n            label: element.label,\n            position: {\n              x: element.x,\n              y: element.y,\n            },\n            original_resolution: {\n              width: originalDimensions.width,\n              height: originalDimensions.height,\n            },\n            canvas_resolution: {\n              width: element.width,\n              height: element.height,\n            },\n            z_index: element.zIndex ?? 0,\n            image_url: element.imageUrl,\n            crop: element.crop || null,\n          });\n        } catch (error) {\n          console.error(`Ошибка при получении размеров медиа для слайда ${slideNumber}:`, error);\n          console.error(`URL медиа: ${element.imageUrl}`);\n          // Добавляем медиа без оригинальных размеров\n          slideData.elements.push({\n            type: \"media\",\n            id: element.id,\n            label: element.label,\n            position: {\n              x: element.x,\n              y: element.y,\n            },\n            original_resolution: null,\n            canvas_resolution: {\n              width: element.width,\n              height: element.height,\n            },\n            z_index: element.zIndex ?? 0,\n            image_url: element.imageUrl,\n            crop: element.crop || null,\n          });\n        }\n      }\n    }\n\n    // Сортируем элементы по z_index (от меньшего к большему для правильного порядка слоев)\n    slideData.elements.sort((a: any, b: any) => a.z_index - b.z_index);\n\n    return slideData;\n  };\n\n  // Функция для отправки вебхука с данными всех слайдов\n  const handleGenerate = async () => {\n    if (isGenerating) return;\n    \n    setIsGenerating(true);\n    try {\n      const slidesData = [];\n      \n      // Подготавливаем данные для каждого слайда\n      for (let i = 0; i < scenes.length; i++) {\n        const scene = scenes[i];\n        const slideNumberMatch = scene.title.match(/\\d+/);\n        const slideNumber = slideNumberMatch ? parseInt(slideNumberMatch[0], 10) : i + 1;\n        \n        const slideData = await prepareSlideData(scene, slideNumber);\n        slidesData.push(slideData);\n      }\n\n      // Отправляем вебхук\n      const response = await fetch(\"https://rueleven.ru/webhook-test/2c6c697f-78cd-4eb2-bf01-2f00827b965d\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          video_title: videoTitle,\n          aspect_ratio: aspectRatio,\n          slides: slidesData,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(`Ошибка HTTP: ${response.status}`);\n      }\n\n      console.log(\"Вебхук успешно отправлен:\", slidesData);\n      alert(\"Генерация начата! Данные отправлены на сервер.\");\n    } catch (error) {\n      console.error(\"Ошибка при отправке вебхука:\", error);\n      alert(\"Произошла ошибка при отправке данных. Проверьте консоль для подробностей.\");\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  // Проверяем, можно ли сгенерировать (для активного слайда)\n  const canGenerate = useMemo(() => {\n    if (!activeScene) return false;\n    return !!(\n      activeScene.avatarId &&\n      activeScene.voiceId &&\n      activeScene.script.trim()\n    );\n  }, [activeScene]);\n\n  return (\n    <section className=\"flex h-screen w-full flex-col gap-4 px-4 pb-6 pt-4 sm:px-6 lg:gap-6 lg:pb-8\">\n      <div className=\"flex items-center justify-between gap-4 pb-2\">\n        <button\n          type=\"button\"\n          onClick={async () => {\n            // Получаем UUID залогиненного пользователя\n            const {\n              data: { user },\n            } = await supabase.auth.getUser();\n            const userUuid = user?.id || null;\n\n            // Отправляем вебхук для каждого слайда перед переходом назад\n            for (let i = 0; i < scenes.length; i++) {\n              const scene = scenes[i];\n              if (!scene.voiceId) continue;\n\n              // Находим выбранный голос и получаем его voice_id из таблицы\n              const selectedVoice = voices.find((voice) => voice.id === scene.voiceId);\n              if (!selectedVoice || !selectedVoice.voice_id) continue;\n\n              // Извлекаем номер слайда из title (например, \"Слайд 1\" -> 1)\n              const slideNumberMatch = scene.title.match(/\\d+/);\n              const slideNumber = slideNumberMatch ? parseInt(slideNumberMatch[0], 10) : i + 1;\n\n              try {\n                await fetch(\"https://rueleven.ru/webhook/8c42bae1-807d-40fa-b795-42897b4ec5b2\", {\n                  method: \"POST\",\n                  headers: {\n                    \"Content-Type\": \"application/json\",\n                  },\n                  body: JSON.stringify({\n                    slide_number: slideNumber,\n                    voice_id: selectedVoice.voice_id,\n                    uuid: userUuid,\n                  }),\n                });\n                console.log(`Вебхук отправлен для слайда ${slideNumber}`);\n              } catch (error) {\n                console.error(`Ошибка при отправке вебхука для слайда ${slideNumber}:`, error);\n              }\n            }\n\n            router.push(\"/material\");\n          }}\n          className=\"flex items-center gap-2 rounded-xl border border-gray-200 bg-white px-4 py-2 text-sm font-semibold text-gray-900 transition hover:bg-gray-50\"\n        >\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            viewBox=\"0 0 24 24\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            strokeWidth={2}\n            className=\"h-5 w-5\"\n          >\n            <path d=\"M19 12H5M12 19l-7-7 7-7\" />\n          </svg>\n          Назад\n        </button>\n        <button\n          type=\"button\"\n          onClick={handleGenerate}\n          disabled={!canGenerate || isGenerating}\n          className={`flex items-center gap-2 rounded-xl px-4 py-2 text-sm font-semibold text-white transition ${\n            canGenerate && !isGenerating\n              ? \"bg-green-600 hover:bg-green-500\"\n              : \"bg-gray-300 cursor-not-allowed\"\n          }`}\n        >\n          {isGenerating ? (\n            <>\n              <svg\n                className=\"animate-spin h-5 w-5\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n                fill=\"none\"\n                viewBox=\"0 0 24 24\"\n              >\n                <circle\n                  className=\"opacity-25\"\n                  cx=\"12\"\n                  cy=\"12\"\n                  r=\"10\"\n                  stroke=\"currentColor\"\n                  strokeWidth=\"4\"\n                ></circle>\n                <path\n                  className=\"opacity-75\"\n                  fill=\"currentColor\"\n                  d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n                ></path>\n              </svg>\n              Генерация...\n            </>\n          ) : (\n            <>\n              <svg\n                xmlns=\"http://www.w3.org/2000/svg\"\n                viewBox=\"0 0 24 24\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                strokeWidth={2}\n                className=\"h-5 w-5\"\n              >\n                <path d=\"M5 12h14M12 5l7 7-7 7\" />\n              </svg>\n              Сгенерировать\n            </>\n          )}\n        </button>\n      </div>\n      <div className=\"flex h-full min-h-0 flex-1 flex-col gap-4 lg:grid lg:grid-cols-[629px_minmax(0,1fr)] lg:items-stretch lg:gap-6\">\n        <div className=\"flex min-h-0 flex-1 flex-col lg:min-h-0 lg:h-full\">\n          <EditorSidebar\n            aspectRatio={aspectRatio}\n            onAspectRatioChange={(newRatio) => {\n              // Конвертируем координаты всех элементов и аватара при изменении соотношения сторон\n              const oldRatio = aspectRatio;\n              setScenes((prevScenes) =>\n                prevScenes.map((scene) => {\n                  const updatedScene = { ...scene };\n\n                  // Конвертируем позицию и размер аватара\n                  if (updatedScene.avatarPosition && updatedScene.avatarSize) {\n                    updatedScene.avatarPosition = convertCoordinates(\n                      updatedScene.avatarPosition,\n                      oldRatio,\n                      newRatio,\n                    );\n                    updatedScene.avatarSize = convertSize(\n                      updatedScene.avatarSize,\n                      oldRatio,\n                      newRatio,\n                    );\n                  }\n\n                  // Конвертируем координаты всех элементов\n                  updatedScene.elements = updatedScene.elements.map((element) => {\n                    const newPosition = convertCoordinates(\n                      { x: element.x, y: element.y },\n                      oldRatio,\n                      newRatio,\n                    );\n                    const newSize = convertSize(\n                      { width: element.width, height: element.height },\n                      oldRatio,\n                      newRatio,\n                    );\n                    return {\n                      ...element,\n                      x: newPosition.x,\n                      y: newPosition.y,\n                      width: newSize.width,\n                      height: newSize.height,\n                    };\n                  });\n\n                  return updatedScene;\n                }),\n              );\n              setAspectRatio(newRatio);\n            }}\n            videoTitle={videoTitle}\n            onVideoTitleChange={setVideoTitle}\n            avatars={avatars}\n            isLoadingAvatars={isLoadingAvatars}\n            voices={voices}\n            isLoadingVoices={isLoadingVoices}\n            scenes={scenes}\n            activeSceneId={activeSceneId}\n            onSelectScene={setActiveSceneId}\n            onAddScene={handleAddScene}\n            onDeleteScene={handleDeleteScene}\n            onSceneVoiceChange={(sceneId, voiceId) => {\n              handleSceneUpdate(sceneId, (scene) => ({ ...scene, voiceId }));\n            }}\n            onSceneScriptChange={(sceneId, script) => {\n              handleSceneUpdate(sceneId, (scene) => ({ ...scene, script }));\n            }}\n            onSceneAvatarChange={(sceneId, avatarId) => {\n              const scene = scenes.find((s) => s.id === sceneId);\n              if (!scene) return;\n              \n              if (avatarId && !scene.avatarPosition) {\n                // При первом добавлении аватара устанавливаем начальную позицию и размер\n                const initialSize = getInitialAvatarSize(aspectRatio);\n                const canvasSize = CANVAS_SIZES[aspectRatio];\n                const maxZIndex = Math.max(...scene.elements.map((el) => el.zIndex ?? 0), 0);\n                handleSceneUpdate(sceneId, (s) => ({\n                  ...s,\n                  avatarId,\n                  avatarPosition: { x: canvasSize.width / 2, y: canvasSize.height / 2 },\n                  avatarSize: initialSize,\n                  avatarZIndex: maxZIndex + 1,\n                }));\n              } else {\n                handleSceneUpdate(sceneId, (s) => ({ ...s, avatarId }));\n              }\n            }}\n          />\n        </div>\n\n        <div className=\"flex min-h-0 flex-1 flex-col gap-4\">\n          <div className=\"flex-1 min-h-0\">\n            <CanvasArea\n              aspectRatio={aspectRatio}\n              elements={activeScene?.elements ?? []}\n              avatar={\n                activeScene?.avatarId\n                  ? avatars.find((a) => a.id === activeScene.avatarId) ?? null\n                  : null\n              }\n              avatarPosition={\n                activeScene?.avatarPosition ?? {\n                  x: CANVAS_SIZES[aspectRatio].width / 2,\n                  y: CANVAS_SIZES[aspectRatio].height / 2,\n                }\n              }\n              avatarSize={activeScene?.avatarSize ?? getInitialAvatarSize(aspectRatio)}\n              avatarZIndex={activeScene?.avatarZIndex}\n              avatarLocked={activeScene?.avatarLocked}\n              onElementPositionChange={handleElementPositionChange}\n              onElementSizeChange={handleElementSizeChange}\n              onRemoveElement={handleRemoveElement}\n              onReorderLayers={handleReorderLayers}\n              onAvatarPositionChange={handleAvatarPositionChange}\n              onAvatarSizeChange={handleAvatarSizeChange}\n              onAddMediaAsset={handleAddMediaAsset}\n              onRemoveAvatar={handleRemoveAvatar}\n              onToggleAvatarLock={handleToggleAvatarLock}\n            />\n          </div>\n          <div className=\"min-h-[220px] lg:min-h-[240px]\">\n            <Timeline\n              scenes={scenes}\n              activeSceneId={activeSceneId}\n              onSelectScene={setActiveSceneId}\n              onAddScene={handleAddScene}\n              avatars={avatars}\n              aspectRatio={aspectRatio}\n            />\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n}\n\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAGA;AACA;AACA;AATA;;;;;;;;AAkBA,MAAM,cAAc,CAAC,QAAyB,CAAC;QAC7C,IAAI,OAAO,UAAU;QACrB,OAAO,CAAC,MAAM,EAAE,OAAO;QACvB,QAAQ;QACR,UAAU;QACV,SAAS;QACT,UAAU,EAAE;IACd,CAAC;AAEM,SAAS;IACd,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,gBAAgB,IAAA,gNAAO,EAAC,IAAM;YAAC,YAAY;SAAG,EAAE,EAAE;IACxD,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAc;IAC5D,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAC;IAC7C,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAU;IAC9C,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,iNAAQ,EAChD,aAAa,CAAC,EAAE,CAAC,EAAE;IAErB,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAiB,EAAE;IACzD,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAgB,EAAE;IACtD,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,iNAAQ,EAAC;IACzD,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,iNAAQ,EAAC;IACvD,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAC;IAEjD,MAAM,cAAc,OAAO,IAAI,CAAC,CAAC,QAAU,MAAM,EAAE,KAAK;IAExD,IAAA,kNAAS,EAAC;QACR,MAAM,eAAe;YACnB,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,iIAAQ,CAAC,IAAI,CAAC,OAAO;YAE/B,IAAI,CAAC,MAAM;YAEX,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,iIAAQ,CACnC,IAAI,CAAC,iBACL,MAAM,CAAC,KACP,EAAE,CAAC,OAAO,KAAK,EAAE,EACjB,EAAE,CAAC,UAAU,QACb,KAAK,CAAC,cAAc;gBAAE,WAAW;YAAM;YAE1C,IAAI,OAAO;gBACT,QAAQ,KAAK,CAAC,8CAA8C;YAC9D,OAAO;gBACL,WACE,CAAC,QAAQ,EAAE,EAAE,GAAG,CAAC,CAAC,SAAW,CAAC;wBAC5B,IAAI,OAAO,EAAE,IAAI;wBACjB,MAAM,OAAO,IAAI;wBACjB,OAAO,OAAO,KAAK;wBACnB,WAAW,OAAO,SAAS;wBAC3B,YAAY,OAAO,UAAU;wBAC7B,UAAU,OAAO,QAAQ;oBAC3B,CAAC;YAEL;YACA,oBAAoB;QACtB;QAEA;IACF,GAAG,EAAE;IAEL,IAAA,kNAAS,EAAC;QACR,MAAM,cAAc;YAClB,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,iIAAQ,CAAC,IAAI,CAAC,OAAO;YAE/B,IAAI,CAAC,MAAM;YAEX,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,iIAAQ,CACnC,IAAI,CAAC,UACL,MAAM,CAAC,KACP,EAAE,CAAC,OAAO,KAAK,EAAE,EACjB,KAAK,CAAC,cAAc;gBAAE,WAAW;YAAM;YAE1C,IAAI,OAAO;gBACT,QAAQ,KAAK,CAAC,6CAA6C;YAC7D,OAAO;gBACL,UACE,CAAC,QAAQ,EAAE,EACR,MAAM,CAAC,CAAC,QAAU,MAAM,GAAG,IAAI,MAAM,IAAI,EACzC,GAAG,CAAC,CAAC,QAAU,CAAC;wBACf,IAAI,MAAM,EAAE,IAAI;wBAChB,MAAM,MAAM,IAAI;wBAChB,KAAK,MAAM,GAAG;wBACd,aAAa,MAAM,WAAW;wBAC9B,UAAU,MAAM,QAAQ,IAAI;oBAC9B,CAAC;YAEP;YACA,mBAAmB;QACrB;QAEA;IACF,GAAG,EAAE;IAEL,MAAM,oBAAoB,CAAC,SAAiB,UAC1C,UAAU,CAAC,OACT,KAAK,GAAG,CAAC,CAAC,QAAW,MAAM,EAAE,KAAK,UAAU,QAAQ,SAAS;IAGjE,sCAAsC;IACtC,MAAM,eAAuE;QAC3E,QAAQ;YAAE,OAAO;YAAM,QAAQ;QAAK;QACpC,QAAQ;YAAE,OAAO;YAAM,QAAQ;QAAK;IACtC;IAEA,yEAAyE;IACzE,MAAM,uBAAuB,CAAC;QAC5B,MAAM,aAAa,YAAY,CAAC,MAAM;QAEtC,kDAAkD;QAClD,MAAM,sBAAsB;QAC5B,MAAM,SAAS,WAAW,MAAM,GAAG;QAEnC,wDAAwD;QACxD,MAAM,oBAAoB,IAAI;QAE9B,6DAA6D;QAC7D,MAAM,QAAQ,SAAS;QAEvB,OAAO;YAAE;YAAO;QAAO;IACzB;IAEA,gEAAgE;IAChE,MAAM,qBAAqB,CACzB,QACA,WACA;QAEA,IAAI,cAAc,SAAS,OAAO;QAElC,MAAM,WAAW,YAAY,CAAC,UAAU;QACxC,MAAM,SAAS,YAAY,CAAC,QAAQ;QAEpC,sDAAsD;QACtD,MAAM,WAAW,OAAO,CAAC,GAAG,SAAS,KAAK;QAC1C,MAAM,WAAW,OAAO,CAAC,GAAG,SAAS,MAAM;QAE3C,mCAAmC;QACnC,OAAO;YACL,GAAG,WAAW,OAAO,KAAK;YAC1B,GAAG,WAAW,OAAO,MAAM;QAC7B;IACF;IAEA,6DAA6D;IAC7D,MAAM,cAAc,CAClB,MACA,WACA;QAEA,IAAI,cAAc,SAAS,OAAO;QAElC,MAAM,WAAW,YAAY,CAAC,UAAU;QACxC,MAAM,SAAS,YAAY,CAAC,QAAQ;QAEpC,sDAAsD;QACtD,MAAM,eAAe,KAAK,KAAK,GAAG,SAAS,KAAK;QAChD,MAAM,gBAAgB,KAAK,MAAM,GAAG,SAAS,MAAM;QAEnD,mCAAmC;QACnC,OAAO;YACL,OAAO,eAAe,OAAO,KAAK;YAClC,QAAQ,gBAAgB,OAAO,MAAM;QACvC;IACF;IAEA,MAAM,iBAAiB,CAAC;QACtB,UAAU,CAAC;YACT,MAAM,WAAW,eACb,KAAK,SAAS,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,gBAAgB,IAC/C,KAAK,MAAM;YACf,2EAA2E;YAC3E,MAAM,cAAc,KAAK,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;YAC9C,MAAM,gBAAgB,eAClB,KAAK,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,gBAC1B,IAAI,CAAC,KAAK,MAAM,GAAG,EAAE;YAEzB,MAAM,WAAkB;gBACtB,IAAI,OAAO,UAAU;gBACrB,OAAO,CAAC,MAAM,EAAE,WAAW,GAAG;gBAC9B,QAAQ;gBACR,UAAU,aAAa,YAAY,eAAe,YAAY;gBAC9D,SAAS,aAAa,WAAW,eAAe,WAAW;gBAC3D,UAAU,aAAa,WAAW;uBAAI,YAAY,QAAQ;iBAAC,GAAG,eAAe,WAAW;uBAAI,cAAc,QAAQ;iBAAC,GAAG,EAAE;gBACxH,gBAAgB,aAAa,kBAAkB,eAAe;gBAC9D,YAAY,aAAa,cAAc,eAAe;gBACtD,cAAc,aAAa,gBAAgB,eAAe;YAC5D;YAEA,iBAAiB,SAAS,EAAE;YAE5B,IAAI,cAAc;gBAChB,MAAM,QAAQ,KAAK,SAAS,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;gBAC7C,MAAM,UAAU;uBAAI;iBAAK;gBACzB,QAAQ,MAAM,CAAC,QAAQ,GAAG,GAAG;gBAC7B,OAAO,QAAQ,GAAG,CAAC,CAAC,OAAO,MAAQ,CAAC;wBAClC,GAAG,KAAK;wBACR,OAAO,CAAC,MAAM,EAAE,MAAM,GAAG;oBAC3B,CAAC;YACH;YAEA,OAAO;mBAAI;gBAAM;aAAS,CAAC,GAAG,CAAC,CAAC,OAAO,MAAQ,CAAC;oBAC9C,GAAG,KAAK;oBACR,OAAO,CAAC,MAAM,EAAE,MAAM,GAAG;gBAC3B,CAAC;QACH;IACF;IAEA,MAAM,oBAAoB,CAAC;QACzB,UAAU,CAAC;YACT,MAAM,WAAW,KAAK,MAAM,CAAC,CAAC,QAAU,MAAM,EAAE,KAAK;YACrD,IAAI,SAAS,MAAM,KAAK,GAAG;gBACzB,MAAM,WAAW,YAAY;gBAC7B,iBAAiB,SAAS,EAAE;gBAC5B,OAAO;oBAAC;iBAAS;YACnB;YACA,IAAI,kBAAkB,SAAS;gBAC7B,MAAM,eAAe,KAAK,SAAS,CAAC,CAAC,QAAU,MAAM,EAAE,KAAK;gBAC5D,MAAM,iBAAiB,KAAK,GAAG,CAAC,GAAG,eAAe;gBAClD,iBAAiB,QAAQ,CAAC,eAAe,EAAE,MAAM,QAAQ,CAAC,EAAE,CAAC,EAAE;YACjE;YACA,OAAO,SAAS,GAAG,CAAC,CAAC,OAAO,QAAU,CAAC;oBACrC,GAAG,KAAK;oBACR,OAAO,CAAC,MAAM,EAAE,QAAQ,GAAG;gBAC7B,CAAC;QACH;IACF;IAEA,MAAM,qBAAqB,CAAC;QAC1B,IAAI,CAAC,aAAa;QAClB,kBAAkB,YAAY,EAAE,EAAE,CAAC,QAAU,CAAC;gBAAE,GAAG,KAAK;gBAAE,QAAQ;YAAM,CAAC;IAC3E;IAEA,MAAM,oBAAoB,CAAC;QACzB,IAAI,CAAC,aAAa;QAClB,kBAAkB,YAAY,EAAE,EAAE,CAAC,QAAU,CAAC;gBAAE,GAAG,KAAK;gBAAE;YAAQ,CAAC;IACrE;IAEA,MAAM,qBAAqB,CAAC;QAC1B,IAAI,CAAC,aAAa;QAClB,kBAAkB,YAAY,EAAE,EAAE,CAAC;YACjC,IAAI,YAAY,CAAC,MAAM,cAAc,EAAE;gBACrC,yEAAyE;gBACzE,MAAM,cAAc,qBAAqB;gBACzC,MAAM,aAAa,YAAY,CAAC,YAAY;gBAC5C,iEAAiE;gBACjE,MAAM,YAAY,KAAK,GAAG,IAAI,MAAM,QAAQ,CAAC,GAAG,CAAC,CAAC,KAAO,GAAG,MAAM,IAAI,IAAI;gBAC1E,OAAO;oBACL,GAAG,KAAK;oBACR;oBACA,gBAAgB;wBAAE,GAAG,WAAW,KAAK,GAAG;wBAAG,GAAG,WAAW,MAAM,GAAG;oBAAE;oBACpE,YAAY;oBACZ,cAAc,YAAY;gBAC5B;YACF;YACA,OAAO;gBAAE,GAAG,KAAK;gBAAE;YAAS;QAC9B;IACF;IAEA,MAAM,qBAAqB;QACzB,IAAI,CAAC,aAAa;QAClB,kBAAkB,YAAY,EAAE,EAAE,CAAC,QAAU,CAAC;gBAC5C,GAAG,KAAK;gBACR,UAAU;gBACV,gBAAgB;gBAChB,YAAY;YACd,CAAC;IACH;IAEA,MAAM,6BAA6B,CAAC;QAClC,IAAI,CAAC,aAAa;QAClB,kBAAkB,YAAY,EAAE,EAAE,CAAC,QAAU,CAAC;gBAC5C,GAAG,KAAK;gBACR,gBAAgB;YAClB,CAAC;IACH;IAEA,MAAM,yBAAyB,CAAC;QAC9B,IAAI,CAAC,aAAa;QAClB,kBAAkB,YAAY,EAAE,EAAE,CAAC,QAAU,CAAC;gBAC5C,GAAG,KAAK;gBACR,YAAY;YACd,CAAC;IACH;IAGA,MAAM,sBAAsB,CAAC,UAAmB;QAC9C,IAAI,CAAC,aAAa;QAClB,kBAAkB,YAAY,EAAE,EAAE,CAAC;YACjC,MAAM,aACJ,MAAM,QAAQ,CAAC,MAAM,CAAC,CAAC,UAAY,QAAQ,IAAI,KAAK,SAAS,MAAM,GAAG;YAExE,MAAM,aAAa,YAAY,CAAC,YAAY;YAE5C,oEAAoE;YACpE,MAAM,eAAe,WAAW,KAAK,GAAG;YACxC,kFAAkF;YAClF,sFAAsF;YACtF,MAAM,gBAAgB,WAAW,MAAM,GAAG;YAE1C,2EAA2E;YAC3E,MAAM,mBAAmB,MAAM,QAAQ,CAAC,MAAM,CAAC,CAAC,KAAK,KAAO,KAAK,GAAG,CAAC,KAAK,GAAG,MAAM,IAAI,IAAI;YAC3F,MAAM,YAAY,KAAK,GAAG,CAAC,kBAAkB,MAAM,YAAY,IAAI;YAEnE,kEAAkE;YAClE,MAAM,QAAQ,YAAY,CAAC,MAAM,EAAE,YAAY;YAE/C,MAAM,aAA4B;gBAChC,IAAI,CAAC,MAAM,EAAE,MAAM,EAAE,CAAC,CAAC,EAAE,WAAW,CAAC,EAAE,KAAK,GAAG,IAAI;gBACnD,MAAM;gBACN,OAAO;gBACP,OAAO;gBACP,OAAO;gBACP,QAAQ;gBACR,GAAG,WAAW,KAAK,GAAG;gBACtB,GAAG,WAAW,MAAM,GAAG;gBACvB,UAAU;gBACV,QAAQ,YAAY;YACtB;YAEA,OAAO;gBACL,GAAG,KAAK;gBACR,UAAU;uBAAI,MAAM,QAAQ;oBAAE;iBAAW;YAC3C;QACF;IACF;IAEA,MAAM,8BAA8B,CAAC,WAAmB;QACtD,IAAI,CAAC,aAAa;QAClB,kBAAkB,YAAY,EAAE,EAAE,CAAC,QAAU,CAAC;gBAC5C,GAAG,KAAK;gBACR,UAAU,MAAM,QAAQ,CAAC,GAAG,CAAC,CAAC,UAC5B,QAAQ,EAAE,KAAK,YAAY;wBAAE,GAAG,OAAO;wBAAE,GAAG,MAAM;oBAAC,IAAI;YAE3D,CAAC;IACH;IAEA,MAAM,0BAA0B,CAAC,WAAmB;QAClD,IAAI,CAAC,aAAa;QAClB,kBAAkB,YAAY,EAAE,EAAE,CAAC,QAAU,CAAC;gBAC5C,GAAG,KAAK;gBACR,UAAU,MAAM,QAAQ,CAAC,GAAG,CAAC,CAAC,UAC5B,QAAQ,EAAE,KAAK,YAAY;wBAAE,GAAG,OAAO;wBAAE,GAAG,IAAI;oBAAC,IAAI;YAEzD,CAAC;IACH;IAEA,MAAM,sBAAsB,CAAC;QAC3B,IAAI,CAAC,aAAa;QAClB,kBAAkB,YAAY,EAAE,EAAE,CAAC,QAAU,CAAC;gBAC5C,GAAG,KAAK;gBACR,UAAU,MAAM,QAAQ,CAAC,MAAM,CAAC,CAAC,UAAY,QAAQ,EAAE,KAAK;YAC9D,CAAC;IACH;IAEA,MAAM,sBAAsB,CAAC;QAC3B,IAAI,CAAC,aAAa;QAClB,kBAAkB,YAAY,EAAE,EAAE,CAAC;YACjC,6DAA6D;YAC7D,gDAAgD;YAChD,MAAM,kBAAkB,MAAM,QAAQ,CAAC,GAAG,CAAC,CAAC;gBAC1C,MAAM,QAAQ,SAAS,OAAO,CAAC,QAAQ,EAAE;gBACzC,mFAAmF;gBACnF,MAAM,SAAS,UAAU,CAAC,IAAI,SAAS,MAAM,GAAG,QAAQ,QAAQ,MAAM,IAAI;gBAC1E,OAAO;oBACL,GAAG,OAAO;oBACV;gBACF;YACF;YAEA,+BAA+B;YAC/B,MAAM,cAAc,SAAS,OAAO,CAAC;YACrC,MAAM,eAAe,gBAAgB,CAAC,IAAI,SAAS,MAAM,GAAG,cAAc,MAAM,YAAY,IAAI;YAEhG,OAAO;gBACL,GAAG,KAAK;gBACR,UAAU;gBACV;YACF;QACF;IACF;IAEA,MAAM,yBAAyB;QAC7B,IAAI,CAAC,aAAa;QAClB,kBAAkB,YAAY,EAAE,EAAE,CAAC,QAAU,CAAC;gBAC5C,GAAG,KAAK;gBACR,cAAc,CAAC,MAAM,YAAY;YACnC,CAAC;IACH;IAEA,0DAA0D;IAC1D,MAAM,qBAAqB,CAAC;QAC1B,OAAO,IAAI,QAAQ,CAAC,SAAS;YAC3B,+EAA+E;YAC/E,MAAM,MAAM,SAAS,aAAa,CAAC;YAEnC,qCAAqC;YACrC,MAAM,UAAU,WAAW;gBACzB,IAAI,MAAM,GAAG;gBACb,IAAI,OAAO,GAAG;gBACd,OAAO,IAAI,MAAM,CAAC,8BAA8B,EAAE,UAAU;YAC9D,GAAG,QAAQ,oBAAoB;YAE/B,IAAI,MAAM,GAAG;gBACX,aAAa;gBACb,MAAM,QAAQ,IAAI,YAAY,IAAI,IAAI,KAAK;gBAC3C,MAAM,SAAS,IAAI,aAAa,IAAI,IAAI,MAAM;gBAE9C,IAAI,QAAQ,KAAK,SAAS,GAAG;oBAC3B,QAAQ,GAAG,CAAC,CAAC,8BAA8B,EAAE,SAAS,GAAG,EAAE,MAAM,CAAC,EAAE,QAAQ;oBAC5E,QAAQ;wBAAE;wBAAO;oBAAO;gBAC1B,OAAO;oBACL,OAAO,IAAI,MAAM,CAAC,8BAA8B,EAAE,UAAU;gBAC9D;YACF;YAEA,IAAI,OAAO,GAAG,CAAC;gBACb,aAAa;gBACb,QAAQ,KAAK,CAAC,CAAC,6BAA6B,EAAE,UAAU,EAAE;gBAC1D,OAAO,IAAI,MAAM,CAAC,kCAAkC,EAAE,UAAU;YAClE;YAEA,iDAAiD;YACjD,IAAI,GAAG,GAAG;QACZ;IACF;IAEA,mDAAmD;IACnD,MAAM,mBAAmB,OAAO,OAAc;QAC5C,MAAM,aAAa,YAAY,CAAC,YAAY;QAC5C,MAAM,YAAiB;YACrB,cAAc;YACd,aAAa;gBACX,OAAO,WAAW,KAAK;gBACvB,QAAQ,WAAW,MAAM;YAC3B;YACA,cAAc;YACd,QAAQ,MAAM,MAAM;YACpB,UAAU,MAAM,OAAO,GAAG,OAAO,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,MAAM,OAAO,GAAG,YAAY,OAAO;YACzF,UAAU,EAAE;QACd;QAEA,sBAAsB;QACtB,IAAI,MAAM,QAAQ,IAAI,MAAM,cAAc,IAAI,MAAM,UAAU,EAAE;YAC9D,MAAM,SAAS,QAAQ,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,MAAM,QAAQ;YAC1D,IAAI,UAAU,OAAO,KAAK,EAAE;gBAC1B,QAAQ,GAAG,CAAC,CAAC,qCAAqC,EAAE,YAAY,EAAE,EAAE,OAAO,KAAK,EAAE;gBAClF,IAAI;oBACF,MAAM,qBAAqB,MAAM,mBAAmB,OAAO,KAAK;oBAChE,QAAQ,GAAG,CAAC,CAAC,oCAAoC,EAAE,YAAY,CAAC,CAAC,EAAE;oBACnE,UAAU,QAAQ,CAAC,IAAI,CAAC;wBACtB,MAAM;wBACN,IAAI,MAAM,QAAQ;wBAClB,UAAU;4BACR,GAAG,MAAM,cAAc,CAAC,CAAC;4BACzB,GAAG,MAAM,cAAc,CAAC,CAAC;wBAC3B;wBACA,qBAAqB;4BACnB,OAAO,mBAAmB,KAAK;4BAC/B,QAAQ,mBAAmB,MAAM;wBACnC;wBACA,mBAAmB;4BACjB,OAAO,MAAM,UAAU,CAAC,KAAK;4BAC7B,QAAQ,MAAM,UAAU,CAAC,MAAM;wBACjC;wBACA,SAAS,MAAM,YAAY,IAAI;wBAC/B,WAAW,OAAO,KAAK;oBACzB;gBACF,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,CAAC,iDAAiD,EAAE,YAAY,CAAC,CAAC,EAAE;oBAClF,QAAQ,KAAK,CAAC,CAAC,aAAa,EAAE,OAAO,KAAK,EAAE;oBAC5C,6CAA6C;oBAC7C,UAAU,QAAQ,CAAC,IAAI,CAAC;wBACtB,MAAM;wBACN,IAAI,MAAM,QAAQ;wBAClB,UAAU;4BACR,GAAG,MAAM,cAAc,CAAC,CAAC;4BACzB,GAAG,MAAM,cAAc,CAAC,CAAC;wBAC3B;wBACA,qBAAqB;wBACrB,mBAAmB;4BACjB,OAAO,MAAM,UAAU,CAAC,KAAK;4BAC7B,QAAQ,MAAM,UAAU,CAAC,MAAM;wBACjC;wBACA,SAAS,MAAM,YAAY,IAAI;wBAC/B,WAAW,OAAO,KAAK;oBACzB;gBACF;YACF;QACF;QAEA,8BAA8B;QAC9B,KAAK,MAAM,WAAW,MAAM,QAAQ,CAAE;YACpC,IAAI,QAAQ,IAAI,KAAK,WAAW,QAAQ,QAAQ,EAAE;gBAChD,QAAQ,GAAG,CAAC,CAAC,mCAAmC,EAAE,YAAY,EAAE,EAAE,QAAQ,QAAQ,EAAE;gBACpF,IAAI;oBACF,MAAM,qBAAqB,MAAM,mBAAmB,QAAQ,QAAQ;oBACpE,QAAQ,GAAG,CAAC,CAAC,kCAAkC,EAAE,YAAY,CAAC,CAAC,EAAE;oBACjE,UAAU,QAAQ,CAAC,IAAI,CAAC;wBACtB,MAAM;wBACN,IAAI,QAAQ,EAAE;wBACd,OAAO,QAAQ,KAAK;wBACpB,UAAU;4BACR,GAAG,QAAQ,CAAC;4BACZ,GAAG,QAAQ,CAAC;wBACd;wBACA,qBAAqB;4BACnB,OAAO,mBAAmB,KAAK;4BAC/B,QAAQ,mBAAmB,MAAM;wBACnC;wBACA,mBAAmB;4BACjB,OAAO,QAAQ,KAAK;4BACpB,QAAQ,QAAQ,MAAM;wBACxB;wBACA,SAAS,QAAQ,MAAM,IAAI;wBAC3B,WAAW,QAAQ,QAAQ;wBAC3B,MAAM,QAAQ,IAAI,IAAI;oBACxB;gBACF,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,CAAC,+CAA+C,EAAE,YAAY,CAAC,CAAC,EAAE;oBAChF,QAAQ,KAAK,CAAC,CAAC,WAAW,EAAE,QAAQ,QAAQ,EAAE;oBAC9C,4CAA4C;oBAC5C,UAAU,QAAQ,CAAC,IAAI,CAAC;wBACtB,MAAM;wBACN,IAAI,QAAQ,EAAE;wBACd,OAAO,QAAQ,KAAK;wBACpB,UAAU;4BACR,GAAG,QAAQ,CAAC;4BACZ,GAAG,QAAQ,CAAC;wBACd;wBACA,qBAAqB;wBACrB,mBAAmB;4BACjB,OAAO,QAAQ,KAAK;4BACpB,QAAQ,QAAQ,MAAM;wBACxB;wBACA,SAAS,QAAQ,MAAM,IAAI;wBAC3B,WAAW,QAAQ,QAAQ;wBAC3B,MAAM,QAAQ,IAAI,IAAI;oBACxB;gBACF;YACF;QACF;QAEA,uFAAuF;QACvF,UAAU,QAAQ,CAAC,IAAI,CAAC,CAAC,GAAQ,IAAW,EAAE,OAAO,GAAG,EAAE,OAAO;QAEjE,OAAO;IACT;IAEA,sDAAsD;IACtD,MAAM,iBAAiB;QACrB,IAAI,cAAc;QAElB,gBAAgB;QAChB,IAAI;YACF,MAAM,aAAa,EAAE;YAErB,2CAA2C;YAC3C,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,MAAM,EAAE,IAAK;gBACtC,MAAM,QAAQ,MAAM,CAAC,EAAE;gBACvB,MAAM,mBAAmB,MAAM,KAAK,CAAC,KAAK,CAAC;gBAC3C,MAAM,cAAc,mBAAmB,SAAS,gBAAgB,CAAC,EAAE,EAAE,MAAM,IAAI;gBAE/E,MAAM,YAAY,MAAM,iBAAiB,OAAO;gBAChD,WAAW,IAAI,CAAC;YAClB;YAEA,oBAAoB;YACpB,MAAM,WAAW,MAAM,MAAM,yEAAyE;gBACpG,QAAQ;gBACR,SAAS;oBACP,gBAAgB;gBAClB;gBACA,MAAM,KAAK,SAAS,CAAC;oBACnB,aAAa;oBACb,cAAc;oBACd,QAAQ;gBACV;YACF;YAEA,IAAI,CAAC,SAAS,EAAE,EAAE;gBAChB,MAAM,IAAI,MAAM,CAAC,aAAa,EAAE,SAAS,MAAM,EAAE;YACnD;YAEA,QAAQ,GAAG,CAAC,6BAA6B;YACzC,MAAM;QACR,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,gCAAgC;YAC9C,MAAM;QACR,SAAU;YACR,gBAAgB;QAClB;IACF;IAEA,2DAA2D;IAC3D,MAAM,cAAc,IAAA,gNAAO,EAAC;QAC1B,IAAI,CAAC,aAAa,OAAO;QACzB,OAAO,CAAC,CAAC,CACP,YAAY,QAAQ,IACpB,YAAY,OAAO,IACnB,YAAY,MAAM,CAAC,IAAI,EACzB;IACF,GAAG;QAAC;KAAY;IAEhB,qBACE,8OAAC;QAAQ,WAAU;;0BACjB,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBACC,MAAK;wBACL,SAAS;4BACP,2CAA2C;4BAC3C,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,iIAAQ,CAAC,IAAI,CAAC,OAAO;4BAC/B,MAAM,WAAW,MAAM,MAAM;4BAE7B,6DAA6D;4BAC7D,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,MAAM,EAAE,IAAK;gCACtC,MAAM,QAAQ,MAAM,CAAC,EAAE;gCACvB,IAAI,CAAC,MAAM,OAAO,EAAE;gCAEpB,6DAA6D;gCAC7D,MAAM,gBAAgB,OAAO,IAAI,CAAC,CAAC,QAAU,MAAM,EAAE,KAAK,MAAM,OAAO;gCACvE,IAAI,CAAC,iBAAiB,CAAC,cAAc,QAAQ,EAAE;gCAE/C,6DAA6D;gCAC7D,MAAM,mBAAmB,MAAM,KAAK,CAAC,KAAK,CAAC;gCAC3C,MAAM,cAAc,mBAAmB,SAAS,gBAAgB,CAAC,EAAE,EAAE,MAAM,IAAI;gCAE/E,IAAI;oCACF,MAAM,MAAM,oEAAoE;wCAC9E,QAAQ;wCACR,SAAS;4CACP,gBAAgB;wCAClB;wCACA,MAAM,KAAK,SAAS,CAAC;4CACnB,cAAc;4CACd,UAAU,cAAc,QAAQ;4CAChC,MAAM;wCACR;oCACF;oCACA,QAAQ,GAAG,CAAC,CAAC,4BAA4B,EAAE,aAAa;gCAC1D,EAAE,OAAO,OAAO;oCACd,QAAQ,KAAK,CAAC,CAAC,uCAAuC,EAAE,YAAY,CAAC,CAAC,EAAE;gCAC1E;4BACF;4BAEA,OAAO,IAAI,CAAC;wBACd;wBACA,WAAU;;0CAEV,8OAAC;gCACC,OAAM;gCACN,SAAQ;gCACR,MAAK;gCACL,QAAO;gCACP,aAAa;gCACb,WAAU;0CAEV,cAAA,8OAAC;oCAAK,GAAE;;;;;;;;;;;4BACJ;;;;;;;kCAGR,8OAAC;wBACC,MAAK;wBACL,SAAS;wBACT,UAAU,CAAC,eAAe;wBAC1B,WAAW,CAAC,yFAAyF,EACnG,eAAe,CAAC,eACZ,oCACA,kCACJ;kCAED,6BACC;;8CACE,8OAAC;oCACC,WAAU;oCACV,OAAM;oCACN,MAAK;oCACL,SAAQ;;sDAER,8OAAC;4CACC,WAAU;4CACV,IAAG;4CACH,IAAG;4CACH,GAAE;4CACF,QAAO;4CACP,aAAY;;;;;;sDAEd,8OAAC;4CACC,WAAU;4CACV,MAAK;4CACL,GAAE;;;;;;;;;;;;gCAEA;;yDAIR;;8CACE,8OAAC;oCACC,OAAM;oCACN,SAAQ;oCACR,MAAK;oCACL,QAAO;oCACP,aAAa;oCACb,WAAU;8CAEV,cAAA,8OAAC;wCAAK,GAAE;;;;;;;;;;;gCACJ;;;;;;;;;;;;;;0BAMd,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC,0KAAa;4BACZ,aAAa;4BACb,qBAAqB,CAAC;gCACpB,oFAAoF;gCACpF,MAAM,WAAW;gCACjB,UAAU,CAAC,aACT,WAAW,GAAG,CAAC,CAAC;wCACd,MAAM,eAAe;4CAAE,GAAG,KAAK;wCAAC;wCAEhC,wCAAwC;wCACxC,IAAI,aAAa,cAAc,IAAI,aAAa,UAAU,EAAE;4CAC1D,aAAa,cAAc,GAAG,mBAC5B,aAAa,cAAc,EAC3B,UACA;4CAEF,aAAa,UAAU,GAAG,YACxB,aAAa,UAAU,EACvB,UACA;wCAEJ;wCAEA,yCAAyC;wCACzC,aAAa,QAAQ,GAAG,aAAa,QAAQ,CAAC,GAAG,CAAC,CAAC;4CACjD,MAAM,cAAc,mBAClB;gDAAE,GAAG,QAAQ,CAAC;gDAAE,GAAG,QAAQ,CAAC;4CAAC,GAC7B,UACA;4CAEF,MAAM,UAAU,YACd;gDAAE,OAAO,QAAQ,KAAK;gDAAE,QAAQ,QAAQ,MAAM;4CAAC,GAC/C,UACA;4CAEF,OAAO;gDACL,GAAG,OAAO;gDACV,GAAG,YAAY,CAAC;gDAChB,GAAG,YAAY,CAAC;gDAChB,OAAO,QAAQ,KAAK;gDACpB,QAAQ,QAAQ,MAAM;4CACxB;wCACF;wCAEA,OAAO;oCACT;gCAEF,eAAe;4BACjB;4BACA,YAAY;4BACZ,oBAAoB;4BACpB,SAAS;4BACT,kBAAkB;4BAClB,QAAQ;4BACR,iBAAiB;4BACjB,QAAQ;4BACR,eAAe;4BACf,eAAe;4BACf,YAAY;4BACZ,eAAe;4BACf,oBAAoB,CAAC,SAAS;gCAC5B,kBAAkB,SAAS,CAAC,QAAU,CAAC;wCAAE,GAAG,KAAK;wCAAE;oCAAQ,CAAC;4BAC9D;4BACA,qBAAqB,CAAC,SAAS;gCAC7B,kBAAkB,SAAS,CAAC,QAAU,CAAC;wCAAE,GAAG,KAAK;wCAAE;oCAAO,CAAC;4BAC7D;4BACA,qBAAqB,CAAC,SAAS;gCAC7B,MAAM,QAAQ,OAAO,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;gCAC1C,IAAI,CAAC,OAAO;gCAEZ,IAAI,YAAY,CAAC,MAAM,cAAc,EAAE;oCACrC,yEAAyE;oCACzE,MAAM,cAAc,qBAAqB;oCACzC,MAAM,aAAa,YAAY,CAAC,YAAY;oCAC5C,MAAM,YAAY,KAAK,GAAG,IAAI,MAAM,QAAQ,CAAC,GAAG,CAAC,CAAC,KAAO,GAAG,MAAM,IAAI,IAAI;oCAC1E,kBAAkB,SAAS,CAAC,IAAM,CAAC;4CACjC,GAAG,CAAC;4CACJ;4CACA,gBAAgB;gDAAE,GAAG,WAAW,KAAK,GAAG;gDAAG,GAAG,WAAW,MAAM,GAAG;4CAAE;4CACpE,YAAY;4CACZ,cAAc,YAAY;wCAC5B,CAAC;gCACH,OAAO;oCACL,kBAAkB,SAAS,CAAC,IAAM,CAAC;4CAAE,GAAG,CAAC;4CAAE;wCAAS,CAAC;gCACvD;4BACF;;;;;;;;;;;kCAIJ,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAI,WAAU;0CACb,cAAA,8OAAC,oKAAU;oCACT,aAAa;oCACb,UAAU,aAAa,YAAY,EAAE;oCACrC,QACE,aAAa,WACT,QAAQ,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,YAAY,QAAQ,KAAK,OACtD;oCAEN,gBACE,aAAa,kBAAkB;wCAC7B,GAAG,YAAY,CAAC,YAAY,CAAC,KAAK,GAAG;wCACrC,GAAG,YAAY,CAAC,YAAY,CAAC,MAAM,GAAG;oCACxC;oCAEF,YAAY,aAAa,cAAc,qBAAqB;oCAC5D,cAAc,aAAa;oCAC3B,cAAc,aAAa;oCAC3B,yBAAyB;oCACzB,qBAAqB;oCACrB,iBAAiB;oCACjB,iBAAiB;oCACjB,wBAAwB;oCACxB,oBAAoB;oCACpB,iBAAiB;oCACjB,gBAAgB;oCAChB,oBAAoB;;;;;;;;;;;0CAGxB,8OAAC;gCAAI,WAAU;0CACb,cAAA,8OAAC,gKAAQ;oCACP,QAAQ;oCACR,eAAe;oCACf,eAAe;oCACf,YAAY;oCACZ,SAAS;oCACT,aAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAO3B"}},
    {"offset": {"line": 3921, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/material/editor/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect } from \"react\";\nimport { useRouter } from \"next/navigation\";\n\nimport { supabase } from \"@/lib/supabaseClient\";\nimport { MaterialEditor } from \"./components/MaterialEditor\";\n\nexport default function MaterialEditorPage() {\n  const router = useRouter();\n\n  useEffect(() => {\n    const checkAuth = async () => {\n      const {\n        data: { user },\n      } = await supabase.auth.getUser();\n      if (!user) {\n        router.push(\"/\");\n      }\n    };\n\n    checkAuth();\n  }, [router]);\n\n  return (\n    <div className=\"min-h-screen bg-white\">\n      <MaterialEditor />\n    </div>\n  );\n}\n\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAEA;AACA;AANA;;;;;;AAQe,SAAS;IACtB,MAAM,SAAS,IAAA,+IAAS;IAExB,IAAA,kNAAS,EAAC;QACR,MAAM,YAAY;YAChB,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,iIAAQ,CAAC,IAAI,CAAC,OAAO;YAC/B,IAAI,CAAC,MAAM;gBACT,OAAO,IAAI,CAAC;YACd;QACF;QAEA;IACF,GAAG;QAAC;KAAO;IAEX,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC,4KAAc;;;;;;;;;;AAGrB"}}]
}
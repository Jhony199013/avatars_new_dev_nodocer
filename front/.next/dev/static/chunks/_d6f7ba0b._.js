(globalThis.TURBOPACK || (globalThis.TURBOPACK = [])).push([typeof document === "object" ? document.currentScript : undefined,
"[project]/lib/supabaseClient.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "supabase",
    ()=>supabase
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$polyfills$2f$process$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = /*#__PURE__*/ __turbopack_context__.i("[project]/node_modules/next/dist/build/polyfills/process.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@supabase/supabase-js/dist/module/index.js [app-client] (ecmascript) <locals>");
;
const supabaseUrl = ("TURBOPACK compile-time value", "https://base.lect-gen.ru") || "";
const supabaseAnonKey = ("TURBOPACK compile-time value", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlzcyI6InN1cGFiYXNlIiwiaWF0IjoxNzYzNDEzMjAwLCJleHAiOjE5MjExNzk2MDB9.idPB37uPfkR0tioORf3PqSuFUCPp6ZDTrdBWtUou_9Y") || "";
const supabase = ("TURBOPACK compile-time truthy", 1) ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createClient"])(supabaseUrl, supabaseAnonKey) : "TURBOPACK unreachable";
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/app/avatars/servers/data:7a96d0 [app-client] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

/* __next_internal_action_entry_do_not_use__ [{"40cd6299375834d156b90e590d5d7df8fc8ed2c79b":"UploadAvatar"},"app/avatars/servers/UploadAvatar.ts",""] */ __turbopack_context__.s([
    "UploadAvatar",
    ()=>UploadAvatar
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var UploadAvatar = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("40cd6299375834d156b90e590d5d7df8fc8ed2c79b", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "UploadAvatar"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vVXBsb2FkQXZhdGFyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHNlcnZlclwiO1xuXG5pbXBvcnQgeyBCdWZmZXIgfSBmcm9tIFwiYnVmZmVyXCI7XG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tIFwiQHN1cGFiYXNlL3N1cGFiYXNlLWpzXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGhvdG9BdmF0YXJSb3cge1xuICBpZD86IHN0cmluZztcbiAgdWlkOiBzdHJpbmc7XG4gIG5hbWU6IHN0cmluZztcbiAgcGhvdG86IHN0cmluZztcbiAgaW1hZ2Vfa2V5OiBzdHJpbmc7XG4gIGhleV9nZW5faWQ6IHN0cmluZyB8IG51bGw7XG4gIGdyb3VwX2lkOiBzdHJpbmcgfCBudWxsO1xuICBzdGF0dXM6IFwiZG9uZVwiIHwgXCJlcnJvclwiO1xuICBjcmVhdGVkX2F0Pzogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgVXBsb2FkQXZhdGFyU3VjY2VzcyB7XG4gIHN1Y2Nlc3M6IHRydWU7XG4gIGF2YXRhcjogUGhvdG9BdmF0YXJSb3c7XG59XG5cbmludGVyZmFjZSBVcGxvYWRBdmF0YXJGYWlsdXJlIHtcbiAgc3VjY2VzczogZmFsc2U7XG4gIGVycm9yOiBzdHJpbmc7XG59XG5cbnR5cGUgVXBsb2FkQXZhdGFyUmVzdWx0ID0gVXBsb2FkQXZhdGFyU3VjY2VzcyB8IFVwbG9hZEF2YXRhckZhaWx1cmU7XG5cbmNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMO1xuY29uc3Qgc3VwYWJhc2VTZXJ2aWNlUm9sZUtleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVk7XG5jb25zdCBoZXlnZW5BcGlLZXkgPSBwcm9jZXNzLmVudi5IRVlHRU5fQVBJX0tFWTtcblxuaWYgKCFzdXBhYmFzZVVybCkge1xuICB0aHJvdyBuZXcgRXJyb3IoXCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwg0L3QtSDQt9Cw0LTQsNC9XCIpO1xufVxuXG5pZiAoIXN1cGFiYXNlU2VydmljZVJvbGVLZXkpIHtcbiAgdGhyb3cgbmV3IEVycm9yKFwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSDQvdC1INC30LDQtNCw0L1cIik7XG59XG5cbmNvbnN0IHN1cGFiYXNlQWRtaW4gPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlU2VydmljZVJvbGVLZXkpO1xuXG5hc3luYyBmdW5jdGlvbiB1cGxvYWRQaG90b1RvSGV5Z2VuKGZpbGU6IEZpbGUpIHtcbiAgaWYgKCFoZXlnZW5BcGlLZXkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJIRVlHRU5fQVBJX0tFWSDQvdC1INC30LDQtNCw0L1cIik7XG4gIH1cblxuICBjb25zdCBidWZmZXIgPSBCdWZmZXIuZnJvbShhd2FpdCBmaWxlLmFycmF5QnVmZmVyKCkpO1xuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFwiaHR0cHM6Ly91cGxvYWQuaGV5Z2VuLmNvbS92MS9hc3NldFwiLCB7XG4gICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICBoZWFkZXJzOiB7XG4gICAgICBcIlgtQXBpLUtleVwiOiBoZXlnZW5BcGlLZXksXG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBmaWxlLnR5cGUgfHwgXCJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW1cIixcbiAgICB9LFxuICAgIGJvZHk6IGJ1ZmZlcixcbiAgfSk7XG5cbiAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgIGNvbnN0IGVycm9yVGV4dCA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBg0J7RiNC40LHQutCwINC30LDQs9GA0YPQt9C60Lgg0YTQvtGC0L46ICR7ZXJyb3JUZXh0IHx8IHJlc3BvbnNlLnN0YXR1c1RleHR9YFxuICAgICk7XG4gIH1cblxuICBjb25zdCBqc29uID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICBjb25zdCBwYXlsb2FkID0gQXJyYXkuaXNBcnJheShqc29uKSA/IGpzb25bMF0gOiBqc29uO1xuICBjb25zdCBkYXRhID0gcGF5bG9hZD8uZGF0YTtcblxuICBpZiAoIWRhdGE/LmltYWdlX2tleSB8fCAhZGF0YT8udXJsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwi0J3QtdC60L7RgNGA0LXQutGC0L3Ri9C5INC+0YLQstC10YIgSGV5Z2VuINC/0YDQuCDQt9Cw0LPRgNGD0LfQutC1INGE0L7RgtC+XCIpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBpbWFnZUtleTogZGF0YS5pbWFnZV9rZXkgYXMgc3RyaW5nLFxuICAgIHBob3RvVXJsOiBkYXRhLnVybCBhcyBzdHJpbmcsXG4gIH07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVBob3RvQXZhdGFySW5IZXlnZW4obmFtZTogc3RyaW5nLCBpbWFnZUtleTogc3RyaW5nKSB7XG4gIGlmICghaGV5Z2VuQXBpS2V5KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiSEVZR0VOX0FQSV9LRVkg0L3QtSDQt9Cw0LTQsNC9XCIpO1xuICB9XG5cbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICBcImh0dHBzOi8vYXBpLmhleWdlbi5jb20vdjIvcGhvdG9fYXZhdGFyL2F2YXRhcl9ncm91cC9jcmVhdGVcIixcbiAgICB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIlgtQXBpLUtleVwiOiBoZXlnZW5BcGlLZXksXG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgaW1hZ2Vfa2V5OiBpbWFnZUtleSxcbiAgICAgIH0pLFxuICAgIH1cbiAgKTtcblxuICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgY29uc3QgZXJyb3JUZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIGDQntGI0LjQsdC60LAg0YHQvtC30LTQsNC90LjRjyDRhNC+0YLQvi3QsNCy0LDRgtCw0YDQsDogJHtlcnJvclRleHQgfHwgcmVzcG9uc2Uuc3RhdHVzVGV4dH1gXG4gICAgKTtcbiAgfVxuXG4gIGNvbnN0IGpzb24gPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gIGNvbnN0IHBheWxvYWQgPSBBcnJheS5pc0FycmF5KGpzb24pID8ganNvblswXSA6IGpzb247XG5cbiAgcmV0dXJuIHtcbiAgICBlcnJvcjogcGF5bG9hZD8uZXJyb3IgPz8gbnVsbCxcbiAgICBkYXRhOiBwYXlsb2FkPy5kYXRhID8/IG51bGwsXG4gIH07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBVcGxvYWRBdmF0YXIoZm9ybURhdGE6IEZvcm1EYXRhKTogUHJvbWlzZTxVcGxvYWRBdmF0YXJSZXN1bHQ+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1aWQgPSBmb3JtRGF0YS5nZXQoXCJ1aWRcIik7XG4gICAgY29uc3QgbmFtZSA9IGZvcm1EYXRhLmdldChcImF2YXRhcl9uYW1lXCIpO1xuICAgIGNvbnN0IGZpbGUgPSBmb3JtRGF0YS5nZXQoXCJwaG90b1wiKTtcblxuICAgIGlmICh0eXBlb2YgdWlkICE9PSBcInN0cmluZ1wiIHx8ICF1aWQpIHtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCLQndC1INGD0LTQsNC70L7RgdGMINC+0L/RgNC10LTQtdC70LjRgtGMINC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRj1wiIH07XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBuYW1lICE9PSBcInN0cmluZ1wiIHx8ICFuYW1lLnRyaW0oKSkge1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcItCS0LLQtdC00LjRgtC1INC40LzRjyDQsNCy0LDRgtCw0YDQsFwiIH07XG4gICAgfVxuXG4gICAgaWYgKCEoZmlsZSBpbnN0YW5jZW9mIEZpbGUpKSB7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwi0KTQsNC50Lsg0L3QtSDQvdCw0LnQtNC10L1cIiB9O1xuICAgIH1cblxuICAgIGNvbnN0IHRyaW1tZWROYW1lID0gbmFtZS50cmltKCk7XG5cbiAgICBjb25zdCB7IGltYWdlS2V5LCBwaG90b1VybCB9ID0gYXdhaXQgdXBsb2FkUGhvdG9Ub0hleWdlbihmaWxlKTtcbiAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjcmVhdGVQaG90b0F2YXRhckluSGV5Z2VuKFxuICAgICAgdHJpbW1lZE5hbWUsXG4gICAgICBpbWFnZUtleVxuICAgICk7XG5cbiAgICBjb25zdCBzdGF0dXM6IFwiZG9uZVwiIHwgXCJlcnJvclwiID0gY3JlYXRlUmVzdWx0LmVycm9yID8gXCJlcnJvclwiIDogXCJkb25lXCI7XG4gICAgY29uc3QgcmVjb3JkOiBQaG90b0F2YXRhclJvdyA9IHtcbiAgICAgIHVpZCxcbiAgICAgIG5hbWU6IHRyaW1tZWROYW1lLFxuICAgICAgcGhvdG86IHBob3RvVXJsLFxuICAgICAgaW1hZ2Vfa2V5OiBpbWFnZUtleSxcbiAgICAgIGhleV9nZW5faWQ6IGNyZWF0ZVJlc3VsdC5kYXRhPy5pZCA/PyBudWxsLFxuICAgICAgZ3JvdXBfaWQ6XG4gICAgICAgIGNyZWF0ZVJlc3VsdC5kYXRhPy5ncm91cF9pZCA/P1xuICAgICAgICBjcmVhdGVSZXN1bHQuZGF0YT8uaWQgPz9cbiAgICAgICAgY3JlYXRlUmVzdWx0LmRhdGE/Lmdyb3VwID8/XG4gICAgICAgIG51bGwsXG4gICAgICBzdGF0dXMsXG4gICAgfTtcblxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgIC5mcm9tKFwicGhvdG9fYXZhdGFyc1wiKVxuICAgICAgLmluc2VydChyZWNvcmQpXG4gICAgICAuc2VsZWN0KClcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yLm1lc3NhZ2UpO1xuICAgIH1cblxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGF2YXRhcjogZGF0YSBhcyBQaG90b0F2YXRhclJvdyB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnN0IG1lc3NhZ2UgPVxuICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBcItCd0LXQuNC30LLQtdGB0YLQvdCw0Y8g0L7RiNC40LHQutCwINGB0LXRgNCy0LXRgNCwXCI7XG4gICAgY29uc29sZS5lcnJvcihcIltVcGxvYWRBdmF0YXJdXCIsIG1lc3NhZ2UpO1xuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogbWVzc2FnZSB9O1xuICB9XG59XG5cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoieVNBbUhzQiJ9
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/app/avatars/components/AvatarUploadModal.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "AvatarUploadModal",
    ()=>AvatarUploadModal
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/image.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/supabaseClient.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$avatars$2f$servers$2f$data$3a$7a96d0__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/app/avatars/servers/data:7a96d0 [app-client] (ecmascript) <text/javascript>");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
;
const MAX_FILE_SIZE = 10 * 1024 * 1024;
const ALLOWED_TYPES = [
    "image/jpeg",
    "image/jpg",
    "image/png"
];
const sleep = (ms)=>new Promise((resolve)=>setTimeout(resolve, ms));
function AvatarUploadModal({ isOpen, onClose, onAvatarUploaded }) {
    _s();
    const [avatarName, setAvatarName] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("");
    const [dragActive, setDragActive] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [selectedFiles, setSelectedFiles] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])([]);
    const [previewUrls, setPreviewUrls] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])([]);
    const [isUploading, setIsUploading] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [progress, setProgress] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(0);
    const fileInputRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const progressIntervalRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const isMountedRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(true);
    const stopProgressLoop = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "AvatarUploadModal.useCallback[stopProgressLoop]": ()=>{
            if (progressIntervalRef.current) {
                clearInterval(progressIntervalRef.current);
                progressIntervalRef.current = null;
            }
        }
    }["AvatarUploadModal.useCallback[stopProgressLoop]"], []);
    const startProgressLoop = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "AvatarUploadModal.useCallback[startProgressLoop]": ()=>{
            stopProgressLoop();
            const startTime = Date.now();
            progressIntervalRef.current = setInterval({
                "AvatarUploadModal.useCallback[startProgressLoop]": ()=>{
                    setProgress({
                        "AvatarUploadModal.useCallback[startProgressLoop]": (prev)=>{
                            const elapsed = Date.now() - startTime;
                            const nextValue = Math.min(90, elapsed / 20000 * 90);
                            return nextValue > prev ? nextValue : prev;
                        }
                    }["AvatarUploadModal.useCallback[startProgressLoop]"]);
                }
            }["AvatarUploadModal.useCallback[startProgressLoop]"], 200);
        }
    }["AvatarUploadModal.useCallback[startProgressLoop]"], [
        stopProgressLoop
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "AvatarUploadModal.useEffect": ()=>{
            return ({
                "AvatarUploadModal.useEffect": ()=>{
                    previewUrls.forEach({
                        "AvatarUploadModal.useEffect": (url)=>URL.revokeObjectURL(url)
                    }["AvatarUploadModal.useEffect"]);
                }
            })["AvatarUploadModal.useEffect"];
        }
    }["AvatarUploadModal.useEffect"], [
        previewUrls
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "AvatarUploadModal.useEffect": ()=>{
            return ({
                "AvatarUploadModal.useEffect": ()=>{
                    isMountedRef.current = false;
                    stopProgressLoop();
                }
            })["AvatarUploadModal.useEffect"];
        }
    }["AvatarUploadModal.useEffect"], [
        stopProgressLoop
    ]);
    const resetState = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "AvatarUploadModal.useCallback[resetState]": ()=>{
            setAvatarName("");
            setSelectedFiles([]);
            previewUrls.forEach({
                "AvatarUploadModal.useCallback[resetState]": (url)=>URL.revokeObjectURL(url)
            }["AvatarUploadModal.useCallback[resetState]"]);
            setPreviewUrls([]);
            setProgress(0);
            stopProgressLoop();
        }
    }["AvatarUploadModal.useCallback[resetState]"], [
        previewUrls,
        stopProgressLoop
    ]);
    const closeModal = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "AvatarUploadModal.useCallback[closeModal]": ()=>{
            resetState();
            onClose();
        }
    }["AvatarUploadModal.useCallback[closeModal]"], [
        onClose,
        resetState
    ]);
    const validateFileTypes = (files)=>{
        const validFiles = [];
        const invalidFormat = [];
        const tooLarge = [];
        files.forEach((file)=>{
            if (!ALLOWED_TYPES.includes(file.type.toLowerCase())) {
                invalidFormat.push(file.name);
            } else if (file.size > MAX_FILE_SIZE) {
                tooLarge.push(`${file.name} (${(file.size / 1024 / 1024).toFixed(1)} МБ)`);
            } else {
                validFiles.push(file);
            }
        });
        if (invalidFormat.length || tooLarge.length) {
            let message = "";
            if (invalidFormat.length) {
                message += `Файлы с неподдерживаемым форматом:\n${invalidFormat.join("\n")}\n\nДопустимы только PNG или JPG.\n\n`;
            }
            if (tooLarge.length) {
                message += `Файлы превышают лимит 10 МБ:\n${tooLarge.join("\n")}`;
            }
            alert(message.trim());
        }
        return validFiles;
    };
    const createPreviews = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "AvatarUploadModal.useCallback[createPreviews]": (files)=>{
            previewUrls.forEach({
                "AvatarUploadModal.useCallback[createPreviews]": (url)=>URL.revokeObjectURL(url)
            }["AvatarUploadModal.useCallback[createPreviews]"]);
            const limitedFiles = files.slice(0, 1);
            setSelectedFiles(limitedFiles);
            setPreviewUrls(limitedFiles.map({
                "AvatarUploadModal.useCallback[createPreviews]": (file)=>URL.createObjectURL(file)
            }["AvatarUploadModal.useCallback[createPreviews]"]));
        }
    }["AvatarUploadModal.useCallback[createPreviews]"], [
        previewUrls
    ]);
    const handleDrag = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "AvatarUploadModal.useCallback[handleDrag]": (event)=>{
            event.preventDefault();
            event.stopPropagation();
            if (event.type === "dragenter" || event.type === "dragover") {
                setDragActive(true);
            } else if (event.type === "dragleave") {
                setDragActive(false);
            }
        }
    }["AvatarUploadModal.useCallback[handleDrag]"], []);
    const handleDrop = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "AvatarUploadModal.useCallback[handleDrop]": (event)=>{
            event.preventDefault();
            event.stopPropagation();
            setDragActive(false);
            if (event.dataTransfer.files?.[0]) {
                const validFiles = validateFileTypes([
                    event.dataTransfer.files[0]
                ]);
                if (validFiles.length) {
                    createPreviews(validFiles);
                }
            }
        }
    }["AvatarUploadModal.useCallback[handleDrop]"], [
        createPreviews
    ]);
    const handleFileSelect = (event)=>{
        if (event.target.files?.[0]) {
            const validFiles = validateFileTypes([
                event.target.files[0]
            ]);
            if (validFiles.length) {
                createPreviews(validFiles);
            }
        }
    };
    const removeFile = (index)=>{
        const newPreviews = previewUrls.filter((_, i)=>i !== index);
        const revokedUrl = previewUrls[index];
        if (revokedUrl) {
            URL.revokeObjectURL(revokedUrl);
        }
        setPreviewUrls(newPreviews);
        setSelectedFiles(selectedFiles.filter((_, i)=>i !== index));
    };
    const waitForAvatarCompletion = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "AvatarUploadModal.useCallback[waitForAvatarCompletion]": async (recordId, initialStatus)=>{
            if (!recordId) {
                console.warn("[avatars] Нет ID записи для проверки статуса");
                return true;
            }
            // Если статус уже done сразу после создания, не ждём
            if (initialStatus === "done") {
                console.log("[avatars] Статус уже 'done', не требуется ожидание");
                return true;
            }
            if (initialStatus === "error") {
                console.error("[avatars] Статус 'error' при создании записи");
                return false;
            }
            const timeoutMs = 2 * 60 * 1000;
            const pollDelayMs = 2000;
            const deadline = Date.now() + timeoutMs;
            let attemptCount = 0;
            console.log(`[avatars] Начинаем проверку статуса для записи ${recordId}`);
            while(isMountedRef.current && Date.now() < deadline){
                attemptCount++;
                const { data, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["supabase"].from("photo_avatars").select("status").eq("id", recordId).single();
                if (error) {
                    console.error(`[avatars] Ошибка проверки статуса (попытка ${attemptCount}):`, error);
                    // Если запись не найдена, продолжаем попытки
                    if (error.code === "PGRST116") {
                        await sleep(pollDelayMs);
                        continue;
                    }
                } else if (data?.status === "done") {
                    console.log(`[avatars] Статус 'done' получен после ${attemptCount} попыток`);
                    return true;
                } else if (data?.status === "error") {
                    console.error(`[avatars] Статус 'error' получен после ${attemptCount} попыток`);
                    return false;
                } else {
                    console.log(`[avatars] Попытка ${attemptCount}: статус = ${data?.status || "неизвестен"}`);
                }
                await sleep(pollDelayMs);
            }
            console.warn(`[avatars] Таймаут ожидания статуса после ${attemptCount} попыток`);
            return false;
        }
    }["AvatarUploadModal.useCallback[waitForAvatarCompletion]"], []);
    const handleUpload = async ()=>{
        if (isUploading || !avatarName.trim() || selectedFiles.length === 0) {
            return;
        }
        setIsUploading(true);
        setProgress(0);
        startProgressLoop();
        try {
            const { data: { user }, error: authError } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["supabase"].auth.getUser();
            if (authError) {
                throw new Error(authError.message);
            }
            if (!user) {
                throw new Error("Пользователь не найден");
            }
            const formData = new FormData();
            formData.append("avatar_name", avatarName.trim());
            formData.append("uid", user.id);
            formData.append("photo", selectedFiles[0]);
            const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$avatars$2f$servers$2f$data$3a$7a96d0__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["UploadAvatar"])(formData);
            if (!result.success) {
                throw new Error(result.error);
            }
            // Проверяем статус сразу после создания
            const initialStatus = result.avatar.status;
            console.log(`[avatars] Аватар создан с ID ${result.avatar.id}, начальный статус: ${initialStatus}`);
            // Если статус уже done, сразу устанавливаем прогресс в 100%
            if (initialStatus === "done") {
                stopProgressLoop();
                setProgress(100);
                await onAvatarUploaded?.();
                await sleep(400);
                closeModal();
                return;
            }
            const isReady = await waitForAvatarCompletion(result.avatar.id ?? null, initialStatus);
            if (!isReady) {
                throw new Error("Не удалось дождаться завершения обработки аватара. Попробуйте позже.");
            }
            stopProgressLoop();
            setProgress(100);
            await onAvatarUploaded?.();
            await sleep(400);
            closeModal();
        } catch (error) {
            console.error("[avatars] Ошибка при загрузке:", error);
            alert(`Ошибка при загрузке: ${error instanceof Error ? error.message : "Неизвестная ошибка"}`);
            setProgress(0);
        } finally{
            stopProgressLoop();
            setIsUploading(false);
        }
    };
    const dropZoneClasses = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "AvatarUploadModal.useMemo[dropZoneClasses]": ()=>{
            const base = "rounded-2xl border border-dashed border-blue-400/50 bg-blue-50/30 p-6 text-center transition-all duration-200";
            if (dragActive) {
                return `${base} shadow-lg -translate-y-0.5`;
            }
            return `${base} hover:shadow-md hover:-translate-y-0.5`;
        }
    }["AvatarUploadModal.useMemo[dropZoneClasses]"], [
        dragActive
    ]);
    if (!isOpen) {
        return null;
    }
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-8",
        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
            className: "w-full max-w-lg rounded-[32px] bg-white shadow-2xl",
            children: [
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "relative flex items-center justify-center border-b px-6 py-4",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h2", {
                            className: "text-lg font-semibold text-gray-900",
                            children: "Загрузите фото для аватара"
                        }, void 0, false, {
                            fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                            lineNumber: 336,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                            type: "button",
                            onClick: closeModal,
                            className: "absolute right-6 rounded-full p-1 text-gray-400 transition hover:bg-gray-100 hover:text-gray-600",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                    className: "sr-only",
                                    children: "Закрыть"
                                }, void 0, false, {
                                    fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                    lineNumber: 344,
                                    columnNumber: 13
                                }, this),
                                "✕"
                            ]
                        }, void 0, true, {
                            fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                            lineNumber: 339,
                            columnNumber: 11
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                    lineNumber: 335,
                    columnNumber: 9
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "max-h-[70vh] overflow-y-auto px-6 py-6 [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-track]:bg-gray-100 [&::-webkit-scrollbar-thumb]:bg-gray-300 [&::-webkit-scrollbar-thumb]:rounded-full",
                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "space-y-6 text-sm text-gray-600",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("label", {
                                        htmlFor: "avatar-name",
                                        className: "mb-2 block text-xs font-semibold uppercase tracking-wide text-gray-500",
                                        children: "Имя аватара"
                                    }, void 0, false, {
                                        fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                        lineNumber: 351,
                                        columnNumber: 15
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("input", {
                                        id: "avatar-name",
                                        value: avatarName,
                                        onChange: (event)=>setAvatarName(event.target.value),
                                        placeholder: "Придумайте любое имя",
                                        className: "w-full rounded-2xl border border-gray-200 bg-gray-50 px-4 py-3 text-base text-gray-900 outline-none transition focus:border-gray-400"
                                    }, void 0, false, {
                                        fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                        lineNumber: 357,
                                        columnNumber: 15
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                lineNumber: 350,
                                columnNumber: 13
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: dropZoneClasses,
                                onDragEnter: handleDrag,
                                onDragLeave: handleDrag,
                                onDragOver: handleDrag,
                                onDrop: handleDrop,
                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "mx-auto flex max-w-sm flex-col items-center gap-3 text-gray-700",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "rounded-2xl border border-blue-200 bg-white p-3 text-blue-500",
                                            children: "↑"
                                        }, void 0, false, {
                                            fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                            lineNumber: 374,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                            className: "text-base font-semibold",
                                            children: "Перетащите фотографию сюда"
                                        }, void 0, false, {
                                            fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                            lineNumber: 377,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                            className: "text-xs text-gray-500",
                                            children: "PNG или JPG до 10 МБ"
                                        }, void 0, false, {
                                            fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                            lineNumber: 380,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                            type: "button",
                                            className: "rounded-lg bg-blue-600 px-6 py-2 text-sm font-semibold text-white transition hover:bg-blue-500",
                                            onClick: ()=>fileInputRef.current?.click(),
                                            children: "Выбрать файл"
                                        }, void 0, false, {
                                            fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                            lineNumber: 381,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("input", {
                                            ref: fileInputRef,
                                            type: "file",
                                            accept: "image/jpeg,image/jpg,image/png",
                                            className: "hidden",
                                            onChange: handleFileSelect
                                        }, void 0, false, {
                                            fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                            lineNumber: 388,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                    lineNumber: 373,
                                    columnNumber: 15
                                }, this)
                            }, void 0, false, {
                                fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                lineNumber: 366,
                                columnNumber: 13
                            }, this),
                            selectedFiles.length > 0 && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "rounded-2xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-700",
                                children: selectedFiles.map((file, index)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "flex items-center justify-between gap-3",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "flex items-center gap-3",
                                                children: [
                                                    previewUrls[index] && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                                                        src: previewUrls[index],
                                                        alt: file.name,
                                                        width: 40,
                                                        height: 40,
                                                        className: "h-10 w-10 rounded-lg object-cover",
                                                        unoptimized: true
                                                    }, void 0, false, {
                                                        fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                                        lineNumber: 407,
                                                        columnNumber: 25
                                                    }, this),
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                        className: "truncate",
                                                        children: file.name
                                                    }, void 0, false, {
                                                        fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                                        lineNumber: 416,
                                                        columnNumber: 23
                                                    }, this)
                                                ]
                                            }, void 0, true, {
                                                fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                                lineNumber: 405,
                                                columnNumber: 21
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                type: "button",
                                                onClick: ()=>removeFile(index),
                                                className: "text-gray-400 transition hover:text-red-500",
                                                children: "Удалить"
                                            }, void 0, false, {
                                                fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                                lineNumber: 418,
                                                columnNumber: 21
                                            }, this)
                                        ]
                                    }, `${file.name}-${index}`, true, {
                                        fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                        lineNumber: 401,
                                        columnNumber: 19
                                    }, this))
                            }, void 0, false, {
                                fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                lineNumber: 399,
                                columnNumber: 15
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "rounded-2xl border border-gray-100 bg-gray-50 p-4 text-xs text-gray-600",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                        className: "mb-3 text-sm font-semibold text-gray-800",
                                        children: "Требования к фото"
                                    }, void 0, false, {
                                        fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                        lineNumber: 431,
                                        columnNumber: 15
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("ul", {
                                        className: "space-y-2",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("li", {
                                                children: "Фото в анфас (лицо прямо в камеру)"
                                            }, void 0, false, {
                                                fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                                lineNumber: 435,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("li", {
                                                children: "Хорошее качество изображения, чёткое и резкое"
                                            }, void 0, false, {
                                                fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                                lineNumber: 436,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("li", {
                                                children: "Без теней на лице, равномерное освещение"
                                            }, void 0, false, {
                                                fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                                lineNumber: 437,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("li", {
                                                children: "Без других людей на фото, только вы"
                                            }, void 0, false, {
                                                fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                                lineNumber: 438,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("li", {
                                                children: "Без открытой улыбки, нейтральное выражение лица"
                                            }, void 0, false, {
                                                fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                                lineNumber: 439,
                                                columnNumber: 17
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                        lineNumber: 434,
                                        columnNumber: 15
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                lineNumber: 430,
                                columnNumber: 13
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                        lineNumber: 349,
                        columnNumber: 11
                    }, this)
                }, void 0, false, {
                    fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                    lineNumber: 348,
                    columnNumber: 9
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "flex flex-col gap-3 border-t border-gray-200 px-6 py-4 text-sm text-gray-500 sm:flex-row sm:items-center sm:justify-between sm:gap-4",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "flex flex-1 items-center gap-4",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    type: "button",
                                    onClick: closeModal,
                                    className: "rounded-lg border border-gray-200 px-5 py-2 text-sm font-semibold text-gray-700 transition hover:bg-gray-50",
                                    disabled: isUploading,
                                    children: "Отмена"
                                }, void 0, false, {
                                    fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                    lineNumber: 447,
                                    columnNumber: 13
                                }, this),
                                (isUploading || progress > 0) && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "relative h-1 flex-1 overflow-hidden rounded-full bg-gray-200",
                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "absolute inset-y-0 left-0 rounded-full bg-gradient-to-r from-[#FFB347] via-[#FFC94C] to-[#FFB347] transition-[width] duration-500 ease-out",
                                        style: {
                                            width: `${progress}%`
                                        },
                                        "aria-hidden": "true"
                                    }, void 0, false, {
                                        fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                        lineNumber: 457,
                                        columnNumber: 17
                                    }, this)
                                }, void 0, false, {
                                    fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                                    lineNumber: 456,
                                    columnNumber: 15
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                            lineNumber: 446,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                            type: "button",
                            onClick: handleUpload,
                            disabled: isUploading || !avatarName.trim() || selectedFiles.length === 0,
                            className: "rounded-lg bg-blue-600 px-6 py-2 text-sm font-semibold text-white transition hover:bg-blue-500 disabled:cursor-not-allowed disabled:bg-gray-300 sm:ml-auto",
                            children: isUploading ? "Создаем..." : "Создать"
                        }, void 0, false, {
                            fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                            lineNumber: 465,
                            columnNumber: 11
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
                    lineNumber: 445,
                    columnNumber: 9
                }, this)
            ]
        }, void 0, true, {
            fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
            lineNumber: 334,
            columnNumber: 7
        }, this)
    }, void 0, false, {
        fileName: "[project]/app/avatars/components/AvatarUploadModal.tsx",
        lineNumber: 333,
        columnNumber: 5
    }, this);
}
_s(AvatarUploadModal, "f1w5L+IhpSx6GxCp8OShaf9hhEA=");
_c = AvatarUploadModal;
var _c;
__turbopack_context__.k.register(_c, "AvatarUploadModal");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/app/voices/components/VoiceCreateModal.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "VoiceCreateModal",
    ()=>VoiceCreateModal
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/supabaseClient.ts [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
const MAX_FILE_SIZE = 50 * 1024 * 1024; // 50 МБ
const ALLOWED_TYPES = [
    "audio/mpeg",
    "audio/mp3",
    "audio/wav",
    "audio/webm",
    "audio/ogg"
];
const MAX_DESCRIPTION_LENGTH = 100;
function VoiceCreateModal({ isOpen, onClose, onVoiceCreated }) {
    _s();
    const [voiceName, setVoiceName] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("");
    const [voiceDescription, setVoiceDescription] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("");
    const [selectedFile, setSelectedFile] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [isRecording, setIsRecording] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [recordedBlob, setRecordedBlob] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [recordedAudioUrl, setRecordedAudioUrl] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [isUploading, setIsUploading] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [isWaiting, setIsWaiting] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [progress, setProgress] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(0);
    const [dragActive, setDragActive] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const progressIntervalRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const mediaRecorderRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const audioChunksRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])([]);
    const fileInputRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const audioPlayerRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const stopProgressLoop = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "VoiceCreateModal.useCallback[stopProgressLoop]": ()=>{
            if (progressIntervalRef.current) {
                clearInterval(progressIntervalRef.current);
                progressIntervalRef.current = null;
            }
        }
    }["VoiceCreateModal.useCallback[stopProgressLoop]"], []);
    const startProgressLoop = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "VoiceCreateModal.useCallback[startProgressLoop]": ()=>{
            stopProgressLoop();
            setProgress(0);
            const startTime = Date.now();
            progressIntervalRef.current = setInterval({
                "VoiceCreateModal.useCallback[startProgressLoop]": ()=>{
                    const elapsed = Date.now() - startTime;
                    const nextValue = Math.min(100, elapsed / 15000 * 100);
                    setProgress(nextValue);
                }
            }["VoiceCreateModal.useCallback[startProgressLoop]"], 50);
        }
    }["VoiceCreateModal.useCallback[startProgressLoop]"], [
        stopProgressLoop
    ]);
    const resetState = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "VoiceCreateModal.useCallback[resetState]": ()=>{
            setVoiceName("");
            setVoiceDescription("");
            setSelectedFile(null);
            setRecordedBlob(null);
            // Очищаем URL для освобождения памяти
            if (recordedAudioUrl) {
                URL.revokeObjectURL(recordedAudioUrl);
            }
            setRecordedAudioUrl(null);
            setIsRecording(false);
            setIsWaiting(false);
            setProgress(0);
            stopProgressLoop();
            audioChunksRef.current = [];
            if (mediaRecorderRef.current && mediaRecorderRef.current.state !== "inactive") {
                mediaRecorderRef.current.stop();
            }
            if (mediaRecorderRef.current?.stream) {
                mediaRecorderRef.current.stream.getTracks().forEach({
                    "VoiceCreateModal.useCallback[resetState]": (track)=>track.stop()
                }["VoiceCreateModal.useCallback[resetState]"]);
            }
        }
    }["VoiceCreateModal.useCallback[resetState]"], [
        recordedAudioUrl,
        stopProgressLoop
    ]);
    const closeModal = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "VoiceCreateModal.useCallback[closeModal]": ()=>{
            resetState();
            onClose();
        }
    }["VoiceCreateModal.useCallback[closeModal]"], [
        onClose,
        resetState
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "VoiceCreateModal.useEffect": ()=>{
            return ({
                "VoiceCreateModal.useEffect": ()=>{
                    if (mediaRecorderRef.current?.stream) {
                        mediaRecorderRef.current.stream.getTracks().forEach({
                            "VoiceCreateModal.useEffect": (track)=>track.stop()
                        }["VoiceCreateModal.useEffect"]);
                    }
                    // Очищаем URL при размонтировании
                    if (recordedAudioUrl) {
                        URL.revokeObjectURL(recordedAudioUrl);
                    }
                    stopProgressLoop();
                }
            })["VoiceCreateModal.useEffect"];
        }
    }["VoiceCreateModal.useEffect"], [
        recordedAudioUrl,
        stopProgressLoop
    ]);
    const validateFile = (file)=>{
        if (!ALLOWED_TYPES.includes(file.type.toLowerCase())) {
            alert("Неподдерживаемый формат файла. Допустимы только MP3, WAV, WebM или OGG.");
            return false;
        }
        if (file.size > MAX_FILE_SIZE) {
            alert(`Файл превышает лимит 50 МБ. Размер файла: ${(file.size / 1024 / 1024).toFixed(1)} МБ`);
            return false;
        }
        return true;
    };
    const handleFileSelect = (event)=>{
        if (event.target.files?.[0]) {
            const file = event.target.files[0];
            if (validateFile(file)) {
                setSelectedFile(file);
                setRecordedBlob(null); // Сбрасываем запись если выбрали файл
            }
        }
    };
    const handleDrag = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "VoiceCreateModal.useCallback[handleDrag]": (event)=>{
            event.preventDefault();
            event.stopPropagation();
            if (event.type === "dragenter" || event.type === "dragover") {
                setDragActive(true);
            } else if (event.type === "dragleave") {
                setDragActive(false);
            }
        }
    }["VoiceCreateModal.useCallback[handleDrag]"], []);
    const handleDrop = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "VoiceCreateModal.useCallback[handleDrop]": (event)=>{
            event.preventDefault();
            event.stopPropagation();
            setDragActive(false);
            if (event.dataTransfer.files?.[0]) {
                const file = event.dataTransfer.files[0];
                if (validateFile(file)) {
                    setSelectedFile(file);
                    setRecordedBlob(null); // Сбрасываем запись если выбрали файл
                }
            }
        }
    }["VoiceCreateModal.useCallback[handleDrop]"], []);
    const startRecording = async ()=>{
        try {
            // Проверяем доступность API
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                alert("Ваш браузер не поддерживает запись с микрофона. Пожалуйста, используйте современный браузер (Chrome, Firefox, Edge).");
                return;
            }
            // Проверяем разрешения перед запросом
            try {
                const permissionStatus = await navigator.permissions.query({
                    name: "microphone"
                });
                if (permissionStatus.state === "denied") {
                    alert("Доступ к микрофону запрещен. Пожалуйста, разрешите доступ к микрофону в настройках браузера и обновите страницу.");
                    return;
                }
            } catch (permError) {
                // Некоторые браузеры не поддерживают permissions API, продолжаем
                console.log("Permissions API не поддерживается, продолжаем запрос");
            }
            const stream = await navigator.mediaDevices.getUserMedia({
                audio: {
                    echoCancellation: true,
                    noiseSuppression: true,
                    autoGainControl: true
                }
            });
            const mediaRecorder = new MediaRecorder(stream, {
                mimeType: MediaRecorder.isTypeSupported("audio/webm") ? "audio/webm" : MediaRecorder.isTypeSupported("audio/webm;codecs=opus") ? "audio/webm;codecs=opus" : "audio/mp4"
            });
            mediaRecorderRef.current = mediaRecorder;
            audioChunksRef.current = [];
            mediaRecorder.ondataavailable = (event)=>{
                if (event.data.size > 0) {
                    audioChunksRef.current.push(event.data);
                }
            };
            mediaRecorder.onstop = ()=>{
                const mimeType = mediaRecorder.mimeType || "audio/webm";
                const audioBlob = new Blob(audioChunksRef.current, {
                    type: mimeType
                });
                setRecordedBlob(audioBlob);
                // Создаем URL для воспроизведения
                const audioUrl = URL.createObjectURL(audioBlob);
                setRecordedAudioUrl(audioUrl);
                setSelectedFile(null); // Сбрасываем файл если записали
                stream.getTracks().forEach((track)=>track.stop());
            };
            mediaRecorder.onerror = (event)=>{
                console.error("Ошибка записи:", event);
                setIsRecording(false);
                stream.getTracks().forEach((track)=>track.stop());
                alert("Произошла ошибка при записи. Попробуйте еще раз.");
            };
            mediaRecorder.start();
            setIsRecording(true);
        } catch (error) {
            console.error("Ошибка доступа к микрофону:", error);
            setIsRecording(false);
            let errorMessage = "Не удалось получить доступ к микрофону.";
            if (error instanceof Error) {
                if (error.name === "NotAllowedError" || error.name === "PermissionDeniedError") {
                    errorMessage = "Доступ к микрофону запрещен.\n\n" + "Пожалуйста:\n" + "1. Нажмите на иконку замка в адресной строке браузера\n" + "2. Разрешите доступ к микрофону\n" + "3. Обновите страницу и попробуйте снова";
                } else if (error.name === "NotFoundError" || error.name === "DevicesNotFoundError") {
                    errorMessage = "Микрофон не найден. Убедитесь, что микрофон подключен и включен.";
                } else if (error.name === "NotReadableError" || error.name === "TrackStartError") {
                    errorMessage = "Микрофон уже используется другим приложением.\n\n" + "Закройте другие приложения, использующие микрофон, и попробуйте снова.";
                } else {
                    errorMessage = `Ошибка: ${error.message}`;
                }
            }
            alert(errorMessage);
        }
    };
    const stopRecording = ()=>{
        if (mediaRecorderRef.current && mediaRecorderRef.current.state !== "inactive") {
            mediaRecorderRef.current.stop();
            setIsRecording(false);
        }
    };
    const loadLameJs = ()=>{
        return new Promise((resolve, reject)=>{
            if (("TURBOPACK compile-time value", "object") !== "undefined" && window.lamejs) {
                resolve(window.lamejs);
                return;
            }
            const script = document.createElement("script");
            script.src = "https://cdn.jsdelivr.net/npm/lamejs@1.2.1/lame.min.js";
            script.onload = ()=>resolve(window.lamejs);
            script.onerror = ()=>reject(new Error("Не удалось загрузить библиотеку конвертации"));
            document.head.appendChild(script);
        });
    };
    const convertWebmToMp3 = async (webmBlob)=>{
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const arrayBuffer = await webmBlob.arrayBuffer();
        const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
        try {
            // Пытаемся использовать lamejs для конвертации в MP3
            const Lame = await loadLameJs();
            const mp3encoder = new Lame.Mp3Encoder(audioBuffer.numberOfChannels, audioBuffer.sampleRate, 128 // bitrate
            );
            // Конвертируем float32 в int16
            const samples = [];
            for(let i = 0; i < audioBuffer.numberOfChannels; i++){
                const channelData = audioBuffer.getChannelData(i);
                const int16Array = new Int16Array(channelData.length);
                for(let j = 0; j < channelData.length; j++){
                    int16Array[j] = Math.max(-32768, Math.min(32767, channelData[j] * 32768));
                }
                samples.push(int16Array);
            }
            const mp3Data = [];
            const sampleBlockSize = 1152;
            for(let i = 0; i < samples[0].length; i += sampleBlockSize){
                const left = samples[0].subarray(i, i + sampleBlockSize);
                const right = audioBuffer.numberOfChannels > 1 ? samples[1].subarray(i, i + sampleBlockSize) : left;
                const mp3buf = mp3encoder.encodeBuffer(left, right);
                if (mp3buf.length > 0) {
                    mp3Data.push(mp3buf);
                }
            }
            const mp3buf = mp3encoder.flush();
            if (mp3buf.length > 0) {
                mp3Data.push(mp3buf);
            }
            const mp3Blob = new Blob(mp3Data, {
                type: "audio/mpeg"
            });
            return new File([
                mp3Blob
            ], "recording.mp3", {
                type: "audio/mpeg"
            });
        } catch (error) {
            // Fallback: если lamejs не загрузился, конвертируем в WAV
            console.warn("Не удалось использовать lamejs, используем WAV формат:", error);
            const wavBlob = audioBufferToWav(audioBuffer);
            // Отправляем как WAV с расширением mp3 (сервер может конвертировать)
            return new File([
                wavBlob
            ], "recording.mp3", {
                type: "audio/mpeg"
            });
        }
    };
    const audioBufferToWav = (buffer)=>{
        const length = buffer.length;
        const numberOfChannels = buffer.numberOfChannels;
        const sampleRate = buffer.sampleRate;
        const arrayBuffer = new ArrayBuffer(44 + length * numberOfChannels * 2);
        const view = new DataView(arrayBuffer);
        // WAV header
        const writeString = (offset, string)=>{
            for(let i = 0; i < string.length; i++){
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        };
        writeString(0, "RIFF");
        view.setUint32(4, 36 + length * numberOfChannels * 2, true);
        writeString(8, "WAVE");
        writeString(12, "fmt ");
        view.setUint32(16, 16, true);
        view.setUint16(20, 1, true);
        view.setUint16(22, numberOfChannels, true);
        view.setUint32(24, sampleRate, true);
        view.setUint32(28, sampleRate * numberOfChannels * 2, true);
        view.setUint16(32, numberOfChannels * 2, true);
        view.setUint16(34, 16, true);
        writeString(36, "data");
        view.setUint32(40, length * numberOfChannels * 2, true);
        // Convert float samples to 16-bit PCM
        let offset = 44;
        for(let i = 0; i < length; i++){
            for(let channel = 0; channel < numberOfChannels; channel++){
                const sample = Math.max(-1, Math.min(1, buffer.getChannelData(channel)[i]));
                view.setInt16(offset, sample < 0 ? sample * 0x8000 : sample * 0x7FFF, true);
                offset += 2;
            }
        }
        return new Blob([
            arrayBuffer
        ], {
            type: "audio/wav"
        });
    };
    const handleCloneVoice = async ()=>{
        if (!voiceName.trim()) {
            alert("Введите название голоса");
            return;
        }
        // Запускаем прогресс-бар сразу при нажатии на кнопку
        setIsUploading(true);
        setIsWaiting(true);
        startProgressLoop();
        let audioFile = null;
        if (selectedFile) {
            // Если файл загружен, используем его как есть
            audioFile = selectedFile;
        } else if (recordedBlob) {
            // Если запись с микрофона, конвертируем webm в mp3
            try {
                audioFile = await convertWebmToMp3(recordedBlob);
            } catch (error) {
                console.error("[voices] Ошибка конвертации:", error);
                stopProgressLoop();
                setIsUploading(false);
                setIsWaiting(false);
                alert("Ошибка при конвертации записи. Попробуйте еще раз.");
                return;
            }
        } else {
            stopProgressLoop();
            setIsUploading(false);
            setIsWaiting(false);
            alert("Загрузите файл или запишите голос с микрофона");
            return;
        }
        try {
            // Получаем UUID авторизованного пользователя
            const { data: { user }, error: authError } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["supabase"].auth.getUser();
            if (authError || !user) {
                throw new Error("Не удалось получить данные пользователя");
            }
            const formData = new FormData();
            formData.append("name", voiceName.trim());
            if (voiceDescription.trim()) {
                const trimmedDescription = voiceDescription.trim().slice(0, MAX_DESCRIPTION_LENGTH);
                formData.append("description", trimmedDescription);
            }
            formData.append("file", audioFile);
            formData.append("uuid", user.id);
            const response = await fetch("https://rueleven.ru/webhook/053aa1a5-396c-4cff-b9c4-a71ca8910a22", {
                method: "POST",
                body: formData
            });
            if (!response.ok) {
                throw new Error(`Ошибка отправки: ${response.statusText}`);
            }
            // Отправляем вебхук с UUID пользователя при клонировании голоса
            try {
                await fetch("https://rueleven.ru/webhook/373bb6fa-8fae-49fd-83b6-b503e7f286c4", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        uuid: user.id
                    })
                });
            } catch (webhookError) {
                // Логируем ошибку вебхука, но не прерываем процесс клонирования
                console.error("[VoiceCreateModal] Ошибка отправки вебхука UUID:", webhookError);
            }
            // Продолжаем ждать появления записи в таблице (прогресс-бар уже запущен)
            setIsUploading(false);
            // Ждем появления записи в таблице voices
            const timeoutMs = 30000; // 30 секунд максимум
            const pollDelayMs = 1000; // Проверяем каждую секунду
            const deadline = Date.now() + timeoutMs;
            let found = false;
            while(Date.now() < deadline && !found){
                const { data, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["supabase"].from("voices").select("*").eq("uid", user.id).eq("name", voiceName.trim()).order("created_at", {
                    ascending: false
                }).limit(1);
                if (!error && data && data.length > 0) {
                    found = true;
                    stopProgressLoop();
                    setProgress(100);
                    await new Promise((resolve)=>setTimeout(resolve, 300)); // Небольшая задержка для завершения анимации
                    setIsWaiting(false);
                    await onVoiceCreated?.();
                    closeModal();
                    return;
                }
                await new Promise((resolve)=>setTimeout(resolve, pollDelayMs));
            }
            // Если не нашли за отведенное время
            stopProgressLoop();
            setIsWaiting(false);
            alert("Голос отправлен на обработку. Проверьте список голосов через несколько секунд.");
            await onVoiceCreated?.();
            closeModal();
        } catch (error) {
            console.error("[voices] Ошибка клонирования голоса:", error);
            stopProgressLoop();
            setIsUploading(false);
            setIsWaiting(false);
            alert(`Ошибка при клонировании голоса: ${error instanceof Error ? error.message : "Неизвестная ошибка"}`);
        }
    };
    const dropZoneClasses = `rounded-2xl border border-dashed border-purple-400/50 bg-purple-50/30 p-6 text-center transition-all duration-200 ${dragActive ? "shadow-lg -translate-y-0.5 border-purple-500" : "hover:shadow-md hover:-translate-y-0.5"}`;
    if (!isOpen) {
        return null;
    }
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-8",
        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
            className: "w-full max-w-lg rounded-[32px] bg-white shadow-2xl",
            children: [
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "relative flex items-center justify-center border-b px-6 py-4",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h2", {
                            className: "text-lg font-semibold text-gray-900",
                            children: "Создать голос"
                        }, void 0, false, {
                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                            lineNumber: 508,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                            type: "button",
                            onClick: closeModal,
                            className: "absolute right-6 rounded-full p-1 text-gray-400 transition hover:bg-gray-100 hover:text-gray-600",
                            disabled: isUploading || isRecording,
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                    className: "sr-only",
                                    children: "Закрыть"
                                }, void 0, false, {
                                    fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                    lineNumber: 517,
                                    columnNumber: 13
                                }, this),
                                "✕"
                            ]
                        }, void 0, true, {
                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                            lineNumber: 511,
                            columnNumber: 11
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                    lineNumber: 507,
                    columnNumber: 9
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "max-h-[70vh] overflow-y-auto px-6 py-6 [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-track]:bg-gray-100 [&::-webkit-scrollbar-thumb]:bg-gray-300 [&::-webkit-scrollbar-thumb]:rounded-full",
                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "space-y-6 text-sm text-gray-600",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("label", {
                                        htmlFor: "voice-name",
                                        className: "mb-2 block text-xs font-semibold uppercase tracking-wide text-gray-500",
                                        children: "Название голоса"
                                    }, void 0, false, {
                                        fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                        lineNumber: 524,
                                        columnNumber: 15
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("input", {
                                        id: "voice-name",
                                        value: voiceName,
                                        onChange: (event)=>setVoiceName(event.target.value),
                                        placeholder: "Придумайте название голоса",
                                        className: "w-full rounded-2xl border border-gray-200 bg-gray-50 px-4 py-3 text-base text-gray-900 outline-none transition focus:border-gray-400",
                                        disabled: isUploading || isRecording
                                    }, void 0, false, {
                                        fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                        lineNumber: 530,
                                        columnNumber: 15
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                lineNumber: 523,
                                columnNumber: 13
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "mb-2 flex items-center justify-between",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("label", {
                                                htmlFor: "voice-description",
                                                className: "block text-xs font-semibold uppercase tracking-wide text-gray-500",
                                                children: [
                                                    "Описание голоса ",
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                        className: "text-gray-400",
                                                        children: "(необязательно)"
                                                    }, void 0, false, {
                                                        fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                                        lineNumber: 546,
                                                        columnNumber: 35
                                                    }, this)
                                                ]
                                            }, void 0, true, {
                                                fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                                lineNumber: 542,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                className: `text-xs ${voiceDescription.length > MAX_DESCRIPTION_LENGTH ? "text-red-500" : "text-gray-400"}`,
                                                children: [
                                                    voiceDescription.length,
                                                    "/",
                                                    MAX_DESCRIPTION_LENGTH
                                                ]
                                            }, void 0, true, {
                                                fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                                lineNumber: 548,
                                                columnNumber: 17
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                        lineNumber: 541,
                                        columnNumber: 15
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("textarea", {
                                        id: "voice-description",
                                        value: voiceDescription,
                                        onChange: (event)=>{
                                            const value = event.target.value;
                                            if (value.length <= MAX_DESCRIPTION_LENGTH) {
                                                setVoiceDescription(value);
                                            }
                                        },
                                        maxLength: MAX_DESCRIPTION_LENGTH,
                                        placeholder: "Добавьте описание голоса",
                                        className: "h-28 w-full rounded-2xl border border-gray-200 bg-gray-50 px-4 py-3 text-base text-gray-900 outline-none transition focus:border-gray-400",
                                        disabled: isUploading || isRecording
                                    }, void 0, false, {
                                        fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                        lineNumber: 556,
                                        columnNumber: 15
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                lineNumber: 540,
                                columnNumber: 13
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: dropZoneClasses,
                                onDragEnter: handleDrag,
                                onDragLeave: handleDrag,
                                onDragOver: handleDrag,
                                onDrop: handleDrop,
                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "mx-auto flex max-w-sm flex-col items-center gap-3 text-gray-700",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "rounded-2xl border border-purple-200 bg-white p-3 text-purple-500",
                                            children: "↑"
                                        }, void 0, false, {
                                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                            lineNumber: 581,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                            className: "text-base font-semibold",
                                            children: "Перетащите аудио файл сюда"
                                        }, void 0, false, {
                                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                            lineNumber: 584,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                            className: "text-xs text-gray-500",
                                            children: "MP3, WAV, WebM или OGG до 50 МБ"
                                        }, void 0, false, {
                                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                            lineNumber: 587,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                            type: "button",
                                            className: "rounded-lg bg-purple-600 px-6 py-2 text-sm font-semibold text-white transition hover:bg-purple-500 disabled:opacity-50",
                                            onClick: ()=>fileInputRef.current?.click(),
                                            disabled: isUploading || isRecording,
                                            children: "Выбрать файл"
                                        }, void 0, false, {
                                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                            lineNumber: 588,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("input", {
                                            ref: fileInputRef,
                                            type: "file",
                                            accept: "audio/*",
                                            className: "hidden",
                                            onChange: handleFileSelect,
                                            disabled: isUploading || isRecording
                                        }, void 0, false, {
                                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                            lineNumber: 596,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                    lineNumber: 580,
                                    columnNumber: 15
                                }, this)
                            }, void 0, false, {
                                fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                lineNumber: 573,
                                columnNumber: 13
                            }, this),
                            selectedFile && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "rounded-2xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-700",
                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "flex items-center justify-between gap-3",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "flex items-center gap-3",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "rounded-lg bg-purple-100 p-2 text-purple-600",
                                                    children: "🎵"
                                                }, void 0, false, {
                                                    fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                                    lineNumber: 612,
                                                    columnNumber: 21
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                            className: "font-medium",
                                                            children: selectedFile.name
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                                            lineNumber: 616,
                                                            columnNumber: 23
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                            className: "text-xs text-gray-500",
                                                            children: [
                                                                (selectedFile.size / 1024 / 1024).toFixed(2),
                                                                " МБ"
                                                            ]
                                                        }, void 0, true, {
                                                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                                            lineNumber: 617,
                                                            columnNumber: 23
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                                    lineNumber: 615,
                                                    columnNumber: 21
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                            lineNumber: 611,
                                            columnNumber: 19
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                            type: "button",
                                            onClick: ()=>setSelectedFile(null),
                                            className: "text-gray-400 transition hover:text-red-500",
                                            disabled: isUploading || isRecording,
                                            children: "✕"
                                        }, void 0, false, {
                                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                            lineNumber: 622,
                                            columnNumber: 19
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                    lineNumber: 610,
                                    columnNumber: 17
                                }, this)
                            }, void 0, false, {
                                fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                lineNumber: 609,
                                columnNumber: 15
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "relative",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "absolute inset-0 flex items-center",
                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "w-full border-t border-gray-200"
                                        }, void 0, false, {
                                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                            lineNumber: 637,
                                            columnNumber: 17
                                        }, this)
                                    }, void 0, false, {
                                        fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                        lineNumber: 636,
                                        columnNumber: 15
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "relative flex justify-center text-xs uppercase",
                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "bg-white px-2 text-gray-500",
                                            children: "или"
                                        }, void 0, false, {
                                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                            lineNumber: 640,
                                            columnNumber: 17
                                        }, this)
                                    }, void 0, false, {
                                        fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                        lineNumber: 639,
                                        columnNumber: 15
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                lineNumber: 635,
                                columnNumber: 13
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "rounded-2xl border border-gray-200 bg-gray-50 p-6 text-center",
                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "mx-auto flex max-w-sm flex-col items-center gap-4",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "rounded-full border-4 border-purple-200 bg-white p-4",
                                            children: isRecording ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "h-12 w-12 animate-pulse rounded-full bg-red-500"
                                            }, void 0, false, {
                                                fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                                lineNumber: 649,
                                                columnNumber: 21
                                            }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "h-12 w-12 rounded-full bg-purple-500"
                                            }, void 0, false, {
                                                fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                                lineNumber: 651,
                                                columnNumber: 21
                                            }, this)
                                        }, void 0, false, {
                                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                            lineNumber: 647,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                    className: "text-base font-semibold text-gray-900",
                                                    children: isRecording ? "Идет запись..." : "Записать с микрофона"
                                                }, void 0, false, {
                                                    fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                                    lineNumber: 655,
                                                    columnNumber: 19
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                    className: "mt-1 text-xs text-gray-500",
                                                    children: isRecording ? "Нажмите остановить для завершения записи" : "Нажмите начать для записи голоса"
                                                }, void 0, false, {
                                                    fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                                    lineNumber: 658,
                                                    columnNumber: 19
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                            lineNumber: 654,
                                            columnNumber: 17
                                        }, this),
                                        !isRecording ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                            type: "button",
                                            onClick: startRecording,
                                            className: "rounded-lg bg-purple-600 px-6 py-2 text-sm font-semibold text-white transition hover:bg-purple-500 disabled:opacity-50",
                                            disabled: isUploading || !!selectedFile,
                                            children: "Начать запись"
                                        }, void 0, false, {
                                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                            lineNumber: 665,
                                            columnNumber: 19
                                        }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                            type: "button",
                                            onClick: stopRecording,
                                            className: "rounded-lg bg-red-600 px-6 py-2 text-sm font-semibold text-white transition hover:bg-red-500",
                                            children: "Остановить запись"
                                        }, void 0, false, {
                                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                            lineNumber: 674,
                                            columnNumber: 19
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                    lineNumber: 646,
                                    columnNumber: 15
                                }, this)
                            }, void 0, false, {
                                fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                lineNumber: 645,
                                columnNumber: 13
                            }, this),
                            recordedBlob && !isRecording && recordedAudioUrl && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "rounded-2xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-700",
                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "space-y-3",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "flex items-center justify-between gap-3",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "flex items-center gap-3",
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                            className: "rounded-lg bg-green-100 p-2 text-green-600",
                                                            children: "✓"
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                                            lineNumber: 691,
                                                            columnNumber: 23
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                            children: [
                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                                    className: "font-medium",
                                                                    children: "Запись завершена"
                                                                }, void 0, false, {
                                                                    fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                                                    lineNumber: 695,
                                                                    columnNumber: 25
                                                                }, this),
                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                                    className: "text-xs text-gray-500",
                                                                    children: [
                                                                        (recordedBlob.size / 1024).toFixed(2),
                                                                        " КБ"
                                                                    ]
                                                                }, void 0, true, {
                                                                    fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                                                    lineNumber: 696,
                                                                    columnNumber: 25
                                                                }, this)
                                                            ]
                                                        }, void 0, true, {
                                                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                                            lineNumber: 694,
                                                            columnNumber: 23
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                                    lineNumber: 690,
                                                    columnNumber: 21
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                    type: "button",
                                                    onClick: ()=>{
                                                        setRecordedBlob(null);
                                                        if (recordedAudioUrl) {
                                                            URL.revokeObjectURL(recordedAudioUrl);
                                                        }
                                                        setRecordedAudioUrl(null);
                                                    },
                                                    className: "text-gray-400 transition hover:text-red-500",
                                                    disabled: isUploading,
                                                    children: "✕"
                                                }, void 0, false, {
                                                    fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                                    lineNumber: 701,
                                                    columnNumber: 21
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                            lineNumber: 689,
                                            columnNumber: 19
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "flex items-center gap-2 rounded-lg bg-white p-2",
                                            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("audio", {
                                                ref: audioPlayerRef,
                                                src: recordedAudioUrl,
                                                controls: true,
                                                className: "flex-1",
                                                style: {
                                                    height: "32px"
                                                }
                                            }, void 0, false, {
                                                fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                                lineNumber: 718,
                                                columnNumber: 21
                                            }, this)
                                        }, void 0, false, {
                                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                            lineNumber: 717,
                                            columnNumber: 19
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                    lineNumber: 688,
                                    columnNumber: 17
                                }, this)
                            }, void 0, false, {
                                fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                lineNumber: 687,
                                columnNumber: 15
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                        lineNumber: 522,
                        columnNumber: 11
                    }, this)
                }, void 0, false, {
                    fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                    lineNumber: 521,
                    columnNumber: 9
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "flex flex-col gap-3 border-t border-gray-200 px-6 py-4 text-sm text-gray-500 sm:flex-row sm:items-center sm:justify-between sm:gap-4",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "flex flex-1 items-center gap-4",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    type: "button",
                                    onClick: closeModal,
                                    className: "rounded-lg border border-gray-200 px-5 py-2 text-sm font-semibold text-gray-700 transition hover:bg-gray-50",
                                    disabled: isUploading || isRecording || isWaiting,
                                    children: "Отмена"
                                }, void 0, false, {
                                    fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                    lineNumber: 734,
                                    columnNumber: 13
                                }, this),
                                (isUploading || isWaiting || progress > 0) && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "relative h-1 flex-1 overflow-hidden rounded-full bg-gray-200",
                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "absolute inset-y-0 left-0 rounded-full bg-gradient-to-r from-purple-500 via-purple-600 to-purple-500 transition-[width] duration-100 ease-out",
                                        style: {
                                            width: `${progress}%`
                                        },
                                        "aria-hidden": "true"
                                    }, void 0, false, {
                                        fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                        lineNumber: 744,
                                        columnNumber: 17
                                    }, this)
                                }, void 0, false, {
                                    fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                                    lineNumber: 743,
                                    columnNumber: 15
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                            lineNumber: 733,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                            type: "button",
                            onClick: handleCloneVoice,
                            disabled: isUploading || isRecording || isWaiting || !voiceName.trim() || !selectedFile && !recordedBlob,
                            className: "rounded-lg bg-purple-600 px-6 py-2 text-sm font-semibold text-white transition hover:bg-purple-500 disabled:cursor-not-allowed disabled:bg-gray-300 sm:ml-auto",
                            children: isUploading ? "Клонируем..." : isWaiting ? "Ожидаем..." : "Клонировать голос"
                        }, void 0, false, {
                            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                            lineNumber: 752,
                            columnNumber: 11
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
                    lineNumber: 732,
                    columnNumber: 9
                }, this)
            ]
        }, void 0, true, {
            fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
            lineNumber: 506,
            columnNumber: 7
        }, this)
    }, void 0, false, {
        fileName: "[project]/app/voices/components/VoiceCreateModal.tsx",
        lineNumber: 505,
        columnNumber: 5
    }, this);
}
_s(VoiceCreateModal, "TXG+DIQ3+YdslZIkrwVlVanmnTk=");
_c = VoiceCreateModal;
var _c;
__turbopack_context__.k.register(_c, "VoiceCreateModal");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/app/material/editor/components/EditorSidebar.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "EditorSidebar",
    ()=>EditorSidebar
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/image.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/supabaseClient.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$avatars$2f$components$2f$AvatarUploadModal$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/app/avatars/components/AvatarUploadModal.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$voices$2f$components$2f$VoiceCreateModal$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/app/voices/components/VoiceCreateModal.tsx [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
;
;
const ratioOptions = [
    {
        label: "16:9",
        value: "16:9"
    },
    {
        label: "9:16",
        value: "9:16"
    }
];
function EditorSidebar({ aspectRatio, onAspectRatioChange, videoTitle, onVideoTitleChange, avatars, isLoadingAvatars, voices, isLoadingVoices, scenes, activeSceneId, onSelectScene, onAddScene, onDeleteScene, onSceneVoiceChange, onSceneScriptChange, onSceneAvatarChange, onRefreshAvatars, onRefreshVoices, onApplyCreatedAvatar }) {
    _s();
    const [openAvatarModalForSceneId, setOpenAvatarModalForSceneId] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [openVoiceModalForSceneId, setOpenVoiceModalForSceneId] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [isAvatarCreateModalOpen, setIsAvatarCreateModalOpen] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [isVoiceCreateModalOpen, setIsVoiceCreateModalOpen] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [pendingSceneIdForAvatar, setPendingSceneIdForAvatar] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [pendingSceneIdForVoice, setPendingSceneIdForVoice] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [playingSceneId, setPlayingSceneId] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [loadingSceneId, setLoadingSceneId] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const audioRefs = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])({});
    // Сохраняем последний отправленный текст для каждого слайда
    const lastSentTexts = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])({});
    const sceneScriptsSnapshot = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])({});
    // Refs для textarea элементов
    const textareaRefs = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])({});
    // Очистка аудио при размонтировании компонента
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "EditorSidebar.useEffect": ()=>{
            return ({
                "EditorSidebar.useEffect": ()=>{
                    Object.values(audioRefs.current).forEach({
                        "EditorSidebar.useEffect": (audio)=>{
                            const managed = audio;
                            audio.pause();
                            audio.onplay = null;
                            audio.onpause = null;
                            audio.onended = null;
                            audio.onerror = null;
                            managed.__handlers = undefined;
                            audio.removeAttribute("src");
                            audio.src = "";
                        }
                    }["EditorSidebar.useEffect"]);
                    audioRefs.current = {};
                }
            })["EditorSidebar.useEffect"];
        }
    }["EditorSidebar.useEffect"], []);
    const stopAudioForScene = (sceneId, { resetTime = true } = {})=>{
        const audio = audioRefs.current[sceneId];
        if (!audio) {
            return;
        }
        audio.pause();
        if (resetTime) {
            audio.currentTime = 0;
        }
        setPlayingSceneId((current)=>current === sceneId ? null : current);
    };
    // Останавливает воспроизведение на всех слайдах, кроме указанного
    const stopOtherScenesAudio = (currentSceneId)=>{
        Object.keys(audioRefs.current).forEach((sceneId)=>{
            if (sceneId !== currentSceneId) {
                stopAudioForScene(sceneId);
            }
        });
    };
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "EditorSidebar.useEffect": ()=>{
            const snapshot = {};
            scenes.forEach({
                "EditorSidebar.useEffect": (scene)=>{
                    snapshot[scene.id] = scene.script;
                }
            }["EditorSidebar.useEffect"]);
            const prevSnapshot = sceneScriptsSnapshot.current;
            if (playingSceneId) {
                const prevScript = prevSnapshot[playingSceneId];
                const currentScript = snapshot[playingSceneId];
                const sceneRemoved = prevScript !== undefined && currentScript === undefined;
                const scriptChanged = prevScript !== undefined && currentScript !== undefined && prevScript !== currentScript;
                if (sceneRemoved || scriptChanged) {
                    stopAudioForScene(playingSceneId);
                }
            }
            sceneScriptsSnapshot.current = snapshot;
        }
    }["EditorSidebar.useEffect"], [
        scenes,
        playingSceneId
    ]);
    // Автоматически изменяет высоту textarea в зависимости от содержимого
    const adjustTextareaHeight = (textarea)=>{
        textarea.style.height = "auto";
        textarea.style.height = `${textarea.scrollHeight}px`;
    };
    // Синхронизация высоты textarea при изменении содержимого
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "EditorSidebar.useEffect": ()=>{
            scenes.forEach({
                "EditorSidebar.useEffect": (scene)=>{
                    const textarea = textareaRefs.current[scene.id];
                    if (textarea) {
                        adjustTextareaHeight(textarea);
                    }
                }
            }["EditorSidebar.useEffect"]);
        }
    }["EditorSidebar.useEffect"], [
        scenes
    ]);
    const getOrCreateAudioElement = (sceneId)=>{
        let audio = audioRefs.current[sceneId];
        if (audio) {
            return audio;
        }
        audio = new Audio();
        const handlePlay = ()=>{
            setPlayingSceneId(sceneId);
            setLoadingSceneId(null);
        };
        const handlePause = ()=>{
            setPlayingSceneId((current)=>current === sceneId ? null : current);
        };
        const handleEnded = ()=>{
            setPlayingSceneId((current)=>current === sceneId ? null : current);
        };
        const handleError = (event)=>{
            if (typeof event === "string") {
                console.error("Ошибка загрузки аудио:", event);
                setLoadingSceneId(null);
                setPlayingSceneId((current)=>current === sceneId ? null : current);
                return;
            }
            const audioElement = event.currentTarget;
            const hasSrcAttr = audioElement.getAttribute("src");
            if (!hasSrcAttr || hasSrcAttr === "") {
                return;
            }
            console.error("Ошибка загрузки аудио:", event);
            setLoadingSceneId(null);
            setPlayingSceneId((current)=>current === sceneId ? null : current);
            if (audioElement.error) {
                console.error("Код ошибки:", audioElement.error.code);
                console.error("Сообщение:", audioElement.error.message);
            }
        };
        audio.onplay = handlePlay;
        audio.onpause = handlePause;
        audio.onended = handleEnded;
        audio.onerror = handleError;
        audio.__handlers = {
            onPlay: handlePlay,
            onPause: handlePause,
            onEnded: handleEnded,
            onError: handleError
        };
        audioRefs.current[sceneId] = audio;
        return audio;
    };
    const playSceneAudio = async (sceneId, audioUrl)=>{
        stopOtherScenesAudio(sceneId);
        stopAudioForScene(sceneId);
        const audio = getOrCreateAudioElement(sceneId);
        const currentSrc = audio.getAttribute("src");
        if (currentSrc !== audioUrl) {
            audio.setAttribute("src", audioUrl);
            audio.src = audioUrl;
        }
        try {
            await audio.play();
            setPlayingSceneId(sceneId);
            setLoadingSceneId(null);
        } catch (error) {
            if (error instanceof DOMException && error.name === "AbortError") {
                console.warn("Воспроизведение прервано из-за смены источника");
                return;
            }
            throw error;
        }
    };
    const handlePlayClick = async (sceneId, sceneIndex)=>{
        const scene = scenes.find((s)=>s.id === sceneId);
        if (!scene || !scene.avatarId || !scene.script || scene.script.trim() === "") {
            return;
        }
        // Находим выбранный голос и получаем его voice_id из таблицы
        const selectedVoice = voices.find((voice)=>voice.id === scene.voiceId);
        if (!selectedVoice || !selectedVoice.voice_id) {
            alert("У выбранного голоса отсутствует voice_id");
            return;
        }
        // Извлекаем номер слайда из title (например, "Слайд 1" -> 1)
        const slideNumberMatch = scene.title.match(/\d+/);
        const slideNumber = slideNumberMatch ? parseInt(slideNumberMatch[0], 10) : sceneIndex + 1;
        const currentText = scene.script.trim();
        const lastSentText = lastSentTexts.current[sceneId];
        // Получаем UUID залогиненного пользователя
        const { data: { user } } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["supabase"].auth.getUser();
        const userUuid = user?.id;
        if (!userUuid) {
            alert("Не удалось определить пользователя, авторизуйтесь повторно.");
            return;
        }
        // Проксируем аудио через собственный API, чтобы не светить прямую ссылку
        const baseAudioUrl = `/api/tts-audio?user=${encodeURIComponent(userUuid)}&slide=${slideNumber}&voice=${encodeURIComponent(selectedVoice.voice_id)}`;
        // Определяем, изменился ли текст
        const textChanged = lastSentText !== currentText;
        // Если текст не изменился и уже есть загруженный аудио-файл для этого слайда,
        // просто управляем воспроизведением/паузой без повторной отправки вебхука
        const existingAudio = audioRefs.current[sceneId];
        const existingSrc = existingAudio?.getAttribute("src") ?? "";
        if (!textChanged && existingAudio && existingSrc.startsWith(baseAudioUrl)) {
            if (!existingAudio.paused) {
                stopAudioForScene(sceneId, {
                    resetTime: false
                });
            } else {
                // Перед воспроизведением этого слайда останавливаем все остальные
                stopOtherScenesAudio(sceneId);
                await existingAudio.play();
                setPlayingSceneId(sceneId);
            }
            return;
        }
        try {
            if (!textChanged) {
                setLoadingSceneId(sceneId);
                await playSceneAudio(sceneId, baseAudioUrl);
                return;
            }
            setLoadingSceneId(sceneId);
            // Отправляем вебхук и ждем, пока n8n вернет success === true
            const response = await fetch("https://rueleven.ru/webhook/d08c47c0-82c3-4b50-a7e0-e1b525c5498b", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    voice_id: selectedVoice.voice_id,
                    slide_number: slideNumber,
                    text: currentText,
                    uuid: userUuid
                })
            });
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            // Ожидаем подтверждение от n8n, что файл готов: [{ "success": true }] или { "success": true }
            let json;
            try {
                json = await response.json();
            } catch  {
                throw new Error("Некорректный JSON ответ от вебхука");
            }
            let success = false;
            if (Array.isArray(json) && json.length > 0 && typeof json[0] === "object" && json[0] !== null) {
                success = Boolean(json[0].success);
            } else if (json && typeof json === "object") {
                success = Boolean(json.success);
            }
            if (!success) {
                console.error("Неожиданный ответ вебхука, ожидали success=true:", json);
                throw new Error("Вебхук не вернул success=true, аудио может быть не готово");
            }
            console.log("Вебхук успешно завершил генерацию для слайда:", slideNumber);
            // Сохраняем отправленный текст (используется для определения, изменился ли текст)
            lastSentTexts.current[sceneId] = currentText;
            // Если текст изменился, добавляем cache-buster к URL, чтобы браузер не брал старое аудио из кеша
            const audioUrl = textChanged ? `${baseAudioUrl}&bust=${Date.now()}` : baseAudioUrl;
            console.log("Воспроизведение аудио по URL:", audioUrl);
            await playSceneAudio(sceneId, audioUrl);
            console.log("Воспроизведение начато");
        } catch (error) {
            setLoadingSceneId(null);
            console.error("Ошибка при отправке вебхука или воспроизведении:", error);
            alert(error instanceof Error ? error.message : "Не удалось отправить вебхук или воспроизвести аудио");
        }
    };
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("aside", {
                className: "flex h-full min-h-0 flex-col overflow-hidden rounded-3xl border border-gray-100 bg-white shadow-sm ring-1 ring-black/5",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "flex-shrink-0 space-y-6 border-b border-gray-100 p-6",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "space-y-3",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                        className: "text-sm uppercase tracking-[0.2em] text-gray-500",
                                        children: "Настройка слайдов"
                                    }, void 0, false, {
                                        fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                        lineNumber: 369,
                                        columnNumber: 13
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "flex items-center gap-3",
                                        children: ratioOptions.map(({ label, value })=>{
                                            const isActive = aspectRatio === value;
                                            return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                type: "button",
                                                onClick: ()=>onAspectRatioChange(value),
                                                className: `flex h-12 flex-1 items-center justify-center rounded-2xl border text-sm font-semibold transition ${isActive ? "border-gray-900 bg-gray-900 text-white" : "border-gray-200 text-gray-600 hover:border-gray-300 hover:text-gray-900"}`,
                                                children: label
                                            }, value, false, {
                                                fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                lineNumber: 376,
                                                columnNumber: 19
                                            }, this);
                                        })
                                    }, void 0, false, {
                                        fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                        lineNumber: 372,
                                        columnNumber: 13
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                lineNumber: 368,
                                columnNumber: 11
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("label", {
                                className: "block space-y-2",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                        className: "text-sm text-gray-600",
                                        children: "Название видео"
                                    }, void 0, false, {
                                        fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                        lineNumber: 394,
                                        columnNumber: 13
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("input", {
                                        type: "text",
                                        value: videoTitle,
                                        onChange: (event)=>onVideoTitleChange(event.target.value),
                                        placeholder: "Придумайте название видео",
                                        className: "w-full rounded-2xl border border-gray-200 bg-white px-4 py-3 text-sm text-gray-900 outline-none placeholder:text-gray-400 focus:border-gray-900 focus:ring-1 focus:ring-gray-900"
                                    }, void 0, false, {
                                        fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                        lineNumber: 395,
                                        columnNumber: 13
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                lineNumber: 393,
                                columnNumber: 11
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                        lineNumber: 367,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "flex-1 min-h-0 space-y-2 overflow-y-auto p-4 [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-track]:bg-gray-100 [&::-webkit-scrollbar-thumb]:bg-gray-300 [&::-webkit-scrollbar-thumb]:rounded-full",
                        children: scenes.map((scene, index)=>{
                            const isActive = scene.id === activeSceneId;
                            const selectedAvatar = avatars.find((avatar)=>avatar.id === scene.avatarId);
                            const selectedVoice = voices.find((voice)=>voice.id === scene.voiceId);
                            return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "space-y-2",
                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: `rounded-2xl p-4 transition ${isActive ? "bg-gray-50" : "bg-white hover:bg-gray-50/50"}`,
                                    onClick: ()=>onSelectScene(scene.id),
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "space-y-3",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "flex items-center gap-3",
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                            className: "flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full bg-gray-200 text-sm font-semibold text-gray-700",
                                                            children: index + 1
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                            lineNumber: 423,
                                                            columnNumber: 23
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                            type: "button",
                                                            onClick: (e)=>{
                                                                e.stopPropagation();
                                                                setOpenAvatarModalForSceneId(scene.id);
                                                            },
                                                            className: "flex items-center gap-1 rounded-xl bg-gray-100 px-3 py-2 transition hover:bg-gray-200",
                                                            children: selectedAvatar ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
                                                                children: [
                                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                                        className: "relative h-8 w-8 flex-shrink-0 overflow-hidden rounded-full",
                                                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                                                                            src: selectedAvatar.photo,
                                                                            alt: selectedAvatar.name,
                                                                            fill: true,
                                                                            className: "object-cover",
                                                                            unoptimized: true
                                                                        }, void 0, false, {
                                                                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                            lineNumber: 437,
                                                                            columnNumber: 31
                                                                        }, this)
                                                                    }, void 0, false, {
                                                                        fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                        lineNumber: 436,
                                                                        columnNumber: 29
                                                                    }, this),
                                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                                        className: "text-left text-sm font-medium text-gray-900 whitespace-nowrap",
                                                                        children: "Аватар"
                                                                    }, void 0, false, {
                                                                        fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                        lineNumber: 445,
                                                                        columnNumber: 29
                                                                    }, this)
                                                                ]
                                                            }, void 0, true) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
                                                                children: [
                                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                                        className: "flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full border-2 border-dashed border-gray-300 bg-white",
                                                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                                            className: "text-sm text-gray-400",
                                                                            children: "＋"
                                                                        }, void 0, false, {
                                                                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                            lineNumber: 452,
                                                                            columnNumber: 31
                                                                        }, this)
                                                                    }, void 0, false, {
                                                                        fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                        lineNumber: 451,
                                                                        columnNumber: 29
                                                                    }, this),
                                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                                        className: "text-left text-sm text-gray-500 whitespace-nowrap",
                                                                        children: "Аватар"
                                                                    }, void 0, false, {
                                                                        fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                        lineNumber: 454,
                                                                        columnNumber: 29
                                                                    }, this)
                                                                ]
                                                            }, void 0, true)
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                            lineNumber: 426,
                                                            columnNumber: 23
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                            type: "button",
                                                            onClick: (e)=>{
                                                                e.stopPropagation();
                                                                setOpenVoiceModalForSceneId(scene.id);
                                                            },
                                                            className: "flex items-center gap-1 rounded-xl bg-gray-100 px-3 py-2 transition hover:bg-gray-200",
                                                            children: selectedVoice ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
                                                                children: [
                                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                                        className: "flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full border-2 border-dashed border-gray-300 bg-white",
                                                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                                                            xmlns: "http://www.w3.org/2000/svg",
                                                                            viewBox: "0 0 24 24",
                                                                            fill: "none",
                                                                            stroke: "currentColor",
                                                                            strokeWidth: 2,
                                                                            className: "h-4 w-4 text-gray-400",
                                                                            children: [
                                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                                                                    d: "M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"
                                                                                }, void 0, false, {
                                                                                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                                    lineNumber: 479,
                                                                                    columnNumber: 33
                                                                                }, this),
                                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                                                                    d: "M19 10v2a7 7 0 0 1-14 0v-2"
                                                                                }, void 0, false, {
                                                                                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                                    lineNumber: 480,
                                                                                    columnNumber: 33
                                                                                }, this),
                                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("line", {
                                                                                    x1: "12",
                                                                                    y1: "19",
                                                                                    x2: "12",
                                                                                    y2: "23"
                                                                                }, void 0, false, {
                                                                                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                                    lineNumber: 481,
                                                                                    columnNumber: 33
                                                                                }, this),
                                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("line", {
                                                                                    x1: "8",
                                                                                    y1: "23",
                                                                                    x2: "16",
                                                                                    y2: "23"
                                                                                }, void 0, false, {
                                                                                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                                    lineNumber: 482,
                                                                                    columnNumber: 33
                                                                                }, this)
                                                                            ]
                                                                        }, void 0, true, {
                                                                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                            lineNumber: 471,
                                                                            columnNumber: 31
                                                                        }, this)
                                                                    }, void 0, false, {
                                                                        fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                        lineNumber: 470,
                                                                        columnNumber: 29
                                                                    }, this),
                                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                                        className: "text-left text-sm font-medium text-gray-900 whitespace-nowrap",
                                                                        children: selectedVoice.name
                                                                    }, void 0, false, {
                                                                        fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                        lineNumber: 485,
                                                                        columnNumber: 29
                                                                    }, this)
                                                                ]
                                                            }, void 0, true) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
                                                                children: [
                                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                                        className: "flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full border-2 border-dashed border-gray-300 bg-white",
                                                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                                            className: "text-sm text-gray-400",
                                                                            children: "＋"
                                                                        }, void 0, false, {
                                                                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                            lineNumber: 492,
                                                                            columnNumber: 31
                                                                        }, this)
                                                                    }, void 0, false, {
                                                                        fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                        lineNumber: 491,
                                                                        columnNumber: 29
                                                                    }, this),
                                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                                        className: "text-left text-sm text-gray-500 whitespace-nowrap",
                                                                        children: "Голос"
                                                                    }, void 0, false, {
                                                                        fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                        lineNumber: 494,
                                                                        columnNumber: 29
                                                                    }, this)
                                                                ]
                                                            }, void 0, true)
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                            lineNumber: 460,
                                                            columnNumber: 23
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                            type: "button",
                                                            onClick: (e)=>{
                                                                e.stopPropagation();
                                                                handlePlayClick(scene.id, index);
                                                            },
                                                            disabled: !scene.avatarId || !scene.voiceId || !scene.script || scene.script.trim() === "" || loadingSceneId === scene.id,
                                                            className: "ml-auto flex h-9 w-9 flex-shrink-0 items-center justify-center rounded-xl bg-gray-100 text-gray-900 transition hover:bg-gray-200 disabled:bg-gray-50 disabled:text-gray-300",
                                                            "aria-label": playingSceneId === scene.id ? "Поставить на паузу" : "Воспроизвести голос",
                                                            children: loadingSceneId === scene.id ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                                                className: "h-4 w-4 animate-spin text-gray-600",
                                                                xmlns: "http://www.w3.org/2000/svg",
                                                                fill: "none",
                                                                viewBox: "0 0 24 24",
                                                                children: [
                                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("circle", {
                                                                        className: "opacity-25",
                                                                        cx: "12",
                                                                        cy: "12",
                                                                        r: "10",
                                                                        stroke: "currentColor",
                                                                        strokeWidth: "4"
                                                                    }, void 0, false, {
                                                                        fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                        lineNumber: 523,
                                                                        columnNumber: 29
                                                                    }, this),
                                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                                                        className: "opacity-75",
                                                                        fill: "currentColor",
                                                                        d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                                                                    }, void 0, false, {
                                                                        fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                        lineNumber: 531,
                                                                        columnNumber: 29
                                                                    }, this)
                                                                ]
                                                            }, void 0, true, {
                                                                fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                lineNumber: 517,
                                                                columnNumber: 27
                                                            }, this) : playingSceneId === scene.id ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                                                xmlns: "http://www.w3.org/2000/svg",
                                                                viewBox: "0 0 24 24",
                                                                fill: "currentColor",
                                                                className: "h-4 w-4",
                                                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                                                    d: "M6 4h4v16H6V4zm8 0h4v16h-4V4z"
                                                                }, void 0, false, {
                                                                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                    lineNumber: 544,
                                                                    columnNumber: 29
                                                                }, this)
                                                            }, void 0, false, {
                                                                fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                lineNumber: 538,
                                                                columnNumber: 27
                                                            }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                                                xmlns: "http://www.w3.org/2000/svg",
                                                                viewBox: "0 0 24 24",
                                                                fill: "currentColor",
                                                                className: "h-4 w-4",
                                                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                                                    d: "M8 5v14l11-7z"
                                                                }, void 0, false, {
                                                                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                    lineNumber: 553,
                                                                    columnNumber: 29
                                                                }, this)
                                                            }, void 0, false, {
                                                                fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                lineNumber: 547,
                                                                columnNumber: 27
                                                            }, this)
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                            lineNumber: 500,
                                                            columnNumber: 23
                                                        }, this),
                                                        scenes.length > 1 && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                            type: "button",
                                                            onClick: (e)=>{
                                                                e.stopPropagation();
                                                                onDeleteScene(scene.id);
                                                            },
                                                            className: "flex h-9 w-9 flex-shrink-0 items-center justify-center rounded-xl bg-red-50 text-red-600 transition hover:bg-red-100",
                                                            "aria-label": "Удалить слайд",
                                                            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                                                xmlns: "http://www.w3.org/2000/svg",
                                                                viewBox: "0 0 24 24",
                                                                fill: "none",
                                                                stroke: "currentColor",
                                                                strokeWidth: 2,
                                                                className: "h-4 w-4",
                                                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                                                    d: "M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"
                                                                }, void 0, false, {
                                                                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                    lineNumber: 575,
                                                                    columnNumber: 29
                                                                }, this)
                                                            }, void 0, false, {
                                                                fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                                lineNumber: 567,
                                                                columnNumber: 27
                                                            }, this)
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                            lineNumber: 558,
                                                            columnNumber: 25
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                    lineNumber: 422,
                                                    columnNumber: 21
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("textarea", {
                                                    ref: (el)=>{
                                                        if (el) {
                                                            textareaRefs.current[scene.id] = el;
                                                            adjustTextareaHeight(el);
                                                        }
                                                    },
                                                    value: scene.script,
                                                    onChange: (event)=>{
                                                        onSceneScriptChange(scene.id, event.target.value);
                                                        adjustTextareaHeight(event.target);
                                                    },
                                                    onClick: (e)=>e.stopPropagation(),
                                                    placeholder: "Напишите текст",
                                                    className: "w-full resize-none overflow-hidden rounded-xl border border-gray-200 bg-white px-3 py-2 text-sm text-gray-900 outline-none placeholder:text-gray-400 focus:border-gray-900 focus:ring-1 focus:ring-gray-900",
                                                    style: {
                                                        height: "auto",
                                                        minHeight: "60px"
                                                    }
                                                }, void 0, false, {
                                                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                    lineNumber: 581,
                                                    columnNumber: 21
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                            lineNumber: 421,
                                            columnNumber: 19
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                            type: "button",
                                            onClick: (e)=>{
                                                e.stopPropagation();
                                                onAddScene(scene.id);
                                            },
                                            className: "flex w-full items-center justify-center gap-2 rounded-xl bg-gray-100 px-3 py-2 text-sm font-medium text-gray-700 transition hover:bg-gray-200",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                    className: "text-sm",
                                                    children: "＋"
                                                }, void 0, false, {
                                                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                    lineNumber: 608,
                                                    columnNumber: 21
                                                }, this),
                                                "Слайд"
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                            lineNumber: 600,
                                            columnNumber: 19
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                    lineNumber: 413,
                                    columnNumber: 17
                                }, this)
                            }, scene.id, false, {
                                fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                lineNumber: 412,
                                columnNumber: 15
                            }, this);
                        })
                    }, void 0, false, {
                        fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                        lineNumber: 405,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                lineNumber: 366,
                columnNumber: 7
            }, this),
            openAvatarModalForSceneId && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",
                onClick: ()=>setOpenAvatarModalForSceneId(null),
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "w-full max-w-2xl rounded-3xl border border-gray-100 bg-white p-6 shadow-xl",
                    onClick: (e)=>e.stopPropagation(),
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "mb-4 flex items-center justify-between",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h2", {
                                    className: "text-xl font-semibold text-gray-900",
                                    children: "Выберите аватар"
                                }, void 0, false, {
                                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                    lineNumber: 628,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    type: "button",
                                    onClick: ()=>setOpenAvatarModalForSceneId(null),
                                    className: "rounded-lg p-2 text-gray-400 transition hover:bg-gray-100 hover:text-gray-900",
                                    "aria-label": "Закрыть",
                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                        xmlns: "http://www.w3.org/2000/svg",
                                        viewBox: "0 0 24 24",
                                        fill: "none",
                                        stroke: "currentColor",
                                        strokeWidth: 2,
                                        className: "h-5 w-5",
                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                            d: "M18 6L6 18M6 6l12 12"
                                        }, void 0, false, {
                                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                            lineNumber: 645,
                                            columnNumber: 19
                                        }, this)
                                    }, void 0, false, {
                                        fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                        lineNumber: 637,
                                        columnNumber: 17
                                    }, this)
                                }, void 0, false, {
                                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                    lineNumber: 631,
                                    columnNumber: 15
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                            lineNumber: 627,
                            columnNumber: 13
                        }, this),
                        isLoadingAvatars ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "flex items-center justify-center py-12",
                            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                className: "text-gray-500",
                                children: "Загрузка аватаров..."
                            }, void 0, false, {
                                fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                lineNumber: 651,
                                columnNumber: 17
                            }, this)
                        }, void 0, false, {
                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                            lineNumber: 650,
                            columnNumber: 15
                        }, this) : avatars.length === 0 ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "flex flex-col items-center justify-center gap-4 py-12",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                    className: "text-gray-500",
                                    children: "Нет доступных аватаров"
                                }, void 0, false, {
                                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                    lineNumber: 655,
                                    columnNumber: 17
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    type: "button",
                                    onClick: ()=>{
                                        if (openAvatarModalForSceneId) {
                                            setPendingSceneIdForAvatar(openAvatarModalForSceneId);
                                        }
                                        setOpenAvatarModalForSceneId(null);
                                        setIsAvatarCreateModalOpen(true);
                                    },
                                    className: "rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-blue-700",
                                    children: "Создать аватар"
                                }, void 0, false, {
                                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                    lineNumber: 656,
                                    columnNumber: 17
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                            lineNumber: 654,
                            columnNumber: 15
                        }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4",
                            children: avatars.map((avatar)=>{
                                const scene = scenes.find((s)=>s.id === openAvatarModalForSceneId);
                                const isSelected = scene?.avatarId === avatar.id;
                                return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    type: "button",
                                    onClick: ()=>{
                                        if (openAvatarModalForSceneId) {
                                            onSceneAvatarChange(openAvatarModalForSceneId, isSelected ? null : avatar.id);
                                        }
                                        setOpenAvatarModalForSceneId(null);
                                    },
                                    className: `group relative aspect-[3/4] overflow-hidden rounded-2xl border transition ${isSelected ? "border-gray-900 ring ring-gray-900" : "border-gray-200 hover:border-gray-300"}`,
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                                            src: avatar.photo,
                                            alt: avatar.name,
                                            fill: true,
                                            className: "object-cover",
                                            unoptimized: true
                                        }, void 0, false, {
                                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                            lineNumber: 694,
                                            columnNumber: 23
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "absolute inset-0 bg-black/0 transition group-hover:bg-black/20"
                                        }, void 0, false, {
                                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                            lineNumber: 701,
                                            columnNumber: 23
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-3",
                                            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                className: "text-sm font-semibold text-white",
                                                children: avatar.name
                                            }, void 0, false, {
                                                fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                lineNumber: 703,
                                                columnNumber: 25
                                            }, this)
                                        }, void 0, false, {
                                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                            lineNumber: 702,
                                            columnNumber: 23
                                        }, this)
                                    ]
                                }, avatar.id, true, {
                                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                    lineNumber: 676,
                                    columnNumber: 21
                                }, this);
                            })
                        }, void 0, false, {
                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                            lineNumber: 671,
                            columnNumber: 15
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                    lineNumber: 623,
                    columnNumber: 11
                }, this)
            }, void 0, false, {
                fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                lineNumber: 619,
                columnNumber: 9
            }, this),
            openVoiceModalForSceneId && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",
                onClick: ()=>setOpenVoiceModalForSceneId(null),
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "w-full max-w-2xl rounded-3xl border border-gray-100 bg-white p-6 shadow-xl",
                    onClick: (e)=>e.stopPropagation(),
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "mb-4 flex items-center justify-between",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h2", {
                                    className: "text-xl font-semibold text-gray-900",
                                    children: "Выберите голос"
                                }, void 0, false, {
                                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                    lineNumber: 726,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    type: "button",
                                    onClick: ()=>setOpenVoiceModalForSceneId(null),
                                    className: "rounded-lg p-2 text-gray-400 transition hover:bg-gray-100 hover:text-gray-900",
                                    "aria-label": "Закрыть",
                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                        xmlns: "http://www.w3.org/2000/svg",
                                        viewBox: "0 0 24 24",
                                        fill: "none",
                                        stroke: "currentColor",
                                        strokeWidth: 2,
                                        className: "h-5 w-5",
                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                            d: "M18 6L6 18M6 6l12 12"
                                        }, void 0, false, {
                                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                            lineNumber: 743,
                                            columnNumber: 19
                                        }, this)
                                    }, void 0, false, {
                                        fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                        lineNumber: 735,
                                        columnNumber: 17
                                    }, this)
                                }, void 0, false, {
                                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                    lineNumber: 729,
                                    columnNumber: 15
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                            lineNumber: 725,
                            columnNumber: 13
                        }, this),
                        isLoadingVoices ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "flex items-center justify-center py-12",
                            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                className: "text-gray-500",
                                children: "Загрузка голосов..."
                            }, void 0, false, {
                                fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                lineNumber: 749,
                                columnNumber: 17
                            }, this)
                        }, void 0, false, {
                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                            lineNumber: 748,
                            columnNumber: 15
                        }, this) : voices.length === 0 ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "flex flex-col items-center justify-center gap-4 py-12",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                    className: "text-gray-500",
                                    children: "Нет доступных голосов"
                                }, void 0, false, {
                                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                    lineNumber: 753,
                                    columnNumber: 17
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    type: "button",
                                    onClick: ()=>{
                                        if (openVoiceModalForSceneId) {
                                            setPendingSceneIdForVoice(openVoiceModalForSceneId);
                                        }
                                        setOpenVoiceModalForSceneId(null);
                                        setIsVoiceCreateModalOpen(true);
                                    },
                                    className: "rounded-xl bg-purple-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-purple-700",
                                    children: "Создать голос"
                                }, void 0, false, {
                                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                    lineNumber: 754,
                                    columnNumber: 17
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                            lineNumber: 752,
                            columnNumber: 15
                        }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "space-y-2",
                            children: voices.map((voice)=>{
                                const scene = scenes.find((s)=>s.id === openVoiceModalForSceneId);
                                const isSelected = scene?.voiceId === voice.id;
                                return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    type: "button",
                                    onClick: ()=>{
                                        if (openVoiceModalForSceneId) {
                                            onSceneVoiceChange(openVoiceModalForSceneId, isSelected ? null : voice.id);
                                        }
                                        setOpenVoiceModalForSceneId(null);
                                    },
                                    className: `w-full rounded-xl border p-4 text-left transition ${isSelected ? "border-gray-900 bg-gray-50 ring ring-gray-900" : "border-gray-200 hover:border-gray-300"}`,
                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "flex items-center gap-3",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-gray-100",
                                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                                    xmlns: "http://www.w3.org/2000/svg",
                                                    viewBox: "0 0 24 24",
                                                    fill: "none",
                                                    stroke: "currentColor",
                                                    strokeWidth: 2,
                                                    className: "h-5 w-5 text-gray-600",
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                                            d: "M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                            lineNumber: 802,
                                                            columnNumber: 29
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                                            d: "M19 10v2a7 7 0 0 1-14 0v-2"
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                            lineNumber: 803,
                                                            columnNumber: 29
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("line", {
                                                            x1: "12",
                                                            y1: "19",
                                                            x2: "12",
                                                            y2: "23"
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                            lineNumber: 804,
                                                            columnNumber: 29
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("line", {
                                                            x1: "8",
                                                            y1: "23",
                                                            x2: "16",
                                                            y2: "23"
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                            lineNumber: 805,
                                                            columnNumber: 29
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                    lineNumber: 794,
                                                    columnNumber: 27
                                                }, this)
                                            }, void 0, false, {
                                                fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                lineNumber: 793,
                                                columnNumber: 25
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "flex-1",
                                                children: [
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                        className: "text-sm font-semibold text-gray-900",
                                                        children: voice.name
                                                    }, void 0, false, {
                                                        fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                        lineNumber: 809,
                                                        columnNumber: 27
                                                    }, this),
                                                    voice.description && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                        className: "text-xs text-gray-500",
                                                        children: voice.description
                                                    }, void 0, false, {
                                                        fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                        lineNumber: 813,
                                                        columnNumber: 29
                                                    }, this)
                                                ]
                                            }, void 0, true, {
                                                fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                                lineNumber: 808,
                                                columnNumber: 25
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                        lineNumber: 792,
                                        columnNumber: 23
                                    }, this)
                                }, voice.id, false, {
                                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                                    lineNumber: 774,
                                    columnNumber: 21
                                }, this);
                            })
                        }, void 0, false, {
                            fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                            lineNumber: 769,
                            columnNumber: 15
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                    lineNumber: 721,
                    columnNumber: 11
                }, this)
            }, void 0, false, {
                fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                lineNumber: 717,
                columnNumber: 9
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$app$2f$avatars$2f$components$2f$AvatarUploadModal$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AvatarUploadModal"], {
                isOpen: isAvatarCreateModalOpen,
                onClose: ()=>{
                    setIsAvatarCreateModalOpen(false);
                    setPendingSceneIdForAvatar(null);
                },
                onAvatarUploaded: async ()=>{
                    // Обновляем список аватаров
                    await onRefreshAvatars?.();
                    // Получаем последний созданный аватар и применяем его
                    if (pendingSceneIdForAvatar) {
                        const { data: { user } } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["supabase"].auth.getUser();
                        if (user) {
                            // Ждем немного, чтобы аватар успел обработаться
                            await new Promise((resolve)=>setTimeout(resolve, 2000));
                            const { data: avatarsData } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["supabase"].from("photo_avatars").select("id").eq("uid", user.id).eq("status", "done").order("created_at", {
                                ascending: false
                            }).limit(1);
                            if (avatarsData && avatarsData.length > 0 && avatarsData[0].id) {
                                const avatarId = avatarsData[0].id;
                                // Используем специальную функцию для применения созданного аватара
                                if (onApplyCreatedAvatar) {
                                    onApplyCreatedAvatar(pendingSceneIdForAvatar, avatarId);
                                } else {
                                    onSceneAvatarChange(pendingSceneIdForAvatar, avatarId);
                                }
                            }
                        }
                    }
                    setIsAvatarCreateModalOpen(false);
                    setPendingSceneIdForAvatar(null);
                }
            }, void 0, false, {
                fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                lineNumber: 829,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$app$2f$voices$2f$components$2f$VoiceCreateModal$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["VoiceCreateModal"], {
                isOpen: isVoiceCreateModalOpen,
                onClose: ()=>{
                    setIsVoiceCreateModalOpen(false);
                    setPendingSceneIdForVoice(null);
                },
                onVoiceCreated: async ()=>{
                    // Обновляем список голосов
                    await onRefreshVoices?.();
                    // Получаем последний созданный голос и применяем его
                    if (pendingSceneIdForVoice) {
                        const { data: { user } } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["supabase"].auth.getUser();
                        if (user) {
                            const { data: voicesData } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["supabase"].from("voices").select("id").eq("uid", user.id).order("created_at", {
                                ascending: false
                            }).limit(1);
                            if (voicesData && voicesData.length > 0 && voicesData[0].id) {
                                onSceneVoiceChange(pendingSceneIdForVoice, voicesData[0].id);
                            }
                        }
                    }
                    setIsVoiceCreateModalOpen(false);
                    setPendingSceneIdForVoice(null);
                }
            }, void 0, false, {
                fileName: "[project]/app/material/editor/components/EditorSidebar.tsx",
                lineNumber: 875,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true);
}
_s(EditorSidebar, "oRS+RR5EmBLBTR4nysnCaJLmpgY=");
_c = EditorSidebar;
var _c;
__turbopack_context__.k.register(_c, "EditorSidebar");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/app/material/editor/components/Timeline.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "Timeline",
    ()=>Timeline
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
const CANVAS_SIZES = {
    "16:9": {
        width: 1920,
        height: 1080
    },
    "9:16": {
        width: 1080,
        height: 1920
    }
};
function CanvasThumbnail({ scene, avatars, aspectRatio }) {
    const canvasSize = CANVAS_SIZES[aspectRatio];
    const avatar = scene.avatarId ? avatars.find((a)=>a.id === scene.avatarId) : null;
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "absolute inset-0 bg-gray-50 overflow-hidden",
        children: [
            avatar && scene.avatarPosition && scene.avatarSize && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "absolute",
                style: {
                    left: `${scene.avatarPosition.x / canvasSize.width * 100}%`,
                    top: `${scene.avatarPosition.y / canvasSize.height * 100}%`,
                    width: `${scene.avatarSize.width / canvasSize.width * 100}%`,
                    height: `${scene.avatarSize.height / canvasSize.height * 100}%`,
                    transform: "translate(-50%, -50%)"
                },
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("img", {
                    src: avatar.photo,
                    alt: avatar.name,
                    className: "w-full h-full object-cover rounded"
                }, void 0, false, {
                    fileName: "[project]/app/material/editor/components/Timeline.tsx",
                    lineNumber: 39,
                    columnNumber: 11
                }, this)
            }, void 0, false, {
                fileName: "[project]/app/material/editor/components/Timeline.tsx",
                lineNumber: 29,
                columnNumber: 9
            }, this),
            scene.elements.map((element)=>{
                const leftPercent = element.x / canvasSize.width * 100;
                const topPercent = element.y / canvasSize.height * 100;
                const widthPercent = element.width / canvasSize.width * 100;
                const heightPercent = element.height / canvasSize.height * 100;
                return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "absolute rounded border border-gray-300 overflow-hidden",
                    style: {
                        left: `${leftPercent}%`,
                        top: `${topPercent}%`,
                        width: `${widthPercent}%`,
                        height: `${heightPercent}%`,
                        transform: "translate(-50%, -50%)",
                        backgroundColor: element.imageUrl ? "transparent" : "#e5e7eb"
                    },
                    children: element.imageUrl ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("img", {
                        src: element.imageUrl,
                        alt: element.label,
                        className: "w-full h-full object-cover"
                    }, void 0, false, {
                        fileName: "[project]/app/material/editor/components/Timeline.tsx",
                        lineNumber: 68,
                        columnNumber: 15
                    }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "w-full h-full bg-gray-200"
                    }, void 0, false, {
                        fileName: "[project]/app/material/editor/components/Timeline.tsx",
                        lineNumber: 74,
                        columnNumber: 15
                    }, this)
                }, element.id, false, {
                    fileName: "[project]/app/material/editor/components/Timeline.tsx",
                    lineNumber: 55,
                    columnNumber: 11
                }, this);
            })
        ]
    }, void 0, true, {
        fileName: "[project]/app/material/editor/components/Timeline.tsx",
        lineNumber: 26,
        columnNumber: 5
    }, this);
}
_c = CanvasThumbnail;
function Timeline({ scenes, activeSceneId, onSelectScene, onAddScene, avatars, aspectRatio }) {
    _s();
    const sceneRefs = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])({});
    const scrollContainerRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const [hoveredWarningId, setHoveredWarningId] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [tooltipPosition, setTooltipPosition] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const prevScenesLengthRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(scenes.length);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "Timeline.useEffect": ()=>{
            const activeButton = sceneRefs.current[activeSceneId];
            if (activeButton) {
                activeButton.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            }
        }
    }["Timeline.useEffect"], [
        activeSceneId
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "Timeline.useEffect": ()=>{
            // Автоматическая прокрутка к концу при добавлении нового слайда
            if (scenes.length > prevScenesLengthRef.current && scrollContainerRef.current) {
                const container = scrollContainerRef.current;
                setTimeout({
                    "Timeline.useEffect": ()=>{
                        container.scrollTo({
                            left: container.scrollWidth,
                            behavior: "smooth"
                        });
                    }
                }["Timeline.useEffect"], 100);
            }
            prevScenesLengthRef.current = scenes.length;
        }
    }["Timeline.useEffect"], [
        scenes.length
    ]);
    // Проверяем, есть ли хотя бы один слайд с текстом
    const hasAnyText = scenes.some((scene)=>scene.script && scene.script.trim() !== "");
    const tooltipText = hasAnyText ? "Слайд будет сгенерирован без озвучки" : "Напишите текст хотя бы для одного слайда";
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
        children: [
            hoveredWarningId && tooltipPosition && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "fixed z-[9999] px-3 py-2 rounded-lg border border-gray-200 bg-white shadow-lg text-xs text-gray-700 whitespace-nowrap",
                style: {
                    left: `${tooltipPosition.x}px`,
                    top: `${tooltipPosition.y - 8}px`,
                    transform: 'translate(-50%, -100%)'
                },
                onMouseEnter: ()=>setHoveredWarningId(hoveredWarningId),
                onMouseLeave: ()=>{
                    setHoveredWarningId(null);
                    setTooltipPosition(null);
                },
                children: [
                    tooltipText,
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "absolute top-full left-1/2 -translate-x-1/2 -mt-px",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "border-4 border-transparent border-t-gray-200"
                            }, void 0, false, {
                                fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                lineNumber: 151,
                                columnNumber: 13
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "absolute top-0 left-1/2 -translate-x-1/2 -mt-[3px]",
                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "border-4 border-transparent border-t-white"
                                }, void 0, false, {
                                    fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                    lineNumber: 153,
                                    columnNumber: 15
                                }, this)
                            }, void 0, false, {
                                fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                lineNumber: 152,
                                columnNumber: 13
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/app/material/editor/components/Timeline.tsx",
                        lineNumber: 150,
                        columnNumber: 11
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/app/material/editor/components/Timeline.tsx",
                lineNumber: 136,
                columnNumber: 9
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "flex h-full flex-col rounded-3xl border border-gray-100 bg-white p-4 shadow-sm ring-1 ring-black/5",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    ref: scrollContainerRef,
                    className: "flex w-full flex-1 flex-col gap-2 overflow-x-auto overflow-y-visible pb-2 [&::-webkit-scrollbar]:h-2 [&::-webkit-scrollbar-track]:bg-gray-100 [&::-webkit-scrollbar-thumb]:bg-gray-300 [&::-webkit-scrollbar-thumb]:rounded-full min-h-0",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "flex flex-nowrap items-center gap-1",
                            children: scenes.map((scene, index)=>{
                                const hasNoText = !scene.script || scene.script.trim() === "";
                                const isLast = index === scenes.length - 1;
                                return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "flex flex-shrink-0 items-center",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "h-[28px] w-[180px] flex items-center justify-center relative group",
                                            children: hasNoText && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "flex items-center justify-center gap-1.5 px-2 py-1 bg-red-50 border border-red-200 rounded-lg cursor-help",
                                                onMouseEnter: (e)=>{
                                                    const rect = e.currentTarget.getBoundingClientRect();
                                                    setTooltipPosition({
                                                        x: rect.left + rect.width / 2,
                                                        y: rect.top
                                                    });
                                                    setHoveredWarningId(scene.id);
                                                },
                                                onMouseLeave: ()=>{
                                                    setHoveredWarningId(null);
                                                    setTooltipPosition(null);
                                                },
                                                children: [
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                                        xmlns: "http://www.w3.org/2000/svg",
                                                        viewBox: "0 0 24 24",
                                                        className: "h-4 w-4 text-red-600 flex-shrink-0",
                                                        children: [
                                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                                                d: "M12 2L1 21h22L12 2z",
                                                                fill: "currentColor"
                                                            }, void 0, false, {
                                                                fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                                                lineNumber: 192,
                                                                columnNumber: 27
                                                            }, this),
                                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                                                d: "M11 10h2v4h-2v-4zm0 6h2v2h-2v-2z",
                                                                fill: "white"
                                                            }, void 0, false, {
                                                                fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                                                lineNumber: 196,
                                                                columnNumber: 27
                                                            }, this)
                                                        ]
                                                    }, void 0, true, {
                                                        fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                                        lineNumber: 187,
                                                        columnNumber: 25
                                                    }, this),
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                        className: "text-xs font-medium text-red-700 whitespace-nowrap",
                                                        children: "Нет текста"
                                                    }, void 0, false, {
                                                        fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                                        lineNumber: 201,
                                                        columnNumber: 25
                                                    }, this)
                                                ]
                                            }, void 0, true, {
                                                fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                                lineNumber: 172,
                                                columnNumber: 23
                                            }, this)
                                        }, void 0, false, {
                                            fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                            lineNumber: 170,
                                            columnNumber: 19
                                        }, this),
                                        !isLast && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "w-[1px]"
                                        }, void 0, false, {
                                            fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                            lineNumber: 205,
                                            columnNumber: 31
                                        }, this),
                                        isLast && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "w-[80px]"
                                        }, void 0, false, {
                                            fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                            lineNumber: 206,
                                            columnNumber: 30
                                        }, this)
                                    ]
                                }, `warning-${scene.id}`, true, {
                                    fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                    lineNumber: 169,
                                    columnNumber: 17
                                }, this);
                            })
                        }, void 0, false, {
                            fileName: "[project]/app/material/editor/components/Timeline.tsx",
                            lineNumber: 164,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "flex flex-nowrap items-center gap-1",
                            children: scenes.map((scene, index)=>{
                                const isActive = scene.id === activeSceneId;
                                const isLast = index === scenes.length - 1;
                                return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "flex items-center flex-shrink-0 relative",
                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "flex items-center relative",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                ref: (el)=>{
                                                    sceneRefs.current[scene.id] = el;
                                                },
                                                type: "button",
                                                onClick: ()=>onSelectScene(scene.id),
                                                className: `relative min-w-[180px] min-h-[120px] w-[180px] h-[120px] rounded-2xl border overflow-hidden transition ${isActive ? "border-gray-900" : "border-gray-200 hover:border-gray-300"}`,
                                                children: [
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(CanvasThumbnail, {
                                                        scene: scene,
                                                        avatars: avatars,
                                                        aspectRatio: aspectRatio
                                                    }, void 0, false, {
                                                        fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                                        lineNumber: 231,
                                                        columnNumber: 17
                                                    }, this),
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                        className: "absolute top-2 left-2 flex h-6 w-6 items-center justify-center rounded-full bg-black/70 text-xs font-semibold text-white",
                                                        children: index + 1
                                                    }, void 0, false, {
                                                        fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                                        lineNumber: 237,
                                                        columnNumber: 17
                                                    }, this)
                                                ]
                                            }, void 0, true, {
                                                fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                                lineNumber: 219,
                                                columnNumber: 15
                                            }, this),
                                            !isLast && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "absolute right-[-14px] top-1/2 -translate-y-1/2 z-10 flex h-6 w-6 items-center justify-center rounded-full bg-gray-100",
                                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                                    xmlns: "http://www.w3.org/2000/svg",
                                                    viewBox: "0 0 24 24",
                                                    fill: "none",
                                                    stroke: "currentColor",
                                                    strokeWidth: 2,
                                                    strokeLinecap: "round",
                                                    strokeLinejoin: "round",
                                                    className: "h-3 w-3 text-gray-600",
                                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                                        d: "M9 18l6-6-6-6"
                                                    }, void 0, false, {
                                                        fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                                        lineNumber: 254,
                                                        columnNumber: 25
                                                    }, this)
                                                }, void 0, false, {
                                                    fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                                    lineNumber: 244,
                                                    columnNumber: 23
                                                }, this)
                                            }, void 0, false, {
                                                fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                                lineNumber: 243,
                                                columnNumber: 21
                                            }, this),
                                            isLast && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                type: "button",
                                                onClick: ()=>onAddScene(scene.id),
                                                className: "flex h-[120px] w-[80px] flex-shrink-0 items-center justify-center rounded-2xl border border-gray-200 bg-gray-100 text-gray-700 transition hover:bg-gray-200 active:scale-95 ml-1",
                                                "aria-label": "Добавить слайд",
                                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                                    xmlns: "http://www.w3.org/2000/svg",
                                                    viewBox: "0 0 24 24",
                                                    fill: "none",
                                                    stroke: "currentColor",
                                                    strokeWidth: 2.5,
                                                    strokeLinecap: "round",
                                                    strokeLinejoin: "round",
                                                    className: "h-8 w-8",
                                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                                        d: "M12 5v14M5 12h14"
                                                    }, void 0, false, {
                                                        fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                                        lineNumber: 275,
                                                        columnNumber: 21
                                                    }, this)
                                                }, void 0, false, {
                                                    fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                                    lineNumber: 265,
                                                    columnNumber: 19
                                                }, this)
                                            }, void 0, false, {
                                                fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                                lineNumber: 259,
                                                columnNumber: 17
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                        lineNumber: 218,
                                        columnNumber: 17
                                    }, this)
                                }, scene.id, false, {
                                    fileName: "[project]/app/material/editor/components/Timeline.tsx",
                                    lineNumber: 217,
                                    columnNumber: 15
                                }, this);
                            })
                        }, void 0, false, {
                            fileName: "[project]/app/material/editor/components/Timeline.tsx",
                            lineNumber: 212,
                            columnNumber: 11
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/app/material/editor/components/Timeline.tsx",
                    lineNumber: 159,
                    columnNumber: 9
                }, this)
            }, void 0, false, {
                fileName: "[project]/app/material/editor/components/Timeline.tsx",
                lineNumber: 158,
                columnNumber: 5
            }, this)
        ]
    }, void 0, true);
}
_s(Timeline, "svxN/CCtIKLE9lb+Ke6DDtwjuhQ=");
_c1 = Timeline;
var _c, _c1;
__turbopack_context__.k.register(_c, "CanvasThumbnail");
__turbopack_context__.k.register(_c1, "Timeline");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/app/material/editor/components/useImageAspectRatio.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "useImageAspectRatio",
    ()=>useImageAspectRatio
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var _s = __turbopack_context__.k.signature();
;
function useImageAspectRatio(imageSrc) {
    _s();
    const [aspectRatio, setAspectRatio] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "useImageAspectRatio.useEffect": ()=>{
            if (!imageSrc) {
                setAspectRatio(null);
                return;
            }
            const img = new Image();
            img.onload = ({
                "useImageAspectRatio.useEffect": ()=>{
                    const ratio = img.naturalWidth / img.naturalHeight;
                    setAspectRatio(ratio);
                }
            })["useImageAspectRatio.useEffect"];
            img.onerror = ({
                "useImageAspectRatio.useEffect": ()=>{
                    setAspectRatio(null);
                }
            })["useImageAspectRatio.useEffect"];
            img.src = imageSrc;
            return ({
                "useImageAspectRatio.useEffect": ()=>{
                    img.onload = null;
                    img.onerror = null;
                }
            })["useImageAspectRatio.useEffect"];
        }
    }["useImageAspectRatio.useEffect"], [
        imageSrc
    ]);
    return aspectRatio;
}
_s(useImageAspectRatio, "lyBXZv9RyF2LMs5axocmHA+wGos=");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/app/material/editor/components/AvatarCanvas.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "AvatarCanvas",
    ()=>AvatarCanvas
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$useImageAspectRatio$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/app/material/editor/components/useImageAspectRatio.ts [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
function AvatarCanvas({ avatar, position, size, canvasSize, onRemove, onPointerDown, onResizeStart }) {
    _s();
    if (!avatar) return null;
    // Определяем соотношение сторон изображения
    const imageAspectRatio = (0, __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$useImageAspectRatio$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useImageAspectRatio"])(avatar.photo);
    // Конвертируем пиксели канвы в проценты для отображения
    const leftPercent = position.x / canvasSize.width * 100;
    const topPercent = position.y / canvasSize.height * 100;
    const widthPercent = size.width / canvasSize.width * 100;
    const resizeHandles = [
        {
            corner: "top-left",
            cursor: "cursor-nwse-resize",
            position: "top-0 left-0"
        },
        {
            corner: "top-right",
            cursor: "cursor-nesw-resize",
            position: "top-0 right-0"
        },
        {
            corner: "bottom-left",
            cursor: "cursor-nesw-resize",
            position: "bottom-0 left-0"
        },
        {
            corner: "bottom-right",
            cursor: "cursor-nwse-resize",
            position: "bottom-0 right-0"
        }
    ];
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "group absolute cursor-grab active:cursor-grabbing",
        style: {
            left: `${leftPercent}%`,
            top: `${topPercent}%`,
            width: `${widthPercent}%`,
            aspectRatio: imageAspectRatio ? `${imageAspectRatio} / 1` : undefined,
            transform: "translate(-50%, -50%)"
        },
        onPointerDown: onPointerDown,
        role: "button",
        tabIndex: 0,
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("img", {
                src: avatar.photo,
                alt: avatar.name,
                className: "w-full h-full object-cover rounded-2xl"
            }, void 0, false, {
                fileName: "[project]/app/material/editor/components/AvatarCanvas.tsx",
                lineNumber: 65,
                columnNumber: 7
            }, this),
            resizeHandles.map(({ corner, cursor, position })=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: `absolute h-5 w-5 rounded-full bg-white border-2 border-gray-600 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity hover:border-gray-900 hover:scale-125 ${cursor} ${position}`,
                    style: {
                        transform: corner === "top-left" ? "translate(-50%, -50%)" : corner === "top-right" ? "translate(50%, -50%)" : corner === "bottom-left" ? "translate(-50%, 50%)" : "translate(50%, 50%)"
                    },
                    onPointerDown: (e)=>{
                        e.stopPropagation();
                        onResizeStart(e, corner);
                    },
                    role: "button",
                    tabIndex: 0
                }, corner, false, {
                    fileName: "[project]/app/material/editor/components/AvatarCanvas.tsx",
                    lineNumber: 73,
                    columnNumber: 9
                }, this)),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                type: "button",
                onClick: (e)=>{
                    e.stopPropagation();
                    onRemove();
                },
                className: "absolute right-0 top-0 flex items-center justify-center rounded-full bg-red-500 text-white opacity-0 transition-opacity hover:bg-red-600 group-hover:opacity-100 z-10",
                style: {
                    width: `${Math.min(40, Math.max(24, Math.min(size.width, size.height) * 0.08))}px`,
                    height: `${Math.min(40, Math.max(24, Math.min(size.width, size.height) * 0.08))}px`,
                    transform: 'translate(50%, -50%)'
                },
                "aria-label": "Удалить аватар",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                    xmlns: "http://www.w3.org/2000/svg",
                    viewBox: "0 0 24 24",
                    fill: "none",
                    stroke: "currentColor",
                    strokeWidth: 2.5,
                    className: "w-full h-full p-1",
                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                        d: "M18 6L6 18M6 6l12 12"
                    }, void 0, false, {
                        fileName: "[project]/app/material/editor/components/AvatarCanvas.tsx",
                        lineNumber: 117,
                        columnNumber: 11
                    }, this)
                }, void 0, false, {
                    fileName: "[project]/app/material/editor/components/AvatarCanvas.tsx",
                    lineNumber: 109,
                    columnNumber: 9
                }, this)
            }, void 0, false, {
                fileName: "[project]/app/material/editor/components/AvatarCanvas.tsx",
                lineNumber: 95,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/app/material/editor/components/AvatarCanvas.tsx",
        lineNumber: 51,
        columnNumber: 5
    }, this);
}
_s(AvatarCanvas, "MeXULDdP4Klydiwp5O8/FH2CP7U=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$useImageAspectRatio$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useImageAspectRatio"]
    ];
});
_c = AvatarCanvas;
var _c;
__turbopack_context__.k.register(_c, "AvatarCanvas");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/app/material/editor/components/MediaCanvas.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "MediaCanvas",
    ()=>MediaCanvas
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$useImageAspectRatio$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/app/material/editor/components/useImageAspectRatio.ts [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
function MediaCanvas({ element, canvasSize, onRemove, onPointerDown, onResizeStart }) {
    _s();
    if (!element.imageUrl) return null;
    // Определяем соотношение сторон изображения
    const imageAspectRatio = (0, __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$useImageAspectRatio$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useImageAspectRatio"])(element.imageUrl);
    // Конвертируем пиксели канвы в проценты для отображения
    const leftPercent = element.x / canvasSize.width * 100;
    const topPercent = element.y / canvasSize.height * 100;
    const widthPercent = element.width / canvasSize.width * 100;
    const resizeHandles = [
        {
            corner: "top-left",
            cursor: "cursor-nwse-resize",
            position: "top-0 left-0"
        },
        {
            corner: "top-right",
            cursor: "cursor-nesw-resize",
            position: "top-0 right-0"
        },
        {
            corner: "bottom-left",
            cursor: "cursor-nesw-resize",
            position: "bottom-0 left-0"
        },
        {
            corner: "bottom-right",
            cursor: "cursor-nwse-resize",
            position: "bottom-0 right-0"
        }
    ];
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "group absolute cursor-grab active:cursor-grabbing",
        style: {
            left: `${leftPercent}%`,
            top: `${topPercent}%`,
            width: `${widthPercent}%`,
            aspectRatio: imageAspectRatio ? `${imageAspectRatio} / 1` : undefined,
            transform: "translate(-50%, -50%)"
        },
        onPointerDown: onPointerDown,
        role: "button",
        tabIndex: 0,
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("img", {
                src: element.imageUrl,
                alt: element.label,
                className: "w-full h-full object-cover rounded-2xl"
            }, void 0, false, {
                fileName: "[project]/app/material/editor/components/MediaCanvas.tsx",
                lineNumber: 60,
                columnNumber: 7
            }, this),
            resizeHandles.map(({ corner, cursor, position })=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: `absolute h-5 w-5 rounded-full bg-white border-2 border-gray-600 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity hover:border-gray-900 hover:scale-125 ${cursor} ${position}`,
                    style: {
                        transform: corner === "top-left" ? "translate(-50%, -50%)" : corner === "top-right" ? "translate(50%, -50%)" : corner === "bottom-left" ? "translate(-50%, 50%)" : "translate(50%, 50%)"
                    },
                    onPointerDown: (e)=>{
                        e.stopPropagation();
                        onResizeStart(e, corner);
                    },
                    role: "button",
                    tabIndex: 0
                }, corner, false, {
                    fileName: "[project]/app/material/editor/components/MediaCanvas.tsx",
                    lineNumber: 68,
                    columnNumber: 9
                }, this)),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                type: "button",
                onClick: (e)=>{
                    e.stopPropagation();
                    onRemove();
                },
                className: "absolute right-0 top-0 flex items-center justify-center rounded-full bg-red-500 text-white opacity-0 transition-opacity hover:bg-red-600 group-hover:opacity-100 z-10",
                style: {
                    width: `${Math.min(40, Math.max(24, Math.min(element.width, element.height) * 0.08))}px`,
                    height: `${Math.min(40, Math.max(24, Math.min(element.width, element.height) * 0.08))}px`,
                    transform: 'translate(50%, -50%)'
                },
                "aria-label": "Удалить медиа",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                    xmlns: "http://www.w3.org/2000/svg",
                    viewBox: "0 0 24 24",
                    fill: "none",
                    stroke: "currentColor",
                    strokeWidth: 2.5,
                    className: "w-full h-full p-1",
                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                        d: "M18 6L6 18M6 6l12 12"
                    }, void 0, false, {
                        fileName: "[project]/app/material/editor/components/MediaCanvas.tsx",
                        lineNumber: 112,
                        columnNumber: 11
                    }, this)
                }, void 0, false, {
                    fileName: "[project]/app/material/editor/components/MediaCanvas.tsx",
                    lineNumber: 104,
                    columnNumber: 9
                }, this)
            }, void 0, false, {
                fileName: "[project]/app/material/editor/components/MediaCanvas.tsx",
                lineNumber: 90,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/app/material/editor/components/MediaCanvas.tsx",
        lineNumber: 46,
        columnNumber: 5
    }, this);
}
_s(MediaCanvas, "MeXULDdP4Klydiwp5O8/FH2CP7U=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$useImageAspectRatio$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useImageAspectRatio"]
    ];
});
_c = MediaCanvas;
var _c;
__turbopack_context__.k.register(_c, "MediaCanvas");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/app/material/editor/components/MediaCanvasWrapper.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "MediaCanvasWrapper",
    ()=>MediaCanvasWrapper
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$MediaCanvas$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/app/material/editor/components/MediaCanvas.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$useImageAspectRatio$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/app/material/editor/components/useImageAspectRatio.ts [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
function MediaCanvasWrapper({ element, canvasSize, onRemove, onPointerDown, onResizeStart, screenToCanvas, onElementSizeChange }) {
    _s();
    const imageAspectRatio = (0, __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$useImageAspectRatio$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useImageAspectRatio"])(element.imageUrl ?? null);
    const handleResizeStart = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "MediaCanvasWrapper.useCallback[handleResizeStart]": (event, corner)=>{
            if (!imageAspectRatio) return;
            event.preventDefault();
            event.stopPropagation();
            const startX = event.clientX;
            const startY = event.clientY;
            const initialWidth = element.width;
            const initialHeight = initialWidth / imageAspectRatio;
            const initialX = element.x;
            const initialY = element.y;
            const centerX = initialX;
            const centerY = initialY;
            const halfWidth = initialWidth / 2;
            const halfHeight = initialHeight / 2;
            let initialCornerX, initialCornerY;
            if (corner === "top-left") {
                initialCornerX = centerX - halfWidth;
                initialCornerY = centerY - halfHeight;
            } else if (corner === "top-right") {
                initialCornerX = centerX + halfWidth;
                initialCornerY = centerY - halfHeight;
            } else if (corner === "bottom-left") {
                initialCornerX = centerX - halfWidth;
                initialCornerY = centerY + halfHeight;
            } else {
                initialCornerX = centerX + halfWidth;
                initialCornerY = centerY + halfHeight;
            }
            const initialDistance = Math.sqrt(Math.pow(initialCornerX - centerX, 2) + Math.pow(initialCornerY - centerY, 2));
            let rafId = null;
            const handlePointerMove = {
                "MediaCanvasWrapper.useCallback[handleResizeStart].handlePointerMove": (moveEvent)=>{
                    if (rafId !== null) {
                        cancelAnimationFrame(rafId);
                    }
                    rafId = requestAnimationFrame({
                        "MediaCanvasWrapper.useCallback[handleResizeStart].handlePointerMove": ()=>{
                            const deltaXScreen = moveEvent.clientX - startX;
                            const deltaYScreen = moveEvent.clientY - startY;
                            const deltaX = screenToCanvas(deltaXScreen, "width");
                            const deltaY = screenToCanvas(deltaYScreen, "height");
                            const newCornerX = initialCornerX + deltaX;
                            const newCornerY = initialCornerY + deltaY;
                            const newDistance = Math.sqrt(Math.pow(newCornerX - centerX, 2) + Math.pow(newCornerY - centerY, 2));
                            const scale = newDistance / initialDistance;
                            let newWidth = initialWidth * scale;
                            let newHeight = newWidth / imageAspectRatio;
                            const minSizePx = Math.min(canvasSize.width, canvasSize.height) * 0.05;
                            const maxWidthPx = canvasSize.width; // Максимальная ширина = 100% ширины канвы
                            const maxHeightPx = canvasSize.height; // Максимальная высота = 100% высоты канвы
                            if (newWidth > maxWidthPx) {
                                newWidth = maxWidthPx;
                                newHeight = newWidth / imageAspectRatio;
                            }
                            if (newWidth < minSizePx) {
                                newWidth = minSizePx;
                                newHeight = newWidth / imageAspectRatio;
                            }
                            if (newHeight > maxHeightPx) {
                                newHeight = maxHeightPx;
                                newWidth = newHeight * imageAspectRatio;
                            }
                            if (newHeight < minSizePx) {
                                newHeight = minSizePx;
                                newWidth = newHeight * imageAspectRatio;
                            }
                            onElementSizeChange(element.id, {
                                width: newWidth,
                                height: newHeight
                            });
                            rafId = null;
                        }
                    }["MediaCanvasWrapper.useCallback[handleResizeStart].handlePointerMove"]);
                }
            }["MediaCanvasWrapper.useCallback[handleResizeStart].handlePointerMove"];
            const handlePointerUp = {
                "MediaCanvasWrapper.useCallback[handleResizeStart].handlePointerUp": ()=>{
                    if (rafId !== null) {
                        cancelAnimationFrame(rafId);
                        rafId = null;
                    }
                    window.removeEventListener("pointermove", handlePointerMove);
                    window.removeEventListener("pointerup", handlePointerUp);
                }
            }["MediaCanvasWrapper.useCallback[handleResizeStart].handlePointerUp"];
            window.addEventListener("pointermove", handlePointerMove);
            window.addEventListener("pointerup", handlePointerUp);
        }
    }["MediaCanvasWrapper.useCallback[handleResizeStart]"], [
        element,
        imageAspectRatio,
        screenToCanvas,
        canvasSize,
        onElementSizeChange
    ]);
    if (!imageAspectRatio) {
        return null;
    }
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$MediaCanvas$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["MediaCanvas"], {
        element: element,
        canvasSize: canvasSize,
        onRemove: onRemove,
        onPointerDown: onPointerDown,
        onResizeStart: handleResizeStart
    }, void 0, false, {
        fileName: "[project]/app/material/editor/components/MediaCanvasWrapper.tsx",
        lineNumber: 147,
        columnNumber: 5
    }, this);
}
_s(MediaCanvasWrapper, "u3yimclVmjtf4Sg3ahBNBrU9QYc=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$useImageAspectRatio$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useImageAspectRatio"]
    ];
});
_c = MediaCanvasWrapper;
var _c;
__turbopack_context__.k.register(_c, "MediaCanvasWrapper");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/app/material/editor/components/LayersPanel.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "LayersPanel",
    ()=>LayersPanel
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
function LayersPanel({ isOpen, onClose, elements, avatar, avatarZIndex, avatarLocked, onReorderLayers, onToggleAvatarLock, panelRef }) {
    _s();
    const [draggedId, setDraggedId] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [dragOverId, setDragOverId] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    // Создаем список слоев: элементы и аватар отсортированные по zIndex (больший zIndex = выше = первый в списке)
    const layers = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "LayersPanel.useMemo[layers]": ()=>{
            const allLayers = [
                ...elements.map({
                    "LayersPanel.useMemo[layers]": (el)=>({
                            id: el.id,
                            type: "media",
                            label: el.label,
                            thumbnail: el.imageUrl,
                            zIndex: el.zIndex ?? 0
                        })
                }["LayersPanel.useMemo[layers]"]),
                ...avatar ? [
                    {
                        id: "avatar",
                        type: "avatar",
                        label: avatar.name,
                        thumbnail: avatar.photo,
                        zIndex: avatarZIndex ?? 9999
                    }
                ] : []
            ];
            return allLayers.sort({
                "LayersPanel.useMemo[layers]": (a, b)=>b.zIndex - a.zIndex
            }["LayersPanel.useMemo[layers]"]); // Больший zIndex = первый в списке
        }
    }["LayersPanel.useMemo[layers]"], [
        elements,
        avatar,
        avatarZIndex
    ]);
    const handleDragStart = (e, id)=>{
        // Аватар не перетаскивается, если заблокирован
        if (id === "avatar" && avatarLocked) {
            e.preventDefault();
            return;
        }
        setDraggedId(id);
        e.dataTransfer.effectAllowed = "move";
        e.dataTransfer.setData("text/plain", id);
    };
    const handleDragOver = (e, id)=>{
        // Нельзя перетаскивать на заблокированный аватар или перетаскивать заблокированный аватар
        if (id === "avatar" && avatarLocked || draggedId === "avatar" && avatarLocked) {
            return;
        }
        e.preventDefault();
        e.stopPropagation();
        if (draggedId && draggedId !== id) {
            setDragOverId(id);
        }
    };
    const handleDragLeave = ()=>{
        setDragOverId(null);
    };
    const handleDrop = (e, targetId)=>{
        e.preventDefault();
        e.stopPropagation();
        // Нельзя перетаскивать на заблокированный аватар или перетаскивать заблокированный аватар
        if (targetId === "avatar" && avatarLocked || !draggedId || draggedId === targetId || draggedId === "avatar" && avatarLocked) {
            setDraggedId(null);
            setDragOverId(null);
            return;
        }
        // Используем актуальный список layers
        const currentLayers = [
            ...elements.map((el)=>({
                    id: el.id,
                    type: "media",
                    label: el.label,
                    thumbnail: el.imageUrl,
                    zIndex: el.zIndex ?? 0
                })),
            ...avatar ? [
                {
                    id: "avatar",
                    type: "avatar",
                    label: avatar.name,
                    thumbnail: avatar.photo,
                    zIndex: avatarZIndex ?? 9999
                }
            ] : []
        ].sort((a, b)=>b.zIndex - a.zIndex);
        const draggedIndex = currentLayers.findIndex((l)=>l.id === draggedId);
        const targetIndex = currentLayers.findIndex((l)=>l.id === targetId);
        if (draggedIndex === -1 || targetIndex === -1) {
            setDraggedId(null);
            setDragOverId(null);
            return;
        }
        // Создаем новый порядок слоев
        const newLayers = [
            ...currentLayers
        ];
        const [draggedLayer] = newLayers.splice(draggedIndex, 1);
        newLayers.splice(targetIndex, 0, draggedLayer);
        // Обновляем zIndex: первый в списке (index 0) = больший zIndex = выше на канве
        const newOrder = newLayers.map((l)=>l.id);
        onReorderLayers(newOrder);
        setDraggedId(null);
        setDragOverId(null);
    };
    const handleDragEnd = ()=>{
        setDraggedId(null);
        setDragOverId(null);
    };
    if (!isOpen) return null;
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        ref: panelRef,
        className: "absolute right-0 top-full z-50 mt-2 w-[416px] rounded-xl border border-gray-200 bg-white shadow-lg",
        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
            className: "p-4",
            children: [
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "mb-4",
                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h2", {
                        className: "text-lg font-semibold text-gray-900",
                        children: "Слои"
                    }, void 0, false, {
                        fileName: "[project]/app/material/editor/components/LayersPanel.tsx",
                        lineNumber: 161,
                        columnNumber: 11
                    }, this)
                }, void 0, false, {
                    fileName: "[project]/app/material/editor/components/LayersPanel.tsx",
                    lineNumber: 160,
                    columnNumber: 9
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "space-y-2",
                    children: layers.length === 0 ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                        className: "py-8 text-center text-sm text-gray-500",
                        children: "Нет элементов на канве"
                    }, void 0, false, {
                        fileName: "[project]/app/material/editor/components/LayersPanel.tsx",
                        lineNumber: 166,
                        columnNumber: 13
                    }, this) : layers.map((layer, index)=>{
                        const isAvatar = layer.type === "avatar";
                        const isLocked = isAvatar && avatarLocked;
                        return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            draggable: !isLocked,
                            onDragStart: (e)=>handleDragStart(e, layer.id),
                            onDragOver: (e)=>handleDragOver(e, layer.id),
                            onDragLeave: handleDragLeave,
                            onDrop: (e)=>handleDrop(e, layer.id),
                            onDragEnd: handleDragEnd,
                            className: `flex items-center gap-3 rounded-xl border-2 p-3 transition ${draggedId === layer.id ? "cursor-move opacity-50" : dragOverId === layer.id && !isLocked ? "cursor-move border-blue-500 bg-blue-50" : isLocked ? "cursor-default border-gray-200 bg-gray-50" : "cursor-move border-gray-200 hover:border-gray-300"}`,
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg bg-gray-100 text-xs font-semibold text-gray-600",
                                    children: index + 1
                                }, void 0, false, {
                                    fileName: "[project]/app/material/editor/components/LayersPanel.tsx",
                                    lineNumber: 192,
                                    columnNumber: 17
                                }, this),
                                layer.thumbnail ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "relative h-10 w-10 flex-shrink-0 overflow-hidden rounded-lg",
                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("img", {
                                        src: layer.thumbnail,
                                        alt: layer.label,
                                        className: "h-full w-full object-cover"
                                    }, void 0, false, {
                                        fileName: "[project]/app/material/editor/components/LayersPanel.tsx",
                                        lineNumber: 197,
                                        columnNumber: 21
                                    }, this)
                                }, void 0, false, {
                                    fileName: "[project]/app/material/editor/components/LayersPanel.tsx",
                                    lineNumber: 196,
                                    columnNumber: 19
                                }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg bg-gray-200",
                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                        className: "text-xs text-gray-500",
                                        children: layer.type === "avatar" ? "👤" : "📄"
                                    }, void 0, false, {
                                        fileName: "[project]/app/material/editor/components/LayersPanel.tsx",
                                        lineNumber: 205,
                                        columnNumber: 21
                                    }, this)
                                }, void 0, false, {
                                    fileName: "[project]/app/material/editor/components/LayersPanel.tsx",
                                    lineNumber: 204,
                                    columnNumber: 19
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "flex-1 min-w-0",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                            className: "text-sm font-medium text-gray-900 truncate",
                                            children: layer.label
                                        }, void 0, false, {
                                            fileName: "[project]/app/material/editor/components/LayersPanel.tsx",
                                            lineNumber: 211,
                                            columnNumber: 19
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                            className: "text-xs text-gray-500 truncate",
                                            children: layer.type === "avatar" ? "Аватар" : "Медиа"
                                        }, void 0, false, {
                                            fileName: "[project]/app/material/editor/components/LayersPanel.tsx",
                                            lineNumber: 212,
                                            columnNumber: 19
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/app/material/editor/components/LayersPanel.tsx",
                                    lineNumber: 210,
                                    columnNumber: 17
                                }, this),
                                isAvatar ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    type: "button",
                                    onClick: (e)=>{
                                        e.stopPropagation();
                                        onToggleAvatarLock();
                                    },
                                    className: `flex-shrink-0 rounded-lg px-3 py-1.5 text-xs font-medium transition ${avatarLocked ? "bg-red-100 text-red-600 hover:bg-red-200" : "bg-green-100 text-green-600 hover:bg-green-200"}`,
                                    "aria-label": avatarLocked ? "Разблокировать аватар" : "Заблокировать аватар",
                                    children: avatarLocked ? "Заблокирован" : "Разблокирован"
                                }, void 0, false, {
                                    fileName: "[project]/app/material/editor/components/LayersPanel.tsx",
                                    lineNumber: 217,
                                    columnNumber: 20
                                }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                    xmlns: "http://www.w3.org/2000/svg",
                                    viewBox: "0 0 24 24",
                                    fill: "none",
                                    stroke: "currentColor",
                                    strokeWidth: 2,
                                    className: "h-5 w-5 flex-shrink-0 text-gray-400",
                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                        d: "M8 9h8M8 15h8"
                                    }, void 0, false, {
                                        fileName: "[project]/app/material/editor/components/LayersPanel.tsx",
                                        lineNumber: 241,
                                        columnNumber: 21
                                    }, this)
                                }, void 0, false, {
                                    fileName: "[project]/app/material/editor/components/LayersPanel.tsx",
                                    lineNumber: 233,
                                    columnNumber: 19
                                }, this)
                            ]
                        }, layer.id, true, {
                            fileName: "[project]/app/material/editor/components/LayersPanel.tsx",
                            lineNumber: 174,
                            columnNumber: 15
                        }, this);
                    })
                }, void 0, false, {
                    fileName: "[project]/app/material/editor/components/LayersPanel.tsx",
                    lineNumber: 164,
                    columnNumber: 9
                }, this)
            ]
        }, void 0, true, {
            fileName: "[project]/app/material/editor/components/LayersPanel.tsx",
            lineNumber: 159,
            columnNumber: 7
        }, this)
    }, void 0, false, {
        fileName: "[project]/app/material/editor/components/LayersPanel.tsx",
        lineNumber: 155,
        columnNumber: 5
    }, this);
}
_s(LayersPanel, "HDz9tqLsSNvdMEaqZKjF6EVxhMU=");
_c = LayersPanel;
var _c;
__turbopack_context__.k.register(_c, "LayersPanel");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/app/material/editor/components/CanvasArea.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "CanvasArea",
    ()=>CanvasArea
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$AvatarCanvas$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/app/material/editor/components/AvatarCanvas.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$MediaCanvasWrapper$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/app/material/editor/components/MediaCanvasWrapper.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$LayersPanel$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/app/material/editor/components/LayersPanel.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$useImageAspectRatio$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/app/material/editor/components/useImageAspectRatio.ts [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
;
;
// Размеры канвы в пикселях
const CANVAS_SIZES = {
    "16:9": {
        width: 1920,
        height: 1080
    },
    "9:16": {
        width: 1080,
        height: 1920
    }
};
function CanvasArea({ aspectRatio, elements, mediaAssets, avatar, avatarPosition, avatarSize, avatarZIndex, avatarLocked, onElementPositionChange, onElementSizeChange, onRemoveElement, onReorderLayers, onAvatarPositionChange, onAvatarSizeChange, onAlignAvatars, onAddMediaAsset, onUseMediaAsset, onUseMediaAssetAtPosition, onRemoveMediaAsset, onRemoveAvatar, onToggleAvatarLock }) {
    _s();
    const canvasRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const fileInputRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const layersButtonRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const layersPanelRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const mediaButtonRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const mediaPanelRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const layersCloseTimeoutRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const mediaCloseTimeoutRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const [isLayersPanelOpen, setIsLayersPanelOpen] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [isMediaPanelOpen, setIsMediaPanelOpen] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [draggedMediaAssetId, setDraggedMediaAssetId] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [isDraggingOverCanvas, setIsDraggingOverCanvas] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const mediaUsageOnScene = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "CanvasArea.useMemo[mediaUsageOnScene]": ()=>{
            return elements.reduce({
                "CanvasArea.useMemo[mediaUsageOnScene]": (acc, element)=>{
                    if (element.type === "media" && element.assetId) {
                        acc[element.assetId] = (acc[element.assetId] || 0) + 1;
                    }
                    return acc;
                }
            }["CanvasArea.useMemo[mediaUsageOnScene]"], {});
        }
    }["CanvasArea.useMemo[mediaUsageOnScene]"], [
        elements
    ]);
    // Закрытие меню слоев при клике вне его
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "CanvasArea.useEffect": ()=>{
            const handleClickOutside = {
                "CanvasArea.useEffect.handleClickOutside": (event)=>{
                    if (isLayersPanelOpen && layersButtonRef.current && layersPanelRef.current && !layersButtonRef.current.contains(event.target) && !layersPanelRef.current.contains(event.target)) {
                        setIsLayersPanelOpen(false);
                    }
                }
            }["CanvasArea.useEffect.handleClickOutside"];
            document.addEventListener("mousedown", handleClickOutside);
            return ({
                "CanvasArea.useEffect": ()=>{
                    document.removeEventListener("mousedown", handleClickOutside);
                }
            })["CanvasArea.useEffect"];
        }
    }["CanvasArea.useEffect"], [
        isLayersPanelOpen
    ]);
    // Закрытие меню медиа при клике вне его
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "CanvasArea.useEffect": ()=>{
            const handleClickOutside = {
                "CanvasArea.useEffect.handleClickOutside": (event)=>{
                    if (isMediaPanelOpen && mediaButtonRef.current && mediaPanelRef.current && !mediaButtonRef.current.contains(event.target) && !mediaPanelRef.current.contains(event.target)) {
                        setIsMediaPanelOpen(false);
                    }
                }
            }["CanvasArea.useEffect.handleClickOutside"];
            document.addEventListener("mousedown", handleClickOutside);
            return ({
                "CanvasArea.useEffect": ()=>{
                    document.removeEventListener("mousedown", handleClickOutside);
                }
            })["CanvasArea.useEffect"];
        }
    }["CanvasArea.useEffect"], [
        isMediaPanelOpen
    ]);
    // Обработчики для автоматического закрытия меню слоев
    const handleLayersMouseEnter = ()=>{
        if (layersCloseTimeoutRef.current) {
            clearTimeout(layersCloseTimeoutRef.current);
            layersCloseTimeoutRef.current = null;
        }
    };
    const handleLayersMouseLeave = ()=>{
        layersCloseTimeoutRef.current = setTimeout(()=>{
            setIsLayersPanelOpen(false);
        }, 500);
    };
    // Обработчики для автоматического закрытия меню медиа
    const handleMediaMouseEnter = ()=>{
        if (mediaCloseTimeoutRef.current) {
            clearTimeout(mediaCloseTimeoutRef.current);
            mediaCloseTimeoutRef.current = null;
        }
    };
    const handleMediaMouseLeave = ()=>{
        mediaCloseTimeoutRef.current = setTimeout(()=>{
            setIsMediaPanelOpen(false);
        }, 500);
    };
    // Очистка таймеров при размонтировании
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "CanvasArea.useEffect": ()=>{
            return ({
                "CanvasArea.useEffect": ()=>{
                    if (layersCloseTimeoutRef.current) {
                        clearTimeout(layersCloseTimeoutRef.current);
                    }
                    if (mediaCloseTimeoutRef.current) {
                        clearTimeout(mediaCloseTimeoutRef.current);
                    }
                }
            })["CanvasArea.useEffect"];
        }
    }["CanvasArea.useEffect"], []);
    const [draggingElementId, setDraggingElementId] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [dragCoords, setDragCoords] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [draggingAvatar, setDraggingAvatar] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [avatarDragCoords, setAvatarDragCoords] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [snapPoint, setSnapPoint] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const canvasSize = CANVAS_SIZES[aspectRatio];
    // Получаем пропорции изображения аватара для правильного масштабирования
    const avatarImageAspectRatio = (0, __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$useImageAspectRatio$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useImageAspectRatio"])(avatar?.photo ?? null);
    // Получаем пропорции изображений медиа элементов
    const mediaImageAspectRatios = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "CanvasArea.useMemo[mediaImageAspectRatios]": ()=>{
            const ratios = {};
            elements.forEach({
                "CanvasArea.useMemo[mediaImageAspectRatios]": (element)=>{
                    if (element.imageUrl) {
                        ratios[element.id] = null; // Будет установлено через хук
                    }
                }
            }["CanvasArea.useMemo[mediaImageAspectRatios]"]);
            return ratios;
        }
    }["CanvasArea.useMemo[mediaImageAspectRatios]"], [
        elements
    ]);
    // Определяем линии привязки
    const snapLines = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "CanvasArea.useMemo[snapLines]": ()=>{
            const snapDistance = 160; // Расстояние от углов
            return {
                vertical: [
                    snapDistance,
                    canvasSize.width - snapDistance,
                    canvasSize.width / 2
                ],
                horizontal: [
                    snapDistance,
                    canvasSize.height - snapDistance,
                    canvasSize.height / 2
                ]
            };
        }
    }["CanvasArea.useMemo[snapLines]"], [
        canvasSize
    ]);
    // Определяем точки привязки (пересечения линий)
    const snapPoints = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "CanvasArea.useMemo[snapPoints]": ()=>{
            const snapDistance = 160;
            return [
                {
                    x: snapDistance,
                    y: snapDistance,
                    type: 'top-left'
                },
                {
                    x: canvasSize.width - snapDistance,
                    y: snapDistance,
                    type: 'top-right'
                },
                {
                    x: snapDistance,
                    y: canvasSize.height - snapDistance,
                    type: 'bottom-left'
                },
                {
                    x: canvasSize.width - snapDistance,
                    y: canvasSize.height - snapDistance,
                    type: 'bottom-right'
                },
                {
                    x: canvasSize.width / 2,
                    y: canvasSize.height / 2,
                    type: 'center'
                }
            ];
        }
    }["CanvasArea.useMemo[snapPoints]"], [
        canvasSize
    ]);
    // Проверка привязки к линиям и точкам
    const checkSnap = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "CanvasArea.useCallback[checkSnap]": (x, y, threshold = 20)=>{
            let snapX = null;
            let snapY = null;
            let snapType = '';
            // Проверяем привязку к вертикальным линиям
            for (const lineX of snapLines.vertical){
                if (Math.abs(x - lineX) <= threshold) {
                    snapX = lineX;
                    break;
                }
            }
            // Проверяем привязку к горизонтальным линиям
            for (const lineY of snapLines.horizontal){
                if (Math.abs(y - lineY) <= threshold) {
                    snapY = lineY;
                    break;
                }
            }
            // Проверяем привязку к точкам (пересечениям линий)
            for (const point of snapPoints){
                const distance = Math.sqrt(Math.pow(x - point.x, 2) + Math.pow(y - point.y, 2));
                if (distance <= threshold) {
                    // Если попали в точку, используем координаты точки
                    snapX = point.x;
                    snapY = point.y;
                    snapType = point.type;
                    break;
                }
            }
            // Если есть привязка хотя бы по одной оси
            if (snapX !== null || snapY !== null) {
                return {
                    x: snapX,
                    y: snapY,
                    type: snapType || (snapX !== null && snapY !== null ? 'intersection' : snapX !== null ? 'vertical' : 'horizontal')
                };
            }
            return null;
        }
    }["CanvasArea.useCallback[checkSnap]"], [
        snapLines,
        snapPoints
    ]);
    // Конвертирует пиксели канвы в пиксели экрана
    const canvasToScreen = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "CanvasArea.useCallback[canvasToScreen]": (canvasPx, dimension)=>{
            const canvas = canvasRef.current;
            if (!canvas) return 0;
            const rect = canvas.getBoundingClientRect();
            const screenSize = dimension === "width" ? rect.width : rect.height;
            const canvasSizePx = dimension === "width" ? canvasSize.width : canvasSize.height;
            return canvasPx / canvasSizePx * screenSize;
        }
    }["CanvasArea.useCallback[canvasToScreen]"], [
        canvasSize
    ]);
    // Конвертирует пиксели экрана в пиксели канвы
    const screenToCanvas = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "CanvasArea.useCallback[screenToCanvas]": (screenPx, dimension)=>{
            const canvas = canvasRef.current;
            if (!canvas) return 0;
            const rect = canvas.getBoundingClientRect();
            const screenSize = dimension === "width" ? rect.width : rect.height;
            const canvasSizePx = dimension === "width" ? canvasSize.width : canvasSize.height;
            return screenPx / screenSize * canvasSizePx;
        }
    }["CanvasArea.useCallback[screenToCanvas]"], [
        canvasSize
    ]);
    const handlePointerDown = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "CanvasArea.useCallback[handlePointerDown]": (event, element)=>{
            event.preventDefault();
            const canvas = canvasRef.current;
            if (!canvas) return;
            setDraggingElementId(element.id);
            const canvasRect = canvas.getBoundingClientRect();
            // Вычисляем позицию мыши относительно канвы
            const mouseXRelative = event.clientX - canvasRect.left;
            const mouseYRelative = event.clientY - canvasRect.top;
            // Конвертируем в пиксели канвы
            const mouseXCanvas = screenToCanvas(mouseXRelative, "width");
            const mouseYCanvas = screenToCanvas(mouseYRelative, "height");
            // Вычисляем смещение мыши относительно центра элемента
            const offsetX = mouseXCanvas - element.x;
            const offsetY = mouseYCanvas - element.y;
            const startX = event.clientX;
            const startY = event.clientY;
            const initialX = element.x;
            const initialY = element.y;
            const handlePointerMove = {
                "CanvasArea.useCallback[handlePointerDown].handlePointerMove": (moveEvent)=>{
                    const deltaXScreen = moveEvent.clientX - startX;
                    const deltaYScreen = moveEvent.clientY - startY;
                    // Конвертируем смещение экрана в пиксели канвы
                    const deltaX = screenToCanvas(deltaXScreen, "width");
                    const deltaY = screenToCanvas(deltaYScreen, "height");
                    // Вычисляем новую позицию центра элемента с учетом смещения мыши
                    let nextX = initialX + deltaX;
                    let nextY = initialY + deltaY;
                    // Ограничиваем позицию так, чтобы элемент не выходил за границы канвы
                    const halfWidth = element.width / 2;
                    const halfHeight = element.height / 2;
                    nextX = Math.min(canvasSize.width - halfWidth, Math.max(halfWidth, nextX));
                    nextY = Math.min(canvasSize.height - halfHeight, Math.max(halfHeight, nextY));
                    setDragCoords({
                        x: Math.round(nextX),
                        y: Math.round(nextY)
                    });
                    onElementPositionChange(element.id, {
                        x: nextX,
                        y: nextY
                    });
                }
            }["CanvasArea.useCallback[handlePointerDown].handlePointerMove"];
            const handlePointerUp = {
                "CanvasArea.useCallback[handlePointerDown].handlePointerUp": ()=>{
                    setDraggingElementId(null);
                    setDragCoords(null);
                    window.removeEventListener("pointermove", handlePointerMove);
                    window.removeEventListener("pointerup", handlePointerUp);
                }
            }["CanvasArea.useCallback[handlePointerDown].handlePointerUp"];
            window.addEventListener("pointermove", handlePointerMove);
            window.addEventListener("pointerup", handlePointerUp);
        }
    }["CanvasArea.useCallback[handlePointerDown]"], [
        onElementPositionChange,
        screenToCanvas,
        canvasSize
    ]);
    const handleAvatarPointerDown = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "CanvasArea.useCallback[handleAvatarPointerDown]": (event)=>{
            event.preventDefault();
            const canvas = canvasRef.current;
            if (!canvas) return;
            setDraggingAvatar(true);
            const startX = event.clientX;
            const startY = event.clientY;
            // Начальная позиция центра аватара в пикселях канвы
            const initialX = Math.max(0, Math.min(canvasSize.width, avatarPosition.x));
            const initialY = Math.max(0, Math.min(canvasSize.height, avatarPosition.y));
            let rafId = null;
            const handlePointerMove = {
                "CanvasArea.useCallback[handleAvatarPointerDown].handlePointerMove": (moveEvent)=>{
                    if (rafId !== null) {
                        cancelAnimationFrame(rafId);
                    }
                    rafId = requestAnimationFrame({
                        "CanvasArea.useCallback[handleAvatarPointerDown].handlePointerMove": ()=>{
                            const deltaXScreen = moveEvent.clientX - startX;
                            const deltaYScreen = moveEvent.clientY - startY;
                            // Конвертируем смещение экрана в пиксели канвы
                            const deltaX = screenToCanvas(deltaXScreen, "width");
                            const deltaY = screenToCanvas(deltaYScreen, "height");
                            // Вычисляем новую позицию центра аватара
                            let nextX = initialX + deltaX;
                            let nextY = initialY + deltaY;
                            // Проверяем привязку к линиям и точкам
                            const snap = checkSnap(nextX, nextY);
                            if (snap) {
                                // Фиксируем координаты только если есть привязка по соответствующей оси
                                if (snap.x !== null) {
                                    nextX = snap.x;
                                }
                                if (snap.y !== null) {
                                    nextY = snap.y;
                                }
                                setSnapPoint(snap);
                            } else {
                                setSnapPoint(null);
                            }
                            // Ограничиваем позицию так, чтобы центр аватара не выходил за границы канвы
                            nextX = Math.max(0, Math.min(canvasSize.width, nextX));
                            nextY = Math.max(0, Math.min(canvasSize.height, nextY));
                            setAvatarDragCoords({
                                x: Math.round(nextX),
                                y: Math.round(nextY)
                            });
                            onAvatarPositionChange({
                                x: nextX,
                                y: nextY
                            });
                            rafId = null;
                        }
                    }["CanvasArea.useCallback[handleAvatarPointerDown].handlePointerMove"]);
                }
            }["CanvasArea.useCallback[handleAvatarPointerDown].handlePointerMove"];
            const handlePointerUp = {
                "CanvasArea.useCallback[handleAvatarPointerDown].handlePointerUp": ()=>{
                    setDraggingAvatar(false);
                    setAvatarDragCoords(null);
                    setSnapPoint(null);
                    if (rafId !== null) {
                        cancelAnimationFrame(rafId);
                        rafId = null;
                    }
                    window.removeEventListener("pointermove", handlePointerMove);
                    window.removeEventListener("pointerup", handlePointerUp);
                }
            }["CanvasArea.useCallback[handleAvatarPointerDown].handlePointerUp"];
            window.addEventListener("pointermove", handlePointerMove);
            window.addEventListener("pointerup", handlePointerUp);
        }
    }["CanvasArea.useCallback[handleAvatarPointerDown]"], [
        avatarPosition,
        onAvatarPositionChange,
        screenToCanvas,
        canvasSize,
        checkSnap
    ]);
    const handleAvatarResizeStart = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "CanvasArea.useCallback[handleAvatarResizeStart]": (event, corner)=>{
            event.preventDefault();
            event.stopPropagation();
            const canvas = canvasRef.current;
            if (!canvas) return;
            const startX = event.clientX;
            const startY = event.clientY;
            const initialWidth = avatarSize.width;
            // Высота вычисляется автоматически на основе ширины и пропорций изображения
            const initialHeight = avatarImageAspectRatio ? initialWidth / avatarImageAspectRatio : avatarSize.height;
            const initialX = avatarPosition.x;
            const initialY = avatarPosition.y;
            // Вычисляем начальную позицию угла в пикселях канвы
            const centerX = initialX;
            const centerY = initialY;
            const halfWidth = initialWidth / 2;
            const halfHeight = initialHeight / 2;
            let initialCornerX, initialCornerY;
            if (corner === "top-left") {
                initialCornerX = centerX - halfWidth;
                initialCornerY = centerY - halfHeight;
            } else if (corner === "top-right") {
                initialCornerX = centerX + halfWidth;
                initialCornerY = centerY - halfHeight;
            } else if (corner === "bottom-left") {
                initialCornerX = centerX - halfWidth;
                initialCornerY = centerY + halfHeight;
            } else {
                // bottom-right
                initialCornerX = centerX + halfWidth;
                initialCornerY = centerY + halfHeight;
            }
            // Начальное расстояние от центра до угла (для расчета масштаба)
            const initialDistance = Math.sqrt(Math.pow(initialCornerX - centerX, 2) + Math.pow(initialCornerY - centerY, 2));
            let rafId = null;
            const handlePointerMove = {
                "CanvasArea.useCallback[handleAvatarResizeStart].handlePointerMove": (moveEvent)=>{
                    if (rafId !== null) {
                        cancelAnimationFrame(rafId);
                    }
                    rafId = requestAnimationFrame({
                        "CanvasArea.useCallback[handleAvatarResizeStart].handlePointerMove": ()=>{
                            const deltaXScreen = moveEvent.clientX - startX;
                            const deltaYScreen = moveEvent.clientY - startY;
                            // Конвертируем смещение экрана в пиксели канвы
                            const deltaX = screenToCanvas(deltaXScreen, "width");
                            const deltaY = screenToCanvas(deltaYScreen, "height");
                            // Вычисляем новую позицию угла в пикселях канвы
                            const newCornerX = initialCornerX + deltaX;
                            const newCornerY = initialCornerY + deltaY;
                            // Вычисляем новое расстояние от центра до угла
                            const newDistance = Math.sqrt(Math.pow(newCornerX - centerX, 2) + Math.pow(newCornerY - centerY, 2));
                            // Масштабируем на основе изменения расстояния
                            const scale = newDistance / initialDistance;
                            // Вычисляем новую ширину
                            let newWidth = initialWidth * scale;
                            // Вычисляем высоту автоматически на основе ширины и пропорций изображения
                            let newHeight = avatarImageAspectRatio ? newWidth / avatarImageAspectRatio : initialHeight * scale;
                            // Ограничиваем минимальный и максимальный размер в пикселях
                            const minSizePx = Math.min(canvasSize.width, canvasSize.height) * 0.05; // минимум 5% от меньшей стороны
                            const maxSizePx = Math.min(canvasSize.width, canvasSize.height) * 0.95; // максимум 95% от меньшей стороны
                            // Ограничиваем ширину
                            if (newWidth > maxSizePx) {
                                newWidth = maxSizePx;
                                newHeight = avatarImageAspectRatio ? newWidth / avatarImageAspectRatio : newHeight;
                            }
                            if (newWidth < minSizePx) {
                                newWidth = minSizePx;
                                newHeight = avatarImageAspectRatio ? newWidth / avatarImageAspectRatio : newHeight;
                            }
                            // Ограничиваем высоту (если она слишком большая)
                            if (newHeight > maxSizePx) {
                                newHeight = maxSizePx;
                                newWidth = avatarImageAspectRatio ? newHeight * avatarImageAspectRatio : newWidth;
                            }
                            if (newHeight < minSizePx) {
                                newHeight = minSizePx;
                                newWidth = avatarImageAspectRatio ? newHeight * avatarImageAspectRatio : newWidth;
                            }
                            onAvatarSizeChange({
                                width: newWidth,
                                height: newHeight
                            });
                            rafId = null;
                        }
                    }["CanvasArea.useCallback[handleAvatarResizeStart].handlePointerMove"]);
                }
            }["CanvasArea.useCallback[handleAvatarResizeStart].handlePointerMove"];
            const handlePointerUp = {
                "CanvasArea.useCallback[handleAvatarResizeStart].handlePointerUp": ()=>{
                    if (rafId !== null) {
                        cancelAnimationFrame(rafId);
                        rafId = null;
                    }
                    window.removeEventListener("pointermove", handlePointerMove);
                    window.removeEventListener("pointerup", handlePointerUp);
                }
            }["CanvasArea.useCallback[handleAvatarResizeStart].handlePointerUp"];
            window.addEventListener("pointermove", handlePointerMove);
            window.addEventListener("pointerup", handlePointerUp);
        }
    }["CanvasArea.useCallback[handleAvatarResizeStart]"], [
        avatarPosition,
        avatarSize,
        onAvatarSizeChange,
        screenToCanvas,
        canvasSize,
        avatarImageAspectRatio
    ]);
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "flex h-full flex-col rounded-3xl border border-gray-100 bg-white p-4 shadow-sm ring-1 ring-black/5",
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "mb-3 flex flex-shrink-0 items-center justify-between",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                className: "text-sm font-semibold text-gray-900",
                                children: "Редактор"
                            }, void 0, false, {
                                fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                lineNumber: 553,
                                columnNumber: 11
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                className: "text-xs text-gray-500",
                                children: [
                                    "Соотношение сторон ",
                                    aspectRatio
                                ]
                            }, void 0, true, {
                                fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                lineNumber: 554,
                                columnNumber: 11
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                        lineNumber: 552,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "flex items-center gap-2",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("input", {
                                        ref: fileInputRef,
                                        type: "file",
                                        accept: "image/*",
                                        multiple: true,
                                        className: "hidden",
                                        onChange: (e)=>{
                                            const files = e.target.files;
                                            if (files && files.length > 0) {
                                                Array.from(files).forEach((file)=>{
                                                    const imageUrl = URL.createObjectURL(file);
                                                    const fileName = file.name;
                                                    onAddMediaAsset(imageUrl, fileName);
                                                });
                                            }
                                            // Сброс input для возможности повторной загрузки того же файла
                                            if (e.target) {
                                                e.target.value = "";
                                            }
                                        }
                                    }, void 0, false, {
                                        fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                        lineNumber: 560,
                                        columnNumber: 13
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "relative",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                ref: mediaButtonRef,
                                                type: "button",
                                                onClick: ()=>{
                                                    if (mediaCloseTimeoutRef.current) {
                                                        clearTimeout(mediaCloseTimeoutRef.current);
                                                        mediaCloseTimeoutRef.current = null;
                                                    }
                                                    setIsMediaPanelOpen(!isMediaPanelOpen);
                                                },
                                                onMouseEnter: handleMediaMouseEnter,
                                                onMouseLeave: handleMediaMouseLeave,
                                                className: "flex h-9 min-w-[100px] items-center justify-center gap-2 rounded-2xl border border-gray-200 px-4 text-xs font-semibold text-gray-900 transition hover:bg-gray-50",
                                                children: [
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                        className: "text-base leading-none",
                                                        children: "＋"
                                                    }, void 0, false, {
                                                        fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                        lineNumber: 596,
                                                        columnNumber: 17
                                                    }, this),
                                                    " Медиа"
                                                ]
                                            }, void 0, true, {
                                                fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                lineNumber: 582,
                                                columnNumber: 15
                                            }, this),
                                            isMediaPanelOpen && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                ref: mediaPanelRef,
                                                onMouseEnter: handleMediaMouseEnter,
                                                onMouseLeave: handleMediaMouseLeave,
                                                className: "absolute right-0 top-full z-50 mt-2 w-[416px] rounded-xl border border-gray-200 bg-white shadow-lg",
                                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "p-4",
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                            className: "mb-4",
                                                            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h2", {
                                                                className: "text-lg font-semibold text-gray-900",
                                                                children: "Медиа"
                                                            }, void 0, false, {
                                                                fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                                lineNumber: 607,
                                                                columnNumber: 23
                                                            }, this)
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                            lineNumber: 606,
                                                            columnNumber: 21
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                            className: "space-y-2",
                                                            children: [
                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                                    type: "button",
                                                                    onClick: ()=>{
                                                                        fileInputRef.current?.click();
                                                                        setIsMediaPanelOpen(false);
                                                                    },
                                                                    className: "flex w-full items-center gap-3 rounded-xl border-2 border-dashed border-gray-300 p-3 transition hover:border-gray-400 hover:bg-gray-50",
                                                                    children: [
                                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                                            className: "flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg bg-gray-100",
                                                                            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                                                className: "text-xl",
                                                                                children: "＋"
                                                                            }, void 0, false, {
                                                                                fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                                                lineNumber: 619,
                                                                                columnNumber: 27
                                                                            }, this)
                                                                        }, void 0, false, {
                                                                            fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                                            lineNumber: 618,
                                                                            columnNumber: 25
                                                                        }, this),
                                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                                            className: "flex-1 text-left",
                                                                            children: [
                                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                                                    className: "text-sm font-medium text-gray-900",
                                                                                    children: "Добавить медиа"
                                                                                }, void 0, false, {
                                                                                    fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                                                    lineNumber: 622,
                                                                                    columnNumber: 27
                                                                                }, this),
                                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                                                    className: "text-xs text-gray-500",
                                                                                    children: "Загрузить изображение"
                                                                                }, void 0, false, {
                                                                                    fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                                                    lineNumber: 623,
                                                                                    columnNumber: 27
                                                                                }, this)
                                                                            ]
                                                                        }, void 0, true, {
                                                                            fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                                            lineNumber: 621,
                                                                            columnNumber: 25
                                                                        }, this)
                                                                    ]
                                                                }, void 0, true, {
                                                                    fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                                    lineNumber: 610,
                                                                    columnNumber: 23
                                                                }, this),
                                                                mediaAssets.length === 0 ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                                    className: "py-8 text-center text-sm text-gray-500",
                                                                    children: "Нет добавленных медиа"
                                                                }, void 0, false, {
                                                                    fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                                    lineNumber: 627,
                                                                    columnNumber: 25
                                                                }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                                    className: "max-h-[420px] overflow-y-auto space-y-2 pr-1 [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-track]:bg-gray-100 [&::-webkit-scrollbar-thumb]:bg-gray-300 [&::-webkit-scrollbar-thumb]:rounded-full",
                                                                    children: mediaAssets.map((asset, index)=>{
                                                                        const usageCount = mediaUsageOnScene[asset.id] ?? 0;
                                                                        return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                                            draggable: true,
                                                                            onDragStart: (e)=>{
                                                                                setDraggedMediaAssetId(asset.id);
                                                                                e.dataTransfer.effectAllowed = "copy";
                                                                                e.dataTransfer.setData("text/plain", asset.id);
                                                                            },
                                                                            onDragEnd: ()=>{
                                                                                setDraggedMediaAssetId(null);
                                                                                setIsDraggingOverCanvas(false);
                                                                            },
                                                                            className: "flex items-center gap-3 rounded-xl border-2 border-gray-200 p-3 transition hover:border-gray-300 cursor-move",
                                                                            children: [
                                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                                                    className: "flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg bg-gray-100 text-xs font-semibold text-gray-600",
                                                                                    children: index + 1
                                                                                }, void 0, false, {
                                                                                    fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                                                    lineNumber: 649,
                                                                                    columnNumber: 33
                                                                                }, this),
                                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                                                    className: "relative h-10 w-10 flex-shrink-0 overflow-hidden rounded-lg bg-gray-100",
                                                                                    children: asset.imageUrl ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("img", {
                                                                                        src: asset.imageUrl,
                                                                                        alt: asset.label,
                                                                                        className: "h-full w-full object-cover"
                                                                                    }, void 0, false, {
                                                                                        fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                                                        lineNumber: 654,
                                                                                        columnNumber: 37
                                                                                    }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                                                        className: "flex h-full w-full items-center justify-center text-xs text-gray-500",
                                                                                        children: "📄"
                                                                                    }, void 0, false, {
                                                                                        fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                                                        lineNumber: 660,
                                                                                        columnNumber: 37
                                                                                    }, this)
                                                                                }, void 0, false, {
                                                                                    fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                                                    lineNumber: 652,
                                                                                    columnNumber: 33
                                                                                }, this),
                                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                                                    className: "flex-1 min-w-0",
                                                                                    children: [
                                                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                                                            className: "text-sm font-medium text-gray-900 truncate",
                                                                                            children: asset.label
                                                                                        }, void 0, false, {
                                                                                            fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                                                            lineNumber: 666,
                                                                                            columnNumber: 35
                                                                                        }, this),
                                                                                        usageCount > 0 ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                                                            className: "text-xs text-gray-500",
                                                                                            children: [
                                                                                                "На слайде: ",
                                                                                                usageCount
                                                                                            ]
                                                                                        }, void 0, true, {
                                                                                            fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                                                            lineNumber: 668,
                                                                                            columnNumber: 37
                                                                                        }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                                                            className: "text-xs text-gray-500",
                                                                                            children: "Не используется"
                                                                                        }, void 0, false, {
                                                                                            fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                                                            lineNumber: 672,
                                                                                            columnNumber: 37
                                                                                        }, this)
                                                                                    ]
                                                                                }, void 0, true, {
                                                                                    fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                                                    lineNumber: 665,
                                                                                    columnNumber: 33
                                                                                }, this),
                                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                                                    className: "flex flex-col gap-1",
                                                                                    children: [
                                                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                                                            type: "button",
                                                                                            draggable: false,
                                                                                            onDragStart: (e)=>e.stopPropagation(),
                                                                                            onClick: ()=>{
                                                                                                onUseMediaAsset(asset.id);
                                                                                                setIsMediaPanelOpen(false);
                                                                                            },
                                                                                            className: "rounded-lg px-3 py-1.5 text-xs font-medium text-gray-900 border border-gray-200 hover:bg-gray-50 transition",
                                                                                            children: "На слайд"
                                                                                        }, void 0, false, {
                                                                                            fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                                                            lineNumber: 676,
                                                                                            columnNumber: 35
                                                                                        }, this),
                                                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                                                            type: "button",
                                                                                            draggable: false,
                                                                                            onDragStart: (e)=>e.stopPropagation(),
                                                                                            onClick: ()=>{
                                                                                                onRemoveMediaAsset(asset.id);
                                                                                            },
                                                                                            className: "rounded-lg px-3 py-1.5 text-xs font-medium text-red-600 transition hover:bg-red-50",
                                                                                            "aria-label": "Удалить медиа из библиотеки",
                                                                                            children: "Удалить"
                                                                                        }, void 0, false, {
                                                                                            fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                                                            lineNumber: 688,
                                                                                            columnNumber: 35
                                                                                        }, this)
                                                                                    ]
                                                                                }, void 0, true, {
                                                                                    fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                                                    lineNumber: 675,
                                                                                    columnNumber: 33
                                                                                }, this)
                                                                            ]
                                                                        }, asset.id, true, {
                                                                            fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                                            lineNumber: 635,
                                                                            columnNumber: 31
                                                                        }, this);
                                                                    })
                                                                }, void 0, false, {
                                                                    fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                                    lineNumber: 631,
                                                                    columnNumber: 25
                                                                }, this)
                                                            ]
                                                        }, void 0, true, {
                                                            fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                            lineNumber: 609,
                                                            columnNumber: 21
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                    lineNumber: 605,
                                                    columnNumber: 19
                                                }, this)
                                            }, void 0, false, {
                                                fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                lineNumber: 599,
                                                columnNumber: 17
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                        lineNumber: 581,
                                        columnNumber: 13
                                    }, this)
                                ]
                            }, void 0, true),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "flex items-center gap-2",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "relative",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                ref: layersButtonRef,
                                                type: "button",
                                                onClick: ()=>{
                                                    if (layersCloseTimeoutRef.current) {
                                                        clearTimeout(layersCloseTimeoutRef.current);
                                                        layersCloseTimeoutRef.current = null;
                                                    }
                                                    setIsLayersPanelOpen(!isLayersPanelOpen);
                                                },
                                                onMouseEnter: handleLayersMouseEnter,
                                                onMouseLeave: handleLayersMouseLeave,
                                                className: "flex h-9 min-w-[100px] items-center justify-center gap-2 rounded-2xl border border-gray-200 px-4 text-xs font-semibold text-gray-900 transition hover:bg-gray-50",
                                                children: [
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                                        xmlns: "http://www.w3.org/2000/svg",
                                                        viewBox: "0 0 24 24",
                                                        fill: "none",
                                                        stroke: "currentColor",
                                                        strokeWidth: 2,
                                                        className: "h-4 w-4 flex-shrink-0",
                                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                                            d: "M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                            lineNumber: 736,
                                                            columnNumber: 15
                                                        }, this)
                                                    }, void 0, false, {
                                                        fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                        lineNumber: 728,
                                                        columnNumber: 13
                                                    }, this),
                                                    "Слои"
                                                ]
                                            }, void 0, true, {
                                                fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                lineNumber: 714,
                                                columnNumber: 13
                                            }, this),
                                            isLayersPanelOpen && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                onMouseEnter: handleLayersMouseEnter,
                                                onMouseLeave: handleLayersMouseLeave,
                                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$LayersPanel$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["LayersPanel"], {
                                                    isOpen: isLayersPanelOpen,
                                                    onClose: ()=>setIsLayersPanelOpen(false),
                                                    elements: elements,
                                                    avatar: avatar,
                                                    avatarZIndex: avatarZIndex,
                                                    avatarLocked: avatarLocked,
                                                    onReorderLayers: onReorderLayers,
                                                    onToggleAvatarLock: onToggleAvatarLock,
                                                    panelRef: layersPanelRef
                                                }, void 0, false, {
                                                    fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                    lineNumber: 745,
                                                    columnNumber: 15
                                                }, this)
                                            }, void 0, false, {
                                                fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                lineNumber: 741,
                                                columnNumber: 13
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                        lineNumber: 713,
                                        columnNumber: 11
                                    }, this),
                                    onAlignAvatars && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                        type: "button",
                                        onClick: onAlignAvatars,
                                        className: "flex h-9 items-center justify-center gap-1.5 rounded-2xl border border-gray-200 px-4 text-xs font-semibold text-gray-900 transition hover:bg-gray-50",
                                        title: "Выровнять аватар по первому слайду",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                                xmlns: "http://www.w3.org/2000/svg",
                                                viewBox: "0 0 24 24",
                                                fill: "none",
                                                stroke: "currentColor",
                                                strokeWidth: 2,
                                                strokeLinecap: "round",
                                                strokeLinejoin: "round",
                                                className: "h-4 w-4",
                                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                                    d: "M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"
                                                }, void 0, false, {
                                                    fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                    lineNumber: 776,
                                                    columnNumber: 19
                                                }, this)
                                            }, void 0, false, {
                                                fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                lineNumber: 766,
                                                columnNumber: 17
                                            }, this),
                                            "Выровнять аватар"
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                        lineNumber: 760,
                                        columnNumber: 15
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                lineNumber: 712,
                                columnNumber: 11
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                        lineNumber: 558,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                lineNumber: 551,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "relative flex-1 min-h-0 overflow-hidden",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "flex h-full w-full items-center justify-center p-2",
                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        ref: canvasRef,
                        onDragOver: (e)=>{
                            e.preventDefault();
                            e.stopPropagation();
                            if (draggedMediaAssetId) {
                                setIsDraggingOverCanvas(true);
                                e.dataTransfer.dropEffect = "copy";
                            }
                        },
                        onDragLeave: (e)=>{
                            // Проверяем, что мы действительно покинули канву, а не перешли на дочерний элемент
                            const rect = canvasRef.current?.getBoundingClientRect();
                            if (rect) {
                                const x = e.clientX;
                                const y = e.clientY;
                                if (x < rect.left || x > rect.right || y < rect.top || y > rect.bottom) {
                                    setIsDraggingOverCanvas(false);
                                }
                            }
                        },
                        onDrop: (e)=>{
                            e.preventDefault();
                            e.stopPropagation();
                            setIsDraggingOverCanvas(false);
                            if (!draggedMediaAssetId || !onUseMediaAssetAtPosition) return;
                            const canvas = canvasRef.current;
                            if (!canvas) return;
                            const rect = canvas.getBoundingClientRect();
                            const x = e.clientX - rect.left;
                            const y = e.clientY - rect.top;
                            // Конвертируем координаты экрана в координаты канвы
                            const canvasX = screenToCanvas(x, "width");
                            const canvasY = screenToCanvas(y, "height");
                            onUseMediaAssetAtPosition(draggedMediaAssetId, canvasX, canvasY);
                            setDraggedMediaAssetId(null);
                        },
                        className: `relative overflow-visible rounded-2xl bg-gray-50 border-2 border-dashed transition ${isDraggingOverCanvas ? "border-blue-400 bg-blue-50" : "border-gray-300"}`,
                        style: {
                            aspectRatio: aspectRatio === "16:9" ? "16 / 9" : "9 / 16",
                            width: aspectRatio === "16:9" ? "100%" : "auto",
                            height: aspectRatio === "9:16" ? "100%" : "auto",
                            maxWidth: "100%",
                            maxHeight: "100%"
                        },
                        children: [
                            snapPoint && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
                                children: [
                                    snapPoint.x !== null && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "absolute z-40 pointer-events-none",
                                        style: {
                                            left: `${snapPoint.x / canvasSize.width * 100}%`,
                                            top: 0,
                                            width: '1px',
                                            height: '100%',
                                            backgroundColor: '#3b82f6',
                                            opacity: 0.5
                                        }
                                    }, void 0, false, {
                                        fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                        lineNumber: 850,
                                        columnNumber: 19
                                    }, this),
                                    snapPoint.y !== null && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "absolute z-40 pointer-events-none",
                                        style: {
                                            left: 0,
                                            top: `${snapPoint.y / canvasSize.height * 100}%`,
                                            width: '100%',
                                            height: '1px',
                                            backgroundColor: '#3b82f6',
                                            opacity: 0.5
                                        }
                                    }, void 0, false, {
                                        fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                        lineNumber: 864,
                                        columnNumber: 19
                                    }, this)
                                ]
                            }, void 0, true),
                            draggingElementId && dragCoords && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "absolute z-50 rounded-lg bg-black/80 px-3 py-1.5 text-xs font-mono text-white pointer-events-none whitespace-nowrap",
                                style: {
                                    left: `${dragCoords.x / canvasSize.width * 100}%`,
                                    top: `${dragCoords.y / canvasSize.height * 100}%`,
                                    transform: "translate(-50%, calc(50% + 30px))"
                                },
                                children: [
                                    "X: ",
                                    dragCoords.x,
                                    " Y: ",
                                    dragCoords.y
                                ]
                            }, void 0, true, {
                                fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                lineNumber: 881,
                                columnNumber: 15
                            }, this),
                            draggingAvatar && avatarDragCoords && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "absolute z-50 rounded-lg bg-black/80 px-3 py-1.5 text-xs font-mono text-white pointer-events-none whitespace-nowrap",
                                style: {
                                    left: `${avatarDragCoords.x / canvasSize.width * 100}%`,
                                    top: `${avatarDragCoords.y / canvasSize.height * 100}%`,
                                    transform: "translate(-50%, calc(50% + 30px))"
                                },
                                children: [
                                    "X: ",
                                    avatarDragCoords.x,
                                    " Y: ",
                                    avatarDragCoords.y
                                ]
                            }, void 0, true, {
                                fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                lineNumber: 895,
                                columnNumber: 15
                            }, this),
                            [
                                ...elements.map((el)=>({
                                        type: "element",
                                        data: el,
                                        zIndex: el.zIndex ?? 0
                                    })),
                                ...avatar ? [
                                    {
                                        type: "avatar",
                                        data: avatar,
                                        zIndex: avatarZIndex ?? 9999
                                    }
                                ] : []
                            ].sort((a, b)=>a.zIndex - b.zIndex).map((item)=>{
                                if (item.type === "avatar") {
                                    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$AvatarCanvas$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AvatarCanvas"], {
                                        avatar: item.data,
                                        position: avatarPosition,
                                        size: avatarSize,
                                        canvasSize: canvasSize,
                                        onRemove: onRemoveAvatar,
                                        onPointerDown: handleAvatarPointerDown,
                                        onResizeStart: handleAvatarResizeStart
                                    }, "avatar", false, {
                                        fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                        lineNumber: 915,
                                        columnNumber: 21
                                    }, this);
                                }
                                const element = item.data;
                                if (element.imageUrl) {
                                    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$MediaCanvasWrapper$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["MediaCanvasWrapper"], {
                                        element: element,
                                        canvasSize: canvasSize,
                                        onRemove: ()=>onRemoveElement(element.id),
                                        onPointerDown: (event)=>handlePointerDown(event, element),
                                        onResizeStart: ()=>{},
                                        screenToCanvas: screenToCanvas,
                                        onElementSizeChange: onElementSizeChange
                                    }, element.id, false, {
                                        fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                        lineNumber: 931,
                                        columnNumber: 21
                                    }, this);
                                }
                                // Плейсхолдер для элементов без изображения
                                const leftPercent = element.x / canvasSize.width * 100;
                                const topPercent = element.y / canvasSize.height * 100;
                                const widthPercent = element.width / canvasSize.width * 100;
                                const heightPercent = element.height / canvasSize.height * 100;
                                return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    role: "button",
                                    tabIndex: 0,
                                    onPointerDown: (event)=>handlePointerDown(event, element),
                                    className: "absolute cursor-grab rounded-2xl border-2 border-gray-300 bg-white text-center text-xs font-semibold text-gray-900 shadow-md transition hover:border-gray-900 active:cursor-grabbing overflow-hidden",
                                    style: {
                                        left: `${leftPercent}%`,
                                        top: `${topPercent}%`,
                                        width: `${widthPercent}%`,
                                        height: `${heightPercent}%`,
                                        transform: "translate(-50%, -50%)",
                                        background: "#f3f4f6"
                                    },
                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "flex h-full w-full flex-col items-center justify-center px-2",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                className: "text-sm text-gray-900",
                                                children: element.label
                                            }, void 0, false, {
                                                fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                lineNumber: 967,
                                                columnNumber: 23
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                className: "text-[10px] text-gray-500",
                                                children: "Медиа"
                                            }, void 0, false, {
                                                fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                                lineNumber: 968,
                                                columnNumber: 23
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                        lineNumber: 966,
                                        columnNumber: 21
                                    }, this)
                                }, element.id, false, {
                                    fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                                    lineNumber: 951,
                                    columnNumber: 19
                                }, this);
                            })
                        ]
                    }, void 0, true, {
                        fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                        lineNumber: 787,
                        columnNumber: 11
                    }, this)
                }, void 0, false, {
                    fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                    lineNumber: 786,
                    columnNumber: 9
                }, this)
            }, void 0, false, {
                fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
                lineNumber: 785,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/app/material/editor/components/CanvasArea.tsx",
        lineNumber: 550,
        columnNumber: 5
    }, this);
}
_s(CanvasArea, "DMpJ9lmuMQZWDx/oki6mRC0vmF0=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$useImageAspectRatio$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useImageAspectRatio"]
    ];
});
_c = CanvasArea;
var _c;
__turbopack_context__.k.register(_c, "CanvasArea");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/app/material/editor/components/MaterialEditor.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "MaterialEditor",
    ()=>MaterialEditor
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/navigation.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/supabaseClient.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$EditorSidebar$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/app/material/editor/components/EditorSidebar.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$Timeline$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/app/material/editor/components/Timeline.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$CanvasArea$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/app/material/editor/components/CanvasArea.tsx [app-client] (ecmascript)");
(()=>{
    const e = new Error("Cannot find module './servers/CreateVideoTemp'");
    e.code = 'MODULE_NOT_FOUND';
    throw e;
})();
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
;
;
;
;
const createScene = (index)=>({
        id: crypto.randomUUID(),
        title: `Слайд ${index}`,
        script: "",
        avatarId: null,
        voiceId: null,
        elements: []
    });
function MaterialEditor() {
    _s();
    const router = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRouter"])();
    const searchParams = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useSearchParams"])();
    const initialScenes = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "MaterialEditor.useMemo[initialScenes]": ()=>[
                createScene(1)
            ]
    }["MaterialEditor.useMemo[initialScenes]"], []);
    const [aspectRatio, setAspectRatio] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("16:9");
    const [videoTitle, setVideoTitle] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("Новое видео");
    const [scenes, setScenes] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(initialScenes);
    const [activeSceneId, setActiveSceneId] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(initialScenes[0].id);
    const [avatars, setAvatars] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])([]);
    const [voices, setVoices] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])([]);
    const [mediaAssets, setMediaAssets] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])([]);
    const [isLoadingAvatars, setIsLoadingAvatars] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(true);
    const [isLoadingVoices, setIsLoadingVoices] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(true);
    const [isGenerating, setIsGenerating] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [initialParamsApplied, setInitialParamsApplied] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    // Функция для обновления списка аватаров
    const refreshAvatars = async ()=>{
        const { data: { user } } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["supabase"].auth.getUser();
        if (!user) return;
        const { data, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["supabase"].from("photo_avatars").select("*").eq("uid", user.id).eq("status", "done").order("created_at", {
            ascending: false
        });
        if (error) {
            console.error("[MaterialEditor] Ошибка загрузки аватаров:", error);
        } else {
            setAvatars((data ?? []).map((avatar)=>({
                    id: avatar.id ?? "",
                    name: avatar.name,
                    photo: avatar.photo,
                    image_key: avatar.image_key,
                    hey_gen_id: avatar.hey_gen_id,
                    group_id: avatar.group_id
                })));
        }
    };
    // Функция для обновления списка голосов
    const refreshVoices = async ()=>{
        const { data: { user } } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["supabase"].auth.getUser();
        if (!user) return;
        const { data, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["supabase"].from("voices").select("*").eq("uid", user.id).order("created_at", {
            ascending: false
        });
        if (error) {
            console.error("[MaterialEditor] Ошибка загрузки голосов:", error);
        } else {
            setVoices((data ?? []).filter((voice)=>voice.url && voice.name).map((voice)=>({
                    id: voice.id ?? "",
                    name: voice.name,
                    url: voice.url,
                    description: voice.description,
                    voice_id: voice.voice_id ?? null
                })));
        }
    };
    const activeScene = scenes.find((scene)=>scene.id === activeSceneId);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "MaterialEditor.useEffect": ()=>{
            const fetchAvatars = {
                "MaterialEditor.useEffect.fetchAvatars": async ()=>{
                    const { data: { user } } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["supabase"].auth.getUser();
                    if (!user) return;
                    const { data, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["supabase"].from("photo_avatars").select("*").eq("uid", user.id).eq("status", "done").order("created_at", {
                        ascending: false
                    });
                    if (error) {
                        console.error("[MaterialEditor] Ошибка загрузки аватаров:", error);
                    } else {
                        setAvatars((data ?? []).map({
                            "MaterialEditor.useEffect.fetchAvatars": (avatar)=>({
                                    id: avatar.id ?? "",
                                    name: avatar.name,
                                    photo: avatar.photo,
                                    image_key: avatar.image_key,
                                    hey_gen_id: avatar.hey_gen_id,
                                    group_id: avatar.group_id
                                })
                        }["MaterialEditor.useEffect.fetchAvatars"]));
                    }
                    setIsLoadingAvatars(false);
                }
            }["MaterialEditor.useEffect.fetchAvatars"];
            fetchAvatars();
        }
    }["MaterialEditor.useEffect"], []);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "MaterialEditor.useEffect": ()=>{
            const fetchVoices = {
                "MaterialEditor.useEffect.fetchVoices": async ()=>{
                    const { data: { user } } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["supabase"].auth.getUser();
                    if (!user) return;
                    const { data, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["supabase"].from("voices").select("*").eq("uid", user.id).order("created_at", {
                        ascending: false
                    });
                    if (error) {
                        console.error("[MaterialEditor] Ошибка загрузки голосов:", error);
                    } else {
                        setVoices((data ?? []).filter({
                            "MaterialEditor.useEffect.fetchVoices": (voice)=>voice.url && voice.name
                        }["MaterialEditor.useEffect.fetchVoices"]).map({
                            "MaterialEditor.useEffect.fetchVoices": (voice)=>({
                                    id: voice.id ?? "",
                                    name: voice.name,
                                    url: voice.url,
                                    description: voice.description,
                                    voice_id: voice.voice_id ?? null
                                })
                        }["MaterialEditor.useEffect.fetchVoices"]));
                    }
                    setIsLoadingVoices(false);
                }
            }["MaterialEditor.useEffect.fetchVoices"];
            fetchVoices();
        }
    }["MaterialEditor.useEffect"], []);
    // Применяем параметры из URL после загрузки аватаров и голосов
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "MaterialEditor.useEffect": ()=>{
            if (!isLoadingAvatars && !isLoadingVoices && !initialParamsApplied && avatars.length > 0 && voices.length > 0) {
                const avatarId = searchParams.get("avatarId");
                const voiceId = searchParams.get("voiceId");
                if (avatarId || voiceId) {
                    setScenes({
                        "MaterialEditor.useEffect": (prev)=>{
                            const firstScene = prev[0];
                            if (!firstScene) return prev;
                            const updatedScene = {
                                ...firstScene,
                                avatarId: avatarId && avatars.some({
                                    "MaterialEditor.useEffect": (a)=>a.id === avatarId
                                }["MaterialEditor.useEffect"]) ? avatarId : firstScene.avatarId,
                                voiceId: voiceId && voices.some({
                                    "MaterialEditor.useEffect": (v)=>v.id === voiceId
                                }["MaterialEditor.useEffect"]) ? voiceId : firstScene.voiceId
                            };
                            return [
                                updatedScene,
                                ...prev.slice(1)
                            ];
                        }
                    }["MaterialEditor.useEffect"]);
                    setInitialParamsApplied(true);
                } else {
                    setInitialParamsApplied(true);
                }
            }
        }
    }["MaterialEditor.useEffect"], [
        isLoadingAvatars,
        isLoadingVoices,
        initialParamsApplied,
        avatars,
        voices,
        searchParams
    ]);
    const handleSceneUpdate = (sceneId, updater)=>setScenes((prev)=>prev.map((scene)=>scene.id === sceneId ? updater(scene) : scene));
    // Константы размеров канвы в пикселях
    const CANVAS_SIZES = {
        "16:9": {
            width: 1920,
            height: 1080
        },
        "9:16": {
            width: 1080,
            height: 1920
        }
    };
    // Рассчитывает начальный размер аватара в пикселях (35% от высоты канвы)
    const getInitialAvatarSize = (ratio)=>{
        const canvasSize = CANVAS_SIZES[ratio];
        // Высота аватара = 35% от высоты канвы в пикселях
        const avatarHeightPercent = 0.35;
        const height = canvasSize.height * avatarHeightPercent;
        // Типичное соотношение сторон аватара (ширина к высоте)
        const avatarAspectRatio = 3 / 4;
        // Ширина рассчитывается на основе соотношения сторон аватара
        const width = height * avatarAspectRatio;
        return {
            width,
            height
        };
    };
    // Конвертирует координаты из одного соотношения сторон в другое
    const convertCoordinates = (coords, fromRatio, toRatio)=>{
        if (fromRatio === toRatio) return coords;
        const fromSize = CANVAS_SIZES[fromRatio];
        const toSize = CANVAS_SIZES[toRatio];
        // Конвертируем в проценты относительно исходной канвы
        const xPercent = coords.x / fromSize.width;
        const yPercent = coords.y / fromSize.height;
        // Применяем проценты к новой канве
        return {
            x: xPercent * toSize.width,
            y: yPercent * toSize.height
        };
    };
    // Конвертирует размеры из одного соотношения сторон в другое
    const convertSize = (size, fromRatio, toRatio)=>{
        if (fromRatio === toRatio) return size;
        const fromSize = CANVAS_SIZES[fromRatio];
        const toSize = CANVAS_SIZES[toRatio];
        // Конвертируем в проценты относительно исходной канвы
        const widthPercent = size.width / fromSize.width;
        const heightPercent = size.height / fromSize.height;
        // Применяем проценты к новой канве
        return {
            width: widthPercent * toSize.width,
            height: heightPercent * toSize.height
        };
    };
    const handleAddScene = (afterSceneId)=>{
        const newSceneId = crypto.randomUUID();
        setScenes((prev)=>{
            const newIndex = afterSceneId ? prev.findIndex((s)=>s.id === afterSceneId) + 1 : prev.length;
            // Берем данные из активного слайда для копирования настроек (кроме текста)
            const activeScene = prev.find((s)=>s.id === activeSceneId);
            const previousScene = afterSceneId ? prev.find((s)=>s.id === afterSceneId) : prev[prev.length - 1];
            const newScene = {
                id: newSceneId,
                title: `Слайд ${newIndex + 1}`,
                script: "",
                avatarId: activeScene?.avatarId ?? previousScene?.avatarId ?? null,
                voiceId: activeScene?.voiceId ?? previousScene?.voiceId ?? null,
                elements: [],
                avatarPosition: activeScene?.avatarPosition ?? previousScene?.avatarPosition,
                avatarSize: activeScene?.avatarSize ?? previousScene?.avatarSize,
                avatarZIndex: activeScene?.avatarZIndex ?? previousScene?.avatarZIndex
            };
            if (afterSceneId) {
                const index = prev.findIndex((s)=>s.id === afterSceneId);
                const updated = [
                    ...prev
                ];
                updated.splice(index + 1, 0, newScene);
                return updated.map((scene, idx)=>({
                        ...scene,
                        title: `Слайд ${idx + 1}`
                    }));
            }
            return [
                ...prev,
                newScene
            ].map((scene, idx)=>({
                    ...scene,
                    title: `Слайд ${idx + 1}`
                }));
        });
        setActiveSceneId(newSceneId);
    };
    const handleDeleteScene = (sceneId)=>{
        setScenes((prev)=>{
            const filtered = prev.filter((scene)=>scene.id !== sceneId);
            if (filtered.length === 0) {
                const newScene = createScene(1);
                setActiveSceneId(newScene.id);
                return [
                    newScene
                ];
            }
            if (activeSceneId === sceneId) {
                const currentIndex = prev.findIndex((scene)=>scene.id === sceneId);
                const newActiveIndex = Math.max(0, currentIndex - 1);
                setActiveSceneId(filtered[newActiveIndex]?.id ?? filtered[0].id);
            }
            return filtered.map((scene, index)=>({
                    ...scene,
                    title: `Слайд ${index + 1}`
                }));
        });
    };
    const handleScriptChange = (value)=>{
        if (!activeScene) return;
        handleSceneUpdate(activeScene.id, (scene)=>({
                ...scene,
                script: value
            }));
    };
    const handleVoiceChange = (voiceId)=>{
        if (!activeScene) return;
        handleSceneUpdate(activeScene.id, (scene)=>({
                ...scene,
                voiceId
            }));
    };
    const handleAvatarChange = (avatarId)=>{
        if (!activeScene) return;
        handleSceneUpdate(activeScene.id, (scene)=>{
            if (avatarId && !scene.avatarPosition) {
                // При первом добавлении аватара устанавливаем начальную позицию и размер
                const initialSize = getInitialAvatarSize(aspectRatio);
                const canvasSize = CANVAS_SIZES[aspectRatio];
                // Аватар по умолчанию имеет большой zIndex (выше всех элементов)
                const maxZIndex = Math.max(...scene.elements.map((el)=>el.zIndex ?? 0), 0);
                return {
                    ...scene,
                    avatarId,
                    avatarPosition: {
                        x: canvasSize.width / 2,
                        y: canvasSize.height / 2
                    },
                    avatarSize: initialSize,
                    avatarZIndex: maxZIndex + 1
                };
            }
            return {
                ...scene,
                avatarId
            };
        });
    };
    const handleRemoveAvatar = ()=>{
        if (!activeScene) return;
        handleSceneUpdate(activeScene.id, (scene)=>({
                ...scene,
                avatarId: null,
                avatarPosition: undefined,
                avatarSize: undefined
            }));
    };
    const handleAvatarPositionChange = (coords)=>{
        if (!activeScene) return;
        handleSceneUpdate(activeScene.id, (scene)=>({
                ...scene,
                avatarPosition: coords
            }));
    };
    const handleAvatarSizeChange = (size)=>{
        if (!activeScene) return;
        handleSceneUpdate(activeScene.id, (scene)=>({
                ...scene,
                avatarSize: size
            }));
    };
    const addAssetToScene = (sceneId, asset)=>{
        const canvasSize = CANVAS_SIZES[aspectRatio];
        handleSceneUpdate(sceneId, (scene)=>{
            const mediaIndex = scene.elements.filter((element)=>element.type === "media").length + 1;
            const elementWidth = canvasSize.width * 0.28;
            const elementHeight = canvasSize.height * 0.34;
            const maxElementZIndex = scene.elements.reduce((max, el)=>Math.max(max, el.zIndex ?? 0), 0);
            const maxZIndex = Math.max(maxElementZIndex, scene.avatarZIndex ?? 0);
            const newElement = {
                id: `media-${scene.id}-${mediaIndex}-${Date.now()}`,
                type: "media",
                label: asset.label,
                color: "#1fb6ff",
                width: elementWidth,
                height: elementHeight,
                x: canvasSize.width / 2,
                y: canvasSize.height / 2,
                imageUrl: asset.imageUrl,
                assetId: asset.id,
                zIndex: maxZIndex + 1
            };
            return {
                ...scene,
                elements: [
                    ...scene.elements,
                    newElement
                ]
            };
        });
    };
    const handleAddMediaAsset = (imageUrl, fileName)=>{
        if (!activeScene) return;
        if (!imageUrl) return;
        const newAsset = {
            id: `asset-${Date.now()}-${Math.random().toString(36).slice(2, 7)}`,
            label: fileName || `Медиа ${mediaAssets.length + 1}`,
            imageUrl,
            createdAt: Date.now()
        };
        setMediaAssets((prev)=>[
                ...prev,
                newAsset
            ]);
        addAssetToScene(activeScene.id, newAsset);
    };
    const handleAddExistingAssetToScene = (assetId)=>{
        if (!activeScene) return;
        const asset = mediaAssets.find((item)=>item.id === assetId);
        if (!asset) return;
        addAssetToScene(activeScene.id, asset);
    };
    const addAssetToSceneAtPosition = (sceneId, asset, x, y)=>{
        const canvasSize = CANVAS_SIZES[aspectRatio];
        handleSceneUpdate(sceneId, (scene)=>{
            const mediaIndex = scene.elements.filter((element)=>element.type === "media").length + 1;
            const elementWidth = canvasSize.width * 0.28;
            const elementHeight = canvasSize.height * 0.34;
            const maxElementZIndex = scene.elements.reduce((max, el)=>Math.max(max, el.zIndex ?? 0), 0);
            const maxZIndex = Math.max(maxElementZIndex, scene.avatarZIndex ?? 0);
            const newElement = {
                id: `media-${scene.id}-${mediaIndex}-${Date.now()}`,
                type: "media",
                label: asset.label,
                color: "#1fb6ff",
                width: elementWidth,
                height: elementHeight,
                x: Math.max(0, Math.min(canvasSize.width, x)),
                y: Math.max(0, Math.min(canvasSize.height, y)),
                imageUrl: asset.imageUrl,
                assetId: asset.id,
                zIndex: maxZIndex + 1
            };
            return {
                ...scene,
                elements: [
                    ...scene.elements,
                    newElement
                ]
            };
        });
    };
    const handleRemoveMediaAsset = (assetId)=>{
        setMediaAssets((prev)=>{
            const assetToRemove = prev.find((asset)=>asset.id === assetId);
            if (assetToRemove?.imageUrl?.startsWith("blob:")) {
                URL.revokeObjectURL(assetToRemove.imageUrl);
            }
            return prev.filter((asset)=>asset.id !== assetId);
        });
        setScenes((prevScenes)=>prevScenes.map((scene)=>({
                    ...scene,
                    elements: scene.elements.filter((element)=>element.assetId !== assetId)
                })));
    };
    const handleElementPositionChange = (elementId, coords)=>{
        if (!activeScene) return;
        handleSceneUpdate(activeScene.id, (scene)=>({
                ...scene,
                elements: scene.elements.map((element)=>element.id === elementId ? {
                        ...element,
                        ...coords
                    } : element)
            }));
    };
    const handleElementSizeChange = (elementId, size)=>{
        if (!activeScene) return;
        handleSceneUpdate(activeScene.id, (scene)=>({
                ...scene,
                elements: scene.elements.map((element)=>element.id === elementId ? {
                        ...element,
                        ...size
                    } : element)
            }));
    };
    const handleRemoveElement = (elementId)=>{
        if (!activeScene) return;
        handleSceneUpdate(activeScene.id, (scene)=>({
                ...scene,
                elements: scene.elements.filter((element)=>element.id !== elementId)
            }));
    };
    const handleReorderLayers = (newOrder)=>{
        if (!activeScene) return;
        handleSceneUpdate(activeScene.id, (scene)=>{
            // Первый в списке (index 0) = больший zIndex = выше на канве
            // Обновляем zIndex для всех элементов и аватара
            const updatedElements = scene.elements.map((element)=>{
                const index = newOrder.indexOf(element.id);
                // Первый элемент (index 0) получает zIndex = newOrder.length, последний получает 1
                const zIndex = index !== -1 ? newOrder.length - index : element.zIndex ?? 0;
                return {
                    ...element,
                    zIndex
                };
            });
            // Обновляем zIndex для аватара
            const avatarIndex = newOrder.indexOf("avatar");
            const avatarZIndex = avatarIndex !== -1 ? newOrder.length - avatarIndex : scene.avatarZIndex ?? 9999;
            return {
                ...scene,
                elements: updatedElements,
                avatarZIndex
            };
        });
    };
    const handleToggleAvatarLock = ()=>{
        if (!activeScene) return;
        handleSceneUpdate(activeScene.id, (scene)=>({
                ...scene,
                avatarLocked: !scene.avatarLocked
            }));
    };
    // Функция для выравнивания аватаров по первому слайду
    const handleAlignAvatars = ()=>{
        if (scenes.length === 0) return;
        const firstScene = scenes[0];
        if (!firstScene.avatarId || !firstScene.avatarPosition || !firstScene.avatarSize) {
            alert("В первом слайде должен быть аватар с заданными позицией и размером");
            return;
        }
        const referencePosition = firstScene.avatarPosition;
        const referenceSize = firstScene.avatarSize;
        // Применяем координаты и размер из первого слайда ко всем остальным
        setScenes((prev)=>prev.map((scene, index)=>{
                if (index === 0) return scene; // Первый слайд не трогаем
                if (!scene.avatarId) return scene; // Пропускаем слайды без аватара
                return {
                    ...scene,
                    avatarPosition: referencePosition,
                    avatarSize: referenceSize
                };
            }));
    };
    // Функция для получения оригинальных размеров изображения
    const getImageDimensions = (imageUrl)=>{
        return new Promise((resolve, reject)=>{
            // Используем window.Image чтобы избежать конфликта с импортом Image из Next.js
            const img = document.createElement("img");
            // Устанавливаем таймаут для загрузки
            const timeout = setTimeout(()=>{
                img.onload = null;
                img.onerror = null;
                reject(new Error(`Таймаут загрузки изображения: ${imageUrl}`));
            }, 15000); // 15 секунд таймаут
            img.onload = ()=>{
                clearTimeout(timeout);
                const width = img.naturalWidth || img.width;
                const height = img.naturalHeight || img.height;
                if (width > 0 && height > 0) {
                    console.log(`Размеры изображения получены: ${imageUrl} - ${width}x${height}`);
                    resolve({
                        width,
                        height
                    });
                } else {
                    reject(new Error(`Неверные размеры изображения: ${imageUrl}`));
                }
            };
            img.onerror = (error)=>{
                clearTimeout(timeout);
                console.error(`Ошибка загрузки изображения: ${imageUrl}`, error);
                reject(new Error(`Не удалось загрузить изображение: ${imageUrl}`));
            };
            // Устанавливаем src после настройки обработчиков
            img.src = imageUrl;
        });
    };
    // Функция для подготовки данных слайда для вебхука
    const prepareSlideData = async (scene, slideNumber)=>{
        const canvasSize = CANVAS_SIZES[aspectRatio];
        const slideData = {
            slide_number: slideNumber,
            canvas_size: {
                width: canvasSize.width,
                height: canvasSize.height
            },
            aspect_ratio: aspectRatio,
            script: scene.script,
            voice_id: scene.voiceId ? voices.find((v)=>v.id === scene.voiceId)?.voice_id ?? null : null,
            elements: []
        };
        // Обрабатываем аватар
        if (scene.avatarId && scene.avatarPosition && scene.avatarSize) {
            const avatar = avatars.find((a)=>a.id === scene.avatarId);
            if (avatar && avatar.photo) {
                console.log(`Загрузка размеров аватара для слайда ${slideNumber}: ${avatar.photo}`);
                try {
                    const originalDimensions = await getImageDimensions(avatar.photo);
                    console.log(`Размеры аватара получены для слайда ${slideNumber}:`, originalDimensions);
                    slideData.elements.push({
                        type: "avatar",
                        id: scene.avatarId,
                        position: {
                            x: scene.avatarPosition.x,
                            y: scene.avatarPosition.y
                        },
                        original_resolution: {
                            width: originalDimensions.width,
                            height: originalDimensions.height
                        },
                        canvas_resolution: {
                            width: scene.avatarSize.width,
                            height: scene.avatarSize.height
                        },
                        z_index: scene.avatarZIndex ?? 0,
                        image_url: avatar.photo,
                        hey_gen_id: avatar.hey_gen_id
                    });
                } catch (error) {
                    console.error(`Ошибка при получении размеров аватара для слайда ${slideNumber}:`, error);
                    console.error(`URL аватара: ${avatar.photo}`);
                    // Добавляем аватар без оригинальных размеров
                    slideData.elements.push({
                        type: "avatar",
                        id: scene.avatarId,
                        position: {
                            x: scene.avatarPosition.x,
                            y: scene.avatarPosition.y
                        },
                        original_resolution: null,
                        canvas_resolution: {
                            width: scene.avatarSize.width,
                            height: scene.avatarSize.height
                        },
                        z_index: scene.avatarZIndex ?? 0,
                        image_url: avatar.photo,
                        hey_gen_id: avatar.hey_gen_id
                    });
                }
            }
        }
        // Обрабатываем медиа элементы
        for (const element of scene.elements){
            if (element.type === "media" && element.imageUrl) {
                console.log(`Загрузка размеров медиа для слайда ${slideNumber}: ${element.imageUrl}`);
                try {
                    const originalDimensions = await getImageDimensions(element.imageUrl);
                    console.log(`Размеры медиа получены для слайда ${slideNumber}:`, originalDimensions);
                    slideData.elements.push({
                        type: "media",
                        id: element.id,
                        label: element.label,
                        position: {
                            x: element.x,
                            y: element.y
                        },
                        original_resolution: {
                            width: originalDimensions.width,
                            height: originalDimensions.height
                        },
                        canvas_resolution: {
                            width: element.width,
                            height: element.height
                        },
                        z_index: element.zIndex ?? 0,
                        image_url: element.imageUrl,
                        crop: element.crop || null
                    });
                } catch (error) {
                    console.error(`Ошибка при получении размеров медиа для слайда ${slideNumber}:`, error);
                    console.error(`URL медиа: ${element.imageUrl}`);
                    // Добавляем медиа без оригинальных размеров
                    slideData.elements.push({
                        type: "media",
                        id: element.id,
                        label: element.label,
                        position: {
                            x: element.x,
                            y: element.y
                        },
                        original_resolution: null,
                        canvas_resolution: {
                            width: element.width,
                            height: element.height
                        },
                        z_index: element.zIndex ?? 0,
                        image_url: element.imageUrl,
                        crop: element.crop || null
                    });
                }
            }
        }
        // Сортируем элементы по z_index (от меньшего к большему для правильного порядка слоев)
        slideData.elements.sort((a, b)=>a.z_index - b.z_index);
        return slideData;
    };
    // Функция для отправки вебхука с данными всех слайдов
    const handleGenerate = async ()=>{
        if (isGenerating) return;
        setIsGenerating(true);
        try {
            // Получаем UUID залогиненного пользователя
            const { data: { user } } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["supabase"].auth.getUser();
            const userUuid = user?.id;
            if (!userUuid) {
                alert("Не удалось определить пользователя, авторизуйтесь повторно.");
                setIsGenerating(false);
                return;
            }
            const slidesData = [];
            // Подготавливаем данные для каждого слайда
            for(let i = 0; i < scenes.length; i++){
                const scene = scenes[i];
                const slideNumberMatch = scene.title.match(/\d+/);
                const slideNumber = slideNumberMatch ? parseInt(slideNumberMatch[0], 10) : i + 1;
                const slideData = await prepareSlideData(scene, slideNumber);
                slidesData.push(slideData);
            }
            // Сохраняем данные в таблицу video_temp
            const saveResult = await CreateVideoTemp(videoTitle, slidesData, userUuid);
            if (!saveResult.success) {
                console.error("[MaterialEditor] Ошибка при сохранении в video_temp:", saveResult.error);
            // Не прерываем процесс, просто логируем ошибку
            } else {
                console.log("[MaterialEditor] Данные успешно сохранены в video_temp, ID:", saveResult.id);
            }
            // Отправляем вебхук
            const response = await fetch("https://rueleven.ru/webhook-test/2c6c697f-78cd-4eb2-bf01-2f00827b965d", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    video_title: videoTitle,
                    aspect_ratio: aspectRatio,
                    slides: slidesData,
                    uuid: userUuid
                })
            });
            if (!response.ok) {
                throw new Error(`Ошибка HTTP: ${response.status}`);
            }
            console.log("Вебхук успешно отправлен:", slidesData);
            alert("Генерация начата! Данные отправлены на сервер.");
        } catch (error) {
            console.error("Ошибка при отправке вебхука:", error);
            alert("Произошла ошибка при отправке данных. Проверьте консоль для подробностей.");
        } finally{
            setIsGenerating(false);
        }
    };
    // Проверяем, можно ли сгенерировать (для активного слайда)
    const canGenerate = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "MaterialEditor.useMemo[canGenerate]": ()=>{
            if (!activeScene) return false;
            // Проверяем, есть ли текст хотя бы на одном слайде
            const hasTextOnAnySlide = scenes.some({
                "MaterialEditor.useMemo[canGenerate].hasTextOnAnySlide": (scene)=>scene.script && scene.script.trim().length > 0
            }["MaterialEditor.useMemo[canGenerate].hasTextOnAnySlide"]);
            return !!(videoTitle.trim() && activeScene.avatarId && activeScene.voiceId && (activeScene.script.trim() || hasTextOnAnySlide));
        }
    }["MaterialEditor.useMemo[canGenerate]"], [
        activeScene,
        videoTitle,
        scenes
    ]);
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("section", {
        className: "flex h-screen w-full flex-col gap-4 px-4 pb-6 pt-4 sm:px-6 lg:gap-6 lg:pb-8",
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "flex items-center justify-between gap-4 pb-2",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                        type: "button",
                        onClick: async ()=>{
                            // Получаем UUID залогиненного пользователя
                            const { data: { user } } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["supabase"].auth.getUser();
                            const userUuid = user?.id || null;
                            // Отправляем вебхук для каждого слайда перед переходом назад
                            for(let i = 0; i < scenes.length; i++){
                                const scene = scenes[i];
                                if (!scene.voiceId) continue;
                                // Находим выбранный голос и получаем его voice_id из таблицы
                                const selectedVoice = voices.find((voice)=>voice.id === scene.voiceId);
                                if (!selectedVoice || !selectedVoice.voice_id) continue;
                                // Извлекаем номер слайда из title (например, "Слайд 1" -> 1)
                                const slideNumberMatch = scene.title.match(/\d+/);
                                const slideNumber = slideNumberMatch ? parseInt(slideNumberMatch[0], 10) : i + 1;
                                try {
                                    await fetch("https://rueleven.ru/webhook/8c42bae1-807d-40fa-b795-42897b4ec5b2", {
                                        method: "POST",
                                        headers: {
                                            "Content-Type": "application/json"
                                        },
                                        body: JSON.stringify({
                                            slide_number: slideNumber,
                                            voice_id: selectedVoice.voice_id,
                                            uuid: userUuid
                                        })
                                    });
                                    console.log(`Вебхук отправлен для слайда ${slideNumber}`);
                                } catch (error) {
                                    console.error(`Ошибка при отправке вебхука для слайда ${slideNumber}:`, error);
                                }
                            }
                            router.push("/material");
                        },
                        className: "flex items-center gap-2 rounded-xl border border-gray-200 bg-white px-4 py-2 text-sm font-semibold text-gray-900 transition hover:bg-gray-50",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                xmlns: "http://www.w3.org/2000/svg",
                                viewBox: "0 0 24 24",
                                fill: "none",
                                stroke: "currentColor",
                                strokeWidth: 2,
                                className: "h-5 w-5",
                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                    d: "M19 12H5M12 19l-7-7 7-7"
                                }, void 0, false, {
                                    fileName: "[project]/app/material/editor/components/MaterialEditor.tsx",
                                    lineNumber: 898,
                                    columnNumber: 13
                                }, this)
                            }, void 0, false, {
                                fileName: "[project]/app/material/editor/components/MaterialEditor.tsx",
                                lineNumber: 890,
                                columnNumber: 11
                            }, this),
                            "Назад"
                        ]
                    }, void 0, true, {
                        fileName: "[project]/app/material/editor/components/MaterialEditor.tsx",
                        lineNumber: 846,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                        type: "button",
                        onClick: handleGenerate,
                        disabled: !canGenerate || isGenerating,
                        className: `flex items-center gap-2 rounded-xl px-4 py-2 text-sm font-semibold text-white transition ${canGenerate && !isGenerating ? "bg-green-600 hover:bg-green-500" : "bg-gray-300 cursor-not-allowed"}`,
                        children: isGenerating ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                    className: "animate-spin h-5 w-5",
                                    xmlns: "http://www.w3.org/2000/svg",
                                    fill: "none",
                                    viewBox: "0 0 24 24",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("circle", {
                                            className: "opacity-25",
                                            cx: "12",
                                            cy: "12",
                                            r: "10",
                                            stroke: "currentColor",
                                            strokeWidth: "4"
                                        }, void 0, false, {
                                            fileName: "[project]/app/material/editor/components/MaterialEditor.tsx",
                                            lineNumber: 920,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                            className: "opacity-75",
                                            fill: "currentColor",
                                            d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                                        }, void 0, false, {
                                            fileName: "[project]/app/material/editor/components/MaterialEditor.tsx",
                                            lineNumber: 928,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/app/material/editor/components/MaterialEditor.tsx",
                                    lineNumber: 914,
                                    columnNumber: 15
                                }, this),
                                "Генерация..."
                            ]
                        }, void 0, true) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                    xmlns: "http://www.w3.org/2000/svg",
                                    viewBox: "0 0 24 24",
                                    fill: "none",
                                    stroke: "currentColor",
                                    strokeWidth: 2,
                                    className: "h-5 w-5",
                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                        d: "M5 12h14M12 5l7 7-7 7"
                                    }, void 0, false, {
                                        fileName: "[project]/app/material/editor/components/MaterialEditor.tsx",
                                        lineNumber: 946,
                                        columnNumber: 17
                                    }, this)
                                }, void 0, false, {
                                    fileName: "[project]/app/material/editor/components/MaterialEditor.tsx",
                                    lineNumber: 938,
                                    columnNumber: 15
                                }, this),
                                "Сгенерировать"
                            ]
                        }, void 0, true)
                    }, void 0, false, {
                        fileName: "[project]/app/material/editor/components/MaterialEditor.tsx",
                        lineNumber: 902,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/app/material/editor/components/MaterialEditor.tsx",
                lineNumber: 845,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "flex h-full min-h-0 flex-1 flex-col gap-4 lg:grid lg:grid-cols-[629px_minmax(0,1fr)] lg:items-stretch lg:gap-6",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "flex min-h-0 flex-1 flex-col lg:min-h-0 lg:h-full",
                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$EditorSidebar$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["EditorSidebar"], {
                            aspectRatio: aspectRatio,
                            onAspectRatioChange: (newRatio)=>{
                                // Конвертируем координаты всех элементов и аватара при изменении соотношения сторон
                                const oldRatio = aspectRatio;
                                setScenes((prevScenes)=>prevScenes.map((scene)=>{
                                        const updatedScene = {
                                            ...scene
                                        };
                                        // Конвертируем позицию и размер аватара
                                        if (updatedScene.avatarPosition && updatedScene.avatarSize) {
                                            updatedScene.avatarPosition = convertCoordinates(updatedScene.avatarPosition, oldRatio, newRatio);
                                            updatedScene.avatarSize = convertSize(updatedScene.avatarSize, oldRatio, newRatio);
                                        }
                                        // Конвертируем координаты всех элементов
                                        updatedScene.elements = updatedScene.elements.map((element)=>{
                                            const newPosition = convertCoordinates({
                                                x: element.x,
                                                y: element.y
                                            }, oldRatio, newRatio);
                                            const newSize = convertSize({
                                                width: element.width,
                                                height: element.height
                                            }, oldRatio, newRatio);
                                            return {
                                                ...element,
                                                x: newPosition.x,
                                                y: newPosition.y,
                                                width: newSize.width,
                                                height: newSize.height
                                            };
                                        });
                                        return updatedScene;
                                    }));
                                setAspectRatio(newRatio);
                            },
                            videoTitle: videoTitle,
                            onVideoTitleChange: setVideoTitle,
                            avatars: avatars,
                            isLoadingAvatars: isLoadingAvatars,
                            voices: voices,
                            isLoadingVoices: isLoadingVoices,
                            scenes: scenes,
                            activeSceneId: activeSceneId,
                            onSelectScene: setActiveSceneId,
                            onAddScene: handleAddScene,
                            onDeleteScene: handleDeleteScene,
                            onSceneVoiceChange: (sceneId, voiceId)=>{
                                handleSceneUpdate(sceneId, (scene)=>({
                                        ...scene,
                                        voiceId
                                    }));
                            },
                            onSceneScriptChange: (sceneId, script)=>{
                                handleSceneUpdate(sceneId, (scene)=>({
                                        ...scene,
                                        script
                                    }));
                            },
                            onSceneAvatarChange: (sceneId, avatarId)=>{
                                const scene = scenes.find((s)=>s.id === sceneId);
                                if (!scene) return;
                                if (avatarId && !scene.avatarPosition) {
                                    // При первом добавлении аватара устанавливаем начальную позицию и размер
                                    const initialSize = getInitialAvatarSize(aspectRatio);
                                    const canvasSize = CANVAS_SIZES[aspectRatio];
                                    const maxZIndex = Math.max(...scene.elements.map((el)=>el.zIndex ?? 0), 0);
                                    handleSceneUpdate(sceneId, (s)=>({
                                            ...s,
                                            avatarId,
                                            avatarPosition: {
                                                x: canvasSize.width / 2,
                                                y: canvasSize.height / 2
                                            },
                                            avatarSize: initialSize,
                                            avatarZIndex: maxZIndex + 1
                                        }));
                                } else {
                                    handleSceneUpdate(sceneId, (s)=>({
                                            ...s,
                                            avatarId
                                        }));
                                }
                            },
                            onRefreshAvatars: refreshAvatars,
                            onRefreshVoices: refreshVoices,
                            onApplyCreatedAvatar: (sceneId, avatarId)=>{
                                const scene = scenes.find((s)=>s.id === sceneId);
                                if (!scene) return;
                                // При применении созданного аватара устанавливаем начальную позицию и размер
                                const initialSize = getInitialAvatarSize(aspectRatio);
                                const canvasSize = CANVAS_SIZES[aspectRatio];
                                const maxZIndex = Math.max(...scene.elements.map((el)=>el.zIndex ?? 0), 0);
                                handleSceneUpdate(sceneId, (s)=>({
                                        ...s,
                                        avatarId,
                                        avatarPosition: {
                                            x: canvasSize.width / 2,
                                            y: canvasSize.height / 2
                                        },
                                        avatarSize: initialSize,
                                        avatarZIndex: maxZIndex + 1
                                    }));
                            }
                        }, void 0, false, {
                            fileName: "[project]/app/material/editor/components/MaterialEditor.tsx",
                            lineNumber: 955,
                            columnNumber: 11
                        }, this)
                    }, void 0, false, {
                        fileName: "[project]/app/material/editor/components/MaterialEditor.tsx",
                        lineNumber: 954,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "flex min-h-0 flex-1 flex-col gap-4",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "flex-1 min-h-0",
                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$CanvasArea$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["CanvasArea"], {
                                    aspectRatio: aspectRatio,
                                    elements: activeScene?.elements ?? [],
                                    avatar: activeScene?.avatarId ? avatars.find((a)=>a.id === activeScene.avatarId) ?? null : null,
                                    avatarPosition: activeScene?.avatarPosition ?? {
                                        x: CANVAS_SIZES[aspectRatio].width / 2,
                                        y: CANVAS_SIZES[aspectRatio].height / 2
                                    },
                                    avatarSize: activeScene?.avatarSize ?? getInitialAvatarSize(aspectRatio),
                                    avatarZIndex: activeScene?.avatarZIndex,
                                    avatarLocked: activeScene?.avatarLocked,
                                    onElementPositionChange: handleElementPositionChange,
                                    onElementSizeChange: handleElementSizeChange,
                                    onRemoveElement: handleRemoveElement,
                                    onReorderLayers: handleReorderLayers,
                                    onAvatarPositionChange: handleAvatarPositionChange,
                                    onAvatarSizeChange: handleAvatarSizeChange,
                                    onAlignAvatars: handleAlignAvatars,
                                    onAddMediaAsset: handleAddMediaAsset,
                                    mediaAssets: mediaAssets,
                                    onUseMediaAsset: handleAddExistingAssetToScene,
                                    onUseMediaAssetAtPosition: (assetId, x, y)=>{
                                        if (!activeScene) return;
                                        const asset = mediaAssets.find((item)=>item.id === assetId);
                                        if (!asset) return;
                                        addAssetToSceneAtPosition(activeScene.id, asset, x, y);
                                    },
                                    onRemoveMediaAsset: handleRemoveMediaAsset,
                                    onRemoveAvatar: handleRemoveAvatar,
                                    onToggleAvatarLock: handleToggleAvatarLock
                                }, void 0, false, {
                                    fileName: "[project]/app/material/editor/components/MaterialEditor.tsx",
                                    lineNumber: 1064,
                                    columnNumber: 13
                                }, this)
                            }, void 0, false, {
                                fileName: "[project]/app/material/editor/components/MaterialEditor.tsx",
                                lineNumber: 1063,
                                columnNumber: 11
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "min-h-[220px] lg:min-h-[240px]",
                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$Timeline$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Timeline"], {
                                    scenes: scenes,
                                    activeSceneId: activeSceneId,
                                    onSelectScene: setActiveSceneId,
                                    onAddScene: handleAddScene,
                                    avatars: avatars,
                                    aspectRatio: aspectRatio
                                }, void 0, false, {
                                    fileName: "[project]/app/material/editor/components/MaterialEditor.tsx",
                                    lineNumber: 1103,
                                    columnNumber: 13
                                }, this)
                            }, void 0, false, {
                                fileName: "[project]/app/material/editor/components/MaterialEditor.tsx",
                                lineNumber: 1102,
                                columnNumber: 11
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/app/material/editor/components/MaterialEditor.tsx",
                        lineNumber: 1062,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/app/material/editor/components/MaterialEditor.tsx",
                lineNumber: 953,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/app/material/editor/components/MaterialEditor.tsx",
        lineNumber: 844,
        columnNumber: 5
    }, this);
}
_s(MaterialEditor, "NrYla3tp5aQe1Ggq9l1D5kXoM4M=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRouter"],
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useSearchParams"]
    ];
});
_c = MaterialEditor;
var _c;
__turbopack_context__.k.register(_c, "MaterialEditor");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/app/material/editor/page.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>MaterialEditorPage
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/navigation.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/supabaseClient.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$MaterialEditor$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/app/material/editor/components/MaterialEditor.tsx [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
;
function MaterialEditorWrapper() {
    _s();
    const router = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRouter"])();
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "MaterialEditorWrapper.useEffect": ()=>{
            const checkAuth = {
                "MaterialEditorWrapper.useEffect.checkAuth": async ()=>{
                    const { data: { user } } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabaseClient$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["supabase"].auth.getUser();
                    if (!user) {
                        router.push("/login");
                    }
                }
            }["MaterialEditorWrapper.useEffect.checkAuth"];
            checkAuth();
        }
    }["MaterialEditorWrapper.useEffect"], [
        router
    ]);
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "min-h-screen bg-white",
        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$app$2f$material$2f$editor$2f$components$2f$MaterialEditor$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["MaterialEditor"], {}, void 0, false, {
            fileName: "[project]/app/material/editor/page.tsx",
            lineNumber: 27,
            columnNumber: 7
        }, this)
    }, void 0, false, {
        fileName: "[project]/app/material/editor/page.tsx",
        lineNumber: 26,
        columnNumber: 5
    }, this);
}
_s(MaterialEditorWrapper, "vQduR7x+OPXj6PSmJyFnf+hU7bg=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRouter"]
    ];
});
_c = MaterialEditorWrapper;
function MaterialEditorPage() {
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Suspense"], {
        fallback: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
            className: "flex min-h-screen items-center justify-center",
            children: "Загрузка..."
        }, void 0, false, {
            fileName: "[project]/app/material/editor/page.tsx",
            lineNumber: 34,
            columnNumber: 25
        }, void 0),
        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(MaterialEditorWrapper, {}, void 0, false, {
            fileName: "[project]/app/material/editor/page.tsx",
            lineNumber: 35,
            columnNumber: 7
        }, this)
    }, void 0, false, {
        fileName: "[project]/app/material/editor/page.tsx",
        lineNumber: 34,
        columnNumber: 5
    }, this);
}
_c1 = MaterialEditorPage;
var _c, _c1;
__turbopack_context__.k.register(_c, "MaterialEditorWrapper");
__turbopack_context__.k.register(_c1, "MaterialEditorPage");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
]);

//# sourceMappingURL=_d6f7ba0b._.js.map
{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextResponse, type NextRequest } from \"next/server\";\n\nconst PROTECTED_ROUTES = [\"/\", \"/avatars\", \"/voices\", \"/material\"];\nconst AUTH_COOKIE_NAME = \"app-auth\";\n\nfunction isProtectedRoute(pathname: string) {\n  // Главная страница должна быть точно \"/\", а не начинаться с \"/\"\n  if (pathname === \"/\") {\n    return true;\n  }\n  // Проверяем защищенные маршруты и их подмаршруты (например, /material/editor)\n  return PROTECTED_ROUTES.some((route) => route !== \"/\" && pathname.startsWith(route));\n}\n\nfunction isAuthenticated(request: NextRequest) {\n  const cookies = request.cookies.getAll();\n\n  const hasSupabaseToken = cookies.some((cookie) =>\n    cookie.name.includes(\"auth-token\"),\n  );\n\n  const hasCustomAuthCookie = Boolean(\n    cookies.find((cookie) => cookie.name === AUTH_COOKIE_NAME)?.value,\n  );\n\n  return hasSupabaseToken || hasCustomAuthCookie;\n}\n\nexport async function middleware(request: NextRequest) {\n  const { pathname } = request.nextUrl;\n  const authenticated = isAuthenticated(request);\n\n  if (!authenticated && isProtectedRoute(pathname)) {\n    return NextResponse.redirect(new URL(\"/login\", request.url));\n  }\n\n  if (authenticated && pathname === \"/login\") {\n    return NextResponse.redirect(new URL(\"/\", request.url));\n  }\n\n  return NextResponse.next();\n}\n\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except for the ones starting with:\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     * - public folder\n     */\n    \"/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)\",\n  ],\n};\n\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAEA,MAAM,mBAAmB;IAAC;IAAK;IAAY;IAAW;CAAY;AAClE,MAAM,mBAAmB;AAEzB,SAAS,iBAAiB,QAAgB;IACxC,gEAAgE;IAChE,IAAI,aAAa,KAAK;QACpB,OAAO;IACT;IACA,8EAA8E;IAC9E,OAAO,iBAAiB,IAAI,CAAC,CAAC,QAAU,UAAU,OAAO,SAAS,UAAU,CAAC;AAC/E;AAEA,SAAS,gBAAgB,OAAoB;IAC3C,MAAM,UAAU,QAAQ,OAAO,CAAC,MAAM;IAEtC,MAAM,mBAAmB,QAAQ,IAAI,CAAC,CAAC,SACrC,OAAO,IAAI,CAAC,QAAQ,CAAC;IAGvB,MAAM,sBAAsB,QAC1B,QAAQ,IAAI,CAAC,CAAC,SAAW,OAAO,IAAI,KAAK,mBAAmB;IAG9D,OAAO,oBAAoB;AAC7B;AAEO,eAAe,WAAW,OAAoB;IACnD,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IACpC,MAAM,gBAAgB,gBAAgB;IAEtC,IAAI,CAAC,iBAAiB,iBAAiB,WAAW;QAChD,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;IAC5D;IAEA,IAAI,iBAAiB,aAAa,UAAU;QAC1C,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;IACvD;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;KAMC,GACD;KACD;AACH"}}]
}
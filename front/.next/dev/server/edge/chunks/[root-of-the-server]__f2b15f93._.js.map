{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextResponse, type NextRequest } from \"next/server\";\n\nconst AUTH_COOKIE_NAME = \"app-auth\";\nconst LOGIN_ROUTE = \"/login\";\n\nfunction isLoginRoute(pathname: string) {\n  return pathname === LOGIN_ROUTE;\n}\n\nfunction isAuthenticated(request: NextRequest) {\n  const cookies = request.cookies.getAll();\n\n  // Проверяем наличие Supabase токена (обычно это cookie с именем содержащим \"auth-token\")\n  const supabaseTokenCookie = cookies.find((cookie) =>\n    cookie.name.includes(\"auth-token\"),\n  );\n  const hasSupabaseToken = Boolean(\n    supabaseTokenCookie?.value && supabaseTokenCookie.value.trim() !== \"\",\n  );\n\n  // Проверяем наличие кастомной auth cookie\n  const customAuthCookie = cookies.find(\n    (cookie) => cookie.name === AUTH_COOKIE_NAME,\n  );\n  const hasCustomAuthCookie = Boolean(\n    customAuthCookie?.value && customAuthCookie.value.trim() !== \"\",\n  );\n\n  // Пользователь авторизован только если есть хотя бы один валидный токен\n  return hasSupabaseToken || hasCustomAuthCookie;\n}\n\nexport async function middleware(request: NextRequest) {\n  const { pathname } = request.nextUrl;\n  const authenticated = isAuthenticated(request);\n\n  // Если пользователь не авторизован и пытается зайти на любую страницу кроме логина\n  if (!authenticated && !isLoginRoute(pathname)) {\n    return NextResponse.redirect(new URL(LOGIN_ROUTE, request.url));\n  }\n\n  // Если пользователь авторизован и пытается зайти на страницу логина\n  if (authenticated && isLoginRoute(pathname)) {\n    return NextResponse.redirect(new URL(\"/\", request.url));\n  }\n\n  return NextResponse.next();\n}\n\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except for the ones starting with:\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     * - public folder\n     */\n    \"/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)\",\n  ],\n};\n\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAEA,MAAM,mBAAmB;AACzB,MAAM,cAAc;AAEpB,SAAS,aAAa,QAAgB;IACpC,OAAO,aAAa;AACtB;AAEA,SAAS,gBAAgB,OAAoB;IAC3C,MAAM,UAAU,QAAQ,OAAO,CAAC,MAAM;IAEtC,yFAAyF;IACzF,MAAM,sBAAsB,QAAQ,IAAI,CAAC,CAAC,SACxC,OAAO,IAAI,CAAC,QAAQ,CAAC;IAEvB,MAAM,mBAAmB,QACvB,qBAAqB,SAAS,oBAAoB,KAAK,CAAC,IAAI,OAAO;IAGrE,0CAA0C;IAC1C,MAAM,mBAAmB,QAAQ,IAAI,CACnC,CAAC,SAAW,OAAO,IAAI,KAAK;IAE9B,MAAM,sBAAsB,QAC1B,kBAAkB,SAAS,iBAAiB,KAAK,CAAC,IAAI,OAAO;IAG/D,wEAAwE;IACxE,OAAO,oBAAoB;AAC7B;AAEO,eAAe,WAAW,OAAoB;IACnD,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IACpC,MAAM,gBAAgB,gBAAgB;IAEtC,mFAAmF;IACnF,IAAI,CAAC,iBAAiB,CAAC,aAAa,WAAW;QAC7C,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,aAAa,QAAQ,GAAG;IAC/D;IAEA,oEAAoE;IACpE,IAAI,iBAAiB,aAAa,WAAW;QAC3C,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;IACvD;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;KAMC,GACD;KACD;AACH"}}]
}
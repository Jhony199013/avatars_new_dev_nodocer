{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/lib/supabaseClient.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || \"\";\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || \"\";\n\n// Создаем клиент только если переменные окружения установлены\n// Во время сборки может не быть переменных окружения\nexport const supabase = supabaseUrl && supabaseAnonKey\n  ? createClient(supabaseUrl, supabaseAnonKey)\n  : createClient(\"https://placeholder.supabase.co\", \"placeholder-key\");\n\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,gEAAwC;AAC5D,MAAM,kBAAkB,iNAA6C;AAI9D,MAAM,WAAW,uCACpB,IAAA,uMAAY,EAAC,aAAa,mBAC1B"}},
    {"offset": {"line": 41, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/%28main%29/components/Toast.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect } from \"react\";\r\n\r\ninterface ToastProps {\r\n  message: string;\r\n  isVisible: boolean;\r\n  onClose: () => void;\r\n  type?: \"error\" | \"success\";\r\n}\r\n\r\nexport function Toast({\r\n  message,\r\n  isVisible,\r\n  onClose,\r\n  type = \"error\",\r\n}: ToastProps) {\r\n  useEffect(() => {\r\n    if (!isVisible) return;\r\n\r\n    const timer = setTimeout(onClose, 5000);\r\n    return () => clearTimeout(timer);\r\n  }, [isVisible, onClose]);\r\n\r\n  if (!isVisible || !message) {\r\n    return null;\r\n  }\r\n\r\n  const baseStyles =\r\n    \"fixed bottom-6 right-6 z-50 flex max-w-sm items-start gap-3 rounded-lg border px-4 py-3 shadow-lg animate-slide-in-right\";\r\n  const typeStyles =\r\n    type === \"error\"\r\n      ? \"border-red-200 bg-red-50 text-red-800\"\r\n      : \"border-green-200 bg-green-50 text-green-800\";\r\n\r\n  return (\r\n    <div className={`${baseStyles} ${typeStyles}`}>\r\n      <div className=\"flex-1 text-sm font-medium\">{message}</div>\r\n      <button\r\n        type=\"button\"\r\n        onClick={onClose}\r\n        className=\"text-gray-400 transition hover:text-gray-600\"\r\n        aria-label=\"Закрыть уведомление\"\r\n      >\r\n        <svg\r\n          className=\"h-4 w-4\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n            strokeWidth={2}\r\n            d=\"M6 18L18 6M6 6l12 12\"\r\n          />\r\n        </svg>\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAWO,SAAS,MAAM,EACpB,OAAO,EACP,SAAS,EACT,OAAO,EACP,OAAO,OAAO,EACH;IACX,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,WAAW;QAEhB,MAAM,QAAQ,WAAW,SAAS;QAClC,OAAO,IAAM,aAAa;IAC5B,GAAG;QAAC;QAAW;KAAQ;IAEvB,IAAI,CAAC,aAAa,CAAC,SAAS;QAC1B,OAAO;IACT;IAEA,MAAM,aACJ;IACF,MAAM,aACJ,SAAS,UACL,0CACA;IAEN,qBACE,8OAAC;QAAI,WAAW,GAAG,WAAW,CAAC,EAAE,YAAY;;0BAC3C,8OAAC;gBAAI,WAAU;0BAA8B;;;;;;0BAC7C,8OAAC;gBACC,MAAK;gBACL,SAAS;gBACT,WAAU;gBACV,cAAW;0BAEX,cAAA,8OAAC;oBACC,WAAU;oBACV,MAAK;oBACL,QAAO;oBACP,SAAQ;8BAER,cAAA,8OAAC;wBACC,eAAc;wBACd,gBAAe;wBACf,aAAa;wBACb,GAAE;;;;;;;;;;;;;;;;;;;;;;AAMd"}},
    {"offset": {"line": 116, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/%28main%29/components/errorTranslations.ts"],"sourcesContent":["const translations = [\r\n  {\r\n    matchers: [\r\n      \"invalid login credentials\",\r\n      \"invalid credentials\",\r\n      \"invalid email or password\",\r\n    ],\r\n    message: \"Неверный email или пароль\",\r\n  },\r\n  {\r\n    matchers: [\"email not confirmed\", \"email confirmation required\"],\r\n    message: \"Email не подтверждён. Проверьте почту.\",\r\n  },\r\n  {\r\n    matchers: [\"user not found\"],\r\n    message: \"Пользователь не найден.\",\r\n  },\r\n  {\r\n    matchers: [\"user already registered\", \"already registered\", \"email already\"],\r\n    message: \"Пользователь с таким email уже зарегистрирован.\",\r\n  },\r\n  {\r\n    matchers: [\"password too short\", \"at least 8 characters\", \"minimum length\"],\r\n    message: \"Пароль слишком короткий. Минимум 8 символов.\",\r\n  },\r\n  {\r\n    matchers: [\"weak password\"],\r\n    message: \"Пароль слишком слабый.\",\r\n  },\r\n  {\r\n    matchers: [\"invalid email\", \"malformed email\"],\r\n    message: \"Некорректный email адрес.\",\r\n  },\r\n  {\r\n    matchers: [\"network error\", \"fetch error\"],\r\n    message: \"Ошибка сети. Проверьте подключение к интернету.\",\r\n  },\r\n  {\r\n    matchers: [\"rate limit\", \"too many requests\"],\r\n    message: \"Слишком много запросов. Попробуйте позже.\",\r\n  },\r\n  {\r\n    matchers: [\"server error\", \"internal error\"],\r\n    message: \"Ошибка сервера. Попробуйте позже.\",\r\n  },\r\n];\r\n\r\nexport function translateError(message: string) {\r\n  if (!message) {\r\n    return \"Произошла ошибка. Попробуйте ещё раз.\";\r\n  }\r\n\r\n  const normalized = message.toLowerCase();\r\n  const matched = translations.find(({ matchers }) =>\r\n    matchers.some((matcher) => normalized.includes(matcher)),\r\n  );\r\n\r\n  return matched ? matched.message : message;\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA,MAAM,eAAe;IACnB;QACE,UAAU;YACR;YACA;YACA;SACD;QACD,SAAS;IACX;IACA;QACE,UAAU;YAAC;YAAuB;SAA8B;QAChE,SAAS;IACX;IACA;QACE,UAAU;YAAC;SAAiB;QAC5B,SAAS;IACX;IACA;QACE,UAAU;YAAC;YAA2B;YAAsB;SAAgB;QAC5E,SAAS;IACX;IACA;QACE,UAAU;YAAC;YAAsB;YAAyB;SAAiB;QAC3E,SAAS;IACX;IACA;QACE,UAAU;YAAC;SAAgB;QAC3B,SAAS;IACX;IACA;QACE,UAAU;YAAC;YAAiB;SAAkB;QAC9C,SAAS;IACX;IACA;QACE,UAAU;YAAC;YAAiB;SAAc;QAC1C,SAAS;IACX;IACA;QACE,UAAU;YAAC;YAAc;SAAoB;QAC7C,SAAS;IACX;IACA;QACE,UAAU;YAAC;YAAgB;SAAiB;QAC5C,SAAS;IACX;CACD;AAEM,SAAS,eAAe,OAAe;IAC5C,IAAI,CAAC,SAAS;QACZ,OAAO;IACT;IAEA,MAAM,aAAa,QAAQ,WAAW;IACtC,MAAM,UAAU,aAAa,IAAI,CAAC,CAAC,EAAE,QAAQ,EAAE,GAC7C,SAAS,IAAI,CAAC,CAAC,UAAY,WAAW,QAAQ,CAAC;IAGjD,OAAO,UAAU,QAAQ,OAAO,GAAG;AACrC"}},
    {"offset": {"line": 205, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/%28main%29/components/AuthCard.tsx"],"sourcesContent":["\"use client\";\n\nimport { useMemo, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { supabase } from \"@/lib/supabaseClient\";\nimport { Toast } from \"./Toast\";\nimport { translateError } from \"./errorTranslations\";\n\ntype Mode = \"login\" | \"register\";\n\nconst passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*[^A-Za-z0-9]).{8,}$/;\n\nexport function AuthCard() {\n  const router = useRouter();\n  const [mode, setMode] = useState<Mode>(\"login\");\n  const [loading, setLoading] = useState(false);\n  const [toastMessage, setToastMessage] = useState<string | null>(null);\n  const [isToastVisible, setIsToastVisible] = useState(false);\n  const [toastType, setToastType] = useState<\"error\" | \"success\">(\"error\");\n  const [form, setForm] = useState({\n    email: \"\",\n    password: \"\",\n    confirmPassword: \"\",\n    firstName: \"\",\n    lastName: \"\",\n    company: \"\",\n    phone: \"\",\n  });\n\n  const showErrorToast = (message: string) => {\n    setToastMessage(message);\n    setToastType(\"error\");\n    setIsToastVisible(true);\n  };\n\n  const showSuccessToast = (message: string) => {\n    setToastMessage(message);\n    setToastType(\"success\");\n    setIsToastVisible(true);\n  };\n\n  const handleChange = (field: keyof typeof form, value: string) => {\n    if (field === \"phone\") {\n      const digits = value.replace(/\\D/g, \"\").slice(0, 10);\n      let masked = \"\";\n      if (digits.length > 0) {\n        masked = \"+7(\";\n        masked += digits.slice(0, 3);\n        if (digits.length >= 3) masked += \")\";\n        if (digits.length > 3) masked += digits.slice(3, 6);\n        if (digits.length >= 6) masked += \"-\";\n        if (digits.length > 6) masked += digits.slice(6, 8);\n        if (digits.length >= 8) masked += \"-\";\n        if (digits.length > 8) masked += digits.slice(8, 10);\n      }\n      setForm((prev) => ({ ...prev, phone: masked }));\n    } else {\n      setForm((prev) => ({ ...prev, [field]: value }));\n    }\n  };\n\n  const toggleMode = () => {\n    setMode((prev) => (prev === \"login\" ? \"register\" : \"login\"));\n    setIsToastVisible(false);\n  };\n\n  const canSubmit = useMemo(() => {\n    if (loading) return false;\n    if (mode === \"login\") {\n      return Boolean(form.email && form.password);\n    }\n    return (\n      Boolean(form.email && form.password && form.confirmPassword) &&\n      passwordRegex.test(form.password) &&\n      form.password === form.confirmPassword\n    );\n  }, [form, mode, loading]);\n\n  const handleSubmit = async (event: React.FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    setIsToastVisible(false);\n\n    if (mode === \"register\") {\n      if (form.password !== form.confirmPassword) {\n        showErrorToast(\"Пароли не совпадают\");\n        return;\n      }\n      if (!passwordRegex.test(form.password)) {\n        showErrorToast(\n          \"Пароль: ≥8 символов, минимум одна заглавная, одна строчная и один спецсимвол\",\n        );\n        return;\n      }\n    }\n\n    setLoading(true);\n    try {\n      if (mode === \"login\") {\n        const { error: signInError } = await supabase.auth.signInWithPassword({\n          email: form.email,\n          password: form.password,\n        });\n        if (signInError) throw signInError;\n        showSuccessToast(\"Вход выполнен успешно\");\n      } else {\n        const { data: signUpData, error: signUpError } = await supabase.auth.signUp({\n          email: form.email,\n          password: form.password,\n          options: {\n            data: {\n              firstName: form.firstName || null,\n              lastName: form.lastName || null,\n              company: form.company || null,\n              phone: form.phone || null,\n            },\n          },\n        });\n        if (signUpError) throw signUpError;\n        \n        // Отправляем вебхук с UUID пользователя после успешной регистрации\n        if (signUpData?.user?.id) {\n          try {\n            await fetch(\"https://rueleven.ru/webhook/373bb6fa-8fae-49fd-83b6-b503e7f286c4\", {\n              method: \"POST\",\n              headers: {\n                \"Content-Type\": \"application/json\",\n              },\n              body: JSON.stringify({ uuid: signUpData.user.id }),\n            });\n          } catch (webhookError) {\n            // Логируем ошибку вебхука, но не прерываем процесс регистрации\n            console.error(\"[AuthCard] Ошибка отправки вебхука регистрации:\", webhookError);\n          }\n        }\n        \n        showSuccessToast(\"Регистрация выполнена успешно\");\n      }\n\n      document.cookie = \"app-auth=1; path=/; max-age=604800\";\n\n      router.push(\"/\");\n    } catch (err) {\n      const message =\n        typeof err === \"object\" && err && \"message\" in err\n          ? String((err as { message?: string }).message)\n          : \"Не удалось выполнить запрос\";\n      showErrorToast(translateError(message));\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <>\n      <div className=\"mx-auto mt-16 w-full max-w-md rounded-3xl border border-black/10 bg-white p-8 shadow-2xl\">\n        <h1 className=\"mb-6 text-center text-2xl font-semibold text-black\">\n          {mode === \"login\" ? \"Вход в сервис\" : \"Регистрация\"}\n        </h1>\n\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          {mode === \"register\" && (\n            <>\n              <input\n                type=\"text\"\n                placeholder=\"Имя\"\n                value={form.firstName}\n                onChange={(event) =>\n                  handleChange(\"firstName\", event.currentTarget.value)\n                }\n                className=\"w-full rounded-xl border border-black/15 bg-white px-4 py-3 text-black outline-none transition focus:border-black\"\n              />\n              <input\n                type=\"text\"\n                placeholder=\"Фамилия (необязательно)\"\n                value={form.lastName}\n                onChange={(event) =>\n                  handleChange(\"lastName\", event.currentTarget.value)\n                }\n                className=\"w-full rounded-xl border border-black/15 bg-white px-4 py-3 text-black outline-none transition focus:border-black\"\n              />\n              <input\n                type=\"text\"\n                placeholder=\"Компания (необязательно)\"\n                value={form.company}\n                onChange={(event) =>\n                  handleChange(\"company\", event.currentTarget.value)\n                }\n                className=\"w-full rounded-xl border border-black/15 bg-white px-4 py-3 text-black outline-none transition focus:border-black\"\n              />\n              <input\n                type=\"tel\"\n                placeholder=\"+7(XXX)XXX-XX-XX\"\n                value={form.phone}\n                onChange={(event) =>\n                  handleChange(\"phone\", event.currentTarget.value)\n                }\n                className=\"w-full rounded-xl border border-black/15 bg-white px-4 py-3 text-black outline-none transition focus:border-black\"\n              />\n            </>\n          )}\n\n          <input\n            type=\"email\"\n            placeholder=\"E-mail\"\n            value={form.email}\n            onChange={(event) =>\n              handleChange(\"email\", event.currentTarget.value)\n            }\n            required\n            className=\"w-full rounded-xl border border-black/15 bg-white px-4 py-3 text-black outline-none transition focus:border-black\"\n          />\n\n          <input\n            type=\"password\"\n            placeholder=\"Пароль\"\n            value={form.password}\n            onChange={(event) =>\n              handleChange(\"password\", event.currentTarget.value)\n            }\n            required\n            className=\"w-full rounded-xl border border-black/15 bg-white px-4 py-3 text-black outline-none transition focus:border-black\"\n          />\n\n          {mode === \"register\" && (\n            <input\n              type=\"password\"\n              placeholder=\"Подтвердите пароль\"\n              value={form.confirmPassword}\n              onChange={(event) =>\n                handleChange(\"confirmPassword\", event.currentTarget.value)\n              }\n              required\n              className=\"w-full rounded-xl border border-black/15 bg-white px-4 py-3 text-black outline-none transition focus:border-black\"\n            />\n          )}\n\n          <button\n            type=\"submit\"\n            disabled={!canSubmit}\n            className=\"w-full rounded-xl bg-black px-4 py-3 font-semibold text-white transition hover:bg-black/90 disabled:cursor-not-allowed disabled:opacity-40\"\n          >\n          {loading\n            ? mode === \"login\"\n              ? \"Выполняем вход...\"\n              : \"Создаём аккаунт...\"\n            : mode === \"login\"\n            ? \"Войти\"\n            : \"Зарегистрироваться\"}\n          </button>\n        </form>\n\n        <div className=\"mt-4 text-center text-sm text-black\">\n          {mode === \"login\" ? (\n            <button\n              type=\"button\"\n              onClick={toggleMode}\n              className=\"font-medium underline-offset-4 hover:underline\"\n            >\n              Нет аккаунта? Зарегистрироваться\n            </button>\n          ) : (\n            <button\n              type=\"button\"\n              onClick={toggleMode}\n              className=\"font-medium underline-offset-4 hover:underline\"\n            >\n              Уже есть аккаунт? Войти\n            </button>\n          )}\n        </div>\n      </div>\n\n      <Toast\n        message={toastMessage || \"\"}\n        isVisible={isToastVisible}\n        onClose={() => setIsToastVisible(false)}\n        type={toastType}\n      />\n    </>\n  );\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 519, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/components/ui/LogoutModal.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { supabase } from \"@/lib/supabaseClient\";\n\ninterface LogoutModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport function LogoutModal({ isOpen, onClose }: LogoutModalProps) {\n  const router = useRouter();\n  const [isLoggingOut, setIsLoggingOut] = useState(false);\n\n  const handleLogout = async () => {\n    setIsLoggingOut(true);\n    try {\n      await supabase.auth.signOut();\n      document.cookie =\n        \"app-auth=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT\";\n      router.push(\"/\");\n      onClose();\n    } catch (error) {\n      console.error(\"Ошибка при выходе:\", error);\n    } finally {\n      setIsLoggingOut(false);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\">\n      <div className=\"mx-4 w-full max-w-md rounded-2xl bg-white p-6 shadow-2xl\">\n        <h2 className=\"mb-4 text-xl font-semibold text-gray-900\">Выход</h2>\n        <p className=\"mb-6 text-gray-600\">Вы действительно хотите выйти из аккаунта?</p>\n        <div className=\"flex gap-3\">\n          <button\n            type=\"button\"\n            onClick={onClose}\n            disabled={isLoggingOut}\n            className=\"flex-1 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-semibold text-gray-700 transition hover:bg-gray-50 disabled:opacity-50\"\n          >\n            Отмена\n          </button>\n          <button\n            type=\"button\"\n            onClick={handleLogout}\n            disabled={isLoggingOut}\n            className=\"flex-1 rounded-lg bg-gray-900 px-4 py-2 text-sm font-semibold text-white transition hover:bg-gray-800 disabled:opacity-50\"\n          >\n            {isLoggingOut ? \"Выходим...\" : \"Выйти\"}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAWO,SAAS,YAAY,EAAE,MAAM,EAAE,OAAO,EAAoB;IAC/D,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAC;IAEjD,MAAM,eAAe;QACnB,gBAAgB;QAChB,IAAI;YACF,MAAM,iIAAQ,CAAC,IAAI,CAAC,OAAO;YAC3B,SAAS,MAAM,GACb;YACF,OAAO,IAAI,CAAC;YACZ;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,sBAAsB;QACtC,SAAU;YACR,gBAAgB;QAClB;IACF;IAEA,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAG,WAAU;8BAA2C;;;;;;8BACzD,8OAAC;oBAAE,WAAU;8BAAqB;;;;;;8BAClC,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BACC,MAAK;4BACL,SAAS;4BACT,UAAU;4BACV,WAAU;sCACX;;;;;;sCAGD,8OAAC;4BACC,MAAK;4BACL,SAAS;4BACT,UAAU;4BACV,WAAU;sCAET,eAAe,eAAe;;;;;;;;;;;;;;;;;;;;;;;AAM3C"}},
    {"offset": {"line": 617, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/lib/prefetchAvatars.ts"],"sourcesContent":["import { supabase } from \"./supabaseClient\";\nimport type { PhotoAvatarRow } from \"@/app/avatars/servers/UploadAvatar\";\n\n// Кеш для prefetch данных\nlet prefetchCache: {\n  data: PhotoAvatarRow[] | null;\n  timestamp: number;\n  userId: string | null;\n} = {\n  data: null,\n  timestamp: 0,\n  userId: null,\n};\n\nconst CACHE_DURATION = 30000; // 30 секунд\n\nexport async function prefetchAvatarsData(): Promise<void> {\n  try {\n    // Проверяем кеш\n    const now = Date.now();\n    if (\n      prefetchCache.data &&\n      prefetchCache.userId &&\n      now - prefetchCache.timestamp < CACHE_DURATION\n    ) {\n      return; // Данные уже в кеше и свежие\n    }\n\n    // Получаем пользователя\n    const {\n      data: { user },\n    } = await supabase.auth.getUser();\n\n    if (!user) {\n      return;\n    }\n\n    // Проверяем, не загружаем ли мы те же данные\n    if (prefetchCache.userId === user.id && now - prefetchCache.timestamp < CACHE_DURATION) {\n      return;\n    }\n\n    // Загружаем данные в фоне\n    const { data, error } = await supabase\n      .from(\"photo_avatars\")\n      .select(\"*\")\n      .eq(\"uid\", user.id)\n      .order(\"created_at\", { ascending: false });\n\n    if (!error && data) {\n      prefetchCache = {\n        data,\n        timestamp: now,\n        userId: user.id,\n      };\n    }\n  } catch (error) {\n    // Игнорируем ошибки prefetch - это не критично\n    console.debug(\"[prefetch] Ошибка prefetch аватаров:\", error);\n  }\n}\n\nexport function getPrefetchedAvatars(): PhotoAvatarRow[] | null {\n  const now = Date.now();\n  if (\n    prefetchCache.data &&\n    now - prefetchCache.timestamp < CACHE_DURATION\n  ) {\n    return prefetchCache.data;\n  }\n  return null;\n}\n\nexport function clearPrefetchCache(): void {\n  prefetchCache = {\n    data: null,\n    timestamp: 0,\n    userId: null,\n  };\n}\n\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAGA,0BAA0B;AAC1B,IAAI,gBAIA;IACF,MAAM;IACN,WAAW;IACX,QAAQ;AACV;AAEA,MAAM,iBAAiB,OAAO,YAAY;AAEnC,eAAe;IACpB,IAAI;QACF,gBAAgB;QAChB,MAAM,MAAM,KAAK,GAAG;QACpB,IACE,cAAc,IAAI,IAClB,cAAc,MAAM,IACpB,MAAM,cAAc,SAAS,GAAG,gBAChC;YACA,QAAQ,6BAA6B;QACvC;QAEA,wBAAwB;QACxB,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,iIAAQ,CAAC,IAAI,CAAC,OAAO;QAE/B,IAAI,CAAC,MAAM;YACT;QACF;QAEA,6CAA6C;QAC7C,IAAI,cAAc,MAAM,KAAK,KAAK,EAAE,IAAI,MAAM,cAAc,SAAS,GAAG,gBAAgB;YACtF;QACF;QAEA,0BAA0B;QAC1B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,iIAAQ,CACnC,IAAI,CAAC,iBACL,MAAM,CAAC,KACP,EAAE,CAAC,OAAO,KAAK,EAAE,EACjB,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM;QAE1C,IAAI,CAAC,SAAS,MAAM;YAClB,gBAAgB;gBACd;gBACA,WAAW;gBACX,QAAQ,KAAK,EAAE;YACjB;QACF;IACF,EAAE,OAAO,OAAO;QACd,+CAA+C;QAC/C,QAAQ,KAAK,CAAC,wCAAwC;IACxD;AACF;AAEO,SAAS;IACd,MAAM,MAAM,KAAK,GAAG;IACpB,IACE,cAAc,IAAI,IAClB,MAAM,cAAc,SAAS,GAAG,gBAChC;QACA,OAAO,cAAc,IAAI;IAC3B;IACA,OAAO;AACT;AAEO,SAAS;IACd,gBAAgB;QACd,MAAM;QACN,WAAW;QACX,QAAQ;IACV;AACF"}},
    {"offset": {"line": 684, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/components/ui/Header.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\nimport { LogoutModal } from \"./LogoutModal\";\nimport { prefetchAvatarsData } from \"@/lib/prefetchAvatars\";\n\nconst navLinks = [\n  { href: \"/\", label: \"Главная\" },\n  { href: \"/avatars\", label: \"Аватары\" },\n  { href: \"/voices\", label: \"Голоса\" },\n  { href: \"/material\", label: \"Материал\" },\n];\n\nexport function Header() {\n  const pathname = usePathname();\n  const [isLogoutModalOpen, setIsLogoutModalOpen] = useState(false);\n\n  return (\n    <>\n      <header className=\"h-16 w-full bg-white shadow-lg\">\n        <div className=\"mx-auto flex h-full w-full max-w-[1350px] items-center px-6\">\n          <nav className=\"flex flex-1 items-center gap-8\">\n            {navLinks.map(({ href, label }) => {\n              const isActive = pathname === href;\n              const handleMouseEnter = () => {\n                // Prefetch данные для страницы аватаров при наведении\n                if (href === \"/avatars\" && !isActive) {\n                  prefetchAvatarsData();\n                }\n              };\n              \n              return (\n                <Link\n                  key={href}\n                  href={href}\n                  onMouseEnter={handleMouseEnter}\n                  prefetch={true}\n                  className={`text-lg font-semibold transition ${\n                    isActive\n                      ? \"text-gray-900\"\n                      : \"text-gray-500 hover:text-gray-800\"\n                  }`}\n                >\n                  {label}\n                </Link>\n              );\n            })}\n          </nav>\n          <div className=\"flex flex-none justify-end\">\n            <button\n              type=\"button\"\n              onClick={() => setIsLogoutModalOpen(true)}\n              className=\"rounded-lg bg-gray-900 px-4 py-2 text-sm font-semibold text-white transition hover:bg-gray-800\"\n            >\n              Выйти\n            </button>\n          </div>\n        </div>\n      </header>\n      <LogoutModal\n        isOpen={isLogoutModalOpen}\n        onClose={() => setIsLogoutModalOpen(false)}\n      />\n    </>\n  );\n}\n\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AANA;;;;;;;AAQA,MAAM,WAAW;IACf;QAAE,MAAM;QAAK,OAAO;IAAU;IAC9B;QAAE,MAAM;QAAY,OAAO;IAAU;IACrC;QAAE,MAAM;QAAW,OAAO;IAAS;IACnC;QAAE,MAAM;QAAa,OAAO;IAAW;CACxC;AAEM,SAAS;IACd,MAAM,WAAW,IAAA,iJAAW;IAC5B,MAAM,CAAC,mBAAmB,qBAAqB,GAAG,IAAA,iNAAQ,EAAC;IAE3D,qBACE;;0BACE,8OAAC;gBAAO,WAAU;0BAChB,cAAA,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAI,WAAU;sCACZ,SAAS,GAAG,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE;gCAC5B,MAAM,WAAW,aAAa;gCAC9B,MAAM,mBAAmB;oCACvB,sDAAsD;oCACtD,IAAI,SAAS,cAAc,CAAC,UAAU;wCACpC,IAAA,6IAAmB;oCACrB;gCACF;gCAEA,qBACE,8OAAC,uKAAI;oCAEH,MAAM;oCACN,cAAc;oCACd,UAAU;oCACV,WAAW,CAAC,iCAAiC,EAC3C,WACI,kBACA,qCACJ;8CAED;mCAVI;;;;;4BAaX;;;;;;sCAEF,8OAAC;4BAAI,WAAU;sCACb,cAAA,8OAAC;gCACC,MAAK;gCACL,SAAS,IAAM,qBAAqB;gCACpC,WAAU;0CACX;;;;;;;;;;;;;;;;;;;;;;0BAMP,8OAAC,+IAAW;gBACV,QAAQ;gBACR,SAAS,IAAM,qBAAqB;;;;;;;;AAI5C"}},
    {"offset": {"line": 799, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/components/ui/CosmoLoader.tsx"],"sourcesContent":["type CosmoLoaderProps = {\r\n  ariaLabel?: string;\r\n};\r\n\r\nexport function CosmoLoader({ ariaLabel = \"Загрузка...\" }: CosmoLoaderProps) {\r\n  return (\r\n    <div className=\"flex flex-col items-center\" role=\"status\" aria-live=\"polite\">\r\n      <div className=\"relative flex items-center justify-center\">\r\n        <div\r\n          className=\"h-10 w-10 animate-spin rounded-full border-[3px] border-transparent shadow-[0_0_18px_rgba(255,192,76,0.55)]\"\r\n          style={{\r\n            borderTopColor: \"#FFB347\",\r\n            borderRightColor: \"#FFC94C\",\r\n          }}\r\n        />\r\n        <div className=\"absolute h-3 w-3 rounded-full bg-[#FFB347] opacity-70 blur-sm\" />\r\n      </div>\r\n      <span className=\"sr-only\">{ariaLabel}</span>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;AAIO,SAAS,YAAY,EAAE,YAAY,aAAa,EAAoB;IACzE,qBACE,8OAAC;QAAI,WAAU;QAA6B,MAAK;QAAS,aAAU;;0BAClE,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBACC,WAAU;wBACV,OAAO;4BACL,gBAAgB;4BAChB,kBAAkB;wBACpB;;;;;;kCAEF,8OAAC;wBAAI,WAAU;;;;;;;;;;;;0BAEjB,8OAAC;gBAAK,WAAU;0BAAW;;;;;;;;;;;;AAGjC"}},
    {"offset": {"line": 857, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/avatars/servers/DeletePhotoAvatar.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { createClient } from \"@supabase/supabase-js\";\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\r\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\r\nconst heygenApiKey = process.env.HEYGEN_API_KEY;\r\n\r\nif (!supabaseUrl) {\r\n  throw new Error(\"NEXT_PUBLIC_SUPABASE_URL не задан\");\r\n}\r\n\r\nif (!supabaseServiceRoleKey) {\r\n  throw new Error(\"SUPABASE_SERVICE_ROLE_KEY не задан\");\r\n}\r\n\r\nconst supabaseAdmin = createClient(supabaseUrl, supabaseServiceRoleKey);\r\n\r\ninterface DeletePhotoAvatarInput {\r\n  uid: string;\r\n  recordId?: string | null;\r\n  groupId?: string | null;\r\n  imageKey?: string | null;\r\n}\r\n\r\ninterface DeletePhotoAvatarResult {\r\n  success: boolean;\r\n  error?: string;\r\n}\r\n\r\nasync function deleteFromHeygen(groupId?: string | null) {\r\n  if (!groupId) {\r\n    return;\r\n  }\r\n\r\n  if (!heygenApiKey) {\r\n    throw new Error(\"HEYGEN_API_KEY не задан\");\r\n  }\r\n\r\n  const response = await fetch(\r\n    `https://api.heygen.com/v2/photo_avatar_group/${groupId}`,\r\n    {\r\n      method: \"DELETE\",\r\n      headers: {\r\n        \"X-Api-Key\": heygenApiKey,\r\n      },\r\n    }\r\n  );\r\n\r\n  if (!response.ok && response.status !== 404) {\r\n    const message = await response.text();\r\n    throw new Error(\r\n      `Не удалось удалить аватар в HeyGen: ${message || response.statusText}`\r\n    );\r\n  }\r\n}\r\n\r\nexport async function DeletePhotoAvatar({\r\n  uid,\r\n  recordId,\r\n  groupId,\r\n  imageKey,\r\n}: DeletePhotoAvatarInput): Promise<DeletePhotoAvatarResult> {\r\n  try {\r\n    if (!uid) {\r\n      return { success: false, error: \"Пользователь не найден\" };\r\n    }\r\n\r\n    if (!recordId && !groupId && !imageKey) {\r\n      return { success: false, error: \"Нет идентификатора записи\" };\r\n    }\r\n\r\n    await deleteFromHeygen(groupId);\r\n\r\n    let query = supabaseAdmin.from(\"photo_avatars\").delete().eq(\"uid\", uid);\r\n\r\n    if (recordId) {\r\n      query = query.eq(\"id\", recordId);\r\n    } else if (groupId) {\r\n      query = query.eq(\"group_id\", groupId);\r\n    } else if (imageKey) {\r\n      query = query.eq(\"image_key\", imageKey);\r\n    }\r\n\r\n    const { error } = await query;\r\n\r\n    if (error) {\r\n      throw new Error(error.message);\r\n    }\r\n\r\n    return { success: true };\r\n  } catch (error) {\r\n    const message =\r\n      error instanceof Error ? error.message : \"Неизвестная ошибка\";\r\n    console.error(\"[DeletePhotoAvatar]\", message);\r\n    return { success: false, error: message };\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":[],"mappings":";;;;;;;IAyDsB,oBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 869, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/avatars/servers/UpdateAvatarName.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { createClient } from \"@supabase/supabase-js\";\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\r\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\r\n\r\nif (!supabaseUrl) {\r\n  throw new Error(\"NEXT_PUBLIC_SUPABASE_URL не задан\");\r\n}\r\n\r\nif (!supabaseServiceRoleKey) {\r\n  throw new Error(\"SUPABASE_SERVICE_ROLE_KEY не задан\");\r\n}\r\n\r\nconst supabaseAdmin = createClient(supabaseUrl, supabaseServiceRoleKey);\r\n\r\ninterface UpdateAvatarNameInput {\r\n  uid: string;\r\n  recordId: string;\r\n  newName: string;\r\n}\r\n\r\ninterface UpdateAvatarNameResult {\r\n  success: boolean;\r\n  error?: string;\r\n}\r\n\r\nexport async function UpdateAvatarName({\r\n  uid,\r\n  recordId,\r\n  newName,\r\n}: UpdateAvatarNameInput): Promise<UpdateAvatarNameResult> {\r\n  try {\r\n    if (!uid) {\r\n      return { success: false, error: \"Пользователь не найден\" };\r\n    }\r\n\r\n    if (!recordId) {\r\n      return { success: false, error: \"ID записи не указан\" };\r\n    }\r\n\r\n    if (!newName || !newName.trim()) {\r\n      return { success: false, error: \"Имя не может быть пустым\" };\r\n    }\r\n\r\n    const trimmedName = newName.trim();\r\n\r\n    const { error } = await supabaseAdmin\r\n      .from(\"photo_avatars\")\r\n      .update({ name: trimmedName })\r\n      .eq(\"id\", recordId)\r\n      .eq(\"uid\", uid);\r\n\r\n    if (error) {\r\n      throw new Error(error.message);\r\n    }\r\n\r\n    return { success: true };\r\n  } catch (error) {\r\n    const message =\r\n      error instanceof Error ? error.message : \"Неизвестная ошибка\";\r\n    console.error(\"[UpdateAvatarName]\", message);\r\n    return { success: false, error: message };\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n"],"names":[],"mappings":";;;;;;;IA4BsB,mBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 881, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/avatars/components/DeleteAvatarModal.tsx"],"sourcesContent":["\"use client\";\r\n\r\ninterface DeleteAvatarModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onConfirm: () => void | Promise<void>;\r\n  avatarName: string;\r\n  isDeleting?: boolean;\r\n}\r\n\r\nexport function DeleteAvatarModal({\r\n  isOpen,\r\n  onClose,\r\n  onConfirm,\r\n  avatarName,\r\n  isDeleting = false,\r\n}: DeleteAvatarModalProps) {\r\n  if (!isOpen) return null;\r\n\r\n  const handleConfirm = async () => {\r\n    await onConfirm();\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\">\r\n      <div className=\"mx-4 w-full max-w-md rounded-2xl bg-white p-6 shadow-2xl\">\r\n        <h2 className=\"mb-4 text-xl font-semibold text-gray-900\">\r\n          Удаление аватара\r\n        </h2>\r\n        <p className=\"mb-6 text-gray-600\">\r\n          Вы действительно хотите удалить аватар «{avatarName}»?\r\n        </p>\r\n        <div className=\"flex gap-3\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={onClose}\r\n            disabled={isDeleting}\r\n            className=\"flex-1 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-semibold text-gray-700 transition hover:bg-gray-50 disabled:opacity-50\"\r\n          >\r\n            Отмена\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={handleConfirm}\r\n            disabled={isDeleting}\r\n            className=\"flex-1 rounded-lg bg-red-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-red-700 disabled:opacity-50\"\r\n          >\r\n            {isDeleting ? \"Удаляем...\" : \"Удалить\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;AAAA;;AAUO,SAAS,kBAAkB,EAChC,MAAM,EACN,OAAO,EACP,SAAS,EACT,UAAU,EACV,aAAa,KAAK,EACK;IACvB,IAAI,CAAC,QAAQ,OAAO;IAEpB,MAAM,gBAAgB;QACpB,MAAM;IACR;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAG,WAAU;8BAA2C;;;;;;8BAGzD,8OAAC;oBAAE,WAAU;;wBAAqB;wBACS;wBAAW;;;;;;;8BAEtD,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BACC,MAAK;4BACL,SAAS;4BACT,UAAU;4BACV,WAAU;sCACX;;;;;;sCAGD,8OAAC;4BACC,MAAK;4BACL,SAAS;4BACT,UAAU;4BACV,WAAU;sCAET,aAAa,eAAe;;;;;;;;;;;;;;;;;;;;;;;AAMzC"}},
    {"offset": {"line": 965, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/avatars/components/EditAvatarModal.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\n\ninterface EditAvatarModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onConfirm: (newName: string) => void | Promise<void>;\n  currentName: string;\n  isSaving?: boolean;\n}\n\nexport function EditAvatarModal({\n  isOpen,\n  onClose,\n  onConfirm,\n  currentName,\n  isSaving = false,\n}: EditAvatarModalProps) {\n  const [newName, setNewName] = useState(currentName);\n\n  useEffect(() => {\n    if (isOpen) {\n      setNewName(currentName);\n    }\n  }, [isOpen, currentName]);\n\n  if (!isOpen) return null;\n\n  const handleConfirm = async () => {\n    if (!newName.trim()) {\n      return;\n    }\n    await onConfirm(newName.trim());\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === \"Enter\" && !isSaving && newName.trim()) {\n      handleConfirm();\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\">\n      <div className=\"mx-4 w-full max-w-md rounded-2xl bg-white p-6 shadow-2xl\">\n        <h2 className=\"mb-4 text-xl font-semibold text-gray-900\">\n          Редактировать имя\n        </h2>\n        <input\n          type=\"text\"\n          value={newName}\n          onChange={(e) => setNewName(e.target.value)}\n          onKeyDown={handleKeyDown}\n          disabled={isSaving}\n          placeholder=\"Введите новое имя\"\n          className=\"mb-6 w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-base text-gray-900 outline-none transition focus:border-gray-400 disabled:opacity-50\"\n          autoFocus\n        />\n        <div className=\"flex gap-3\">\n          <button\n            type=\"button\"\n            onClick={onClose}\n            disabled={isSaving}\n            className=\"flex-1 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-semibold text-gray-700 transition hover:bg-gray-50 disabled:opacity-50\"\n          >\n            Отмена\n          </button>\n          <button\n            type=\"button\"\n            onClick={handleConfirm}\n            disabled={isSaving || !newName.trim()}\n            className=\"flex-1 rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-blue-700 disabled:opacity-50\"\n          >\n            {isSaving ? \"Сохраняем...\" : \"Сохранить\"}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAYO,SAAS,gBAAgB,EAC9B,MAAM,EACN,OAAO,EACP,SAAS,EACT,WAAW,EACX,WAAW,KAAK,EACK;IACrB,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,IAAA,kNAAS,EAAC;QACR,IAAI,QAAQ;YACV,WAAW;QACb;IACF,GAAG;QAAC;QAAQ;KAAY;IAExB,IAAI,CAAC,QAAQ,OAAO;IAEpB,MAAM,gBAAgB;QACpB,IAAI,CAAC,QAAQ,IAAI,IAAI;YACnB;QACF;QACA,MAAM,UAAU,QAAQ,IAAI;IAC9B;IAEA,MAAM,gBAAgB,CAAC;QACrB,IAAI,EAAE,GAAG,KAAK,WAAW,CAAC,YAAY,QAAQ,IAAI,IAAI;YACpD;QACF;IACF;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAG,WAAU;8BAA2C;;;;;;8BAGzD,8OAAC;oBACC,MAAK;oBACL,OAAO;oBACP,UAAU,CAAC,IAAM,WAAW,EAAE,MAAM,CAAC,KAAK;oBAC1C,WAAW;oBACX,UAAU;oBACV,aAAY;oBACZ,WAAU;oBACV,SAAS;;;;;;8BAEX,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BACC,MAAK;4BACL,SAAS;4BACT,UAAU;4BACV,WAAU;sCACX;;;;;;sCAGD,8OAAC;4BACC,MAAK;4BACL,SAAS;4BACT,UAAU,YAAY,CAAC,QAAQ,IAAI;4BACnC,WAAU;sCAET,WAAW,iBAAiB;;;;;;;;;;;;;;;;;;;;;;;AAMzC"}},
    {"offset": {"line": 1070, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/%28main%29/components/DashboardAvatarCard.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport Image from \"next/image\";\r\nimport { useState, useRef, useEffect } from \"react\";\r\nimport type { PhotoAvatarRow } from \"@/app/avatars/servers/UploadAvatar\";\r\nimport { DeletePhotoAvatar } from \"@/app/avatars/servers/DeletePhotoAvatar\";\r\nimport { UpdateAvatarName } from \"@/app/avatars/servers/UpdateAvatarName\";\r\nimport { DeleteAvatarModal } from \"@/app/avatars/components/DeleteAvatarModal\";\r\nimport { EditAvatarModal } from \"@/app/avatars/components/EditAvatarModal\";\r\n\r\ninterface DashboardAvatarCardProps {\r\n  avatar: PhotoAvatarRow;\r\n  currentUserId: string | null;\r\n  onAvatarChanged?: () => void | Promise<void>;\r\n}\r\n\r\nexport function DashboardAvatarCard({\r\n  avatar,\r\n  currentUserId,\r\n  onAvatarChanged,\r\n}: DashboardAvatarCardProps) {\r\n  const [deletingId, setDeletingId] = useState(false);\r\n  const [editingId, setEditingId] = useState(false);\r\n  const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);\r\n  const [isEditModalOpen, setIsEditModalOpen] = useState(false);\r\n  const [openMenu, setOpenMenu] = useState(false);\r\n  const [hovered, setHovered] = useState(false);\r\n  const menuRef = useRef<HTMLDivElement | null>(null);\r\n  const closeMenuTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  const key =\r\n    avatar.id ??\r\n    avatar.hey_gen_id ??\r\n    avatar.group_id ??\r\n    `${avatar.uid}-${avatar.image_key}`;\r\n\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (openMenu && menuRef.current && !menuRef.current.contains(event.target as Node)) {\r\n        setOpenMenu(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener(\"mousedown\", handleClickOutside);\r\n    };\r\n  }, [openMenu]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (closeMenuTimeoutRef.current) {\r\n        clearTimeout(closeMenuTimeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const handleMenuClick = (event: React.MouseEvent) => {\r\n    event.stopPropagation();\r\n    setOpenMenu(!openMenu);\r\n  };\r\n\r\n  const handleEditClick = () => {\r\n    setOpenMenu(false);\r\n    setIsEditModalOpen(true);\r\n  };\r\n\r\n  const handleDeleteClick = () => {\r\n    setOpenMenu(false);\r\n    if (!currentUserId) {\r\n      alert(\"Не удалось определить пользователя\");\r\n      return;\r\n    }\r\n    setIsDeleteModalOpen(true);\r\n  };\r\n\r\n  const handleEditConfirm = async (newName: string) => {\r\n    if (!currentUserId || !avatar.id) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setEditingId(true);\r\n      const result = await UpdateAvatarName({\r\n        uid: currentUserId,\r\n        recordId: avatar.id,\r\n        newName,\r\n      });\r\n\r\n      if (!result.success) {\r\n        throw new Error(result.error || \"Не удалось обновить имя\");\r\n      }\r\n\r\n      setIsEditModalOpen(false);\r\n      await onAvatarChanged?.();\r\n    } catch (error) {\r\n      console.error(\"[DashboardAvatarCard] Ошибка редактирования:\", error);\r\n      alert(\r\n        `Ошибка при редактировании: ${\r\n          error instanceof Error ? error.message : \"Неизвестная ошибка\"\r\n        }`\r\n      );\r\n    } finally {\r\n      setEditingId(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteConfirm = async () => {\r\n    if (!currentUserId) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setDeletingId(true);\r\n      const result = await DeletePhotoAvatar({\r\n        uid: currentUserId,\r\n        recordId: avatar.id ?? null,\r\n        groupId: avatar.group_id ?? avatar.hey_gen_id ?? null,\r\n        imageKey: avatar.image_key,\r\n      });\r\n\r\n      if (!result.success) {\r\n        throw new Error(result.error || \"Не удалось удалить аватар\");\r\n      }\r\n\r\n      setIsDeleteModalOpen(false);\r\n      await onAvatarChanged?.();\r\n    } catch (error) {\r\n      console.error(\"[DashboardAvatarCard] Ошибка удаления:\", error);\r\n      alert(\r\n        `Ошибка при удалении: ${\r\n          error instanceof Error ? error.message : \"Неизвестная ошибка\"\r\n        }`\r\n      );\r\n    } finally {\r\n      setDeletingId(false);\r\n    }\r\n  };\r\n\r\n  const showMenuButton = hovered || openMenu;\r\n\r\n  return (\r\n    <>\r\n      <article\r\n        className=\"group relative rounded-3xl border border-gray-100 bg-white p-4 shadow-sm ring-1 ring-black/5 transition-all duration-300 hover:-translate-y-2 hover:shadow-lg\"\r\n        onMouseLeave={() => {\r\n          setHovered(false);\r\n          if (closeMenuTimeoutRef.current) {\r\n            clearTimeout(closeMenuTimeoutRef.current);\r\n          }\r\n          closeMenuTimeoutRef.current = setTimeout(() => {\r\n            if (openMenu) {\r\n              setOpenMenu(false);\r\n            }\r\n          }, 500);\r\n        }}\r\n        onMouseEnter={() => {\r\n          setHovered(true);\r\n          if (closeMenuTimeoutRef.current) {\r\n            clearTimeout(closeMenuTimeoutRef.current);\r\n            closeMenuTimeoutRef.current = null;\r\n          }\r\n        }}\r\n      >\r\n        <p className=\"mb-3 text-center text-lg font-semibold text-gray-900 line-clamp-2\">\r\n          {avatar.name}\r\n        </p>\r\n        <div className=\"relative aspect-[3/4] w-full overflow-hidden rounded-2xl\">\r\n          <Image\r\n            src={avatar.photo}\r\n            alt={`Фото аватара ${avatar.name}`}\r\n            fill\r\n            sizes=\"(min-width: 1280px) 16vw, (min-width: 1024px) 33vw, (min-width: 640px) 50vw, 100vw\"\r\n            className=\"object-contain\"\r\n            unoptimized\r\n          />\r\n          <div className=\"absolute right-3 top-3\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={handleMenuClick}\r\n              className={`flex h-8 w-8 items-center justify-center rounded-full bg-white/90 text-gray-600 shadow-md transition-all duration-200 hover:bg-white hover:text-gray-900 ${\r\n                showMenuButton ? \"opacity-100\" : \"opacity-0\"\r\n              }`}\r\n              aria-label=\"Меню\"\r\n            >\r\n              <svg\r\n                xmlns=\"http://www.w3.org/2000/svg\"\r\n                viewBox=\"0 0 24 24\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                strokeWidth={2.5}\r\n                className=\"h-4 w-4\"\r\n              >\r\n                <circle cx=\"5\" cy=\"12\" r=\"1.5\" />\r\n                <circle cx=\"12\" cy=\"12\" r=\"1.5\" />\r\n                <circle cx=\"19\" cy=\"12\" r=\"1.5\" />\r\n              </svg>\r\n            </button>\r\n            {openMenu && (\r\n              <div\r\n                ref={menuRef}\r\n                className=\"absolute right-0 top-10 z-50 min-w-[160px] rounded-lg border border-gray-200 bg-white shadow-lg\"\r\n              >\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={handleEditClick}\r\n                  disabled={editingId || deletingId}\r\n                  className=\"w-full rounded-t-lg px-4 py-2 text-left text-sm text-gray-700 transition hover:bg-gray-50 disabled:opacity-50\"\r\n                >\r\n                  Редактировать\r\n                </button>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={handleDeleteClick}\r\n                  disabled={editingId || deletingId}\r\n                  className=\"w-full rounded-b-lg px-4 py-2 text-left text-sm text-red-600 transition hover:bg-red-50 disabled:opacity-50\"\r\n                >\r\n                  Удалить\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n        {avatar.created_at && (\r\n          <p className=\"mt-3 text-center text-xs text-gray-400\">\r\n            {new Intl.DateTimeFormat(\"ru-RU\", {\r\n              dateStyle: \"medium\",\r\n              timeStyle: \"short\",\r\n            }).format(new Date(avatar.created_at))}\r\n          </p>\r\n        )}\r\n      </article>\r\n      <DeleteAvatarModal\r\n        isOpen={isDeleteModalOpen}\r\n        onClose={() => setIsDeleteModalOpen(false)}\r\n        onConfirm={handleDeleteConfirm}\r\n        avatarName={avatar.name}\r\n        isDeleting={deletingId}\r\n      />\r\n      <EditAvatarModal\r\n        isOpen={isEditModalOpen}\r\n        onClose={() => setIsEditModalOpen(false)}\r\n        onConfirm={handleEditConfirm}\r\n        currentName={avatar.name}\r\n        isSaving={editingId}\r\n      />\r\n    </>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1373, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/avatars/servers/UploadAvatar.ts"],"sourcesContent":["\"use server\";\n\nimport { Buffer } from \"buffer\";\nimport { createClient } from \"@supabase/supabase-js\";\n\nexport interface PhotoAvatarRow {\n  id?: string;\n  uid: string;\n  name: string;\n  photo: string;\n  image_key: string;\n  hey_gen_id: string | null;\n  group_id: string | null;\n  status: \"done\" | \"error\";\n  created_at?: string;\n}\n\ninterface UploadAvatarSuccess {\n  success: true;\n  avatar: PhotoAvatarRow;\n}\n\ninterface UploadAvatarFailure {\n  success: false;\n  error: string;\n}\n\ntype UploadAvatarResult = UploadAvatarSuccess | UploadAvatarFailure;\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\nconst heygenApiKey = process.env.HEYGEN_API_KEY;\n\nif (!supabaseUrl) {\n  throw new Error(\"NEXT_PUBLIC_SUPABASE_URL не задан\");\n}\n\nif (!supabaseServiceRoleKey) {\n  throw new Error(\"SUPABASE_SERVICE_ROLE_KEY не задан\");\n}\n\nconst supabaseAdmin = createClient(supabaseUrl, supabaseServiceRoleKey);\n\nasync function uploadPhotoToHeygen(file: File) {\n  if (!heygenApiKey) {\n    throw new Error(\"HEYGEN_API_KEY не задан\");\n  }\n\n  const buffer = Buffer.from(await file.arrayBuffer());\n  const response = await fetch(\"https://upload.heygen.com/v1/asset\", {\n    method: \"POST\",\n    headers: {\n      \"X-Api-Key\": heygenApiKey,\n      \"Content-Type\": file.type || \"application/octet-stream\",\n    },\n    body: buffer,\n  });\n\n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(\n      `Ошибка загрузки фото: ${errorText || response.statusText}`\n    );\n  }\n\n  const json = await response.json();\n  const payload = Array.isArray(json) ? json[0] : json;\n  const data = payload?.data;\n\n  if (!data?.image_key || !data?.url) {\n    throw new Error(\"Некорректный ответ Heygen при загрузке фото\");\n  }\n\n  return {\n    imageKey: data.image_key as string,\n    photoUrl: data.url as string,\n  };\n}\n\nasync function createPhotoAvatarInHeygen(name: string, imageKey: string) {\n  if (!heygenApiKey) {\n    throw new Error(\"HEYGEN_API_KEY не задан\");\n  }\n\n  const response = await fetch(\n    \"https://api.heygen.com/v2/photo_avatar/avatar_group/create\",\n    {\n      method: \"POST\",\n      headers: {\n        \"X-Api-Key\": heygenApiKey,\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        name,\n        image_key: imageKey,\n      }),\n    }\n  );\n\n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(\n      `Ошибка создания фото-аватара: ${errorText || response.statusText}`\n    );\n  }\n\n  const json = await response.json();\n  const payload = Array.isArray(json) ? json[0] : json;\n\n  return {\n    error: payload?.error ?? null,\n    data: payload?.data ?? null,\n  };\n}\n\nexport async function UploadAvatar(formData: FormData): Promise<UploadAvatarResult> {\n  try {\n    const uid = formData.get(\"uid\");\n    const name = formData.get(\"avatar_name\");\n    const file = formData.get(\"photo\");\n\n    if (typeof uid !== \"string\" || !uid) {\n      return { success: false, error: \"Не удалось определить пользователя\" };\n    }\n\n    if (typeof name !== \"string\" || !name.trim()) {\n      return { success: false, error: \"Введите имя аватара\" };\n    }\n\n    if (!(file instanceof File)) {\n      return { success: false, error: \"Файл не найден\" };\n    }\n\n    const trimmedName = name.trim();\n\n    const { imageKey, photoUrl } = await uploadPhotoToHeygen(file);\n    const createResult = await createPhotoAvatarInHeygen(\n      trimmedName,\n      imageKey\n    );\n\n    const status: \"done\" | \"error\" = createResult.error ? \"error\" : \"done\";\n    const record: PhotoAvatarRow = {\n      uid,\n      name: trimmedName,\n      photo: photoUrl,\n      image_key: imageKey,\n      hey_gen_id: createResult.data?.id ?? null,\n      group_id:\n        createResult.data?.group_id ??\n        createResult.data?.id ??\n        createResult.data?.group ??\n        null,\n      status,\n    };\n\n    const { data, error } = await supabaseAdmin\n      .from(\"photo_avatars\")\n      .insert(record)\n      .select()\n      .single();\n\n    if (error) {\n      throw new Error(error.message);\n    }\n\n    return { success: true, avatar: data as PhotoAvatarRow };\n  } catch (error) {\n    const message =\n      error instanceof Error ? error.message : \"Неизвестная ошибка сервера\";\n    console.error(\"[UploadAvatar]\", message);\n    return { success: false, error: message };\n  }\n}\n\n"],"names":[],"mappings":";;;;;;;IAmHsB,eAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 1385, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/avatars/components/AvatarUploadModal.tsx"],"sourcesContent":["\"use client\";\n\nimport Image from \"next/image\";\nimport { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { supabase } from \"@/lib/supabaseClient\";\nimport { UploadAvatar } from \"../servers/UploadAvatar\";\n\ninterface AvatarUploadModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onAvatarUploaded?: () => void | Promise<void>;\n}\n\nconst MAX_FILE_SIZE = 10 * 1024 * 1024;\nconst ALLOWED_TYPES = [\"image/jpeg\", \"image/jpg\", \"image/png\"];\n\nconst sleep = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms));\n\nexport function AvatarUploadModal({\n  isOpen,\n  onClose,\n  onAvatarUploaded,\n}: AvatarUploadModalProps) {\n  const [avatarName, setAvatarName] = useState(\"\");\n  const [dragActive, setDragActive] = useState(false);\n  const [selectedFiles, setSelectedFiles] = useState<File[]>([]);\n  const [previewUrls, setPreviewUrls] = useState<string[]>([]);\n  const [isUploading, setIsUploading] = useState(false);\n  const [progress, setProgress] = useState(0);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const progressIntervalRef = useRef<ReturnType<typeof setInterval> | null>(\n    null\n  );\n  const isMountedRef = useRef(true);\n\n  const stopProgressLoop = useCallback(() => {\n    if (progressIntervalRef.current) {\n      clearInterval(progressIntervalRef.current);\n      progressIntervalRef.current = null;\n    }\n  }, []);\n\n  const startProgressLoop = useCallback(() => {\n    stopProgressLoop();\n    const startTime = Date.now();\n    progressIntervalRef.current = setInterval(() => {\n      setProgress((prev) => {\n        const elapsed = Date.now() - startTime;\n        const nextValue = Math.min(90, (elapsed / 20000) * 90);\n        return nextValue > prev ? nextValue : prev;\n      });\n    }, 200);\n  }, [stopProgressLoop]);\n\n  useEffect(() => {\n    return () => {\n      previewUrls.forEach((url) => URL.revokeObjectURL(url));\n    };\n  }, [previewUrls]);\n\n  useEffect(() => {\n    return () => {\n      isMountedRef.current = false;\n      stopProgressLoop();\n    };\n  }, [stopProgressLoop]);\n\n  const resetState = useCallback(() => {\n    setAvatarName(\"\");\n    setSelectedFiles([]);\n    previewUrls.forEach((url) => URL.revokeObjectURL(url));\n    setPreviewUrls([]);\n    setProgress(0);\n    stopProgressLoop();\n  }, [previewUrls, stopProgressLoop]);\n\n  const closeModal = useCallback(() => {\n    resetState();\n    onClose();\n  }, [onClose, resetState]);\n\n  const validateFileTypes = (files: File[]): File[] => {\n    const validFiles: File[] = [];\n    const invalidFormat: string[] = [];\n    const tooLarge: string[] = [];\n\n    files.forEach((file) => {\n      if (!ALLOWED_TYPES.includes(file.type.toLowerCase())) {\n        invalidFormat.push(file.name);\n      } else if (file.size > MAX_FILE_SIZE) {\n        tooLarge.push(\n          `${file.name} (${(file.size / 1024 / 1024).toFixed(1)} МБ)`\n        );\n      } else {\n        validFiles.push(file);\n      }\n    });\n\n    if (invalidFormat.length || tooLarge.length) {\n      let message = \"\";\n      if (invalidFormat.length) {\n        message += `Файлы с неподдерживаемым форматом:\\n${invalidFormat.join(\n          \"\\n\"\n        )}\\n\\nДопустимы только PNG или JPG.\\n\\n`;\n      }\n      if (tooLarge.length) {\n        message += `Файлы превышают лимит 10 МБ:\\n${tooLarge.join(\"\\n\")}`;\n      }\n      alert(message.trim());\n    }\n\n    return validFiles;\n  };\n\n  const createPreviews = useCallback(\n    (files: File[]) => {\n      previewUrls.forEach((url) => URL.revokeObjectURL(url));\n      const limitedFiles = files.slice(0, 1);\n      setSelectedFiles(limitedFiles);\n      setPreviewUrls(limitedFiles.map((file) => URL.createObjectURL(file)));\n    },\n    [previewUrls]\n  );\n\n  const handleDrag = useCallback((event: React.DragEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    if (event.type === \"dragenter\" || event.type === \"dragover\") {\n      setDragActive(true);\n    } else if (event.type === \"dragleave\") {\n      setDragActive(false);\n    }\n  }, []);\n\n  const handleDrop = useCallback(\n    (event: React.DragEvent) => {\n      event.preventDefault();\n      event.stopPropagation();\n      setDragActive(false);\n      if (event.dataTransfer.files?.[0]) {\n        const validFiles = validateFileTypes([event.dataTransfer.files[0]]);\n        if (validFiles.length) {\n          createPreviews(validFiles);\n        }\n      }\n    },\n    [createPreviews]\n  );\n\n  const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => {\n    if (event.target.files?.[0]) {\n      const validFiles = validateFileTypes([event.target.files[0]]);\n      if (validFiles.length) {\n        createPreviews(validFiles);\n      }\n    }\n  };\n\n  const removeFile = (index: number) => {\n    const newPreviews = previewUrls.filter((_, i) => i !== index);\n    const revokedUrl = previewUrls[index];\n    if (revokedUrl) {\n      URL.revokeObjectURL(revokedUrl);\n    }\n    setPreviewUrls(newPreviews);\n    setSelectedFiles(selectedFiles.filter((_, i) => i !== index));\n  };\n\n  const waitForAvatarCompletion = useCallback(\n    async (recordId?: string | null, initialStatus?: \"done\" | \"error\") => {\n      if (!recordId) {\n        console.warn(\"[avatars] Нет ID записи для проверки статуса\");\n        return true;\n      }\n\n      // Если статус уже done сразу после создания, не ждём\n      if (initialStatus === \"done\") {\n        console.log(\"[avatars] Статус уже 'done', не требуется ожидание\");\n        return true;\n      }\n\n      if (initialStatus === \"error\") {\n        console.error(\"[avatars] Статус 'error' при создании записи\");\n        return false;\n      }\n\n      const timeoutMs = 2 * 60 * 1000;\n      const pollDelayMs = 2000;\n      const deadline = Date.now() + timeoutMs;\n      let attemptCount = 0;\n\n      console.log(`[avatars] Начинаем проверку статуса для записи ${recordId}`);\n\n      while (isMountedRef.current && Date.now() < deadline) {\n        attemptCount++;\n        const { data, error } = await supabase\n          .from(\"photo_avatars\")\n          .select(\"status\")\n          .eq(\"id\", recordId)\n          .single();\n\n        if (error) {\n          console.error(\n            `[avatars] Ошибка проверки статуса (попытка ${attemptCount}):`,\n            error\n          );\n          // Если запись не найдена, продолжаем попытки\n          if (error.code === \"PGRST116\") {\n            await sleep(pollDelayMs);\n            continue;\n          }\n        } else if (data?.status === \"done\") {\n          console.log(\n            `[avatars] Статус 'done' получен после ${attemptCount} попыток`\n          );\n          return true;\n        } else if (data?.status === \"error\") {\n          console.error(\n            `[avatars] Статус 'error' получен после ${attemptCount} попыток`\n          );\n          return false;\n        } else {\n          console.log(\n            `[avatars] Попытка ${attemptCount}: статус = ${data?.status || \"неизвестен\"}`\n          );\n        }\n\n        await sleep(pollDelayMs);\n      }\n\n      console.warn(\n        `[avatars] Таймаут ожидания статуса после ${attemptCount} попыток`\n      );\n      return false;\n    },\n    []\n  );\n\n  const handleUpload = async () => {\n    if (isUploading || !avatarName.trim() || selectedFiles.length === 0) {\n      return;\n    }\n\n    setIsUploading(true);\n    setProgress(0);\n    startProgressLoop();\n\n    try {\n      const {\n        data: { user },\n        error: authError,\n      } = await supabase.auth.getUser();\n\n      if (authError) {\n        throw new Error(authError.message);\n      }\n\n      if (!user) {\n        throw new Error(\"Пользователь не найден\");\n      }\n\n      const formData = new FormData();\n      formData.append(\"avatar_name\", avatarName.trim());\n      formData.append(\"uid\", user.id);\n      formData.append(\"photo\", selectedFiles[0]);\n\n      const result = await UploadAvatar(formData);\n\n      if (!result.success) {\n        throw new Error(result.error);\n      }\n\n      // Проверяем статус сразу после создания\n      const initialStatus = result.avatar.status;\n      console.log(\n        `[avatars] Аватар создан с ID ${result.avatar.id}, начальный статус: ${initialStatus}`\n      );\n\n      // Если статус уже done, сразу устанавливаем прогресс в 100%\n      if (initialStatus === \"done\") {\n        stopProgressLoop();\n        setProgress(100);\n        await onAvatarUploaded?.();\n        await sleep(400);\n        closeModal();\n        return;\n      }\n\n      const isReady = await waitForAvatarCompletion(\n        result.avatar.id ?? null,\n        initialStatus\n      );\n\n      if (!isReady) {\n        throw new Error(\n          \"Не удалось дождаться завершения обработки аватара. Попробуйте позже.\"\n        );\n      }\n\n      stopProgressLoop();\n      setProgress(100);\n      await onAvatarUploaded?.();\n      await sleep(400);\n      closeModal();\n    } catch (error) {\n      console.error(\"[avatars] Ошибка при загрузке:\", error);\n      alert(\n        `Ошибка при загрузке: ${\n          error instanceof Error ? error.message : \"Неизвестная ошибка\"\n        }`\n      );\n      setProgress(0);\n    } finally {\n      stopProgressLoop();\n      setIsUploading(false);\n    }\n  };\n\n  const dropZoneClasses = useMemo(() => {\n    const base =\n      \"rounded-2xl border border-dashed border-blue-400/50 bg-blue-50/30 p-6 text-center transition-all duration-200\";\n    if (dragActive) {\n      return `${base} shadow-lg -translate-y-0.5`;\n    }\n    return `${base} hover:shadow-md hover:-translate-y-0.5`;\n  }, [dragActive]);\n\n  if (!isOpen) {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-8\">\n      <div className=\"w-full max-w-lg rounded-[32px] bg-white shadow-2xl\">\n        <div className=\"relative flex items-center justify-center border-b px-6 py-4\">\n          <h2 className=\"text-lg font-semibold text-gray-900\">\n            Загрузите фото для аватара\n          </h2>\n          <button\n            type=\"button\"\n            onClick={closeModal}\n            className=\"absolute right-6 rounded-full p-1 text-gray-400 transition hover:bg-gray-100 hover:text-gray-600\"\n          >\n            <span className=\"sr-only\">Закрыть</span>✕\n          </button>\n        </div>\n\n        <div className=\"max-h-[70vh] overflow-y-auto px-6 py-6 [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-track]:bg-gray-100 [&::-webkit-scrollbar-thumb]:bg-gray-300 [&::-webkit-scrollbar-thumb]:rounded-full\">\n          <div className=\"space-y-6 text-sm text-gray-600\">\n            <div>\n              <label\n                htmlFor=\"avatar-name\"\n                className=\"mb-2 block text-xs font-semibold uppercase tracking-wide text-gray-500\"\n              >\n                Имя аватара\n              </label>\n              <input\n                id=\"avatar-name\"\n                value={avatarName}\n                onChange={(event) => setAvatarName(event.target.value)}\n                placeholder=\"Придумайте любое имя\"\n                className=\"w-full rounded-2xl border border-gray-200 bg-gray-50 px-4 py-3 text-base text-gray-900 outline-none transition focus:border-gray-400\"\n              />\n            </div>\n\n            <div\n              className={dropZoneClasses}\n              onDragEnter={handleDrag}\n              onDragLeave={handleDrag}\n              onDragOver={handleDrag}\n              onDrop={handleDrop}\n            >\n              <div className=\"mx-auto flex max-w-sm flex-col items-center gap-3 text-gray-700\">\n                <div className=\"rounded-2xl border border-blue-200 bg-white p-3 text-blue-500\">\n                  ↑\n                </div>\n                <p className=\"text-base font-semibold\">\n                  Перетащите фотографию сюда\n                </p>\n                <p className=\"text-xs text-gray-500\">PNG или JPG до 10 МБ</p>\n                <button\n                  type=\"button\"\n                  className=\"rounded-lg bg-blue-600 px-6 py-2 text-sm font-semibold text-white transition hover:bg-blue-500\"\n                  onClick={() => fileInputRef.current?.click()}\n                >\n                  Выбрать файл\n                </button>\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  accept=\"image/jpeg,image/jpg,image/png\"\n                  className=\"hidden\"\n                  onChange={handleFileSelect}\n                />\n              </div>\n            </div>\n\n            {selectedFiles.length > 0 && (\n              <div className=\"rounded-2xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-700\">\n                {selectedFiles.map((file, index) => (\n                  <div\n                    key={`${file.name}-${index}`}\n                    className=\"flex items-center justify-between gap-3\"\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      {previewUrls[index] && (\n                        <Image\n                          src={previewUrls[index]}\n                          alt={file.name}\n                          width={40}\n                          height={40}\n                          className=\"h-10 w-10 rounded-lg object-cover\"\n                          unoptimized\n                        />\n                      )}\n                      <div className=\"truncate\">{file.name}</div>\n                    </div>\n                    <button\n                      type=\"button\"\n                      onClick={() => removeFile(index)}\n                      className=\"text-gray-400 transition hover:text-red-500\"\n                    >\n                      Удалить\n                    </button>\n                  </div>\n                ))}\n              </div>\n            )}\n\n            <div className=\"rounded-2xl border border-gray-100 bg-gray-50 p-4 text-xs text-gray-600\">\n              <p className=\"mb-3 text-sm font-semibold text-gray-800\">\n                Требования к фото\n              </p>\n              <ul className=\"space-y-2\">\n                <li>Фото в анфас (лицо прямо в камеру)</li>\n                <li>Хорошее качество изображения, чёткое и резкое</li>\n                <li>Без теней на лице, равномерное освещение</li>\n                <li>Без других людей на фото, только вы</li>\n                <li>Без открытой улыбки, нейтральное выражение лица</li>\n              </ul>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex flex-col gap-3 border-t border-gray-200 px-6 py-4 text-sm text-gray-500 sm:flex-row sm:items-center sm:justify-between sm:gap-4\">\n          <div className=\"flex flex-1 items-center gap-4\">\n            <button\n              type=\"button\"\n              onClick={closeModal}\n              className=\"rounded-lg border border-gray-200 px-5 py-2 text-sm font-semibold text-gray-700 transition hover:bg-gray-50\"\n              disabled={isUploading}\n            >\n              Отмена\n            </button>\n            {(isUploading || progress > 0) && (\n              <div className=\"relative h-1 flex-1 overflow-hidden rounded-full bg-gray-200\">\n                <div\n                  className=\"absolute inset-y-0 left-0 rounded-full bg-gradient-to-r from-[#FFB347] via-[#FFC94C] to-[#FFB347] transition-[width] duration-500 ease-out\"\n                  style={{ width: `${progress}%` }}\n                  aria-hidden=\"true\"\n                />\n              </div>\n            )}\n          </div>\n          <button\n            type=\"button\"\n            onClick={handleUpload}\n            disabled={\n              isUploading || !avatarName.trim() || selectedFiles.length === 0\n            }\n            className=\"rounded-lg bg-blue-600 px-6 py-2 text-sm font-semibold text-white transition hover:bg-blue-500 disabled:cursor-not-allowed disabled:bg-gray-300 sm:ml-auto\"\n          >\n            {isUploading ? \"Создаем...\" : \"Создать\"}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1994, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/%28main%29/components/DashboardAvatarsSection.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport type { PhotoAvatarRow } from \"@/app/avatars/servers/UploadAvatar\";\r\nimport { DashboardAvatarCard } from \"./DashboardAvatarCard\";\r\nimport { AvatarUploadModal } from \"@/app/avatars/components/AvatarUploadModal\";\r\n\r\ninterface DashboardAvatarsSectionProps {\r\n  avatars: PhotoAvatarRow[];\r\n  currentUserId: string | null;\r\n  onAvatarsChanged?: () => void | Promise<void>;\r\n}\r\n\r\nexport function DashboardAvatarsSection({\r\n  avatars,\r\n  currentUserId,\r\n  onAvatarsChanged,\r\n}: DashboardAvatarsSectionProps) {\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n\r\n  return (\r\n    <section>\r\n      <div className=\"mb-6 flex items-center justify-between\">\r\n        <h2 className=\"text-2xl font-bold text-gray-900\">Мои аватары</h2>\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => setIsModalOpen(true)}\r\n          className=\"min-w-[170px] rounded-lg bg-blue-600 px-4 py-3 text-sm font-semibold text-white transition hover:bg-blue-500\"\r\n        >\r\n          Создать аватар\r\n        </button>\r\n      </div>\r\n      {avatars.length === 0 ? (\r\n        <div className=\"rounded-2xl border border-gray-200 bg-gray-50 p-12 text-center\">\r\n          <p className=\"text-gray-600\">У вас пока нет аватаров</p>\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setIsModalOpen(true)}\r\n            className=\"mt-4 inline-block rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-blue-500\"\r\n          >\r\n            Создать аватар\r\n          </button>\r\n        </div>\r\n      ) : (\r\n        <div className=\"grid gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6\">\r\n          {avatars.map((avatar) => {\r\n            const key =\r\n              avatar.id ??\r\n              avatar.hey_gen_id ??\r\n              avatar.group_id ??\r\n              `${avatar.uid}-${avatar.image_key}`;\r\n            return (\r\n              <DashboardAvatarCard\r\n                key={key}\r\n                avatar={avatar}\r\n                currentUserId={currentUserId}\r\n                onAvatarChanged={onAvatarsChanged}\r\n              />\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n      <AvatarUploadModal\r\n        isOpen={isModalOpen}\r\n        onClose={() => setIsModalOpen(false)}\r\n        onAvatarUploaded={onAvatarsChanged}\r\n      />\r\n    </section>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;AAEA;AAEA;AACA;AALA;;;;;AAaO,SAAS,wBAAwB,EACtC,OAAO,EACP,aAAa,EACb,gBAAgB,EACa;IAC7B,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC;IAE/C,qBACE,8OAAC;;0BACC,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;kCAAmC;;;;;;kCACjD,8OAAC;wBACC,MAAK;wBACL,SAAS,IAAM,eAAe;wBAC9B,WAAU;kCACX;;;;;;;;;;;;YAIF,QAAQ,MAAM,KAAK,kBAClB,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAE,WAAU;kCAAgB;;;;;;kCAC7B,8OAAC;wBACC,MAAK;wBACL,SAAS,IAAM,eAAe;wBAC9B,WAAU;kCACX;;;;;;;;;;;qCAKH,8OAAC;gBAAI,WAAU;0BACZ,QAAQ,GAAG,CAAC,CAAC;oBACZ,MAAM,MACJ,OAAO,EAAE,IACT,OAAO,UAAU,IACjB,OAAO,QAAQ,IACf,GAAG,OAAO,GAAG,CAAC,CAAC,EAAE,OAAO,SAAS,EAAE;oBACrC,qBACE,8OAAC,4KAAmB;wBAElB,QAAQ;wBACR,eAAe;wBACf,iBAAiB;uBAHZ;;;;;gBAMX;;;;;;0BAGJ,8OAAC,uKAAiB;gBAChB,QAAQ;gBACR,SAAS,IAAM,eAAe;gBAC9B,kBAAkB;;;;;;;;;;;;AAI1B"}},
    {"offset": {"line": 2103, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/voices/servers/DeleteVoice.ts"],"sourcesContent":["\"use server\";\n\nimport { createClient } from \"@supabase/supabase-js\";\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\nif (!supabaseUrl) {\n  throw new Error(\"NEXT_PUBLIC_SUPABASE_URL не задан\");\n}\n\nif (!supabaseServiceRoleKey) {\n  throw new Error(\"SUPABASE_SERVICE_ROLE_KEY не задан\");\n}\n\nconst supabaseAdmin = createClient(supabaseUrl, supabaseServiceRoleKey);\n\ninterface DeleteVoiceInput {\n  uid: string;\n  voiceId: string;\n}\n\ninterface DeleteVoiceResult {\n  success: boolean;\n  error?: string;\n}\n\nexport async function DeleteVoice({\n  uid,\n  voiceId,\n}: DeleteVoiceInput): Promise<DeleteVoiceResult> {\n  try {\n    if (!uid) {\n      return { success: false, error: \"Пользователь не найден\" };\n    }\n\n    if (!voiceId) {\n      return { success: false, error: \"ID голоса не указан\" };\n    }\n\n    // Сначала получаем запись из таблицы, чтобы извлечь voice_id и название голоса\n    const { data: voiceRecord, error: fetchError } = await supabaseAdmin\n      .from(\"voices\")\n      .select(\"voice_id, name\")\n      .eq(\"id\", voiceId)\n      .eq(\"uid\", uid)\n      .single();\n\n    if (fetchError) {\n      throw new Error(`Не удалось найти голос: ${fetchError.message}`);\n    }\n\n    if (!voiceRecord || !voiceRecord.voice_id) {\n      throw new Error(\"Не найдено значение voice_id для этого голоса\");\n    }\n\n    // Отправляем вебхук с voice_id, названием голоса и UUID пользователя\n    const webhookResponse = await fetch(\n      \"https://rueleven.ru/webhook/932aee6f-b554-45e9-b232-f7829b0a1d06\",\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ \n          voice_id: voiceRecord.voice_id,\n          voice_name: voiceRecord.name || null,\n          uuid: uid,\n        }),\n      }\n    );\n\n    if (!webhookResponse.ok) {\n      const message = await webhookResponse.text();\n      throw new Error(\n        `Не удалось отправить вебхук: ${\n          message || webhookResponse.statusText\n        }`\n      );\n    }\n\n    // Удаляем запись из таблицы\n    const { error } = await supabaseAdmin\n      .from(\"voices\")\n      .delete()\n      .eq(\"id\", voiceId)\n      .eq(\"uid\", uid);\n\n    if (error) {\n      throw new Error(error.message);\n    }\n\n    return { success: true };\n  } catch (error) {\n    const message =\n      error instanceof Error ? error.message : \"Неизвестная ошибка\";\n    console.error(\"[DeleteVoice]\", message);\n    return { success: false, error: message };\n  }\n}\n\n\n"],"names":[],"mappings":";;;;;;;IA2BsB,cAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 2115, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/voices/servers/UpdateVoice.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { createClient } from \"@supabase/supabase-js\";\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\r\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\r\n\r\nif (!supabaseUrl) {\r\n  throw new Error(\"NEXT_PUBLIC_SUPABASE_URL не задан\");\r\n}\r\n\r\nif (!supabaseServiceRoleKey) {\r\n  throw new Error(\"SUPABASE_SERVICE_ROLE_KEY не задан\");\r\n}\r\n\r\nconst supabaseAdmin = createClient(supabaseUrl, supabaseServiceRoleKey);\r\n\r\ninterface UpdateVoiceInput {\r\n  uid: string;\r\n  voiceId: string;\r\n  name: string;\r\n  description?: string | null;\r\n}\r\n\r\ninterface UpdateVoiceResult {\r\n  success: boolean;\r\n  error?: string;\r\n}\r\n\r\nexport async function UpdateVoice({\r\n  uid,\r\n  voiceId,\r\n  name,\r\n  description,\r\n}: UpdateVoiceInput): Promise<UpdateVoiceResult> {\r\n  try {\r\n    if (!uid) {\r\n      return { success: false, error: \"Пользователь не найден\" };\r\n    }\r\n\r\n    if (!voiceId) {\r\n      return { success: false, error: \"ID голоса не указан\" };\r\n    }\r\n\r\n    if (!name || !name.trim()) {\r\n      return { success: false, error: \"Имя не может быть пустым\" };\r\n    }\r\n\r\n    const trimmedName = name.trim();\r\n    const trimmedDescription = description?.trim();\r\n\r\n    const { error } = await supabaseAdmin\r\n      .from(\"voices\")\r\n      .update({\r\n        name: trimmedName,\r\n        description: trimmedDescription || null,\r\n      })\r\n      .eq(\"id\", voiceId)\r\n      .eq(\"uid\", uid);\r\n\r\n    if (error) {\r\n      throw new Error(error.message);\r\n    }\r\n\r\n    return { success: true };\r\n  } catch (error) {\r\n    const message =\r\n      error instanceof Error ? error.message : \"Неизвестная ошибка\";\r\n    console.error(\"[UpdateVoice]\", message);\r\n    return { success: false, error: message };\r\n  }\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;;;;IA6BsB,cAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 2127, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/voices/components/VoiceDeleteModal.tsx"],"sourcesContent":["\"use client\";\r\n\r\ninterface VoiceDeleteModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onConfirm: () => void | Promise<void>;\r\n  voiceName: string;\r\n  isDeleting?: boolean;\r\n}\r\n\r\nexport function VoiceDeleteModal({\r\n  isOpen,\r\n  onClose,\r\n  onConfirm,\r\n  voiceName,\r\n  isDeleting = false,\r\n}: VoiceDeleteModalProps) {\r\n  if (!isOpen) {\r\n    return null;\r\n  }\r\n\r\n  const handleConfirm = async () => {\r\n    await onConfirm();\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\">\r\n      <div className=\"mx-4 w-full max-w-md rounded-2xl bg-white p-6 shadow-2xl\">\r\n        <h2 className=\"mb-4 text-xl font-semibold text-gray-900\">\r\n          Удаление голоса\r\n        </h2>\r\n        <p className=\"mb-6 text-gray-600\">\r\n          Вы действительно хотите удалить голос «{voiceName}»?\r\n        </p>\r\n        <div className=\"flex gap-3\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={onClose}\r\n            disabled={isDeleting}\r\n            className=\"flex-1 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-semibold text-gray-700 transition hover:bg-gray-50 disabled:opacity-50\"\r\n          >\r\n            Отмена\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={handleConfirm}\r\n            disabled={isDeleting}\r\n            className=\"flex-1 rounded-lg bg-red-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-red-700 disabled:opacity-50\"\r\n          >\r\n            {isDeleting ? \"Удаляем...\" : \"Удалить\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;;AAAA;;AAUO,SAAS,iBAAiB,EAC/B,MAAM,EACN,OAAO,EACP,SAAS,EACT,SAAS,EACT,aAAa,KAAK,EACI;IACtB,IAAI,CAAC,QAAQ;QACX,OAAO;IACT;IAEA,MAAM,gBAAgB;QACpB,MAAM;IACR;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAG,WAAU;8BAA2C;;;;;;8BAGzD,8OAAC;oBAAE,WAAU;;wBAAqB;wBACQ;wBAAU;;;;;;;8BAEpD,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BACC,MAAK;4BACL,SAAS;4BACT,UAAU;4BACV,WAAU;sCACX;;;;;;sCAGD,8OAAC;4BACC,MAAK;4BACL,SAAS;4BACT,UAAU;4BACV,WAAU;sCAET,aAAa,eAAe;;;;;;;;;;;;;;;;;;;;;;;AAMzC"}},
    {"offset": {"line": 2213, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/voices/components/VoiceEditModal.tsx"],"sourcesContent":["\"use client\";\n\nimport {\n  type KeyboardEvent as ReactKeyboardEvent,\n  useEffect,\n  useState,\n} from \"react\";\n\nexport interface VoiceEditFormValues {\n  name: string;\n  description: string;\n}\n\nconst MAX_DESCRIPTION_LENGTH = 100;\n\ninterface VoiceEditModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onConfirm: (values: VoiceEditFormValues) => void | Promise<void>;\n  currentName: string;\n  currentDescription: string;\n  isSaving?: boolean;\n}\n\nexport function VoiceEditModal({\n  isOpen,\n  onClose,\n  onConfirm,\n  currentName,\n  currentDescription,\n  isSaving = false,\n}: VoiceEditModalProps) {\n  const [formValues, setFormValues] = useState<VoiceEditFormValues>({\n    name: currentName,\n    description: currentDescription,\n  });\n\n  useEffect(() => {\n    if (isOpen) {\n      setFormValues({\n        name: currentName,\n        description: currentDescription,\n      });\n    }\n  }, [isOpen, currentName, currentDescription]);\n\n  if (!isOpen) {\n    return null;\n  }\n\n  const handleConfirm = async () => {\n    if (!formValues.name.trim()) {\n      return;\n    }\n\n    await onConfirm({\n      name: formValues.name.trim(),\n      description: formValues.description.trim().slice(0, MAX_DESCRIPTION_LENGTH),\n    });\n  };\n\n  const handleKeyDown = (\n    event: ReactKeyboardEvent<HTMLInputElement | HTMLTextAreaElement>\n  ) => {\n    const isTextarea = event.currentTarget.tagName === \"TEXTAREA\";\n    if (\n      event.key === \"Enter\" &&\n      !isTextarea &&\n      !isSaving &&\n      formValues.name.trim()\n    ) {\n      event.preventDefault();\n      handleConfirm();\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\">\n      <div className=\"mx-4 w-full max-w-md rounded-2xl bg-white p-6 shadow-2xl\">\n        <h2 className=\"mb-4 text-xl font-semibold text-gray-900\">\n          Редактировать голос\n        </h2>\n        <div className=\"space-y-4\">\n          <div>\n            <label\n              htmlFor=\"voice-name\"\n              className=\"mb-2 block text-xs font-semibold uppercase tracking-wide text-gray-500\"\n            >\n              Имя\n            </label>\n            <input\n              id=\"voice-name\"\n              type=\"text\"\n              value={formValues.name}\n              onChange={(event) =>\n                setFormValues((prev) => ({ ...prev, name: event.target.value }))\n              }\n              onKeyDown={handleKeyDown}\n              disabled={isSaving}\n              placeholder=\"Введите новое имя\"\n              className=\"w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-base text-gray-900 outline-none transition focus:border-gray-400 disabled:opacity-50\"\n              autoFocus\n            />\n          </div>\n          <div>\n            <div className=\"mb-2 flex items-center justify-between\">\n              <label\n                htmlFor=\"voice-description\"\n                className=\"block text-xs font-semibold uppercase tracking-wide text-gray-500\"\n              >\n                Описание\n              </label>\n              <span className={`text-xs ${\n                formValues.description.length > MAX_DESCRIPTION_LENGTH \n                  ? \"text-red-500\" \n                  : \"text-gray-400\"\n              }`}>\n                {formValues.description.length}/{MAX_DESCRIPTION_LENGTH}\n              </span>\n            </div>\n            <textarea\n              id=\"voice-description\"\n              value={formValues.description}\n              onChange={(event) => {\n                const value = event.target.value;\n                if (value.length <= MAX_DESCRIPTION_LENGTH) {\n                  setFormValues((prev) => ({\n                    ...prev,\n                    description: value,\n                  }));\n                }\n              }}\n              maxLength={MAX_DESCRIPTION_LENGTH}\n              onKeyDown={handleKeyDown}\n              disabled={isSaving}\n              placeholder=\"Добавьте описание голоса\"\n              className=\"h-28 w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-base text-gray-900 outline-none transition focus:border-gray-400 disabled:opacity-50\"\n            />\n          </div>\n        </div>\n        <div className=\"mt-6 flex gap-3\">\n          <button\n            type=\"button\"\n            onClick={onClose}\n            disabled={isSaving}\n            className=\"flex-1 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-semibold text-gray-700 transition hover:bg-gray-50 disabled:opacity-50\"\n          >\n            Отмена\n          </button>\n          <button\n            type=\"button\"\n            onClick={handleConfirm}\n            disabled={isSaving || !formValues.name.trim()}\n            className=\"flex-1 rounded-lg bg-purple-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-purple-700 disabled:opacity-50\"\n          >\n            {isSaving ? \"Сохраняем...\" : \"Сохранить\"}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAaA,MAAM,yBAAyB;AAWxB,SAAS,eAAe,EAC7B,MAAM,EACN,OAAO,EACP,SAAS,EACT,WAAW,EACX,kBAAkB,EAClB,WAAW,KAAK,EACI;IACpB,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAsB;QAChE,MAAM;QACN,aAAa;IACf;IAEA,IAAA,kNAAS,EAAC;QACR,IAAI,QAAQ;YACV,cAAc;gBACZ,MAAM;gBACN,aAAa;YACf;QACF;IACF,GAAG;QAAC;QAAQ;QAAa;KAAmB;IAE5C,IAAI,CAAC,QAAQ;QACX,OAAO;IACT;IAEA,MAAM,gBAAgB;QACpB,IAAI,CAAC,WAAW,IAAI,CAAC,IAAI,IAAI;YAC3B;QACF;QAEA,MAAM,UAAU;YACd,MAAM,WAAW,IAAI,CAAC,IAAI;YAC1B,aAAa,WAAW,WAAW,CAAC,IAAI,GAAG,KAAK,CAAC,GAAG;QACtD;IACF;IAEA,MAAM,gBAAgB,CACpB;QAEA,MAAM,aAAa,MAAM,aAAa,CAAC,OAAO,KAAK;QACnD,IACE,MAAM,GAAG,KAAK,WACd,CAAC,cACD,CAAC,YACD,WAAW,IAAI,CAAC,IAAI,IACpB;YACA,MAAM,cAAc;YACpB;QACF;IACF;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAG,WAAU;8BAA2C;;;;;;8BAGzD,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;;8CACC,8OAAC;oCACC,SAAQ;oCACR,WAAU;8CACX;;;;;;8CAGD,8OAAC;oCACC,IAAG;oCACH,MAAK;oCACL,OAAO,WAAW,IAAI;oCACtB,UAAU,CAAC,QACT,cAAc,CAAC,OAAS,CAAC;gDAAE,GAAG,IAAI;gDAAE,MAAM,MAAM,MAAM,CAAC,KAAK;4CAAC,CAAC;oCAEhE,WAAW;oCACX,UAAU;oCACV,aAAY;oCACZ,WAAU;oCACV,SAAS;;;;;;;;;;;;sCAGb,8OAAC;;8CACC,8OAAC;oCAAI,WAAU;;sDACb,8OAAC;4CACC,SAAQ;4CACR,WAAU;sDACX;;;;;;sDAGD,8OAAC;4CAAK,WAAW,CAAC,QAAQ,EACxB,WAAW,WAAW,CAAC,MAAM,GAAG,yBAC5B,iBACA,iBACJ;;gDACC,WAAW,WAAW,CAAC,MAAM;gDAAC;gDAAE;;;;;;;;;;;;;8CAGrC,8OAAC;oCACC,IAAG;oCACH,OAAO,WAAW,WAAW;oCAC7B,UAAU,CAAC;wCACT,MAAM,QAAQ,MAAM,MAAM,CAAC,KAAK;wCAChC,IAAI,MAAM,MAAM,IAAI,wBAAwB;4CAC1C,cAAc,CAAC,OAAS,CAAC;oDACvB,GAAG,IAAI;oDACP,aAAa;gDACf,CAAC;wCACH;oCACF;oCACA,WAAW;oCACX,WAAW;oCACX,UAAU;oCACV,aAAY;oCACZ,WAAU;;;;;;;;;;;;;;;;;;8BAIhB,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BACC,MAAK;4BACL,SAAS;4BACT,UAAU;4BACV,WAAU;sCACX;;;;;;sCAGD,8OAAC;4BACC,MAAK;4BACL,SAAS;4BACT,UAAU,YAAY,CAAC,WAAW,IAAI,CAAC,IAAI;4BAC3C,WAAU;sCAET,WAAW,iBAAiB;;;;;;;;;;;;;;;;;;;;;;;AAMzC"}},
    {"offset": {"line": 2423, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/%28main%29/components/DashboardVoiceCard.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { ReactNode, useEffect, useRef, useState } from \"react\";\r\nimport { DeleteVoice } from \"@/app/voices/servers/DeleteVoice\";\r\nimport { UpdateVoice } from \"@/app/voices/servers/UpdateVoice\";\r\nimport { VoiceDeleteModal } from \"@/app/voices/components/VoiceDeleteModal\";\r\nimport { VoiceEditModal, type VoiceEditFormValues } from \"@/app/voices/components/VoiceEditModal\";\r\n\r\ninterface VoiceRow {\r\n  id?: string;\r\n  uid: string;\r\n  name: string;\r\n  url: string;\r\n  created_at?: string;\r\n  description?: string | null;\r\n}\r\n\r\ninterface DashboardVoiceCardProps {\r\n  voice: VoiceRow;\r\n  currentUserId: string | null;\r\n  onVoiceChanged?: () => void | Promise<void>;\r\n}\r\n\r\nexport function DashboardVoiceCard({\r\n  voice,\r\n  currentUserId,\r\n  onVoiceChanged,\r\n}: DashboardVoiceCardProps) {\r\n  const [isPlaying, setIsPlaying] = useState(false);\r\n  const [openMenu, setOpenMenu] = useState(false);\r\n  const [hovered, setHovered] = useState(false);\r\n  const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);\r\n  const [isEditModalOpen, setIsEditModalOpen] = useState(false);\r\n  const [deletingId, setDeletingId] = useState(false);\r\n  const [editingId, setEditingId] = useState(false);\r\n  const audioRef = useRef<HTMLAudioElement | null>(null);\r\n  const menuRef = useRef<HTMLDivElement | null>(null);\r\n  const closeMenuTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  const formattedDescription = voice.description?.trim() ?? \"\";\r\n\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (openMenu && menuRef.current && !menuRef.current.contains(event.target as Node)) {\r\n        setOpenMenu(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener(\"mousedown\", handleClickOutside);\r\n    };\r\n  }, [openMenu]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (closeMenuTimeoutRef.current) {\r\n        clearTimeout(closeMenuTimeoutRef.current);\r\n      }\r\n      if (audioRef.current) {\r\n        audioRef.current.pause();\r\n        audioRef.current = null;\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const handlePlay = () => {\r\n    if (!audioRef.current) {\r\n      audioRef.current = new Audio(voice.url);\r\n      audioRef.current.onended = () => setIsPlaying(false);\r\n      audioRef.current.onerror = () => {\r\n        setIsPlaying(false);\r\n        alert(\"Ошибка воспроизведения аудио\");\r\n      };\r\n    }\r\n\r\n    if (isPlaying) {\r\n      audioRef.current.pause();\r\n      audioRef.current.currentTime = 0;\r\n      setIsPlaying(false);\r\n    } else {\r\n      audioRef.current.play();\r\n      setIsPlaying(true);\r\n    }\r\n  };\r\n\r\n  const handleMenuClick = (event: React.MouseEvent) => {\r\n    event.stopPropagation();\r\n    setOpenMenu(!openMenu);\r\n  };\r\n\r\n  const handleEditClick = () => {\r\n    if (!currentUserId || !voice.id) {\r\n      alert(\"Не удалось определить пользователя или идентификатор голоса\");\r\n      return;\r\n    }\r\n    setOpenMenu(false);\r\n    setIsEditModalOpen(true);\r\n  };\r\n\r\n  const handleDeleteClick = () => {\r\n    if (!currentUserId || !voice.id) {\r\n      alert(\"Не удалось определить пользователя или идентификатор голоса\");\r\n      return;\r\n    }\r\n    setOpenMenu(false);\r\n    setIsDeleteModalOpen(true);\r\n  };\r\n\r\n  const handleEditConfirm = async ({ name, description }: VoiceEditFormValues) => {\r\n    if (!currentUserId || !voice.id) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setEditingId(true);\r\n      const result = await UpdateVoice({\r\n        uid: currentUserId,\r\n        voiceId: voice.id,\r\n        name,\r\n        description,\r\n      });\r\n\r\n      if (!result.success) {\r\n        throw new Error(result.error || \"Не удалось обновить голос\");\r\n      }\r\n\r\n      setIsEditModalOpen(false);\r\n      await onVoiceChanged?.();\r\n    } catch (error) {\r\n      console.error(\"[DashboardVoiceCard] Ошибка редактирования:\", error);\r\n      alert(\r\n        `Ошибка при редактировании: ${\r\n          error instanceof Error ? error.message : \"Неизвестная ошибка\"\r\n        }`\r\n      );\r\n    } finally {\r\n      setEditingId(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteConfirm = async () => {\r\n    if (!currentUserId || !voice.id) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setDeletingId(true);\r\n      const result = await DeleteVoice({\r\n        uid: currentUserId,\r\n        voiceId: voice.id,\r\n      });\r\n\r\n      if (!result.success) {\r\n        throw new Error(result.error || \"Не удалось удалить голос\");\r\n      }\r\n\r\n      setIsDeleteModalOpen(false);\r\n      await onVoiceChanged?.();\r\n    } catch (error) {\r\n      console.error(\"[DashboardVoiceCard] Ошибка удаления:\", error);\r\n      alert(\r\n        `Ошибка при удалении: ${\r\n          error instanceof Error ? error.message : \"Неизвестная ошибка\"\r\n        }`\r\n      );\r\n    } finally {\r\n      setDeletingId(false);\r\n    }\r\n  };\r\n\r\n  const showMenuButton = hovered || openMenu;\r\n  const isProcessing = deletingId || editingId;\r\n\r\n  return (\r\n    <>\r\n      <article\r\n        className=\"group relative rounded-3xl border border-gray-100 bg-white p-6 shadow-sm ring-1 ring-black/5 transition-all duration-300 hover:-translate-y-2 hover:shadow-lg\"\r\n        onMouseEnter={() => {\r\n          setHovered(true);\r\n          if (closeMenuTimeoutRef.current) {\r\n            clearTimeout(closeMenuTimeoutRef.current);\r\n            closeMenuTimeoutRef.current = null;\r\n          }\r\n        }}\r\n        onMouseLeave={() => {\r\n          setHovered(false);\r\n          if (closeMenuTimeoutRef.current) {\r\n            clearTimeout(closeMenuTimeoutRef.current);\r\n          }\r\n          closeMenuTimeoutRef.current = setTimeout(() => {\r\n            if (openMenu) {\r\n              setOpenMenu(false);\r\n            }\r\n          }, 500);\r\n        }}\r\n      >\r\n        <div className=\"absolute right-3 top-3\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={handleMenuClick}\r\n            className={`flex h-8 w-8 items-center justify-center rounded-full bg-white/90 text-gray-600 shadow-md transition-all duration-200 hover:bg-white hover:text-gray-900 ${\r\n              showMenuButton ? \"opacity-100\" : \"opacity-0\"\r\n            }`}\r\n            aria-label=\"Меню\"\r\n            disabled={isProcessing}\r\n          >\r\n            <svg\r\n              xmlns=\"http://www.w3.org/2000/svg\"\r\n              viewBox=\"0 0 24 24\"\r\n              fill=\"none\"\r\n              stroke=\"currentColor\"\r\n              strokeWidth={2.5}\r\n              className=\"h-4 w-4\"\r\n            >\r\n              <circle cx=\"5\" cy=\"12\" r=\"1.5\" />\r\n              <circle cx=\"12\" cy=\"12\" r=\"1.5\" />\r\n              <circle cx=\"19\" cy=\"12\" r=\"1.5\" />\r\n            </svg>\r\n          </button>\r\n          {openMenu && (\r\n            <div\r\n              ref={menuRef}\r\n              className=\"absolute right-0 top-10 z-50 min-w-[160px] rounded-lg border border-gray-200 bg-white shadow-lg\"\r\n            >\r\n              <button\r\n                type=\"button\"\r\n                onClick={handleEditClick}\r\n                disabled={isProcessing || !voice.id || !currentUserId}\r\n                className=\"w-full rounded-t-lg px-4 py-2 text-left text-sm text-gray-700 transition hover:bg-gray-50 disabled:opacity-50\"\r\n              >\r\n                Редактировать\r\n              </button>\r\n              <button\r\n                type=\"button\"\r\n                onClick={handleDeleteClick}\r\n                disabled={isProcessing || !voice.id || !currentUserId}\r\n                className=\"w-full rounded-b-lg px-4 py-2 text-left text-sm text-red-600 transition hover:bg-red-50 disabled:opacity-50\"\r\n              >\r\n                Удалить\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n        <div className=\"flex items-center gap-4\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={handlePlay}\r\n            className=\"flex h-12 w-12 shrink-0 items-center justify-center rounded-full bg-purple-600 text-white transition hover:bg-purple-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-purple-600\"\r\n            aria-label={isPlaying ? \"Остановить воспроизведение\" : \"Проиграть голос\"}\r\n          >\r\n            {isPlaying ? (\r\n              <svg\r\n                xmlns=\"http://www.w3.org/2000/svg\"\r\n                viewBox=\"0 0 24 24\"\r\n                fill=\"currentColor\"\r\n                className=\"h-6 w-6\"\r\n              >\r\n                <path d=\"M6 4h4v16H6V4zm8 0h4v16h-4V4z\" />\r\n              </svg>\r\n            ) : (\r\n              <svg\r\n                xmlns=\"http://www.w3.org/2000/svg\"\r\n                viewBox=\"0 0 24 24\"\r\n                fill=\"currentColor\"\r\n                className=\"h-6 w-6\"\r\n              >\r\n                <path d=\"M8 5v14l11-7z\" />\r\n              </svg>\r\n            )}\r\n          </button>\r\n          <div className=\"min-w-0 flex-1\">\r\n            <p className=\"text-lg font-semibold text-gray-900 line-clamp-2\">{voice.name}</p>\r\n          </div>\r\n        </div>\r\n        {formattedDescription && (\r\n          <p className=\"mt-4 line-clamp-2 text-sm text-gray-600\">{formattedDescription}</p>\r\n        )}\r\n      </article>\r\n      <VoiceDeleteModal\r\n        isOpen={isDeleteModalOpen}\r\n        onClose={() => setIsDeleteModalOpen(false)}\r\n        onConfirm={handleDeleteConfirm}\r\n        voiceName={voice.name}\r\n        isDeleting={deletingId}\r\n      />\r\n      <VoiceEditModal\r\n        isOpen={isEditModalOpen}\r\n        onClose={() => setIsEditModalOpen(false)}\r\n        onConfirm={handleEditConfirm}\r\n        currentName={voice.name}\r\n        currentDescription={voice.description ?? \"\"}\r\n        isSaving={editingId}\r\n      />\r\n    </>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2789, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/voices/components/VoiceCreateModal.tsx"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport { supabase } from \"@/lib/supabaseClient\";\n\ninterface VoiceCreateModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onVoiceCreated?: () => void | Promise<void>;\n}\n\nconst MAX_FILE_SIZE = 50 * 1024 * 1024; // 50 МБ\nconst ALLOWED_TYPES = [\"audio/mpeg\", \"audio/mp3\", \"audio/wav\", \"audio/webm\", \"audio/ogg\"];\nconst MAX_DESCRIPTION_LENGTH = 100;\n\nexport function VoiceCreateModal({\n  isOpen,\n  onClose,\n  onVoiceCreated,\n}: VoiceCreateModalProps) {\n  const [voiceName, setVoiceName] = useState(\"\");\n  const [voiceDescription, setVoiceDescription] = useState(\"\");\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [isRecording, setIsRecording] = useState(false);\n  const [recordedBlob, setRecordedBlob] = useState<Blob | null>(null);\n  const [recordedAudioUrl, setRecordedAudioUrl] = useState<string | null>(null);\n  const [isUploading, setIsUploading] = useState(false);\n  const [isWaiting, setIsWaiting] = useState(false);\n  const [progress, setProgress] = useState(0);\n  const [dragActive, setDragActive] = useState(false);\n  const progressIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  \n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const audioChunksRef = useRef<Blob[]>([]);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const audioPlayerRef = useRef<HTMLAudioElement>(null);\n\n  const stopProgressLoop = useCallback(() => {\n    if (progressIntervalRef.current) {\n      clearInterval(progressIntervalRef.current);\n      progressIntervalRef.current = null;\n    }\n  }, []);\n\n  const startProgressLoop = useCallback(() => {\n    stopProgressLoop();\n    setProgress(0);\n    const startTime = Date.now();\n    progressIntervalRef.current = setInterval(() => {\n      const elapsed = Date.now() - startTime;\n      const nextValue = Math.min(100, (elapsed / 15000) * 100);\n      setProgress(nextValue);\n    }, 50);\n  }, [stopProgressLoop]);\n\n  const resetState = useCallback(() => {\n    setVoiceName(\"\");\n    setVoiceDescription(\"\");\n    setSelectedFile(null);\n    setRecordedBlob(null);\n    // Очищаем URL для освобождения памяти\n    if (recordedAudioUrl) {\n      URL.revokeObjectURL(recordedAudioUrl);\n    }\n    setRecordedAudioUrl(null);\n    setIsRecording(false);\n    setIsWaiting(false);\n    setProgress(0);\n    stopProgressLoop();\n    audioChunksRef.current = [];\n    if (mediaRecorderRef.current && mediaRecorderRef.current.state !== \"inactive\") {\n      mediaRecorderRef.current.stop();\n    }\n    if (mediaRecorderRef.current?.stream) {\n      mediaRecorderRef.current.stream.getTracks().forEach(track => track.stop());\n    }\n  }, [recordedAudioUrl, stopProgressLoop]);\n\n  const closeModal = useCallback(() => {\n    resetState();\n    onClose();\n  }, [onClose, resetState]);\n\n  useEffect(() => {\n    return () => {\n      if (mediaRecorderRef.current?.stream) {\n        mediaRecorderRef.current.stream.getTracks().forEach(track => track.stop());\n      }\n      // Очищаем URL при размонтировании\n      if (recordedAudioUrl) {\n        URL.revokeObjectURL(recordedAudioUrl);\n      }\n      stopProgressLoop();\n    };\n  }, [recordedAudioUrl, stopProgressLoop]);\n\n  const validateFile = (file: File): boolean => {\n    if (!ALLOWED_TYPES.includes(file.type.toLowerCase())) {\n      alert(\"Неподдерживаемый формат файла. Допустимы только MP3, WAV, WebM или OGG.\");\n      return false;\n    }\n    if (file.size > MAX_FILE_SIZE) {\n      alert(`Файл превышает лимит 50 МБ. Размер файла: ${(file.size / 1024 / 1024).toFixed(1)} МБ`);\n      return false;\n    }\n    return true;\n  };\n\n  const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => {\n    if (event.target.files?.[0]) {\n      const file = event.target.files[0];\n      if (validateFile(file)) {\n        setSelectedFile(file);\n        setRecordedBlob(null); // Сбрасываем запись если выбрали файл\n      }\n    }\n  };\n\n  const handleDrag = useCallback((event: React.DragEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    if (event.type === \"dragenter\" || event.type === \"dragover\") {\n      setDragActive(true);\n    } else if (event.type === \"dragleave\") {\n      setDragActive(false);\n    }\n  }, []);\n\n  const handleDrop = useCallback((event: React.DragEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    setDragActive(false);\n    if (event.dataTransfer.files?.[0]) {\n      const file = event.dataTransfer.files[0];\n      if (validateFile(file)) {\n        setSelectedFile(file);\n        setRecordedBlob(null); // Сбрасываем запись если выбрали файл\n      }\n    }\n  }, []);\n\n  const startRecording = async () => {\n    try {\n      // Проверяем доступность API\n      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n        alert(\n          \"Ваш браузер не поддерживает запись с микрофона. Пожалуйста, используйте современный браузер (Chrome, Firefox, Edge).\"\n        );\n        return;\n      }\n\n      // Проверяем разрешения перед запросом\n      try {\n        const permissionStatus = await navigator.permissions.query({ name: \"microphone\" as PermissionName });\n        if (permissionStatus.state === \"denied\") {\n          alert(\n            \"Доступ к микрофону запрещен. Пожалуйста, разрешите доступ к микрофону в настройках браузера и обновите страницу.\"\n          );\n          return;\n        }\n      } catch (permError) {\n        // Некоторые браузеры не поддерживают permissions API, продолжаем\n        console.log(\"Permissions API не поддерживается, продолжаем запрос\");\n      }\n\n      const stream = await navigator.mediaDevices.getUserMedia({ \n        audio: {\n          echoCancellation: true,\n          noiseSuppression: true,\n          autoGainControl: true,\n        } \n      });\n      \n      const mediaRecorder = new MediaRecorder(stream, {\n        mimeType: MediaRecorder.isTypeSupported(\"audio/webm\") \n          ? \"audio/webm\" \n          : MediaRecorder.isTypeSupported(\"audio/webm;codecs=opus\")\n          ? \"audio/webm;codecs=opus\"\n          : \"audio/mp4\"\n      });\n      \n      mediaRecorderRef.current = mediaRecorder;\n      audioChunksRef.current = [];\n\n      mediaRecorder.ondataavailable = (event) => {\n        if (event.data.size > 0) {\n          audioChunksRef.current.push(event.data);\n        }\n      };\n\n      mediaRecorder.onstop = () => {\n        const mimeType = mediaRecorder.mimeType || \"audio/webm\";\n        const audioBlob = new Blob(audioChunksRef.current, { type: mimeType });\n        setRecordedBlob(audioBlob);\n        \n        // Создаем URL для воспроизведения\n        const audioUrl = URL.createObjectURL(audioBlob);\n        setRecordedAudioUrl(audioUrl);\n        \n        setSelectedFile(null); // Сбрасываем файл если записали\n        stream.getTracks().forEach(track => track.stop());\n      };\n\n      mediaRecorder.onerror = (event) => {\n        console.error(\"Ошибка записи:\", event);\n        setIsRecording(false);\n        stream.getTracks().forEach(track => track.stop());\n        alert(\"Произошла ошибка при записи. Попробуйте еще раз.\");\n      };\n\n      mediaRecorder.start();\n      setIsRecording(true);\n    } catch (error: unknown) {\n      console.error(\"Ошибка доступа к микрофону:\", error);\n      setIsRecording(false);\n      \n      let errorMessage = \"Не удалось получить доступ к микрофону.\";\n      \n      if (error instanceof Error) {\n        if (error.name === \"NotAllowedError\" || error.name === \"PermissionDeniedError\") {\n          errorMessage = \n            \"Доступ к микрофону запрещен.\\n\\n\" +\n            \"Пожалуйста:\\n\" +\n            \"1. Нажмите на иконку замка в адресной строке браузера\\n\" +\n            \"2. Разрешите доступ к микрофону\\n\" +\n            \"3. Обновите страницу и попробуйте снова\";\n        } else if (error.name === \"NotFoundError\" || error.name === \"DevicesNotFoundError\") {\n          errorMessage = \"Микрофон не найден. Убедитесь, что микрофон подключен и включен.\";\n        } else if (error.name === \"NotReadableError\" || error.name === \"TrackStartError\") {\n          errorMessage = \n            \"Микрофон уже используется другим приложением.\\n\\n\" +\n            \"Закройте другие приложения, использующие микрофон, и попробуйте снова.\";\n        } else {\n          errorMessage = `Ошибка: ${error.message}`;\n        }\n      }\n      \n      alert(errorMessage);\n    }\n  };\n\n  const stopRecording = () => {\n    if (mediaRecorderRef.current && mediaRecorderRef.current.state !== \"inactive\") {\n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n    }\n  };\n\n  const loadLameJs = (): Promise<any> => {\n    return new Promise((resolve, reject) => {\n      if (typeof window !== \"undefined\" && (window as any).lamejs) {\n        resolve((window as any).lamejs);\n        return;\n      }\n\n      const script = document.createElement(\"script\");\n      script.src = \"https://cdn.jsdelivr.net/npm/lamejs@1.2.1/lame.min.js\";\n      script.onload = () => resolve((window as any).lamejs);\n      script.onerror = () => reject(new Error(\"Не удалось загрузить библиотеку конвертации\"));\n      document.head.appendChild(script);\n    });\n  };\n\n  const convertWebmToMp3 = async (webmBlob: Blob): Promise<File> => {\n    const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n    const arrayBuffer = await webmBlob.arrayBuffer();\n    const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);\n\n    try {\n      // Пытаемся использовать lamejs для конвертации в MP3\n      const Lame = await loadLameJs();\n      \n      const mp3encoder = new Lame.Mp3Encoder(\n        audioBuffer.numberOfChannels,\n        audioBuffer.sampleRate,\n        128 // bitrate\n      );\n\n      // Конвертируем float32 в int16\n      const samples: Int16Array[] = [];\n      for (let i = 0; i < audioBuffer.numberOfChannels; i++) {\n        const channelData = audioBuffer.getChannelData(i);\n        const int16Array = new Int16Array(channelData.length);\n        for (let j = 0; j < channelData.length; j++) {\n          int16Array[j] = Math.max(-32768, Math.min(32767, channelData[j] * 32768));\n        }\n        samples.push(int16Array);\n      }\n\n      const mp3Data: BlobPart[] = [];\n      const sampleBlockSize = 1152;\n      \n      for (let i = 0; i < samples[0].length; i += sampleBlockSize) {\n        const left = samples[0].subarray(i, i + sampleBlockSize);\n        const right = audioBuffer.numberOfChannels > 1 \n          ? samples[1].subarray(i, i + sampleBlockSize)\n          : left;\n        const mp3buf = mp3encoder.encodeBuffer(left, right);\n        if (mp3buf.length > 0) {\n          mp3Data.push(mp3buf);\n        }\n      }\n\n      const mp3buf = mp3encoder.flush();\n      if (mp3buf.length > 0) {\n        mp3Data.push(mp3buf);\n      }\n\n      const mp3Blob = new Blob(mp3Data, { type: \"audio/mpeg\" });\n      return new File([mp3Blob], \"recording.mp3\", { type: \"audio/mpeg\" });\n    } catch (error) {\n      // Fallback: если lamejs не загрузился, конвертируем в WAV\n      console.warn(\"Не удалось использовать lamejs, используем WAV формат:\", error);\n      const wavBlob = audioBufferToWav(audioBuffer);\n      // Отправляем как WAV с расширением mp3 (сервер может конвертировать)\n      return new File([wavBlob], \"recording.mp3\", { type: \"audio/mpeg\" });\n    }\n  };\n\n  const audioBufferToWav = (buffer: AudioBuffer): Blob => {\n    const length = buffer.length;\n    const numberOfChannels = buffer.numberOfChannels;\n    const sampleRate = buffer.sampleRate;\n    const arrayBuffer = new ArrayBuffer(44 + length * numberOfChannels * 2);\n    const view = new DataView(arrayBuffer);\n\n    // WAV header\n    const writeString = (offset: number, string: string) => {\n      for (let i = 0; i < string.length; i++) {\n        view.setUint8(offset + i, string.charCodeAt(i));\n      }\n    };\n\n    writeString(0, \"RIFF\");\n    view.setUint32(4, 36 + length * numberOfChannels * 2, true);\n    writeString(8, \"WAVE\");\n    writeString(12, \"fmt \");\n    view.setUint32(16, 16, true);\n    view.setUint16(20, 1, true);\n    view.setUint16(22, numberOfChannels, true);\n    view.setUint32(24, sampleRate, true);\n    view.setUint32(28, sampleRate * numberOfChannels * 2, true);\n    view.setUint16(32, numberOfChannels * 2, true);\n    view.setUint16(34, 16, true);\n    writeString(36, \"data\");\n    view.setUint32(40, length * numberOfChannels * 2, true);\n\n    // Convert float samples to 16-bit PCM\n    let offset = 44;\n    for (let i = 0; i < length; i++) {\n      for (let channel = 0; channel < numberOfChannels; channel++) {\n        const sample = Math.max(-1, Math.min(1, buffer.getChannelData(channel)[i]));\n        view.setInt16(offset, sample < 0 ? sample * 0x8000 : sample * 0x7FFF, true);\n        offset += 2;\n      }\n    }\n\n    return new Blob([arrayBuffer], { type: \"audio/wav\" });\n  };\n\n  const handleCloneVoice = async () => {\n    if (!voiceName.trim()) {\n      alert(\"Введите название голоса\");\n      return;\n    }\n\n    // Запускаем прогресс-бар сразу при нажатии на кнопку\n    setIsUploading(true);\n    setIsWaiting(true);\n    startProgressLoop();\n\n    let audioFile: File | null = null;\n\n    if (selectedFile) {\n      // Если файл загружен, используем его как есть\n      audioFile = selectedFile;\n    } else if (recordedBlob) {\n      // Если запись с микрофона, конвертируем webm в mp3\n      try {\n        audioFile = await convertWebmToMp3(recordedBlob);\n      } catch (error) {\n        console.error(\"[voices] Ошибка конвертации:\", error);\n        stopProgressLoop();\n        setIsUploading(false);\n        setIsWaiting(false);\n        alert(\"Ошибка при конвертации записи. Попробуйте еще раз.\");\n        return;\n      }\n    } else {\n      stopProgressLoop();\n      setIsUploading(false);\n      setIsWaiting(false);\n      alert(\"Загрузите файл или запишите голос с микрофона\");\n      return;\n    }\n\n    try {\n      // Получаем UUID авторизованного пользователя\n      const {\n        data: { user },\n        error: authError,\n      } = await supabase.auth.getUser();\n\n      if (authError || !user) {\n        throw new Error(\"Не удалось получить данные пользователя\");\n      }\n\n      const formData = new FormData();\n      formData.append(\"name\", voiceName.trim());\n      if (voiceDescription.trim()) {\n        const trimmedDescription = voiceDescription.trim().slice(0, MAX_DESCRIPTION_LENGTH);\n        formData.append(\"description\", trimmedDescription);\n      }\n      formData.append(\"file\", audioFile);\n      formData.append(\"uuid\", user.id);\n\n      const response = await fetch(\n        \"https://rueleven.ru/webhook/053aa1a5-396c-4cff-b9c4-a71ca8910a22\",\n        {\n          method: \"POST\",\n          body: formData,\n        }\n      );\n\n      if (!response.ok) {\n        throw new Error(`Ошибка отправки: ${response.statusText}`);\n      }\n\n      // Отправляем вебхук с UUID пользователя при клонировании голоса\n      try {\n        await fetch(\"https://rueleven.ru/webhook/373bb6fa-8fae-49fd-83b6-b503e7f286c4\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify({ uuid: user.id }),\n        });\n      } catch (webhookError) {\n        // Логируем ошибку вебхука, но не прерываем процесс клонирования\n        console.error(\"[VoiceCreateModal] Ошибка отправки вебхука UUID:\", webhookError);\n      }\n\n      // Продолжаем ждать появления записи в таблице (прогресс-бар уже запущен)\n      setIsUploading(false);\n\n      // Ждем появления записи в таблице voices\n      const timeoutMs = 30000; // 30 секунд максимум\n      const pollDelayMs = 1000; // Проверяем каждую секунду\n      const deadline = Date.now() + timeoutMs;\n      let found = false;\n\n      while (Date.now() < deadline && !found) {\n        const { data, error } = await supabase\n          .from(\"voices\")\n          .select(\"*\")\n          .eq(\"uid\", user.id)\n          .eq(\"name\", voiceName.trim())\n          .order(\"created_at\", { ascending: false })\n          .limit(1);\n\n        if (!error && data && data.length > 0) {\n          found = true;\n          stopProgressLoop();\n          setProgress(100);\n          await new Promise((resolve) => setTimeout(resolve, 300)); // Небольшая задержка для завершения анимации\n          setIsWaiting(false);\n          await onVoiceCreated?.();\n          closeModal();\n          return;\n        }\n\n        await new Promise((resolve) => setTimeout(resolve, pollDelayMs));\n      }\n\n      // Если не нашли за отведенное время\n      stopProgressLoop();\n      setIsWaiting(false);\n      alert(\"Голос отправлен на обработку. Проверьте список голосов через несколько секунд.\");\n      await onVoiceCreated?.();\n      closeModal();\n    } catch (error) {\n      console.error(\"[voices] Ошибка клонирования голоса:\", error);\n      stopProgressLoop();\n      setIsUploading(false);\n      setIsWaiting(false);\n      alert(\n        `Ошибка при клонировании голоса: ${\n          error instanceof Error ? error.message : \"Неизвестная ошибка\"\n        }`\n      );\n    }\n  };\n\n  const dropZoneClasses = `rounded-2xl border border-dashed border-purple-400/50 bg-purple-50/30 p-6 text-center transition-all duration-200 ${\n    dragActive\n      ? \"shadow-lg -translate-y-0.5 border-purple-500\"\n      : \"hover:shadow-md hover:-translate-y-0.5\"\n  }`;\n\n  if (!isOpen) {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-8\">\n      <div className=\"w-full max-w-lg rounded-[32px] bg-white shadow-2xl\">\n        <div className=\"relative flex items-center justify-center border-b px-6 py-4\">\n          <h2 className=\"text-lg font-semibold text-gray-900\">\n            Создать голос\n          </h2>\n          <button\n            type=\"button\"\n            onClick={closeModal}\n            className=\"absolute right-6 rounded-full p-1 text-gray-400 transition hover:bg-gray-100 hover:text-gray-600\"\n            disabled={isUploading || isRecording}\n          >\n            <span className=\"sr-only\">Закрыть</span>✕\n          </button>\n        </div>\n\n        <div className=\"max-h-[70vh] overflow-y-auto px-6 py-6 [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-track]:bg-gray-100 [&::-webkit-scrollbar-thumb]:bg-gray-300 [&::-webkit-scrollbar-thumb]:rounded-full\">\n          <div className=\"space-y-6 text-sm text-gray-600\">\n            <div>\n              <label\n                htmlFor=\"voice-name\"\n                className=\"mb-2 block text-xs font-semibold uppercase tracking-wide text-gray-500\"\n              >\n                Название голоса\n              </label>\n              <input\n                id=\"voice-name\"\n                value={voiceName}\n                onChange={(event) => setVoiceName(event.target.value)}\n                placeholder=\"Придумайте название голоса\"\n                className=\"w-full rounded-2xl border border-gray-200 bg-gray-50 px-4 py-3 text-base text-gray-900 outline-none transition focus:border-gray-400\"\n                disabled={isUploading || isRecording}\n              />\n            </div>\n\n            <div>\n              <div className=\"mb-2 flex items-center justify-between\">\n                <label\n                  htmlFor=\"voice-description\"\n                  className=\"block text-xs font-semibold uppercase tracking-wide text-gray-500\"\n                >\n                  Описание голоса <span className=\"text-gray-400\">(необязательно)</span>\n                </label>\n                <span className={`text-xs ${\n                  voiceDescription.length > MAX_DESCRIPTION_LENGTH \n                    ? \"text-red-500\" \n                    : \"text-gray-400\"\n                }`}>\n                  {voiceDescription.length}/{MAX_DESCRIPTION_LENGTH}\n                </span>\n              </div>\n              <textarea\n                id=\"voice-description\"\n                value={voiceDescription}\n                onChange={(event) => {\n                  const value = event.target.value;\n                  if (value.length <= MAX_DESCRIPTION_LENGTH) {\n                    setVoiceDescription(value);\n                  }\n                }}\n                maxLength={MAX_DESCRIPTION_LENGTH}\n                placeholder=\"Добавьте описание голоса\"\n                className=\"h-28 w-full rounded-2xl border border-gray-200 bg-gray-50 px-4 py-3 text-base text-gray-900 outline-none transition focus:border-gray-400\"\n                disabled={isUploading || isRecording}\n              />\n            </div>\n\n            {/* Загрузка файла */}\n            <div\n              className={dropZoneClasses}\n              onDragEnter={handleDrag}\n              onDragLeave={handleDrag}\n              onDragOver={handleDrag}\n              onDrop={handleDrop}\n            >\n              <div className=\"mx-auto flex max-w-sm flex-col items-center gap-3 text-gray-700\">\n                <div className=\"rounded-2xl border border-purple-200 bg-white p-3 text-purple-500\">\n                  ↑\n                </div>\n                <p className=\"text-base font-semibold\">\n                  Перетащите аудио файл сюда\n                </p>\n                <p className=\"text-xs text-gray-500\">MP3, WAV, WebM или OGG до 50 МБ</p>\n                <button\n                  type=\"button\"\n                  className=\"rounded-lg bg-purple-600 px-6 py-2 text-sm font-semibold text-white transition hover:bg-purple-500 disabled:opacity-50\"\n                  onClick={() => fileInputRef.current?.click()}\n                  disabled={isUploading || isRecording}\n                >\n                  Выбрать файл\n                </button>\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  accept=\"audio/*\"\n                  className=\"hidden\"\n                  onChange={handleFileSelect}\n                  disabled={isUploading || isRecording}\n                />\n              </div>\n            </div>\n\n            {/* Выбранный файл */}\n            {selectedFile && (\n              <div className=\"rounded-2xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-700\">\n                <div className=\"flex items-center justify-between gap-3\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"rounded-lg bg-purple-100 p-2 text-purple-600\">\n                      🎵\n                    </div>\n                    <div>\n                      <div className=\"font-medium\">{selectedFile.name}</div>\n                      <div className=\"text-xs text-gray-500\">\n                        {(selectedFile.size / 1024 / 1024).toFixed(2)} МБ\n                      </div>\n                    </div>\n                  </div>\n                  <button\n                    type=\"button\"\n                    onClick={() => setSelectedFile(null)}\n                    className=\"text-gray-400 transition hover:text-red-500\"\n                    disabled={isUploading || isRecording}\n                  >\n                    ✕\n                  </button>\n                </div>\n              </div>\n            )}\n\n            {/* Разделитель */}\n            <div className=\"relative\">\n              <div className=\"absolute inset-0 flex items-center\">\n                <div className=\"w-full border-t border-gray-200\"></div>\n              </div>\n              <div className=\"relative flex justify-center text-xs uppercase\">\n                <span className=\"bg-white px-2 text-gray-500\">или</span>\n              </div>\n            </div>\n\n            {/* Запись с микрофона */}\n            <div className=\"rounded-2xl border border-gray-200 bg-gray-50 p-6 text-center\">\n              <div className=\"mx-auto flex max-w-sm flex-col items-center gap-4\">\n                <div className=\"rounded-full border-4 border-purple-200 bg-white p-4\">\n                  {isRecording ? (\n                    <div className=\"h-12 w-12 animate-pulse rounded-full bg-red-500\"></div>\n                  ) : (\n                    <div className=\"h-12 w-12 rounded-full bg-purple-500\"></div>\n                  )}\n                </div>\n                <div>\n                  <p className=\"text-base font-semibold text-gray-900\">\n                    {isRecording ? \"Идет запись...\" : \"Записать с микрофона\"}\n                  </p>\n                  <p className=\"mt-1 text-xs text-gray-500\">\n                    {isRecording\n                      ? \"Нажмите остановить для завершения записи\"\n                      : \"Нажмите начать для записи голоса\"}\n                  </p>\n                </div>\n                {!isRecording ? (\n                  <button\n                    type=\"button\"\n                    onClick={startRecording}\n                    className=\"rounded-lg bg-purple-600 px-6 py-2 text-sm font-semibold text-white transition hover:bg-purple-500 disabled:opacity-50\"\n                    disabled={isUploading || !!selectedFile}\n                  >\n                    Начать запись\n                  </button>\n                ) : (\n                  <button\n                    type=\"button\"\n                    onClick={stopRecording}\n                    className=\"rounded-lg bg-red-600 px-6 py-2 text-sm font-semibold text-white transition hover:bg-red-500\"\n                  >\n                    Остановить запись\n                  </button>\n                )}\n              </div>\n            </div>\n\n            {/* Записанный файл */}\n            {recordedBlob && !isRecording && recordedAudioUrl && (\n              <div className=\"rounded-2xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-700\">\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center justify-between gap-3\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"rounded-lg bg-green-100 p-2 text-green-600\">\n                        ✓\n                      </div>\n                      <div>\n                        <div className=\"font-medium\">Запись завершена</div>\n                        <div className=\"text-xs text-gray-500\">\n                          {(recordedBlob.size / 1024).toFixed(2)} КБ\n                        </div>\n                      </div>\n                    </div>\n                    <button\n                      type=\"button\"\n                      onClick={() => {\n                        setRecordedBlob(null);\n                        if (recordedAudioUrl) {\n                          URL.revokeObjectURL(recordedAudioUrl);\n                        }\n                        setRecordedAudioUrl(null);\n                      }}\n                      className=\"text-gray-400 transition hover:text-red-500\"\n                      disabled={isUploading}\n                    >\n                      ✕\n                    </button>\n                  </div>\n                  {/* Аудио плеер */}\n                  <div className=\"flex items-center gap-2 rounded-lg bg-white p-2\">\n                    <audio\n                      ref={audioPlayerRef}\n                      src={recordedAudioUrl}\n                      controls\n                      className=\"flex-1\"\n                      style={{ height: \"32px\" }}\n                    />\n                  </div>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n\n        <div className=\"flex flex-col gap-3 border-t border-gray-200 px-6 py-4 text-sm text-gray-500 sm:flex-row sm:items-center sm:justify-between sm:gap-4\">\n          <div className=\"flex flex-1 items-center gap-4\">\n            <button\n              type=\"button\"\n              onClick={closeModal}\n              className=\"rounded-lg border border-gray-200 px-5 py-2 text-sm font-semibold text-gray-700 transition hover:bg-gray-50\"\n              disabled={isUploading || isRecording || isWaiting}\n            >\n              Отмена\n            </button>\n            {(isUploading || isWaiting || progress > 0) && (\n              <div className=\"relative h-1 flex-1 overflow-hidden rounded-full bg-gray-200\">\n                <div\n                  className=\"absolute inset-y-0 left-0 rounded-full bg-gradient-to-r from-purple-500 via-purple-600 to-purple-500 transition-[width] duration-100 ease-out\"\n                  style={{ width: `${progress}%` }}\n                  aria-hidden=\"true\"\n                />\n              </div>\n            )}\n          </div>\n          <button\n            type=\"button\"\n            onClick={handleCloneVoice}\n            disabled={\n              isUploading ||\n              isRecording ||\n              isWaiting ||\n              !voiceName.trim() ||\n              (!selectedFile && !recordedBlob)\n            }\n            className=\"rounded-lg bg-purple-600 px-6 py-2 text-sm font-semibold text-white transition hover:bg-purple-500 disabled:cursor-not-allowed disabled:bg-gray-300 sm:ml-auto\"\n          >\n            {isUploading\n              ? \"Клонируем...\"\n              : isWaiting\n                ? \"Ожидаем...\"\n                : \"Клонировать голос\"}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3815, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/%28main%29/components/DashboardVoicesSection.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { DashboardVoiceCard } from \"./DashboardVoiceCard\";\r\nimport { VoiceCreateModal } from \"@/app/voices/components/VoiceCreateModal\";\r\n\r\ninterface VoiceRow {\r\n  id?: string;\r\n  uid: string;\r\n  name: string;\r\n  url: string;\r\n  created_at?: string;\r\n  description?: string | null;\r\n}\r\n\r\ninterface DashboardVoicesSectionProps {\r\n  voices: VoiceRow[];\r\n  currentUserId: string | null;\r\n  onVoicesChanged?: () => void | Promise<void>;\r\n}\r\n\r\nexport function DashboardVoicesSection({\r\n  voices,\r\n  currentUserId,\r\n  onVoicesChanged,\r\n}: DashboardVoicesSectionProps) {\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n\r\n  return (\r\n    <section>\r\n      <div className=\"mb-6 flex items-center justify-between\">\r\n        <h2 className=\"text-2xl font-bold text-gray-900\">Мои голоса</h2>\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => setIsModalOpen(true)}\r\n          className=\"min-w-[170px] rounded-lg bg-purple-600 px-4 py-3 text-sm font-semibold text-white transition hover:bg-purple-500\"\r\n        >\r\n          Создать голос\r\n        </button>\r\n      </div>\r\n      {voices.length === 0 ? (\r\n        <div className=\"rounded-2xl border border-gray-200 bg-gray-50 p-12 text-center\">\r\n          <p className=\"text-gray-600\">У вас пока нет голосов</p>\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setIsModalOpen(true)}\r\n            className=\"mt-4 inline-block rounded-lg bg-purple-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-purple-500\"\r\n          >\r\n            Создать голос\r\n          </button>\r\n        </div>\r\n      ) : (\r\n        <div className=\"grid gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6\">\r\n          {voices.map((voice) => {\r\n            const key = voice.id ?? `${voice.uid}-${voice.name}`;\r\n            return (\r\n              <DashboardVoiceCard\r\n                key={key}\r\n                voice={voice}\r\n                currentUserId={currentUserId}\r\n                onVoiceChanged={onVoicesChanged}\r\n              />\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n      <VoiceCreateModal\r\n        isOpen={isModalOpen}\r\n        onClose={() => setIsModalOpen(false)}\r\n        onVoiceCreated={onVoicesChanged}\r\n      />\r\n    </section>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAqBO,SAAS,uBAAuB,EACrC,MAAM,EACN,aAAa,EACb,eAAe,EACa;IAC5B,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC;IAE/C,qBACE,8OAAC;;0BACC,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;kCAAmC;;;;;;kCACjD,8OAAC;wBACC,MAAK;wBACL,SAAS,IAAM,eAAe;wBAC9B,WAAU;kCACX;;;;;;;;;;;;YAIF,OAAO,MAAM,KAAK,kBACjB,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAE,WAAU;kCAAgB;;;;;;kCAC7B,8OAAC;wBACC,MAAK;wBACL,SAAS,IAAM,eAAe;wBAC9B,WAAU;kCACX;;;;;;;;;;;qCAKH,8OAAC;gBAAI,WAAU;0BACZ,OAAO,GAAG,CAAC,CAAC;oBACX,MAAM,MAAM,MAAM,EAAE,IAAI,GAAG,MAAM,GAAG,CAAC,CAAC,EAAE,MAAM,IAAI,EAAE;oBACpD,qBACE,8OAAC,0KAAkB;wBAEjB,OAAO;wBACP,eAAe;wBACf,gBAAgB;uBAHX;;;;;gBAMX;;;;;;0BAGJ,8OAAC,oKAAgB;gBACf,QAAQ;gBACR,SAAS,IAAM,eAAe;gBAC9B,gBAAgB;;;;;;;;;;;;AAIxB"}},
    {"offset": {"line": 3924, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/%28main%29/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState, useCallback } from \"react\";\nimport Link from \"next/link\";\nimport { supabase } from \"@/lib/supabaseClient\";\nimport { AuthCard } from \"./components/AuthCard\";\nimport { Header } from \"@/components/ui/Header\";\nimport { CosmoLoader } from \"@/components/ui/CosmoLoader\";\nimport { DashboardAvatarsSection } from \"./components/DashboardAvatarsSection\";\nimport { DashboardVoicesSection } from \"./components/DashboardVoicesSection\";\nimport type { PhotoAvatarRow } from \"@/app/avatars/servers/UploadAvatar\";\n\nexport const dynamic = 'force-dynamic';\n\ninterface VoiceRow {\n  id?: string;\n  uid: string;\n  name: string;\n  url: string;\n  created_at?: string;\n  description?: string | null;\n}\n\nexport default function Home() {\n  const [user, setUser] = useState<any>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [avatars, setAvatars] = useState<PhotoAvatarRow[]>([]);\n  const [voices, setVoices] = useState<VoiceRow[]>([]);\n  const [isLoadingData, setIsLoadingData] = useState(false);\n\n  useEffect(() => {\n    const checkAuth = async () => {\n      const {\n        data: { user: currentUser },\n      } = await supabase.auth.getUser();\n      setUser(currentUser);\n      setIsLoading(false);\n      \n      if (currentUser) {\n        fetchDashboardData();\n      }\n    };\n\n    checkAuth();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const fetchDashboardData = useCallback(async () => {\n    setIsLoadingData(true);\n    \n    const {\n      data: { user: currentUser },\n    } = await supabase.auth.getUser();\n\n    if (!currentUser) {\n      setIsLoadingData(false);\n      return;\n    }\n\n    // Загружаем аватары (первые 6)\n    const { data: avatarsData } = await supabase\n      .from(\"photo_avatars\")\n      .select(\"*\")\n      .eq(\"uid\", currentUser.id)\n      .order(\"created_at\", { ascending: false })\n      .limit(6);\n\n    // Загружаем голоса (первые 6)\n    const { data: voicesData } = await supabase\n      .from(\"voices\")\n      .select(\"*\")\n      .eq(\"uid\", currentUser.id)\n      .order(\"created_at\", { ascending: false })\n      .limit(6);\n\n    setAvatars(avatarsData ?? []);\n    setVoices((voicesData ?? []).filter((v) => v.url && v.name));\n    setIsLoadingData(false);\n  }, []);\n\n  if (isLoading) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-white\">\n        <CosmoLoader ariaLabel=\"Загрузка...\" />\n      </div>\n    );\n  }\n\n  if (!user) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-white px-4 py-8\">\n        <AuthCard />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-white\">\n      <Header />\n      <main className=\"mx-auto w-full max-w-[1350px] px-6 py-8\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900\">Главная</h1>\n          <p className=\"mt-2 text-gray-600\">Обзор ваших аватаров, голосов и материалов</p>\n        </div>\n\n        {isLoadingData ? (\n          <div className=\"flex justify-center py-12\">\n            <CosmoLoader ariaLabel=\"Загружаем данные...\" />\n          </div>\n        ) : (\n          <div className=\"space-y-12\">\n            <DashboardAvatarsSection\n              avatars={avatars}\n              currentUserId={user.id}\n              onAvatarsChanged={fetchDashboardData}\n            />\n\n            <DashboardVoicesSection\n              voices={voices}\n              currentUserId={user.id}\n              onVoicesChanged={fetchDashboardData}\n            />\n\n            {/* Секция материалов/видео */}\n            <section>\n              <div className=\"mb-6 flex items-center justify-between\">\n                <h2 className=\"text-2xl font-bold text-gray-900\">Мои материалы</h2>\n                <Link\n                  href=\"/material\"\n                  className=\"text-green-600 hover:text-green-700 font-semibold transition\"\n                >\n                  Все материалы →\n                </Link>\n              </div>\n              <div className=\"rounded-2xl border border-gray-200 bg-gray-50 p-12 text-center\">\n                <p className=\"text-gray-600\">У вас пока нет материалов</p>\n                <Link\n                  href=\"/material/editor\"\n                  className=\"mt-4 inline-block rounded-lg bg-green-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-green-500\"\n                >\n                  Создать материал\n                </Link>\n              </div>\n            </section>\n          </div>\n        )}\n      </main>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}
{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/avatars/servers/DeletePhotoAvatar.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { createClient } from \"@supabase/supabase-js\";\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\r\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\r\nconst heygenApiKey = process.env.HEYGEN_API_KEY;\r\n\r\nif (!supabaseUrl) {\r\n  throw new Error(\"NEXT_PUBLIC_SUPABASE_URL не задан\");\r\n}\r\n\r\nif (!supabaseServiceRoleKey) {\r\n  throw new Error(\"SUPABASE_SERVICE_ROLE_KEY не задан\");\r\n}\r\n\r\nconst supabaseAdmin = createClient(supabaseUrl, supabaseServiceRoleKey);\r\n\r\ninterface DeletePhotoAvatarInput {\r\n  uid: string;\r\n  recordId?: string | null;\r\n  groupId?: string | null;\r\n  imageKey?: string | null;\r\n}\r\n\r\ninterface DeletePhotoAvatarResult {\r\n  success: boolean;\r\n  error?: string;\r\n}\r\n\r\nasync function deleteFromHeygen(groupId?: string | null) {\r\n  if (!groupId) {\r\n    return;\r\n  }\r\n\r\n  if (!heygenApiKey) {\r\n    throw new Error(\"HEYGEN_API_KEY не задан\");\r\n  }\r\n\r\n  const response = await fetch(\r\n    `https://api.heygen.com/v2/photo_avatar_group/${groupId}`,\r\n    {\r\n      method: \"DELETE\",\r\n      headers: {\r\n        \"X-Api-Key\": heygenApiKey,\r\n      },\r\n    }\r\n  );\r\n\r\n  if (!response.ok && response.status !== 404) {\r\n    const message = await response.text();\r\n    throw new Error(\r\n      `Не удалось удалить аватар в HeyGen: ${message || response.statusText}`\r\n    );\r\n  }\r\n}\r\n\r\nexport async function DeletePhotoAvatar({\r\n  uid,\r\n  recordId,\r\n  groupId,\r\n  imageKey,\r\n}: DeletePhotoAvatarInput): Promise<DeletePhotoAvatarResult> {\r\n  try {\r\n    if (!uid) {\r\n      return { success: false, error: \"Пользователь не найден\" };\r\n    }\r\n\r\n    if (!recordId && !groupId && !imageKey) {\r\n      return { success: false, error: \"Нет идентификатора записи\" };\r\n    }\r\n\r\n    await deleteFromHeygen(groupId);\r\n\r\n    let query = supabaseAdmin.from(\"photo_avatars\").delete().eq(\"uid\", uid);\r\n\r\n    if (recordId) {\r\n      query = query.eq(\"id\", recordId);\r\n    } else if (groupId) {\r\n      query = query.eq(\"group_id\", groupId);\r\n    } else if (imageKey) {\r\n      query = query.eq(\"image_key\", imageKey);\r\n    }\r\n\r\n    const { error } = await query;\r\n\r\n    if (error) {\r\n      throw new Error(error.message);\r\n    }\r\n\r\n    return { success: true };\r\n  } catch (error) {\r\n    const message =\r\n      error instanceof Error ? error.message : \"Неизвестная ошибка\";\r\n    console.error(\"[DeletePhotoAvatar]\", message);\r\n    return { success: false, error: message };\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":[],"mappings":";;;;;AAEA;;;;AAEA,MAAM;AACN,MAAM,yBAAyB,QAAQ,GAAG,CAAC,yBAAyB;AACpE,MAAM,eAAe,QAAQ,GAAG,CAAC,cAAc;AAE/C;;AAIA,IAAI,CAAC,wBAAwB;IAC3B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,gBAAgB,IAAA,uMAAY,EAAC,aAAa;AAchD,eAAe,iBAAiB,OAAuB;IACrD,IAAI,CAAC,SAAS;QACZ;IACF;IAEA,IAAI,CAAC,cAAc;QACjB,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,WAAW,MAAM,MACrB,CAAC,6CAA6C,EAAE,SAAS,EACzD;QACE,QAAQ;QACR,SAAS;YACP,aAAa;QACf;IACF;IAGF,IAAI,CAAC,SAAS,EAAE,IAAI,SAAS,MAAM,KAAK,KAAK;QAC3C,MAAM,UAAU,MAAM,SAAS,IAAI;QACnC,MAAM,IAAI,MACR,CAAC,oCAAoC,EAAE,WAAW,SAAS,UAAU,EAAE;IAE3E;AACF;AAEO,eAAe,kBAAkB,EACtC,GAAG,EACH,QAAQ,EACR,OAAO,EACP,QAAQ,EACe;IACvB,IAAI;QACF,IAAI,CAAC,KAAK;YACR,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAyB;QAC3D;QAEA,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,UAAU;YACtC,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAA4B;QAC9D;QAEA,MAAM,iBAAiB;QAEvB,IAAI,QAAQ,cAAc,IAAI,CAAC,iBAAiB,MAAM,GAAG,EAAE,CAAC,OAAO;QAEnE,IAAI,UAAU;YACZ,QAAQ,MAAM,EAAE,CAAC,MAAM;QACzB,OAAO,IAAI,SAAS;YAClB,QAAQ,MAAM,EAAE,CAAC,YAAY;QAC/B,OAAO,IAAI,UAAU;YACnB,QAAQ,MAAM,EAAE,CAAC,aAAa;QAChC;QAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM;QAExB,IAAI,OAAO;YACT,MAAM,IAAI,MAAM,MAAM,OAAO;QAC/B;QAEA,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,OAAO;QACd,MAAM,UACJ,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAC3C,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO;YAAE,SAAS;YAAO,OAAO;QAAQ;IAC1C;AACF;;;IAxCsB;;AAAA,+OAAA"}},
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/avatars/servers/UpdateAvatarName.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { createClient } from \"@supabase/supabase-js\";\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\r\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\r\n\r\nif (!supabaseUrl) {\r\n  throw new Error(\"NEXT_PUBLIC_SUPABASE_URL не задан\");\r\n}\r\n\r\nif (!supabaseServiceRoleKey) {\r\n  throw new Error(\"SUPABASE_SERVICE_ROLE_KEY не задан\");\r\n}\r\n\r\nconst supabaseAdmin = createClient(supabaseUrl, supabaseServiceRoleKey);\r\n\r\ninterface UpdateAvatarNameInput {\r\n  uid: string;\r\n  recordId: string;\r\n  newName: string;\r\n}\r\n\r\ninterface UpdateAvatarNameResult {\r\n  success: boolean;\r\n  error?: string;\r\n}\r\n\r\nexport async function UpdateAvatarName({\r\n  uid,\r\n  recordId,\r\n  newName,\r\n}: UpdateAvatarNameInput): Promise<UpdateAvatarNameResult> {\r\n  try {\r\n    if (!uid) {\r\n      return { success: false, error: \"Пользователь не найден\" };\r\n    }\r\n\r\n    if (!recordId) {\r\n      return { success: false, error: \"ID записи не указан\" };\r\n    }\r\n\r\n    if (!newName || !newName.trim()) {\r\n      return { success: false, error: \"Имя не может быть пустым\" };\r\n    }\r\n\r\n    const trimmedName = newName.trim();\r\n\r\n    const { error } = await supabaseAdmin\r\n      .from(\"photo_avatars\")\r\n      .update({ name: trimmedName })\r\n      .eq(\"id\", recordId)\r\n      .eq(\"uid\", uid);\r\n\r\n    if (error) {\r\n      throw new Error(error.message);\r\n    }\r\n\r\n    return { success: true };\r\n  } catch (error) {\r\n    const message =\r\n      error instanceof Error ? error.message : \"Неизвестная ошибка\";\r\n    console.error(\"[UpdateAvatarName]\", message);\r\n    return { success: false, error: message };\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n"],"names":[],"mappings":";;;;;AAEA;;;;AAEA,MAAM;AACN,MAAM,yBAAyB,QAAQ,GAAG,CAAC,yBAAyB;AAEpE;;AAIA,IAAI,CAAC,wBAAwB;IAC3B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,gBAAgB,IAAA,uMAAY,EAAC,aAAa;AAazC,eAAe,iBAAiB,EACrC,GAAG,EACH,QAAQ,EACR,OAAO,EACe;IACtB,IAAI;QACF,IAAI,CAAC,KAAK;YACR,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAyB;QAC3D;QAEA,IAAI,CAAC,UAAU;YACb,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAsB;QACxD;QAEA,IAAI,CAAC,WAAW,CAAC,QAAQ,IAAI,IAAI;YAC/B,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAA2B;QAC7D;QAEA,MAAM,cAAc,QAAQ,IAAI;QAEhC,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,cACrB,IAAI,CAAC,iBACL,MAAM,CAAC;YAAE,MAAM;QAAY,GAC3B,EAAE,CAAC,MAAM,UACT,EAAE,CAAC,OAAO;QAEb,IAAI,OAAO;YACT,MAAM,IAAI,MAAM,MAAM,OAAO;QAC/B;QAEA,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,OAAO;QACd,MAAM,UACJ,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAC3C,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO;YAAE,SAAS;YAAO,OAAO;QAAQ;IAC1C;AACF;;;IArCsB;;AAAA,+OAAA"}},
    {"offset": {"line": 153, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/voices/servers/DeleteVoice.ts"],"sourcesContent":["\"use server\";\n\nimport { createClient } from \"@supabase/supabase-js\";\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\nif (!supabaseUrl) {\n  throw new Error(\"NEXT_PUBLIC_SUPABASE_URL не задан\");\n}\n\nif (!supabaseServiceRoleKey) {\n  throw new Error(\"SUPABASE_SERVICE_ROLE_KEY не задан\");\n}\n\nconst supabaseAdmin = createClient(supabaseUrl, supabaseServiceRoleKey);\n\ninterface DeleteVoiceInput {\n  uid: string;\n  voiceId: string;\n}\n\ninterface DeleteVoiceResult {\n  success: boolean;\n  error?: string;\n}\n\nexport async function DeleteVoice({\n  uid,\n  voiceId,\n}: DeleteVoiceInput): Promise<DeleteVoiceResult> {\n  try {\n    if (!uid) {\n      return { success: false, error: \"Пользователь не найден\" };\n    }\n\n    if (!voiceId) {\n      return { success: false, error: \"ID голоса не указан\" };\n    }\n\n    // Сначала получаем запись из таблицы, чтобы извлечь voice_id и название голоса\n    const { data: voiceRecord, error: fetchError } = await supabaseAdmin\n      .from(\"voices\")\n      .select(\"voice_id, name\")\n      .eq(\"id\", voiceId)\n      .eq(\"uid\", uid)\n      .single();\n\n    if (fetchError) {\n      throw new Error(`Не удалось найти голос: ${fetchError.message}`);\n    }\n\n    if (!voiceRecord || !voiceRecord.voice_id) {\n      throw new Error(\"Не найдено значение voice_id для этого голоса\");\n    }\n\n    // Отправляем вебхук с voice_id, названием голоса и UUID пользователя\n    const webhookResponse = await fetch(\n      \"https://rueleven.ru/webhook/932aee6f-b554-45e9-b232-f7829b0a1d06\",\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ \n          voice_id: voiceRecord.voice_id,\n          voice_name: voiceRecord.name || null,\n          uuid: uid,\n        }),\n      }\n    );\n\n    if (!webhookResponse.ok) {\n      const message = await webhookResponse.text();\n      throw new Error(\n        `Не удалось отправить вебхук: ${\n          message || webhookResponse.statusText\n        }`\n      );\n    }\n\n    // Удаляем запись из таблицы\n    const { error } = await supabaseAdmin\n      .from(\"voices\")\n      .delete()\n      .eq(\"id\", voiceId)\n      .eq(\"uid\", uid);\n\n    if (error) {\n      throw new Error(error.message);\n    }\n\n    return { success: true };\n  } catch (error) {\n    const message =\n      error instanceof Error ? error.message : \"Неизвестная ошибка\";\n    console.error(\"[DeleteVoice]\", message);\n    return { success: false, error: message };\n  }\n}\n\n\n"],"names":[],"mappings":";;;;;AAEA;;;;AAEA,MAAM;AACN,MAAM,yBAAyB,QAAQ,GAAG,CAAC,yBAAyB;AAEpE;;AAIA,IAAI,CAAC,wBAAwB;IAC3B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,gBAAgB,IAAA,uMAAY,EAAC,aAAa;AAYzC,eAAe,YAAY,EAChC,GAAG,EACH,OAAO,EACU;IACjB,IAAI;QACF,IAAI,CAAC,KAAK;YACR,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAyB;QAC3D;QAEA,IAAI,CAAC,SAAS;YACZ,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAsB;QACxD;QAEA,+EAA+E;QAC/E,MAAM,EAAE,MAAM,WAAW,EAAE,OAAO,UAAU,EAAE,GAAG,MAAM,cACpD,IAAI,CAAC,UACL,MAAM,CAAC,kBACP,EAAE,CAAC,MAAM,SACT,EAAE,CAAC,OAAO,KACV,MAAM;QAET,IAAI,YAAY;YACd,MAAM,IAAI,MAAM,CAAC,wBAAwB,EAAE,WAAW,OAAO,EAAE;QACjE;QAEA,IAAI,CAAC,eAAe,CAAC,YAAY,QAAQ,EAAE;YACzC,MAAM,IAAI,MAAM;QAClB;QAEA,qEAAqE;QACrE,MAAM,kBAAkB,MAAM,MAC5B,oEACA;YACE,QAAQ;YACR,SAAS;gBACP,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,UAAU,YAAY,QAAQ;gBAC9B,YAAY,YAAY,IAAI,IAAI;gBAChC,MAAM;YACR;QACF;QAGF,IAAI,CAAC,gBAAgB,EAAE,EAAE;YACvB,MAAM,UAAU,MAAM,gBAAgB,IAAI;YAC1C,MAAM,IAAI,MACR,CAAC,6BAA6B,EAC5B,WAAW,gBAAgB,UAAU,EACrC;QAEN;QAEA,4BAA4B;QAC5B,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,cACrB,IAAI,CAAC,UACL,MAAM,GACN,EAAE,CAAC,MAAM,SACT,EAAE,CAAC,OAAO;QAEb,IAAI,OAAO;YACT,MAAM,IAAI,MAAM,MAAM,OAAO;QAC/B;QAEA,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,OAAO;QACd,MAAM,UACJ,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAC3C,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO;YAAE,SAAS;YAAO,OAAO;QAAQ;IAC1C;AACF;;;IAxEsB;;AAAA,+OAAA"}},
    {"offset": {"line": 234, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/app/voices/servers/UpdateVoice.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { createClient } from \"@supabase/supabase-js\";\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\r\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\r\n\r\nif (!supabaseUrl) {\r\n  throw new Error(\"NEXT_PUBLIC_SUPABASE_URL не задан\");\r\n}\r\n\r\nif (!supabaseServiceRoleKey) {\r\n  throw new Error(\"SUPABASE_SERVICE_ROLE_KEY не задан\");\r\n}\r\n\r\nconst supabaseAdmin = createClient(supabaseUrl, supabaseServiceRoleKey);\r\n\r\ninterface UpdateVoiceInput {\r\n  uid: string;\r\n  voiceId: string;\r\n  name: string;\r\n  description?: string | null;\r\n}\r\n\r\ninterface UpdateVoiceResult {\r\n  success: boolean;\r\n  error?: string;\r\n}\r\n\r\nexport async function UpdateVoice({\r\n  uid,\r\n  voiceId,\r\n  name,\r\n  description,\r\n}: UpdateVoiceInput): Promise<UpdateVoiceResult> {\r\n  try {\r\n    if (!uid) {\r\n      return { success: false, error: \"Пользователь не найден\" };\r\n    }\r\n\r\n    if (!voiceId) {\r\n      return { success: false, error: \"ID голоса не указан\" };\r\n    }\r\n\r\n    if (!name || !name.trim()) {\r\n      return { success: false, error: \"Имя не может быть пустым\" };\r\n    }\r\n\r\n    const trimmedName = name.trim();\r\n    const trimmedDescription = description?.trim();\r\n\r\n    const { error } = await supabaseAdmin\r\n      .from(\"voices\")\r\n      .update({\r\n        name: trimmedName,\r\n        description: trimmedDescription || null,\r\n      })\r\n      .eq(\"id\", voiceId)\r\n      .eq(\"uid\", uid);\r\n\r\n    if (error) {\r\n      throw new Error(error.message);\r\n    }\r\n\r\n    return { success: true };\r\n  } catch (error) {\r\n    const message =\r\n      error instanceof Error ? error.message : \"Неизвестная ошибка\";\r\n    console.error(\"[UpdateVoice]\", message);\r\n    return { success: false, error: message };\r\n  }\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;;AAEA;;;;AAEA,MAAM;AACN,MAAM,yBAAyB,QAAQ,GAAG,CAAC,yBAAyB;AAEpE;;AAIA,IAAI,CAAC,wBAAwB;IAC3B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,gBAAgB,IAAA,uMAAY,EAAC,aAAa;AAczC,eAAe,YAAY,EAChC,GAAG,EACH,OAAO,EACP,IAAI,EACJ,WAAW,EACM;IACjB,IAAI;QACF,IAAI,CAAC,KAAK;YACR,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAyB;QAC3D;QAEA,IAAI,CAAC,SAAS;YACZ,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAsB;QACxD;QAEA,IAAI,CAAC,QAAQ,CAAC,KAAK,IAAI,IAAI;YACzB,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAA2B;QAC7D;QAEA,MAAM,cAAc,KAAK,IAAI;QAC7B,MAAM,qBAAqB,aAAa;QAExC,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,cACrB,IAAI,CAAC,UACL,MAAM,CAAC;YACN,MAAM;YACN,aAAa,sBAAsB;QACrC,GACC,EAAE,CAAC,MAAM,SACT,EAAE,CAAC,OAAO;QAEb,IAAI,OAAO;YACT,MAAM,IAAI,MAAM,MAAM,OAAO;QAC/B;QAEA,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,OAAO;QACd,MAAM,UACJ,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAC3C,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO;YAAE,SAAS;YAAO,OAAO;QAAQ;IAC1C;AACF;;;IA1CsB;;AAAA,+OAAA"}},
    {"offset": {"line": 301, "column": 0}, "map": {"version":3,"sources":["file:///G:/apps/Dev/avatars_new/front/.next-internal/server/app/%28main%29/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {DeletePhotoAvatar as '404ef6fa38aced2d34bba744ff0fb1ae23c6121202'} from 'ACTIONS_MODULE0'\nexport {UpdateAvatarName as '406d5b6e083f7879367c2bfcb42f10d02bcd7af836'} from 'ACTIONS_MODULE1'\nexport {DeleteVoice as '40283b640ad833f930e378e3009dbbd29e474a640a'} from 'ACTIONS_MODULE2'\nexport {UpdateVoice as '40db8994e698b2000fa8f50a7e0d97e8cf222ef9c0'} from 'ACTIONS_MODULE3'\n"],"names":[],"mappings":";AAAA;AACA;AACA;AACA"}}]
}